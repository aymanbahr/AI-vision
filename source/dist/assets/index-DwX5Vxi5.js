var J6=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var aIe=J6((fIe,BW)=>{function O3(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const a=Object.getOwnPropertyDescriptor(r,s);a&&Object.defineProperty(n,s,a.get?a:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function F3(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function RN(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var nS={exports:{}},vp={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bD;function eH(){if(bD)return vp;bD=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,s,a){var o=null;if(a!==void 0&&(o=""+a),s.key!==void 0&&(o=""+s.key),"key"in s){a={};for(var i in s)i!=="key"&&(a[i]=s[i])}else a=s;return s=a.ref,{$$typeof:n,type:r,key:o,ref:s!==void 0?s:null,props:a}}return vp.Fragment=e,vp.jsx=t,vp.jsxs=t,vp}var xD;function tH(){return xD||(xD=1,nS.exports=eH()),nS.exports}var ne=tH(),rS={exports:{}},xt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wD;function nH(){if(wD)return xt;wD=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),o=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),d=Symbol.iterator;function p(L){return L===null||typeof L!="object"?null:(L=d&&L[d]||L["@@iterator"],typeof L=="function"?L:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,b={};function y(L,K,J){this.props=L,this.context=K,this.refs=b,this.updater=J||m}y.prototype.isReactComponent={},y.prototype.setState=function(L,K){if(typeof L!="object"&&typeof L!="function"&&L!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,L,K,"setState")},y.prototype.forceUpdate=function(L){this.updater.enqueueForceUpdate(this,L,"forceUpdate")};function w(){}w.prototype=y.prototype;function S(L,K,J){this.props=L,this.context=K,this.refs=b,this.updater=J||m}var N=S.prototype=new w;N.constructor=S,v(N,y.prototype),N.isPureReactComponent=!0;var C=Array.isArray,T={H:null,A:null,T:null,S:null,V:null},E=Object.prototype.hasOwnProperty;function $(L,K,J,Z,le,pe){return J=pe.ref,{$$typeof:n,type:L,key:K,ref:J!==void 0?J:null,props:pe}}function _(L,K){return $(L.type,K,void 0,void 0,void 0,L.props)}function R(L){return typeof L=="object"&&L!==null&&L.$$typeof===n}function D(L){var K={"=":"=0",":":"=2"};return"$"+L.replace(/[=:]/g,function(J){return K[J]})}var A=/\/+/g;function M(L,K){return typeof L=="object"&&L!==null&&L.key!=null?D(""+L.key):K.toString(36)}function H(){}function j(L){switch(L.status){case"fulfilled":return L.value;case"rejected":throw L.reason;default:switch(typeof L.status=="string"?L.then(H,H):(L.status="pending",L.then(function(K){L.status==="pending"&&(L.status="fulfilled",L.value=K)},function(K){L.status==="pending"&&(L.status="rejected",L.reason=K)})),L.status){case"fulfilled":return L.value;case"rejected":throw L.reason}}throw L}function G(L,K,J,Z,le){var pe=typeof L;(pe==="undefined"||pe==="boolean")&&(L=null);var ge=!1;if(L===null)ge=!0;else switch(pe){case"bigint":case"string":case"number":ge=!0;break;case"object":switch(L.$$typeof){case n:case e:ge=!0;break;case c:return ge=L._init,G(ge(L._payload),K,J,Z,le)}}if(ge)return le=le(L),ge=Z===""?"."+M(L,0):Z,C(le)?(J="",ge!=null&&(J=ge.replace(A,"$&/")+"/"),G(le,K,J,"",function($e){return $e})):le!=null&&(R(le)&&(le=_(le,J+(le.key==null||L&&L.key===le.key?"":(""+le.key).replace(A,"$&/")+"/")+ge)),K.push(le)),1;ge=0;var Ce=Z===""?".":Z+":";if(C(L))for(var Ie=0;Ie<L.length;Ie++)Z=L[Ie],pe=Ce+M(Z,Ie),ge+=G(Z,K,J,pe,le);else if(Ie=p(L),typeof Ie=="function")for(L=Ie.call(L),Ie=0;!(Z=L.next()).done;)Z=Z.value,pe=Ce+M(Z,Ie++),ge+=G(Z,K,J,pe,le);else if(pe==="object"){if(typeof L.then=="function")return G(j(L),K,J,Z,le);throw K=String(L),Error("Objects are not valid as a React child (found: "+(K==="[object Object]"?"object with keys {"+Object.keys(L).join(", ")+"}":K)+"). If you meant to render a collection of children, use an array instead.")}return ge}function P(L,K,J){if(L==null)return L;var Z=[],le=0;return G(L,Z,"","",function(pe){return K.call(J,pe,le++)}),Z}function V(L){if(L._status===-1){var K=L._result;K=K(),K.then(function(J){(L._status===0||L._status===-1)&&(L._status=1,L._result=J)},function(J){(L._status===0||L._status===-1)&&(L._status=2,L._result=J)}),L._status===-1&&(L._status=0,L._result=K)}if(L._status===1)return L._result.default;throw L._result}var z=typeof reportError=="function"?reportError:function(L){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var K=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof L=="object"&&L!==null&&typeof L.message=="string"?String(L.message):String(L),error:L});if(!window.dispatchEvent(K))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",L);return}console.error(L)};function Y(){}return xt.Children={map:P,forEach:function(L,K,J){P(L,function(){K.apply(this,arguments)},J)},count:function(L){var K=0;return P(L,function(){K++}),K},toArray:function(L){return P(L,function(K){return K})||[]},only:function(L){if(!R(L))throw Error("React.Children.only expected to receive a single React element child.");return L}},xt.Component=y,xt.Fragment=t,xt.Profiler=s,xt.PureComponent=S,xt.StrictMode=r,xt.Suspense=u,xt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=T,xt.__COMPILER_RUNTIME={__proto__:null,c:function(L){return T.H.useMemoCache(L)}},xt.cache=function(L){return function(){return L.apply(null,arguments)}},xt.cloneElement=function(L,K,J){if(L==null)throw Error("The argument must be a React element, but you passed "+L+".");var Z=v({},L.props),le=L.key,pe=void 0;if(K!=null)for(ge in K.ref!==void 0&&(pe=void 0),K.key!==void 0&&(le=""+K.key),K)!E.call(K,ge)||ge==="key"||ge==="__self"||ge==="__source"||ge==="ref"&&K.ref===void 0||(Z[ge]=K[ge]);var ge=arguments.length-2;if(ge===1)Z.children=J;else if(1<ge){for(var Ce=Array(ge),Ie=0;Ie<ge;Ie++)Ce[Ie]=arguments[Ie+2];Z.children=Ce}return $(L.type,le,void 0,void 0,pe,Z)},xt.createContext=function(L){return L={$$typeof:o,_currentValue:L,_currentValue2:L,_threadCount:0,Provider:null,Consumer:null},L.Provider=L,L.Consumer={$$typeof:a,_context:L},L},xt.createElement=function(L,K,J){var Z,le={},pe=null;if(K!=null)for(Z in K.key!==void 0&&(pe=""+K.key),K)E.call(K,Z)&&Z!=="key"&&Z!=="__self"&&Z!=="__source"&&(le[Z]=K[Z]);var ge=arguments.length-2;if(ge===1)le.children=J;else if(1<ge){for(var Ce=Array(ge),Ie=0;Ie<ge;Ie++)Ce[Ie]=arguments[Ie+2];le.children=Ce}if(L&&L.defaultProps)for(Z in ge=L.defaultProps,ge)le[Z]===void 0&&(le[Z]=ge[Z]);return $(L,pe,void 0,void 0,null,le)},xt.createRef=function(){return{current:null}},xt.forwardRef=function(L){return{$$typeof:i,render:L}},xt.isValidElement=R,xt.lazy=function(L){return{$$typeof:c,_payload:{_status:-1,_result:L},_init:V}},xt.memo=function(L,K){return{$$typeof:l,type:L,compare:K===void 0?null:K}},xt.startTransition=function(L){var K=T.T,J={};T.T=J;try{var Z=L(),le=T.S;le!==null&&le(J,Z),typeof Z=="object"&&Z!==null&&typeof Z.then=="function"&&Z.then(Y,z)}catch(pe){z(pe)}finally{T.T=K}},xt.unstable_useCacheRefresh=function(){return T.H.useCacheRefresh()},xt.use=function(L){return T.H.use(L)},xt.useActionState=function(L,K,J){return T.H.useActionState(L,K,J)},xt.useCallback=function(L,K){return T.H.useCallback(L,K)},xt.useContext=function(L){return T.H.useContext(L)},xt.useDebugValue=function(){},xt.useDeferredValue=function(L,K){return T.H.useDeferredValue(L,K)},xt.useEffect=function(L,K,J){var Z=T.H;if(typeof J=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Z.useEffect(L,K)},xt.useId=function(){return T.H.useId()},xt.useImperativeHandle=function(L,K,J){return T.H.useImperativeHandle(L,K,J)},xt.useInsertionEffect=function(L,K){return T.H.useInsertionEffect(L,K)},xt.useLayoutEffect=function(L,K){return T.H.useLayoutEffect(L,K)},xt.useMemo=function(L,K){return T.H.useMemo(L,K)},xt.useOptimistic=function(L,K){return T.H.useOptimistic(L,K)},xt.useReducer=function(L,K,J){return T.H.useReducer(L,K,J)},xt.useRef=function(L){return T.H.useRef(L)},xt.useState=function(L){return T.H.useState(L)},xt.useSyncExternalStore=function(L,K,J){return T.H.useSyncExternalStore(L,K,J)},xt.useTransition=function(){return T.H.useTransition()},xt.version="19.1.0",xt}var SD;function AN(){return SD||(SD=1,rS.exports=nH()),rS.exports}var _e=AN();const ci=F3(_e),M3=O3({__proto__:null,default:ci},[_e]);var sS={exports:{}},yp={},aS={exports:{}},oS={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CD;function rH(){return CD||(CD=1,function(n){function e(P,V){var z=P.length;P.push(V);e:for(;0<z;){var Y=z-1>>>1,L=P[Y];if(0<s(L,V))P[Y]=V,P[z]=L,z=Y;else break e}}function t(P){return P.length===0?null:P[0]}function r(P){if(P.length===0)return null;var V=P[0],z=P.pop();if(z!==V){P[0]=z;e:for(var Y=0,L=P.length,K=L>>>1;Y<K;){var J=2*(Y+1)-1,Z=P[J],le=J+1,pe=P[le];if(0>s(Z,z))le<L&&0>s(pe,Z)?(P[Y]=pe,P[le]=z,Y=le):(P[Y]=Z,P[J]=z,Y=J);else if(le<L&&0>s(pe,z))P[Y]=pe,P[le]=z,Y=le;else break e}}return V}function s(P,V){var z=P.sortIndex-V.sortIndex;return z!==0?z:P.id-V.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var o=Date,i=o.now();n.unstable_now=function(){return o.now()-i}}var u=[],l=[],c=1,d=null,p=3,m=!1,v=!1,b=!1,y=!1,w=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,N=typeof setImmediate<"u"?setImmediate:null;function C(P){for(var V=t(l);V!==null;){if(V.callback===null)r(l);else if(V.startTime<=P)r(l),V.sortIndex=V.expirationTime,e(u,V);else break;V=t(l)}}function T(P){if(b=!1,C(P),!v)if(t(u)!==null)v=!0,E||(E=!0,M());else{var V=t(l);V!==null&&G(T,V.startTime-P)}}var E=!1,$=-1,_=5,R=-1;function D(){return y?!0:!(n.unstable_now()-R<_)}function A(){if(y=!1,E){var P=n.unstable_now();R=P;var V=!0;try{e:{v=!1,b&&(b=!1,S($),$=-1),m=!0;var z=p;try{t:{for(C(P),d=t(u);d!==null&&!(d.expirationTime>P&&D());){var Y=d.callback;if(typeof Y=="function"){d.callback=null,p=d.priorityLevel;var L=Y(d.expirationTime<=P);if(P=n.unstable_now(),typeof L=="function"){d.callback=L,C(P),V=!0;break t}d===t(u)&&r(u),C(P)}else r(u);d=t(u)}if(d!==null)V=!0;else{var K=t(l);K!==null&&G(T,K.startTime-P),V=!1}}break e}finally{d=null,p=z,m=!1}V=void 0}}finally{V?M():E=!1}}}var M;if(typeof N=="function")M=function(){N(A)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,j=H.port2;H.port1.onmessage=A,M=function(){j.postMessage(null)}}else M=function(){w(A,0)};function G(P,V){$=w(function(){P(n.unstable_now())},V)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(P){P.callback=null},n.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<P?Math.floor(1e3/P):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_next=function(P){switch(p){case 1:case 2:case 3:var V=3;break;default:V=p}var z=p;p=V;try{return P()}finally{p=z}},n.unstable_requestPaint=function(){y=!0},n.unstable_runWithPriority=function(P,V){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var z=p;p=P;try{return V()}finally{p=z}},n.unstable_scheduleCallback=function(P,V,z){var Y=n.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?Y+z:Y):z=Y,P){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=z+L,P={id:c++,callback:V,priorityLevel:P,startTime:z,expirationTime:L,sortIndex:-1},z>Y?(P.sortIndex=z,e(l,P),t(u)===null&&P===t(l)&&(b?(S($),$=-1):b=!0,G(T,z-Y))):(P.sortIndex=L,e(u,P),v||m||(v=!0,E||(E=!0,M()))),P},n.unstable_shouldYield=D,n.unstable_wrapCallback=function(P){var V=p;return function(){var z=p;p=V;try{return P.apply(this,arguments)}finally{p=z}}}}(oS)),oS}var ND;function sH(){return ND||(ND=1,aS.exports=rH()),aS.exports}var iS={exports:{}},Xr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kD;function aH(){if(kD)return Xr;kD=1;var n=AN();function e(u){var l="https://react.dev/errors/"+u;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)l+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+u+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function a(u,l,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:d==null?null:""+d,children:u,containerInfo:l,implementation:c}}var o=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function i(u,l){if(u==="font")return"";if(typeof l=="string")return l==="use-credentials"?l:""}return Xr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Xr.createPortal=function(u,l){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)throw Error(e(299));return a(u,l,null,c)},Xr.flushSync=function(u){var l=o.T,c=r.p;try{if(o.T=null,r.p=2,u)return u()}finally{o.T=l,r.p=c,r.d.f()}},Xr.preconnect=function(u,l){typeof u=="string"&&(l?(l=l.crossOrigin,l=typeof l=="string"?l==="use-credentials"?l:"":void 0):l=null,r.d.C(u,l))},Xr.prefetchDNS=function(u){typeof u=="string"&&r.d.D(u)},Xr.preinit=function(u,l){if(typeof u=="string"&&l&&typeof l.as=="string"){var c=l.as,d=i(c,l.crossOrigin),p=typeof l.integrity=="string"?l.integrity:void 0,m=typeof l.fetchPriority=="string"?l.fetchPriority:void 0;c==="style"?r.d.S(u,typeof l.precedence=="string"?l.precedence:void 0,{crossOrigin:d,integrity:p,fetchPriority:m}):c==="script"&&r.d.X(u,{crossOrigin:d,integrity:p,fetchPriority:m,nonce:typeof l.nonce=="string"?l.nonce:void 0})}},Xr.preinitModule=function(u,l){if(typeof u=="string")if(typeof l=="object"&&l!==null){if(l.as==null||l.as==="script"){var c=i(l.as,l.crossOrigin);r.d.M(u,{crossOrigin:c,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0})}}else l==null&&r.d.M(u)},Xr.preload=function(u,l){if(typeof u=="string"&&typeof l=="object"&&l!==null&&typeof l.as=="string"){var c=l.as,d=i(c,l.crossOrigin);r.d.L(u,c,{crossOrigin:d,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0,type:typeof l.type=="string"?l.type:void 0,fetchPriority:typeof l.fetchPriority=="string"?l.fetchPriority:void 0,referrerPolicy:typeof l.referrerPolicy=="string"?l.referrerPolicy:void 0,imageSrcSet:typeof l.imageSrcSet=="string"?l.imageSrcSet:void 0,imageSizes:typeof l.imageSizes=="string"?l.imageSizes:void 0,media:typeof l.media=="string"?l.media:void 0})}},Xr.preloadModule=function(u,l){if(typeof u=="string")if(l){var c=i(l.as,l.crossOrigin);r.d.m(u,{as:typeof l.as=="string"&&l.as!=="script"?l.as:void 0,crossOrigin:c,integrity:typeof l.integrity=="string"?l.integrity:void 0})}else r.d.m(u)},Xr.requestFormReset=function(u){r.d.r(u)},Xr.unstable_batchedUpdates=function(u,l){return u(l)},Xr.useFormState=function(u,l,c){return o.H.useFormState(u,l,c)},Xr.useFormStatus=function(){return o.H.useHostTransitionStatus()},Xr.version="19.1.0",Xr}var TD;function L3(){if(TD)return iS.exports;TD=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),iS.exports=aH(),iS.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ID;function oH(){if(ID)return yp;ID=1;var n=sH(),e=AN(),t=L3();function r(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)f+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function a(h){var f=h,g=h;if(h.alternate)for(;f.return;)f=f.return;else{h=f;do f=h,(f.flags&4098)!==0&&(g=f.return),h=f.return;while(h)}return f.tag===3?g:null}function o(h){if(h.tag===13){var f=h.memoizedState;if(f===null&&(h=h.alternate,h!==null&&(f=h.memoizedState)),f!==null)return f.dehydrated}return null}function i(h){if(a(h)!==h)throw Error(r(188))}function u(h){var f=h.alternate;if(!f){if(f=a(h),f===null)throw Error(r(188));return f!==h?null:h}for(var g=h,x=f;;){var k=g.return;if(k===null)break;var I=k.alternate;if(I===null){if(x=k.return,x!==null){g=x;continue}break}if(k.child===I.child){for(I=k.child;I;){if(I===g)return i(k),h;if(I===x)return i(k),f;I=I.sibling}throw Error(r(188))}if(g.return!==x.return)g=k,x=I;else{for(var F=!1,W=k.child;W;){if(W===g){F=!0,g=k,x=I;break}if(W===x){F=!0,x=k,g=I;break}W=W.sibling}if(!F){for(W=I.child;W;){if(W===g){F=!0,g=I,x=k;break}if(W===x){F=!0,x=I,g=k;break}W=W.sibling}if(!F)throw Error(r(189))}}if(g.alternate!==x)throw Error(r(190))}if(g.tag!==3)throw Error(r(188));return g.stateNode.current===g?h:f}function l(h){var f=h.tag;if(f===5||f===26||f===27||f===6)return h;for(h=h.child;h!==null;){if(f=l(h),f!==null)return f;h=h.sibling}return null}var c=Object.assign,d=Symbol.for("react.element"),p=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),w=Symbol.for("react.provider"),S=Symbol.for("react.consumer"),N=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),$=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),R=Symbol.for("react.activity"),D=Symbol.for("react.memo_cache_sentinel"),A=Symbol.iterator;function M(h){return h===null||typeof h!="object"?null:(h=A&&h[A]||h["@@iterator"],typeof h=="function"?h:null)}var H=Symbol.for("react.client.reference");function j(h){if(h==null)return null;if(typeof h=="function")return h.$$typeof===H?null:h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case v:return"Fragment";case y:return"Profiler";case b:return"StrictMode";case T:return"Suspense";case E:return"SuspenseList";case R:return"Activity"}if(typeof h=="object")switch(h.$$typeof){case m:return"Portal";case N:return(h.displayName||"Context")+".Provider";case S:return(h._context.displayName||"Context")+".Consumer";case C:var f=h.render;return h=h.displayName,h||(h=f.displayName||f.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case $:return f=h.displayName||null,f!==null?f:j(h.type)||"Memo";case _:f=h._payload,h=h._init;try{return j(h(f))}catch{}}return null}var G=Array.isArray,P=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,V=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,z={pending:!1,data:null,method:null,action:null},Y=[],L=-1;function K(h){return{current:h}}function J(h){0>L||(h.current=Y[L],Y[L]=null,L--)}function Z(h,f){L++,Y[L]=h.current,h.current=f}var le=K(null),pe=K(null),ge=K(null),Ce=K(null);function Ie(h,f){switch(Z(ge,f),Z(pe,h),Z(le,null),f.nodeType){case 9:case 11:h=(h=f.documentElement)&&(h=h.namespaceURI)?qA(h):0;break;default:if(h=f.tagName,f=f.namespaceURI)f=qA(f),h=KA(f,h);else switch(h){case"svg":h=1;break;case"math":h=2;break;default:h=0}}J(le),Z(le,h)}function $e(){J(le),J(pe),J(ge)}function Be(h){h.memoizedState!==null&&Z(Ce,h);var f=le.current,g=KA(f,h.type);f!==g&&(Z(pe,h),Z(le,g))}function Oe(h){pe.current===h&&(J(le),J(pe)),Ce.current===h&&(J(Ce),dp._currentValue=z)}var Ve=Object.prototype.hasOwnProperty,Ze=n.unstable_scheduleCallback,lt=n.unstable_cancelCallback,it=n.unstable_shouldYield,ot=n.unstable_requestPaint,pt=n.unstable_now,_t=n.unstable_getCurrentPriorityLevel,hn=n.unstable_ImmediatePriority,en=n.unstable_UserBlockingPriority,Nn=n.unstable_NormalPriority,vn=n.unstable_LowPriority,qn=n.unstable_IdlePriority,Kn=n.log,Bn=n.unstable_setDisableYieldValue,xr=null,Xt=null;function tn(h){if(typeof Kn=="function"&&Bn(h),Xt&&typeof Xt.setStrictMode=="function")try{Xt.setStrictMode(xr,h)}catch{}}var kn=Math.clz32?Math.clz32:xf,tl=Math.log,nl=Math.LN2;function xf(h){return h>>>=0,h===0?32:31-(tl(h)/nl|0)|0}var Us=256,io=4194304;function Ws(h){var f=h&42;if(f!==0)return f;switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return h&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return h}}function hv(h,f,g){var x=h.pendingLanes;if(x===0)return 0;var k=0,I=h.suspendedLanes,F=h.pingedLanes;h=h.warmLanes;var W=x&134217727;return W!==0?(x=W&~I,x!==0?k=Ws(x):(F&=W,F!==0?k=Ws(F):g||(g=W&~h,g!==0&&(k=Ws(g))))):(W=x&~I,W!==0?k=Ws(W):F!==0?k=Ws(F):g||(g=x&~h,g!==0&&(k=Ws(g)))),k===0?0:f!==0&&f!==k&&(f&I)===0&&(I=k&-k,g=f&-f,I>=g||I===32&&(g&4194048)!==0)?f:k}function wf(h,f){return(h.pendingLanes&~(h.suspendedLanes&~h.pingedLanes)&f)===0}function zW(h,f){switch(h){case 1:case 2:case 4:case 8:case 64:return f+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function RE(){var h=Us;return Us<<=1,(Us&4194048)===0&&(Us=256),h}function AE(){var h=io;return io<<=1,(io&62914560)===0&&(io=4194304),h}function H1(h){for(var f=[],g=0;31>g;g++)f.push(h);return f}function Sf(h,f){h.pendingLanes|=f,f!==268435456&&(h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0)}function VW(h,f,g,x,k,I){var F=h.pendingLanes;h.pendingLanes=g,h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0,h.expiredLanes&=g,h.entangledLanes&=g,h.errorRecoveryDisabledLanes&=g,h.shellSuspendCounter=0;var W=h.entanglements,te=h.expirationTimes,me=h.hiddenUpdates;for(g=F&~g;0<g;){var ke=31-kn(g),Ee=1<<ke;W[ke]=0,te[ke]=-1;var ve=me[ke];if(ve!==null)for(me[ke]=null,ke=0;ke<ve.length;ke++){var ye=ve[ke];ye!==null&&(ye.lane&=-536870913)}g&=~Ee}x!==0&&DE(h,x,0),I!==0&&k===0&&h.tag!==0&&(h.suspendedLanes|=I&~(F&~f))}function DE(h,f,g){h.pendingLanes|=f,h.suspendedLanes&=~f;var x=31-kn(f);h.entangledLanes|=f,h.entanglements[x]=h.entanglements[x]|1073741824|g&4194090}function $E(h,f){var g=h.entangledLanes|=f;for(h=h.entanglements;g;){var x=31-kn(g),k=1<<x;k&f|h[x]&f&&(h[x]|=f),g&=~k}}function j1(h){switch(h){case 2:h=1;break;case 8:h=4;break;case 32:h=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:h=128;break;case 268435456:h=134217728;break;default:h=0}return h}function q1(h){return h&=-h,2<h?8<h?(h&134217727)!==0?32:268435456:8:2}function OE(){var h=V.p;return h!==0?h:(h=window.event,h===void 0?32:fD(h.type))}function UW(h,f){var g=V.p;try{return V.p=h,f()}finally{V.p=g}}var Bi=Math.random().toString(36).slice(2),qr="__reactFiber$"+Bi,Cs="__reactProps$"+Bi,_c="__reactContainer$"+Bi,K1="__reactEvents$"+Bi,WW="__reactListeners$"+Bi,GW="__reactHandles$"+Bi,FE="__reactResources$"+Bi,Cf="__reactMarker$"+Bi;function X1(h){delete h[qr],delete h[Cs],delete h[K1],delete h[WW],delete h[GW]}function Rc(h){var f=h[qr];if(f)return f;for(var g=h.parentNode;g;){if(f=g[_c]||g[qr]){if(g=f.alternate,f.child!==null||g!==null&&g.child!==null)for(h=QA(h);h!==null;){if(g=h[qr])return g;h=QA(h)}return f}h=g,g=h.parentNode}return null}function Ac(h){if(h=h[qr]||h[_c]){var f=h.tag;if(f===5||f===6||f===13||f===26||f===27||f===3)return h}return null}function Nf(h){var f=h.tag;if(f===5||f===26||f===27||f===6)return h.stateNode;throw Error(r(33))}function Dc(h){var f=h[FE];return f||(f=h[FE]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function wr(h){h[Cf]=!0}var ME=new Set,LE={};function rl(h,f){$c(h,f),$c(h+"Capture",f)}function $c(h,f){for(LE[h]=f,h=0;h<f.length;h++)ME.add(f[h])}var HW=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),PE={},BE={};function jW(h){return Ve.call(BE,h)?!0:Ve.call(PE,h)?!1:HW.test(h)?BE[h]=!0:(PE[h]=!0,!1)}function dv(h,f,g){if(jW(f))if(g===null)h.removeAttribute(f);else{switch(typeof g){case"undefined":case"function":case"symbol":h.removeAttribute(f);return;case"boolean":var x=f.toLowerCase().slice(0,5);if(x!=="data-"&&x!=="aria-"){h.removeAttribute(f);return}}h.setAttribute(f,""+g)}}function fv(h,f,g){if(g===null)h.removeAttribute(f);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(f);return}h.setAttribute(f,""+g)}}function jo(h,f,g,x){if(x===null)h.removeAttribute(g);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(g);return}h.setAttributeNS(f,g,""+x)}}var Y1,zE;function Oc(h){if(Y1===void 0)try{throw Error()}catch(g){var f=g.stack.trim().match(/\n( *(at )?)/);Y1=f&&f[1]||"",zE=-1<g.stack.indexOf(`
    at`)?" (<anonymous>)":-1<g.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Y1+h+zE}var Z1=!1;function Q1(h,f){if(!h||Z1)return"";Z1=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var x={DetermineComponentFrameRoot:function(){try{if(f){var Ee=function(){throw Error()};if(Object.defineProperty(Ee.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ee,[])}catch(ye){var ve=ye}Reflect.construct(h,[],Ee)}else{try{Ee.call()}catch(ye){ve=ye}h.call(Ee.prototype)}}else{try{throw Error()}catch(ye){ve=ye}(Ee=h())&&typeof Ee.catch=="function"&&Ee.catch(function(){})}}catch(ye){if(ye&&ve&&typeof ye.stack=="string")return[ye.stack,ve.stack]}return[null,null]}};x.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var k=Object.getOwnPropertyDescriptor(x.DetermineComponentFrameRoot,"name");k&&k.configurable&&Object.defineProperty(x.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var I=x.DetermineComponentFrameRoot(),F=I[0],W=I[1];if(F&&W){var te=F.split(`
`),me=W.split(`
`);for(k=x=0;x<te.length&&!te[x].includes("DetermineComponentFrameRoot");)x++;for(;k<me.length&&!me[k].includes("DetermineComponentFrameRoot");)k++;if(x===te.length||k===me.length)for(x=te.length-1,k=me.length-1;1<=x&&0<=k&&te[x]!==me[k];)k--;for(;1<=x&&0<=k;x--,k--)if(te[x]!==me[k]){if(x!==1||k!==1)do if(x--,k--,0>k||te[x]!==me[k]){var ke=`
`+te[x].replace(" at new "," at ");return h.displayName&&ke.includes("<anonymous>")&&(ke=ke.replace("<anonymous>",h.displayName)),ke}while(1<=x&&0<=k);break}}}finally{Z1=!1,Error.prepareStackTrace=g}return(g=h?h.displayName||h.name:"")?Oc(g):""}function qW(h){switch(h.tag){case 26:case 27:case 5:return Oc(h.type);case 16:return Oc("Lazy");case 13:return Oc("Suspense");case 19:return Oc("SuspenseList");case 0:case 15:return Q1(h.type,!1);case 11:return Q1(h.type.render,!1);case 1:return Q1(h.type,!0);case 31:return Oc("Activity");default:return""}}function VE(h){try{var f="";do f+=qW(h),h=h.return;while(h);return f}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}function da(h){switch(typeof h){case"bigint":case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function UE(h){var f=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function KW(h){var f=UE(h)?"checked":"value",g=Object.getOwnPropertyDescriptor(h.constructor.prototype,f),x=""+h[f];if(!h.hasOwnProperty(f)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var k=g.get,I=g.set;return Object.defineProperty(h,f,{configurable:!0,get:function(){return k.call(this)},set:function(F){x=""+F,I.call(this,F)}}),Object.defineProperty(h,f,{enumerable:g.enumerable}),{getValue:function(){return x},setValue:function(F){x=""+F},stopTracking:function(){h._valueTracker=null,delete h[f]}}}}function pv(h){h._valueTracker||(h._valueTracker=KW(h))}function WE(h){if(!h)return!1;var f=h._valueTracker;if(!f)return!0;var g=f.getValue(),x="";return h&&(x=UE(h)?h.checked?"true":"false":h.value),h=x,h!==g?(f.setValue(h),!0):!1}function mv(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}var XW=/[\n"\\]/g;function fa(h){return h.replace(XW,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function J1(h,f,g,x,k,I,F,W){h.name="",F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"?h.type=F:h.removeAttribute("type"),f!=null?F==="number"?(f===0&&h.value===""||h.value!=f)&&(h.value=""+da(f)):h.value!==""+da(f)&&(h.value=""+da(f)):F!=="submit"&&F!=="reset"||h.removeAttribute("value"),f!=null?ew(h,F,da(f)):g!=null?ew(h,F,da(g)):x!=null&&h.removeAttribute("value"),k==null&&I!=null&&(h.defaultChecked=!!I),k!=null&&(h.checked=k&&typeof k!="function"&&typeof k!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?h.name=""+da(W):h.removeAttribute("name")}function GE(h,f,g,x,k,I,F,W){if(I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"&&(h.type=I),f!=null||g!=null){if(!(I!=="submit"&&I!=="reset"||f!=null))return;g=g!=null?""+da(g):"",f=f!=null?""+da(f):g,W||f===h.value||(h.value=f),h.defaultValue=f}x=x??k,x=typeof x!="function"&&typeof x!="symbol"&&!!x,h.checked=W?h.checked:!!x,h.defaultChecked=!!x,F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"&&(h.name=F)}function ew(h,f,g){f==="number"&&mv(h.ownerDocument)===h||h.defaultValue===""+g||(h.defaultValue=""+g)}function Fc(h,f,g,x){if(h=h.options,f){f={};for(var k=0;k<g.length;k++)f["$"+g[k]]=!0;for(g=0;g<h.length;g++)k=f.hasOwnProperty("$"+h[g].value),h[g].selected!==k&&(h[g].selected=k),k&&x&&(h[g].defaultSelected=!0)}else{for(g=""+da(g),f=null,k=0;k<h.length;k++){if(h[k].value===g){h[k].selected=!0,x&&(h[k].defaultSelected=!0);return}f!==null||h[k].disabled||(f=h[k])}f!==null&&(f.selected=!0)}}function HE(h,f,g){if(f!=null&&(f=""+da(f),f!==h.value&&(h.value=f),g==null)){h.defaultValue!==f&&(h.defaultValue=f);return}h.defaultValue=g!=null?""+da(g):""}function jE(h,f,g,x){if(f==null){if(x!=null){if(g!=null)throw Error(r(92));if(G(x)){if(1<x.length)throw Error(r(93));x=x[0]}g=x}g==null&&(g=""),f=g}g=da(f),h.defaultValue=g,x=h.textContent,x===g&&x!==""&&x!==null&&(h.value=x)}function Mc(h,f){if(f){var g=h.firstChild;if(g&&g===h.lastChild&&g.nodeType===3){g.nodeValue=f;return}}h.textContent=f}var YW=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function qE(h,f,g){var x=f.indexOf("--")===0;g==null||typeof g=="boolean"||g===""?x?h.setProperty(f,""):f==="float"?h.cssFloat="":h[f]="":x?h.setProperty(f,g):typeof g!="number"||g===0||YW.has(f)?f==="float"?h.cssFloat=g:h[f]=(""+g).trim():h[f]=g+"px"}function KE(h,f,g){if(f!=null&&typeof f!="object")throw Error(r(62));if(h=h.style,g!=null){for(var x in g)!g.hasOwnProperty(x)||f!=null&&f.hasOwnProperty(x)||(x.indexOf("--")===0?h.setProperty(x,""):x==="float"?h.cssFloat="":h[x]="");for(var k in f)x=f[k],f.hasOwnProperty(k)&&g[k]!==x&&qE(h,k,x)}else for(var I in f)f.hasOwnProperty(I)&&qE(h,I,f[I])}function tw(h){if(h.indexOf("-")===-1)return!1;switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ZW=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),QW=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function gv(h){return QW.test(""+h)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":h}var nw=null;function rw(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var Lc=null,Pc=null;function XE(h){var f=Ac(h);if(f&&(h=f.stateNode)){var g=h[Cs]||null;e:switch(h=f.stateNode,f.type){case"input":if(J1(h,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name),f=g.name,g.type==="radio"&&f!=null){for(g=h;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll('input[name="'+fa(""+f)+'"][type="radio"]'),f=0;f<g.length;f++){var x=g[f];if(x!==h&&x.form===h.form){var k=x[Cs]||null;if(!k)throw Error(r(90));J1(x,k.value,k.defaultValue,k.defaultValue,k.checked,k.defaultChecked,k.type,k.name)}}for(f=0;f<g.length;f++)x=g[f],x.form===h.form&&WE(x)}break e;case"textarea":HE(h,g.value,g.defaultValue);break e;case"select":f=g.value,f!=null&&Fc(h,!!g.multiple,f,!1)}}}var sw=!1;function YE(h,f,g){if(sw)return h(f,g);sw=!0;try{var x=h(f);return x}finally{if(sw=!1,(Lc!==null||Pc!==null)&&(ty(),Lc&&(f=Lc,h=Pc,Pc=Lc=null,XE(f),h)))for(f=0;f<h.length;f++)XE(h[f])}}function kf(h,f){var g=h.stateNode;if(g===null)return null;var x=g[Cs]||null;if(x===null)return null;g=x[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(h=h.type,x=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!x;break e;default:h=!1}if(h)return null;if(g&&typeof g!="function")throw Error(r(231,f,typeof g));return g}var qo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),aw=!1;if(qo)try{var Tf={};Object.defineProperty(Tf,"passive",{get:function(){aw=!0}}),window.addEventListener("test",Tf,Tf),window.removeEventListener("test",Tf,Tf)}catch{aw=!1}var zi=null,ow=null,vv=null;function ZE(){if(vv)return vv;var h,f=ow,g=f.length,x,k="value"in zi?zi.value:zi.textContent,I=k.length;for(h=0;h<g&&f[h]===k[h];h++);var F=g-h;for(x=1;x<=F&&f[g-x]===k[I-x];x++);return vv=k.slice(h,1<x?1-x:void 0)}function yv(h){var f=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&f===13&&(h=13)):h=f,h===10&&(h=13),32<=h||h===13?h:0}function bv(){return!0}function QE(){return!1}function Ns(h){function f(g,x,k,I,F){this._reactName=g,this._targetInst=k,this.type=x,this.nativeEvent=I,this.target=F,this.currentTarget=null;for(var W in h)h.hasOwnProperty(W)&&(g=h[W],this[W]=g?g(I):I[W]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?bv:QE,this.isPropagationStopped=QE,this}return c(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=bv)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=bv)},persist:function(){},isPersistent:bv}),f}var sl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xv=Ns(sl),If=c({},sl,{view:0,detail:0}),JW=Ns(If),iw,uw,Ef,wv=c({},If,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:cw,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==Ef&&(Ef&&h.type==="mousemove"?(iw=h.screenX-Ef.screenX,uw=h.screenY-Ef.screenY):uw=iw=0,Ef=h),iw)},movementY:function(h){return"movementY"in h?h.movementY:uw}}),JE=Ns(wv),eG=c({},wv,{dataTransfer:0}),tG=Ns(eG),nG=c({},If,{relatedTarget:0}),lw=Ns(nG),rG=c({},sl,{animationName:0,elapsedTime:0,pseudoElement:0}),sG=Ns(rG),aG=c({},sl,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),oG=Ns(aG),iG=c({},sl,{data:0}),e_=Ns(iG),uG={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lG={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cG={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hG(h){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(h):(h=cG[h])?!!f[h]:!1}function cw(){return hG}var dG=c({},If,{key:function(h){if(h.key){var f=uG[h.key]||h.key;if(f!=="Unidentified")return f}return h.type==="keypress"?(h=yv(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?lG[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:cw,charCode:function(h){return h.type==="keypress"?yv(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?yv(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),fG=Ns(dG),pG=c({},wv,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),t_=Ns(pG),mG=c({},If,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:cw}),gG=Ns(mG),vG=c({},sl,{propertyName:0,elapsedTime:0,pseudoElement:0}),yG=Ns(vG),bG=c({},wv,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),xG=Ns(bG),wG=c({},sl,{newState:0,oldState:0}),SG=Ns(wG),CG=[9,13,27,32],hw=qo&&"CompositionEvent"in window,_f=null;qo&&"documentMode"in document&&(_f=document.documentMode);var NG=qo&&"TextEvent"in window&&!_f,n_=qo&&(!hw||_f&&8<_f&&11>=_f),r_=" ",s_=!1;function a_(h,f){switch(h){case"keyup":return CG.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function o_(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var Bc=!1;function kG(h,f){switch(h){case"compositionend":return o_(f);case"keypress":return f.which!==32?null:(s_=!0,r_);case"textInput":return h=f.data,h===r_&&s_?null:h;default:return null}}function TG(h,f){if(Bc)return h==="compositionend"||!hw&&a_(h,f)?(h=ZE(),vv=ow=zi=null,Bc=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return n_&&f.locale!=="ko"?null:f.data;default:return null}}var IG={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function i_(h){var f=h&&h.nodeName&&h.nodeName.toLowerCase();return f==="input"?!!IG[h.type]:f==="textarea"}function u_(h,f,g,x){Lc?Pc?Pc.push(x):Pc=[x]:Lc=x,f=iy(f,"onChange"),0<f.length&&(g=new xv("onChange","change",null,g,x),h.push({event:g,listeners:f}))}var Rf=null,Af=null;function EG(h){UA(h,0)}function Sv(h){var f=Nf(h);if(WE(f))return h}function l_(h,f){if(h==="change")return f}var c_=!1;if(qo){var dw;if(qo){var fw="oninput"in document;if(!fw){var h_=document.createElement("div");h_.setAttribute("oninput","return;"),fw=typeof h_.oninput=="function"}dw=fw}else dw=!1;c_=dw&&(!document.documentMode||9<document.documentMode)}function d_(){Rf&&(Rf.detachEvent("onpropertychange",f_),Af=Rf=null)}function f_(h){if(h.propertyName==="value"&&Sv(Af)){var f=[];u_(f,Af,h,rw(h)),YE(EG,f)}}function _G(h,f,g){h==="focusin"?(d_(),Rf=f,Af=g,Rf.attachEvent("onpropertychange",f_)):h==="focusout"&&d_()}function RG(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return Sv(Af)}function AG(h,f){if(h==="click")return Sv(f)}function DG(h,f){if(h==="input"||h==="change")return Sv(f)}function $G(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var Gs=typeof Object.is=="function"?Object.is:$G;function Df(h,f){if(Gs(h,f))return!0;if(typeof h!="object"||h===null||typeof f!="object"||f===null)return!1;var g=Object.keys(h),x=Object.keys(f);if(g.length!==x.length)return!1;for(x=0;x<g.length;x++){var k=g[x];if(!Ve.call(f,k)||!Gs(h[k],f[k]))return!1}return!0}function p_(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function m_(h,f){var g=p_(h);h=0;for(var x;g;){if(g.nodeType===3){if(x=h+g.textContent.length,h<=f&&x>=f)return{node:g,offset:f-h};h=x}e:{for(;g;){if(g.nextSibling){g=g.nextSibling;break e}g=g.parentNode}g=void 0}g=p_(g)}}function g_(h,f){return h&&f?h===f?!0:h&&h.nodeType===3?!1:f&&f.nodeType===3?g_(h,f.parentNode):"contains"in h?h.contains(f):h.compareDocumentPosition?!!(h.compareDocumentPosition(f)&16):!1:!1}function v_(h){h=h!=null&&h.ownerDocument!=null&&h.ownerDocument.defaultView!=null?h.ownerDocument.defaultView:window;for(var f=mv(h.document);f instanceof h.HTMLIFrameElement;){try{var g=typeof f.contentWindow.location.href=="string"}catch{g=!1}if(g)h=f.contentWindow;else break;f=mv(h.document)}return f}function pw(h){var f=h&&h.nodeName&&h.nodeName.toLowerCase();return f&&(f==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||f==="textarea"||h.contentEditable==="true")}var OG=qo&&"documentMode"in document&&11>=document.documentMode,zc=null,mw=null,$f=null,gw=!1;function y_(h,f,g){var x=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;gw||zc==null||zc!==mv(x)||(x=zc,"selectionStart"in x&&pw(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),$f&&Df($f,x)||($f=x,x=iy(mw,"onSelect"),0<x.length&&(f=new xv("onSelect","select",null,f,g),h.push({event:f,listeners:x}),f.target=zc)))}function al(h,f){var g={};return g[h.toLowerCase()]=f.toLowerCase(),g["Webkit"+h]="webkit"+f,g["Moz"+h]="moz"+f,g}var Vc={animationend:al("Animation","AnimationEnd"),animationiteration:al("Animation","AnimationIteration"),animationstart:al("Animation","AnimationStart"),transitionrun:al("Transition","TransitionRun"),transitionstart:al("Transition","TransitionStart"),transitioncancel:al("Transition","TransitionCancel"),transitionend:al("Transition","TransitionEnd")},vw={},b_={};qo&&(b_=document.createElement("div").style,"AnimationEvent"in window||(delete Vc.animationend.animation,delete Vc.animationiteration.animation,delete Vc.animationstart.animation),"TransitionEvent"in window||delete Vc.transitionend.transition);function ol(h){if(vw[h])return vw[h];if(!Vc[h])return h;var f=Vc[h],g;for(g in f)if(f.hasOwnProperty(g)&&g in b_)return vw[h]=f[g];return h}var x_=ol("animationend"),w_=ol("animationiteration"),S_=ol("animationstart"),FG=ol("transitionrun"),MG=ol("transitionstart"),LG=ol("transitioncancel"),C_=ol("transitionend"),N_=new Map,yw="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");yw.push("scrollEnd");function Ma(h,f){N_.set(h,f),rl(f,[h])}var k_=new WeakMap;function pa(h,f){if(typeof h=="object"&&h!==null){var g=k_.get(h);return g!==void 0?g:(f={value:h,source:f,stack:VE(f)},k_.set(h,f),f)}return{value:h,source:f,stack:VE(f)}}var ma=[],Uc=0,bw=0;function Cv(){for(var h=Uc,f=bw=Uc=0;f<h;){var g=ma[f];ma[f++]=null;var x=ma[f];ma[f++]=null;var k=ma[f];ma[f++]=null;var I=ma[f];if(ma[f++]=null,x!==null&&k!==null){var F=x.pending;F===null?k.next=k:(k.next=F.next,F.next=k),x.pending=k}I!==0&&T_(g,k,I)}}function Nv(h,f,g,x){ma[Uc++]=h,ma[Uc++]=f,ma[Uc++]=g,ma[Uc++]=x,bw|=x,h.lanes|=x,h=h.alternate,h!==null&&(h.lanes|=x)}function xw(h,f,g,x){return Nv(h,f,g,x),kv(h)}function Wc(h,f){return Nv(h,null,null,f),kv(h)}function T_(h,f,g){h.lanes|=g;var x=h.alternate;x!==null&&(x.lanes|=g);for(var k=!1,I=h.return;I!==null;)I.childLanes|=g,x=I.alternate,x!==null&&(x.childLanes|=g),I.tag===22&&(h=I.stateNode,h===null||h._visibility&1||(k=!0)),h=I,I=I.return;return h.tag===3?(I=h.stateNode,k&&f!==null&&(k=31-kn(g),h=I.hiddenUpdates,x=h[k],x===null?h[k]=[f]:x.push(f),f.lane=g|536870912),I):null}function kv(h){if(50<sp)throw sp=0,T2=null,Error(r(185));for(var f=h.return;f!==null;)h=f,f=h.return;return h.tag===3?h.stateNode:null}var Gc={};function PG(h,f,g,x){this.tag=h,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Hs(h,f,g,x){return new PG(h,f,g,x)}function ww(h){return h=h.prototype,!(!h||!h.isReactComponent)}function Ko(h,f){var g=h.alternate;return g===null?(g=Hs(h.tag,f,h.key,h.mode),g.elementType=h.elementType,g.type=h.type,g.stateNode=h.stateNode,g.alternate=h,h.alternate=g):(g.pendingProps=f,g.type=h.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=h.flags&65011712,g.childLanes=h.childLanes,g.lanes=h.lanes,g.child=h.child,g.memoizedProps=h.memoizedProps,g.memoizedState=h.memoizedState,g.updateQueue=h.updateQueue,f=h.dependencies,g.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},g.sibling=h.sibling,g.index=h.index,g.ref=h.ref,g.refCleanup=h.refCleanup,g}function I_(h,f){h.flags&=65011714;var g=h.alternate;return g===null?(h.childLanes=0,h.lanes=f,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=g.childLanes,h.lanes=g.lanes,h.child=g.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=g.memoizedProps,h.memoizedState=g.memoizedState,h.updateQueue=g.updateQueue,h.type=g.type,f=g.dependencies,h.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),h}function Tv(h,f,g,x,k,I){var F=0;if(x=h,typeof h=="function")ww(h)&&(F=1);else if(typeof h=="string")F=z6(h,g,le.current)?26:h==="html"||h==="head"||h==="body"?27:5;else e:switch(h){case R:return h=Hs(31,g,f,k),h.elementType=R,h.lanes=I,h;case v:return il(g.children,k,I,f);case b:F=8,k|=24;break;case y:return h=Hs(12,g,f,k|2),h.elementType=y,h.lanes=I,h;case T:return h=Hs(13,g,f,k),h.elementType=T,h.lanes=I,h;case E:return h=Hs(19,g,f,k),h.elementType=E,h.lanes=I,h;default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case w:case N:F=10;break e;case S:F=9;break e;case C:F=11;break e;case $:F=14;break e;case _:F=16,x=null;break e}F=29,g=Error(r(130,h===null?"null":typeof h,"")),x=null}return f=Hs(F,g,f,k),f.elementType=h,f.type=x,f.lanes=I,f}function il(h,f,g,x){return h=Hs(7,h,x,f),h.lanes=g,h}function Sw(h,f,g){return h=Hs(6,h,null,f),h.lanes=g,h}function Cw(h,f,g){return f=Hs(4,h.children!==null?h.children:[],h.key,f),f.lanes=g,f.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},f}var Hc=[],jc=0,Iv=null,Ev=0,ga=[],va=0,ul=null,Xo=1,Yo="";function ll(h,f){Hc[jc++]=Ev,Hc[jc++]=Iv,Iv=h,Ev=f}function E_(h,f,g){ga[va++]=Xo,ga[va++]=Yo,ga[va++]=ul,ul=h;var x=Xo;h=Yo;var k=32-kn(x)-1;x&=~(1<<k),g+=1;var I=32-kn(f)+k;if(30<I){var F=k-k%5;I=(x&(1<<F)-1).toString(32),x>>=F,k-=F,Xo=1<<32-kn(f)+k|g<<k|x,Yo=I+h}else Xo=1<<I|g<<k|x,Yo=h}function Nw(h){h.return!==null&&(ll(h,1),E_(h,1,0))}function kw(h){for(;h===Iv;)Iv=Hc[--jc],Hc[jc]=null,Ev=Hc[--jc],Hc[jc]=null;for(;h===ul;)ul=ga[--va],ga[va]=null,Yo=ga[--va],ga[va]=null,Xo=ga[--va],ga[va]=null}var cs=null,An=null,Wt=!1,cl=null,uo=!1,Tw=Error(r(519));function hl(h){var f=Error(r(418,""));throw Mf(pa(f,h)),Tw}function __(h){var f=h.stateNode,g=h.type,x=h.memoizedProps;switch(f[qr]=h,f[Cs]=x,g){case"dialog":Ot("cancel",f),Ot("close",f);break;case"iframe":case"object":case"embed":Ot("load",f);break;case"video":case"audio":for(g=0;g<op.length;g++)Ot(op[g],f);break;case"source":Ot("error",f);break;case"img":case"image":case"link":Ot("error",f),Ot("load",f);break;case"details":Ot("toggle",f);break;case"input":Ot("invalid",f),GE(f,x.value,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name,!0),pv(f);break;case"select":Ot("invalid",f);break;case"textarea":Ot("invalid",f),jE(f,x.value,x.defaultValue,x.children),pv(f)}g=x.children,typeof g!="string"&&typeof g!="number"&&typeof g!="bigint"||f.textContent===""+g||x.suppressHydrationWarning===!0||jA(f.textContent,g)?(x.popover!=null&&(Ot("beforetoggle",f),Ot("toggle",f)),x.onScroll!=null&&Ot("scroll",f),x.onScrollEnd!=null&&Ot("scrollend",f),x.onClick!=null&&(f.onclick=uy),f=!0):f=!1,f||hl(h)}function R_(h){for(cs=h.return;cs;)switch(cs.tag){case 5:case 13:uo=!1;return;case 27:case 3:uo=!0;return;default:cs=cs.return}}function Of(h){if(h!==cs)return!1;if(!Wt)return R_(h),Wt=!0,!1;var f=h.tag,g;if((g=f!==3&&f!==27)&&((g=f===5)&&(g=h.type,g=!(g!=="form"&&g!=="button")||U2(h.type,h.memoizedProps)),g=!g),g&&An&&hl(h),R_(h),f===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(r(317));e:{for(h=h.nextSibling,f=0;h;){if(h.nodeType===8)if(g=h.data,g==="/$"){if(f===0){An=Pa(h.nextSibling);break e}f--}else g!=="$"&&g!=="$!"&&g!=="$?"||f++;h=h.nextSibling}An=null}}else f===27?(f=An,nu(h.type)?(h=j2,j2=null,An=h):An=f):An=cs?Pa(h.stateNode.nextSibling):null;return!0}function Ff(){An=cs=null,Wt=!1}function A_(){var h=cl;return h!==null&&(Is===null?Is=h:Is.push.apply(Is,h),cl=null),h}function Mf(h){cl===null?cl=[h]:cl.push(h)}var Iw=K(null),dl=null,Zo=null;function Vi(h,f,g){Z(Iw,f._currentValue),f._currentValue=g}function Qo(h){h._currentValue=Iw.current,J(Iw)}function Ew(h,f,g){for(;h!==null;){var x=h.alternate;if((h.childLanes&f)!==f?(h.childLanes|=f,x!==null&&(x.childLanes|=f)):x!==null&&(x.childLanes&f)!==f&&(x.childLanes|=f),h===g)break;h=h.return}}function _w(h,f,g,x){var k=h.child;for(k!==null&&(k.return=h);k!==null;){var I=k.dependencies;if(I!==null){var F=k.child;I=I.firstContext;e:for(;I!==null;){var W=I;I=k;for(var te=0;te<f.length;te++)if(W.context===f[te]){I.lanes|=g,W=I.alternate,W!==null&&(W.lanes|=g),Ew(I.return,g,h),x||(F=null);break e}I=W.next}}else if(k.tag===18){if(F=k.return,F===null)throw Error(r(341));F.lanes|=g,I=F.alternate,I!==null&&(I.lanes|=g),Ew(F,g,h),F=null}else F=k.child;if(F!==null)F.return=k;else for(F=k;F!==null;){if(F===h){F=null;break}if(k=F.sibling,k!==null){k.return=F.return,F=k;break}F=F.return}k=F}}function Lf(h,f,g,x){h=null;for(var k=f,I=!1;k!==null;){if(!I){if((k.flags&524288)!==0)I=!0;else if((k.flags&262144)!==0)break}if(k.tag===10){var F=k.alternate;if(F===null)throw Error(r(387));if(F=F.memoizedProps,F!==null){var W=k.type;Gs(k.pendingProps.value,F.value)||(h!==null?h.push(W):h=[W])}}else if(k===Ce.current){if(F=k.alternate,F===null)throw Error(r(387));F.memoizedState.memoizedState!==k.memoizedState.memoizedState&&(h!==null?h.push(dp):h=[dp])}k=k.return}h!==null&&_w(f,h,g,x),f.flags|=262144}function _v(h){for(h=h.firstContext;h!==null;){if(!Gs(h.context._currentValue,h.memoizedValue))return!0;h=h.next}return!1}function fl(h){dl=h,Zo=null,h=h.dependencies,h!==null&&(h.firstContext=null)}function Kr(h){return D_(dl,h)}function Rv(h,f){return dl===null&&fl(h),D_(h,f)}function D_(h,f){var g=f._currentValue;if(f={context:f,memoizedValue:g,next:null},Zo===null){if(h===null)throw Error(r(308));Zo=f,h.dependencies={lanes:0,firstContext:f},h.flags|=524288}else Zo=Zo.next=f;return g}var BG=typeof AbortController<"u"?AbortController:function(){var h=[],f=this.signal={aborted:!1,addEventListener:function(g,x){h.push(x)}};this.abort=function(){f.aborted=!0,h.forEach(function(g){return g()})}},zG=n.unstable_scheduleCallback,VG=n.unstable_NormalPriority,sr={$$typeof:N,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Rw(){return{controller:new BG,data:new Map,refCount:0}}function Pf(h){h.refCount--,h.refCount===0&&zG(VG,function(){h.controller.abort()})}var Bf=null,Aw=0,qc=0,Kc=null;function UG(h,f){if(Bf===null){var g=Bf=[];Aw=0,qc=$2(),Kc={status:"pending",value:void 0,then:function(x){g.push(x)}}}return Aw++,f.then($_,$_),f}function $_(){if(--Aw===0&&Bf!==null){Kc!==null&&(Kc.status="fulfilled");var h=Bf;Bf=null,qc=0,Kc=null;for(var f=0;f<h.length;f++)(0,h[f])()}}function WG(h,f){var g=[],x={status:"pending",value:null,reason:null,then:function(k){g.push(k)}};return h.then(function(){x.status="fulfilled",x.value=f;for(var k=0;k<g.length;k++)(0,g[k])(f)},function(k){for(x.status="rejected",x.reason=k,k=0;k<g.length;k++)(0,g[k])(void 0)}),x}var O_=P.S;P.S=function(h,f){typeof f=="object"&&f!==null&&typeof f.then=="function"&&UG(h,f),O_!==null&&O_(h,f)};var pl=K(null);function Dw(){var h=pl.current;return h!==null?h:dn.pooledCache}function Av(h,f){f===null?Z(pl,pl.current):Z(pl,f.pool)}function F_(){var h=Dw();return h===null?null:{parent:sr._currentValue,pool:h}}var zf=Error(r(460)),M_=Error(r(474)),Dv=Error(r(542)),$w={then:function(){}};function L_(h){return h=h.status,h==="fulfilled"||h==="rejected"}function $v(){}function P_(h,f,g){switch(g=h[g],g===void 0?h.push(f):g!==f&&(f.then($v,$v),f=g),f.status){case"fulfilled":return f.value;case"rejected":throw h=f.reason,z_(h),h;default:if(typeof f.status=="string")f.then($v,$v);else{if(h=dn,h!==null&&100<h.shellSuspendCounter)throw Error(r(482));h=f,h.status="pending",h.then(function(x){if(f.status==="pending"){var k=f;k.status="fulfilled",k.value=x}},function(x){if(f.status==="pending"){var k=f;k.status="rejected",k.reason=x}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw h=f.reason,z_(h),h}throw Vf=f,zf}}var Vf=null;function B_(){if(Vf===null)throw Error(r(459));var h=Vf;return Vf=null,h}function z_(h){if(h===zf||h===Dv)throw Error(r(483))}var Ui=!1;function Ow(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Fw(h,f){h=h.updateQueue,f.updateQueue===h&&(f.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,callbacks:null})}function Wi(h){return{lane:h,tag:0,payload:null,callback:null,next:null}}function Gi(h,f,g){var x=h.updateQueue;if(x===null)return null;if(x=x.shared,(Yt&2)!==0){var k=x.pending;return k===null?f.next=f:(f.next=k.next,k.next=f),x.pending=f,f=kv(h),T_(h,null,g),f}return Nv(h,x,f,g),kv(h)}function Uf(h,f,g){if(f=f.updateQueue,f!==null&&(f=f.shared,(g&4194048)!==0)){var x=f.lanes;x&=h.pendingLanes,g|=x,f.lanes=g,$E(h,g)}}function Mw(h,f){var g=h.updateQueue,x=h.alternate;if(x!==null&&(x=x.updateQueue,g===x)){var k=null,I=null;if(g=g.firstBaseUpdate,g!==null){do{var F={lane:g.lane,tag:g.tag,payload:g.payload,callback:null,next:null};I===null?k=I=F:I=I.next=F,g=g.next}while(g!==null);I===null?k=I=f:I=I.next=f}else k=I=f;g={baseState:x.baseState,firstBaseUpdate:k,lastBaseUpdate:I,shared:x.shared,callbacks:x.callbacks},h.updateQueue=g;return}h=g.lastBaseUpdate,h===null?g.firstBaseUpdate=f:h.next=f,g.lastBaseUpdate=f}var Lw=!1;function Wf(){if(Lw){var h=Kc;if(h!==null)throw h}}function Gf(h,f,g,x){Lw=!1;var k=h.updateQueue;Ui=!1;var I=k.firstBaseUpdate,F=k.lastBaseUpdate,W=k.shared.pending;if(W!==null){k.shared.pending=null;var te=W,me=te.next;te.next=null,F===null?I=me:F.next=me,F=te;var ke=h.alternate;ke!==null&&(ke=ke.updateQueue,W=ke.lastBaseUpdate,W!==F&&(W===null?ke.firstBaseUpdate=me:W.next=me,ke.lastBaseUpdate=te))}if(I!==null){var Ee=k.baseState;F=0,ke=me=te=null,W=I;do{var ve=W.lane&-536870913,ye=ve!==W.lane;if(ye?(Bt&ve)===ve:(x&ve)===ve){ve!==0&&ve===qc&&(Lw=!0),ke!==null&&(ke=ke.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var dt=h,ut=W;ve=f;var sn=g;switch(ut.tag){case 1:if(dt=ut.payload,typeof dt=="function"){Ee=dt.call(sn,Ee,ve);break e}Ee=dt;break e;case 3:dt.flags=dt.flags&-65537|128;case 0:if(dt=ut.payload,ve=typeof dt=="function"?dt.call(sn,Ee,ve):dt,ve==null)break e;Ee=c({},Ee,ve);break e;case 2:Ui=!0}}ve=W.callback,ve!==null&&(h.flags|=64,ye&&(h.flags|=8192),ye=k.callbacks,ye===null?k.callbacks=[ve]:ye.push(ve))}else ye={lane:ve,tag:W.tag,payload:W.payload,callback:W.callback,next:null},ke===null?(me=ke=ye,te=Ee):ke=ke.next=ye,F|=ve;if(W=W.next,W===null){if(W=k.shared.pending,W===null)break;ye=W,W=ye.next,ye.next=null,k.lastBaseUpdate=ye,k.shared.pending=null}}while(!0);ke===null&&(te=Ee),k.baseState=te,k.firstBaseUpdate=me,k.lastBaseUpdate=ke,I===null&&(k.shared.lanes=0),Qi|=F,h.lanes=F,h.memoizedState=Ee}}function V_(h,f){if(typeof h!="function")throw Error(r(191,h));h.call(f)}function U_(h,f){var g=h.callbacks;if(g!==null)for(h.callbacks=null,h=0;h<g.length;h++)V_(g[h],f)}var Xc=K(null),Ov=K(0);function W_(h,f){h=ai,Z(Ov,h),Z(Xc,f),ai=h|f.baseLanes}function Pw(){Z(Ov,ai),Z(Xc,Xc.current)}function Bw(){ai=Ov.current,J(Xc),J(Ov)}var Hi=0,Tt=null,nn=null,Xn=null,Fv=!1,Yc=!1,ml=!1,Mv=0,Hf=0,Zc=null,GG=0;function zn(){throw Error(r(321))}function zw(h,f){if(f===null)return!1;for(var g=0;g<f.length&&g<h.length;g++)if(!Gs(h[g],f[g]))return!1;return!0}function Vw(h,f,g,x,k,I){return Hi=I,Tt=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,P.H=h===null||h.memoizedState===null?TR:IR,ml=!1,I=g(x,k),ml=!1,Yc&&(I=H_(f,g,x,k)),G_(h),I}function G_(h){P.H=Uv;var f=nn!==null&&nn.next!==null;if(Hi=0,Xn=nn=Tt=null,Fv=!1,Hf=0,Zc=null,f)throw Error(r(300));h===null||Sr||(h=h.dependencies,h!==null&&_v(h)&&(Sr=!0))}function H_(h,f,g,x){Tt=h;var k=0;do{if(Yc&&(Zc=null),Hf=0,Yc=!1,25<=k)throw Error(r(301));if(k+=1,Xn=nn=null,h.updateQueue!=null){var I=h.updateQueue;I.lastEffect=null,I.events=null,I.stores=null,I.memoCache!=null&&(I.memoCache.index=0)}P.H=ZG,I=f(g,x)}while(Yc);return I}function HG(){var h=P.H,f=h.useState()[0];return f=typeof f.then=="function"?jf(f):f,h=h.useState()[0],(nn!==null?nn.memoizedState:null)!==h&&(Tt.flags|=1024),f}function Uw(){var h=Mv!==0;return Mv=0,h}function Ww(h,f,g){f.updateQueue=h.updateQueue,f.flags&=-2053,h.lanes&=~g}function Gw(h){if(Fv){for(h=h.memoizedState;h!==null;){var f=h.queue;f!==null&&(f.pending=null),h=h.next}Fv=!1}Hi=0,Xn=nn=Tt=null,Yc=!1,Hf=Mv=0,Zc=null}function ks(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xn===null?Tt.memoizedState=Xn=h:Xn=Xn.next=h,Xn}function Yn(){if(nn===null){var h=Tt.alternate;h=h!==null?h.memoizedState:null}else h=nn.next;var f=Xn===null?Tt.memoizedState:Xn.next;if(f!==null)Xn=f,nn=h;else{if(h===null)throw Tt.alternate===null?Error(r(467)):Error(r(310));nn=h,h={memoizedState:nn.memoizedState,baseState:nn.baseState,baseQueue:nn.baseQueue,queue:nn.queue,next:null},Xn===null?Tt.memoizedState=Xn=h:Xn=Xn.next=h}return Xn}function Hw(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function jf(h){var f=Hf;return Hf+=1,Zc===null&&(Zc=[]),h=P_(Zc,h,f),f=Tt,(Xn===null?f.memoizedState:Xn.next)===null&&(f=f.alternate,P.H=f===null||f.memoizedState===null?TR:IR),h}function Lv(h){if(h!==null&&typeof h=="object"){if(typeof h.then=="function")return jf(h);if(h.$$typeof===N)return Kr(h)}throw Error(r(438,String(h)))}function jw(h){var f=null,g=Tt.updateQueue;if(g!==null&&(f=g.memoCache),f==null){var x=Tt.alternate;x!==null&&(x=x.updateQueue,x!==null&&(x=x.memoCache,x!=null&&(f={data:x.data.map(function(k){return k.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),g===null&&(g=Hw(),Tt.updateQueue=g),g.memoCache=f,g=f.data[f.index],g===void 0)for(g=f.data[f.index]=Array(h),x=0;x<h;x++)g[x]=D;return f.index++,g}function Jo(h,f){return typeof f=="function"?f(h):f}function Pv(h){var f=Yn();return qw(f,nn,h)}function qw(h,f,g){var x=h.queue;if(x===null)throw Error(r(311));x.lastRenderedReducer=g;var k=h.baseQueue,I=x.pending;if(I!==null){if(k!==null){var F=k.next;k.next=I.next,I.next=F}f.baseQueue=k=I,x.pending=null}if(I=h.baseState,k===null)h.memoizedState=I;else{f=k.next;var W=F=null,te=null,me=f,ke=!1;do{var Ee=me.lane&-536870913;if(Ee!==me.lane?(Bt&Ee)===Ee:(Hi&Ee)===Ee){var ve=me.revertLane;if(ve===0)te!==null&&(te=te.next={lane:0,revertLane:0,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null}),Ee===qc&&(ke=!0);else if((Hi&ve)===ve){me=me.next,ve===qc&&(ke=!0);continue}else Ee={lane:0,revertLane:me.revertLane,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},te===null?(W=te=Ee,F=I):te=te.next=Ee,Tt.lanes|=ve,Qi|=ve;Ee=me.action,ml&&g(I,Ee),I=me.hasEagerState?me.eagerState:g(I,Ee)}else ve={lane:Ee,revertLane:me.revertLane,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},te===null?(W=te=ve,F=I):te=te.next=ve,Tt.lanes|=Ee,Qi|=Ee;me=me.next}while(me!==null&&me!==f);if(te===null?F=I:te.next=W,!Gs(I,h.memoizedState)&&(Sr=!0,ke&&(g=Kc,g!==null)))throw g;h.memoizedState=I,h.baseState=F,h.baseQueue=te,x.lastRenderedState=I}return k===null&&(x.lanes=0),[h.memoizedState,x.dispatch]}function Kw(h){var f=Yn(),g=f.queue;if(g===null)throw Error(r(311));g.lastRenderedReducer=h;var x=g.dispatch,k=g.pending,I=f.memoizedState;if(k!==null){g.pending=null;var F=k=k.next;do I=h(I,F.action),F=F.next;while(F!==k);Gs(I,f.memoizedState)||(Sr=!0),f.memoizedState=I,f.baseQueue===null&&(f.baseState=I),g.lastRenderedState=I}return[I,x]}function j_(h,f,g){var x=Tt,k=Yn(),I=Wt;if(I){if(g===void 0)throw Error(r(407));g=g()}else g=f();var F=!Gs((nn||k).memoizedState,g);F&&(k.memoizedState=g,Sr=!0),k=k.queue;var W=X_.bind(null,x,k,h);if(qf(2048,8,W,[h]),k.getSnapshot!==f||F||Xn!==null&&Xn.memoizedState.tag&1){if(x.flags|=2048,Qc(9,Bv(),K_.bind(null,x,k,g,f),null),dn===null)throw Error(r(349));I||(Hi&124)!==0||q_(x,f,g)}return g}function q_(h,f,g){h.flags|=16384,h={getSnapshot:f,value:g},f=Tt.updateQueue,f===null?(f=Hw(),Tt.updateQueue=f,f.stores=[h]):(g=f.stores,g===null?f.stores=[h]:g.push(h))}function K_(h,f,g,x){f.value=g,f.getSnapshot=x,Y_(f)&&Z_(h)}function X_(h,f,g){return g(function(){Y_(f)&&Z_(h)})}function Y_(h){var f=h.getSnapshot;h=h.value;try{var g=f();return!Gs(h,g)}catch{return!0}}function Z_(h){var f=Wc(h,2);f!==null&&Ys(f,h,2)}function Xw(h){var f=ks();if(typeof h=="function"){var g=h;if(h=g(),ml){tn(!0);try{g()}finally{tn(!1)}}}return f.memoizedState=f.baseState=h,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jo,lastRenderedState:h},f}function Q_(h,f,g,x){return h.baseState=g,qw(h,nn,typeof x=="function"?x:Jo)}function jG(h,f,g,x,k){if(Vv(h))throw Error(r(485));if(h=f.action,h!==null){var I={payload:k,action:h,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(F){I.listeners.push(F)}};P.T!==null?g(!0):I.isTransition=!1,x(I),g=f.pending,g===null?(I.next=f.pending=I,J_(f,I)):(I.next=g.next,f.pending=g.next=I)}}function J_(h,f){var g=f.action,x=f.payload,k=h.state;if(f.isTransition){var I=P.T,F={};P.T=F;try{var W=g(k,x),te=P.S;te!==null&&te(F,W),eR(h,f,W)}catch(me){Yw(h,f,me)}finally{P.T=I}}else try{I=g(k,x),eR(h,f,I)}catch(me){Yw(h,f,me)}}function eR(h,f,g){g!==null&&typeof g=="object"&&typeof g.then=="function"?g.then(function(x){tR(h,f,x)},function(x){return Yw(h,f,x)}):tR(h,f,g)}function tR(h,f,g){f.status="fulfilled",f.value=g,nR(f),h.state=g,f=h.pending,f!==null&&(g=f.next,g===f?h.pending=null:(g=g.next,f.next=g,J_(h,g)))}function Yw(h,f,g){var x=h.pending;if(h.pending=null,x!==null){x=x.next;do f.status="rejected",f.reason=g,nR(f),f=f.next;while(f!==x)}h.action=null}function nR(h){h=h.listeners;for(var f=0;f<h.length;f++)(0,h[f])()}function rR(h,f){return f}function sR(h,f){if(Wt){var g=dn.formState;if(g!==null){e:{var x=Tt;if(Wt){if(An){t:{for(var k=An,I=uo;k.nodeType!==8;){if(!I){k=null;break t}if(k=Pa(k.nextSibling),k===null){k=null;break t}}I=k.data,k=I==="F!"||I==="F"?k:null}if(k){An=Pa(k.nextSibling),x=k.data==="F!";break e}}hl(x)}x=!1}x&&(f=g[0])}}return g=ks(),g.memoizedState=g.baseState=f,x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:rR,lastRenderedState:f},g.queue=x,g=CR.bind(null,Tt,x),x.dispatch=g,x=Xw(!1),I=t2.bind(null,Tt,!1,x.queue),x=ks(),k={state:f,dispatch:null,action:h,pending:null},x.queue=k,g=jG.bind(null,Tt,k,I,g),k.dispatch=g,x.memoizedState=h,[f,g,!1]}function aR(h){var f=Yn();return oR(f,nn,h)}function oR(h,f,g){if(f=qw(h,f,rR)[0],h=Pv(Jo)[0],typeof f=="object"&&f!==null&&typeof f.then=="function")try{var x=jf(f)}catch(F){throw F===zf?Dv:F}else x=f;f=Yn();var k=f.queue,I=k.dispatch;return g!==f.memoizedState&&(Tt.flags|=2048,Qc(9,Bv(),qG.bind(null,k,g),null)),[x,I,h]}function qG(h,f){h.action=f}function iR(h){var f=Yn(),g=nn;if(g!==null)return oR(f,g,h);Yn(),f=f.memoizedState,g=Yn();var x=g.queue.dispatch;return g.memoizedState=h,[f,x,!1]}function Qc(h,f,g,x){return h={tag:h,create:g,deps:x,inst:f,next:null},f=Tt.updateQueue,f===null&&(f=Hw(),Tt.updateQueue=f),g=f.lastEffect,g===null?f.lastEffect=h.next=h:(x=g.next,g.next=h,h.next=x,f.lastEffect=h),h}function Bv(){return{destroy:void 0,resource:void 0}}function uR(){return Yn().memoizedState}function zv(h,f,g,x){var k=ks();x=x===void 0?null:x,Tt.flags|=h,k.memoizedState=Qc(1|f,Bv(),g,x)}function qf(h,f,g,x){var k=Yn();x=x===void 0?null:x;var I=k.memoizedState.inst;nn!==null&&x!==null&&zw(x,nn.memoizedState.deps)?k.memoizedState=Qc(f,I,g,x):(Tt.flags|=h,k.memoizedState=Qc(1|f,I,g,x))}function lR(h,f){zv(8390656,8,h,f)}function cR(h,f){qf(2048,8,h,f)}function hR(h,f){return qf(4,2,h,f)}function dR(h,f){return qf(4,4,h,f)}function fR(h,f){if(typeof f=="function"){h=h();var g=f(h);return function(){typeof g=="function"?g():f(null)}}if(f!=null)return h=h(),f.current=h,function(){f.current=null}}function pR(h,f,g){g=g!=null?g.concat([h]):null,qf(4,4,fR.bind(null,f,h),g)}function Zw(){}function mR(h,f){var g=Yn();f=f===void 0?null:f;var x=g.memoizedState;return f!==null&&zw(f,x[1])?x[0]:(g.memoizedState=[h,f],h)}function gR(h,f){var g=Yn();f=f===void 0?null:f;var x=g.memoizedState;if(f!==null&&zw(f,x[1]))return x[0];if(x=h(),ml){tn(!0);try{h()}finally{tn(!1)}}return g.memoizedState=[x,f],x}function Qw(h,f,g){return g===void 0||(Hi&1073741824)!==0?h.memoizedState=f:(h.memoizedState=g,h=bA(),Tt.lanes|=h,Qi|=h,g)}function vR(h,f,g,x){return Gs(g,f)?g:Xc.current!==null?(h=Qw(h,g,x),Gs(h,f)||(Sr=!0),h):(Hi&42)===0?(Sr=!0,h.memoizedState=g):(h=bA(),Tt.lanes|=h,Qi|=h,f)}function yR(h,f,g,x,k){var I=V.p;V.p=I!==0&&8>I?I:8;var F=P.T,W={};P.T=W,t2(h,!1,f,g);try{var te=k(),me=P.S;if(me!==null&&me(W,te),te!==null&&typeof te=="object"&&typeof te.then=="function"){var ke=WG(te,x);Kf(h,f,ke,Xs(h))}else Kf(h,f,x,Xs(h))}catch(Ee){Kf(h,f,{then:function(){},status:"rejected",reason:Ee},Xs())}finally{V.p=I,P.T=F}}function KG(){}function Jw(h,f,g,x){if(h.tag!==5)throw Error(r(476));var k=bR(h).queue;yR(h,k,f,z,g===null?KG:function(){return xR(h),g(x)})}function bR(h){var f=h.memoizedState;if(f!==null)return f;f={memoizedState:z,baseState:z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jo,lastRenderedState:z},next:null};var g={};return f.next={memoizedState:g,baseState:g,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jo,lastRenderedState:g},next:null},h.memoizedState=f,h=h.alternate,h!==null&&(h.memoizedState=f),f}function xR(h){var f=bR(h).next.queue;Kf(h,f,{},Xs())}function e2(){return Kr(dp)}function wR(){return Yn().memoizedState}function SR(){return Yn().memoizedState}function XG(h){for(var f=h.return;f!==null;){switch(f.tag){case 24:case 3:var g=Xs();h=Wi(g);var x=Gi(f,h,g);x!==null&&(Ys(x,f,g),Uf(x,f,g)),f={cache:Rw()},h.payload=f;return}f=f.return}}function YG(h,f,g){var x=Xs();g={lane:x,revertLane:0,action:g,hasEagerState:!1,eagerState:null,next:null},Vv(h)?NR(f,g):(g=xw(h,f,g,x),g!==null&&(Ys(g,h,x),kR(g,f,x)))}function CR(h,f,g){var x=Xs();Kf(h,f,g,x)}function Kf(h,f,g,x){var k={lane:x,revertLane:0,action:g,hasEagerState:!1,eagerState:null,next:null};if(Vv(h))NR(f,k);else{var I=h.alternate;if(h.lanes===0&&(I===null||I.lanes===0)&&(I=f.lastRenderedReducer,I!==null))try{var F=f.lastRenderedState,W=I(F,g);if(k.hasEagerState=!0,k.eagerState=W,Gs(W,F))return Nv(h,f,k,0),dn===null&&Cv(),!1}catch{}finally{}if(g=xw(h,f,k,x),g!==null)return Ys(g,h,x),kR(g,f,x),!0}return!1}function t2(h,f,g,x){if(x={lane:2,revertLane:$2(),action:x,hasEagerState:!1,eagerState:null,next:null},Vv(h)){if(f)throw Error(r(479))}else f=xw(h,g,x,2),f!==null&&Ys(f,h,2)}function Vv(h){var f=h.alternate;return h===Tt||f!==null&&f===Tt}function NR(h,f){Yc=Fv=!0;var g=h.pending;g===null?f.next=f:(f.next=g.next,g.next=f),h.pending=f}function kR(h,f,g){if((g&4194048)!==0){var x=f.lanes;x&=h.pendingLanes,g|=x,f.lanes=g,$E(h,g)}}var Uv={readContext:Kr,use:Lv,useCallback:zn,useContext:zn,useEffect:zn,useImperativeHandle:zn,useLayoutEffect:zn,useInsertionEffect:zn,useMemo:zn,useReducer:zn,useRef:zn,useState:zn,useDebugValue:zn,useDeferredValue:zn,useTransition:zn,useSyncExternalStore:zn,useId:zn,useHostTransitionStatus:zn,useFormState:zn,useActionState:zn,useOptimistic:zn,useMemoCache:zn,useCacheRefresh:zn},TR={readContext:Kr,use:Lv,useCallback:function(h,f){return ks().memoizedState=[h,f===void 0?null:f],h},useContext:Kr,useEffect:lR,useImperativeHandle:function(h,f,g){g=g!=null?g.concat([h]):null,zv(4194308,4,fR.bind(null,f,h),g)},useLayoutEffect:function(h,f){return zv(4194308,4,h,f)},useInsertionEffect:function(h,f){zv(4,2,h,f)},useMemo:function(h,f){var g=ks();f=f===void 0?null:f;var x=h();if(ml){tn(!0);try{h()}finally{tn(!1)}}return g.memoizedState=[x,f],x},useReducer:function(h,f,g){var x=ks();if(g!==void 0){var k=g(f);if(ml){tn(!0);try{g(f)}finally{tn(!1)}}}else k=f;return x.memoizedState=x.baseState=k,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:k},x.queue=h,h=h.dispatch=YG.bind(null,Tt,h),[x.memoizedState,h]},useRef:function(h){var f=ks();return h={current:h},f.memoizedState=h},useState:function(h){h=Xw(h);var f=h.queue,g=CR.bind(null,Tt,f);return f.dispatch=g,[h.memoizedState,g]},useDebugValue:Zw,useDeferredValue:function(h,f){var g=ks();return Qw(g,h,f)},useTransition:function(){var h=Xw(!1);return h=yR.bind(null,Tt,h.queue,!0,!1),ks().memoizedState=h,[!1,h]},useSyncExternalStore:function(h,f,g){var x=Tt,k=ks();if(Wt){if(g===void 0)throw Error(r(407));g=g()}else{if(g=f(),dn===null)throw Error(r(349));(Bt&124)!==0||q_(x,f,g)}k.memoizedState=g;var I={value:g,getSnapshot:f};return k.queue=I,lR(X_.bind(null,x,I,h),[h]),x.flags|=2048,Qc(9,Bv(),K_.bind(null,x,I,g,f),null),g},useId:function(){var h=ks(),f=dn.identifierPrefix;if(Wt){var g=Yo,x=Xo;g=(x&~(1<<32-kn(x)-1)).toString(32)+g,f=""+f+"R"+g,g=Mv++,0<g&&(f+="H"+g.toString(32)),f+=""}else g=GG++,f=""+f+"r"+g.toString(32)+"";return h.memoizedState=f},useHostTransitionStatus:e2,useFormState:sR,useActionState:sR,useOptimistic:function(h){var f=ks();f.memoizedState=f.baseState=h;var g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=g,f=t2.bind(null,Tt,!0,g),g.dispatch=f,[h,f]},useMemoCache:jw,useCacheRefresh:function(){return ks().memoizedState=XG.bind(null,Tt)}},IR={readContext:Kr,use:Lv,useCallback:mR,useContext:Kr,useEffect:cR,useImperativeHandle:pR,useInsertionEffect:hR,useLayoutEffect:dR,useMemo:gR,useReducer:Pv,useRef:uR,useState:function(){return Pv(Jo)},useDebugValue:Zw,useDeferredValue:function(h,f){var g=Yn();return vR(g,nn.memoizedState,h,f)},useTransition:function(){var h=Pv(Jo)[0],f=Yn().memoizedState;return[typeof h=="boolean"?h:jf(h),f]},useSyncExternalStore:j_,useId:wR,useHostTransitionStatus:e2,useFormState:aR,useActionState:aR,useOptimistic:function(h,f){var g=Yn();return Q_(g,nn,h,f)},useMemoCache:jw,useCacheRefresh:SR},ZG={readContext:Kr,use:Lv,useCallback:mR,useContext:Kr,useEffect:cR,useImperativeHandle:pR,useInsertionEffect:hR,useLayoutEffect:dR,useMemo:gR,useReducer:Kw,useRef:uR,useState:function(){return Kw(Jo)},useDebugValue:Zw,useDeferredValue:function(h,f){var g=Yn();return nn===null?Qw(g,h,f):vR(g,nn.memoizedState,h,f)},useTransition:function(){var h=Kw(Jo)[0],f=Yn().memoizedState;return[typeof h=="boolean"?h:jf(h),f]},useSyncExternalStore:j_,useId:wR,useHostTransitionStatus:e2,useFormState:iR,useActionState:iR,useOptimistic:function(h,f){var g=Yn();return nn!==null?Q_(g,nn,h,f):(g.baseState=h,[h,g.queue.dispatch])},useMemoCache:jw,useCacheRefresh:SR},Jc=null,Xf=0;function Wv(h){var f=Xf;return Xf+=1,Jc===null&&(Jc=[]),P_(Jc,h,f)}function Yf(h,f){f=f.props.ref,h.ref=f!==void 0?f:null}function Gv(h,f){throw f.$$typeof===d?Error(r(525)):(h=Object.prototype.toString.call(f),Error(r(31,h==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":h)))}function ER(h){var f=h._init;return f(h._payload)}function _R(h){function f(ce,ie){if(h){var fe=ce.deletions;fe===null?(ce.deletions=[ie],ce.flags|=16):fe.push(ie)}}function g(ce,ie){if(!h)return null;for(;ie!==null;)f(ce,ie),ie=ie.sibling;return null}function x(ce){for(var ie=new Map;ce!==null;)ce.key!==null?ie.set(ce.key,ce):ie.set(ce.index,ce),ce=ce.sibling;return ie}function k(ce,ie){return ce=Ko(ce,ie),ce.index=0,ce.sibling=null,ce}function I(ce,ie,fe){return ce.index=fe,h?(fe=ce.alternate,fe!==null?(fe=fe.index,fe<ie?(ce.flags|=67108866,ie):fe):(ce.flags|=67108866,ie)):(ce.flags|=1048576,ie)}function F(ce){return h&&ce.alternate===null&&(ce.flags|=67108866),ce}function W(ce,ie,fe,Te){return ie===null||ie.tag!==6?(ie=Sw(fe,ce.mode,Te),ie.return=ce,ie):(ie=k(ie,fe),ie.return=ce,ie)}function te(ce,ie,fe,Te){var He=fe.type;return He===v?ke(ce,ie,fe.props.children,Te,fe.key):ie!==null&&(ie.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===_&&ER(He)===ie.type)?(ie=k(ie,fe.props),Yf(ie,fe),ie.return=ce,ie):(ie=Tv(fe.type,fe.key,fe.props,null,ce.mode,Te),Yf(ie,fe),ie.return=ce,ie)}function me(ce,ie,fe,Te){return ie===null||ie.tag!==4||ie.stateNode.containerInfo!==fe.containerInfo||ie.stateNode.implementation!==fe.implementation?(ie=Cw(fe,ce.mode,Te),ie.return=ce,ie):(ie=k(ie,fe.children||[]),ie.return=ce,ie)}function ke(ce,ie,fe,Te,He){return ie===null||ie.tag!==7?(ie=il(fe,ce.mode,Te,He),ie.return=ce,ie):(ie=k(ie,fe),ie.return=ce,ie)}function Ee(ce,ie,fe){if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return ie=Sw(""+ie,ce.mode,fe),ie.return=ce,ie;if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case p:return fe=Tv(ie.type,ie.key,ie.props,null,ce.mode,fe),Yf(fe,ie),fe.return=ce,fe;case m:return ie=Cw(ie,ce.mode,fe),ie.return=ce,ie;case _:var Te=ie._init;return ie=Te(ie._payload),Ee(ce,ie,fe)}if(G(ie)||M(ie))return ie=il(ie,ce.mode,fe,null),ie.return=ce,ie;if(typeof ie.then=="function")return Ee(ce,Wv(ie),fe);if(ie.$$typeof===N)return Ee(ce,Rv(ce,ie),fe);Gv(ce,ie)}return null}function ve(ce,ie,fe,Te){var He=ie!==null?ie.key:null;if(typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint")return He!==null?null:W(ce,ie,""+fe,Te);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case p:return fe.key===He?te(ce,ie,fe,Te):null;case m:return fe.key===He?me(ce,ie,fe,Te):null;case _:return He=fe._init,fe=He(fe._payload),ve(ce,ie,fe,Te)}if(G(fe)||M(fe))return He!==null?null:ke(ce,ie,fe,Te,null);if(typeof fe.then=="function")return ve(ce,ie,Wv(fe),Te);if(fe.$$typeof===N)return ve(ce,ie,Rv(ce,fe),Te);Gv(ce,fe)}return null}function ye(ce,ie,fe,Te,He){if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return ce=ce.get(fe)||null,W(ie,ce,""+Te,He);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case p:return ce=ce.get(Te.key===null?fe:Te.key)||null,te(ie,ce,Te,He);case m:return ce=ce.get(Te.key===null?fe:Te.key)||null,me(ie,ce,Te,He);case _:var Rt=Te._init;return Te=Rt(Te._payload),ye(ce,ie,fe,Te,He)}if(G(Te)||M(Te))return ce=ce.get(fe)||null,ke(ie,ce,Te,He,null);if(typeof Te.then=="function")return ye(ce,ie,fe,Wv(Te),He);if(Te.$$typeof===N)return ye(ce,ie,fe,Rv(ie,Te),He);Gv(ie,Te)}return null}function dt(ce,ie,fe,Te){for(var He=null,Rt=null,at=ie,ct=ie=0,Nr=null;at!==null&&ct<fe.length;ct++){at.index>ct?(Nr=at,at=null):Nr=at.sibling;var Ut=ve(ce,at,fe[ct],Te);if(Ut===null){at===null&&(at=Nr);break}h&&at&&Ut.alternate===null&&f(ce,at),ie=I(Ut,ie,ct),Rt===null?He=Ut:Rt.sibling=Ut,Rt=Ut,at=Nr}if(ct===fe.length)return g(ce,at),Wt&&ll(ce,ct),He;if(at===null){for(;ct<fe.length;ct++)at=Ee(ce,fe[ct],Te),at!==null&&(ie=I(at,ie,ct),Rt===null?He=at:Rt.sibling=at,Rt=at);return Wt&&ll(ce,ct),He}for(at=x(at);ct<fe.length;ct++)Nr=ye(at,ce,ct,fe[ct],Te),Nr!==null&&(h&&Nr.alternate!==null&&at.delete(Nr.key===null?ct:Nr.key),ie=I(Nr,ie,ct),Rt===null?He=Nr:Rt.sibling=Nr,Rt=Nr);return h&&at.forEach(function(iu){return f(ce,iu)}),Wt&&ll(ce,ct),He}function ut(ce,ie,fe,Te){if(fe==null)throw Error(r(151));for(var He=null,Rt=null,at=ie,ct=ie=0,Nr=null,Ut=fe.next();at!==null&&!Ut.done;ct++,Ut=fe.next()){at.index>ct?(Nr=at,at=null):Nr=at.sibling;var iu=ve(ce,at,Ut.value,Te);if(iu===null){at===null&&(at=Nr);break}h&&at&&iu.alternate===null&&f(ce,at),ie=I(iu,ie,ct),Rt===null?He=iu:Rt.sibling=iu,Rt=iu,at=Nr}if(Ut.done)return g(ce,at),Wt&&ll(ce,ct),He;if(at===null){for(;!Ut.done;ct++,Ut=fe.next())Ut=Ee(ce,Ut.value,Te),Ut!==null&&(ie=I(Ut,ie,ct),Rt===null?He=Ut:Rt.sibling=Ut,Rt=Ut);return Wt&&ll(ce,ct),He}for(at=x(at);!Ut.done;ct++,Ut=fe.next())Ut=ye(at,ce,ct,Ut.value,Te),Ut!==null&&(h&&Ut.alternate!==null&&at.delete(Ut.key===null?ct:Ut.key),ie=I(Ut,ie,ct),Rt===null?He=Ut:Rt.sibling=Ut,Rt=Ut);return h&&at.forEach(function(Q6){return f(ce,Q6)}),Wt&&ll(ce,ct),He}function sn(ce,ie,fe,Te){if(typeof fe=="object"&&fe!==null&&fe.type===v&&fe.key===null&&(fe=fe.props.children),typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case p:e:{for(var He=fe.key;ie!==null;){if(ie.key===He){if(He=fe.type,He===v){if(ie.tag===7){g(ce,ie.sibling),Te=k(ie,fe.props.children),Te.return=ce,ce=Te;break e}}else if(ie.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===_&&ER(He)===ie.type){g(ce,ie.sibling),Te=k(ie,fe.props),Yf(Te,fe),Te.return=ce,ce=Te;break e}g(ce,ie);break}else f(ce,ie);ie=ie.sibling}fe.type===v?(Te=il(fe.props.children,ce.mode,Te,fe.key),Te.return=ce,ce=Te):(Te=Tv(fe.type,fe.key,fe.props,null,ce.mode,Te),Yf(Te,fe),Te.return=ce,ce=Te)}return F(ce);case m:e:{for(He=fe.key;ie!==null;){if(ie.key===He)if(ie.tag===4&&ie.stateNode.containerInfo===fe.containerInfo&&ie.stateNode.implementation===fe.implementation){g(ce,ie.sibling),Te=k(ie,fe.children||[]),Te.return=ce,ce=Te;break e}else{g(ce,ie);break}else f(ce,ie);ie=ie.sibling}Te=Cw(fe,ce.mode,Te),Te.return=ce,ce=Te}return F(ce);case _:return He=fe._init,fe=He(fe._payload),sn(ce,ie,fe,Te)}if(G(fe))return dt(ce,ie,fe,Te);if(M(fe)){if(He=M(fe),typeof He!="function")throw Error(r(150));return fe=He.call(fe),ut(ce,ie,fe,Te)}if(typeof fe.then=="function")return sn(ce,ie,Wv(fe),Te);if(fe.$$typeof===N)return sn(ce,ie,Rv(ce,fe),Te);Gv(ce,fe)}return typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint"?(fe=""+fe,ie!==null&&ie.tag===6?(g(ce,ie.sibling),Te=k(ie,fe),Te.return=ce,ce=Te):(g(ce,ie),Te=Sw(fe,ce.mode,Te),Te.return=ce,ce=Te),F(ce)):g(ce,ie)}return function(ce,ie,fe,Te){try{Xf=0;var He=sn(ce,ie,fe,Te);return Jc=null,He}catch(at){if(at===zf||at===Dv)throw at;var Rt=Hs(29,at,null,ce.mode);return Rt.lanes=Te,Rt.return=ce,Rt}finally{}}}var eh=_R(!0),RR=_R(!1),ya=K(null),lo=null;function ji(h){var f=h.alternate;Z(ar,ar.current&1),Z(ya,h),lo===null&&(f===null||Xc.current!==null||f.memoizedState!==null)&&(lo=h)}function AR(h){if(h.tag===22){if(Z(ar,ar.current),Z(ya,h),lo===null){var f=h.alternate;f!==null&&f.memoizedState!==null&&(lo=h)}}else qi()}function qi(){Z(ar,ar.current),Z(ya,ya.current)}function ei(h){J(ya),lo===h&&(lo=null),J(ar)}var ar=K(0);function Hv(h){for(var f=h;f!==null;){if(f.tag===13){var g=f.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||g.data==="$?"||H2(g)))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===h)break;for(;f.sibling===null;){if(f.return===null||f.return===h)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}function n2(h,f,g,x){f=h.memoizedState,g=g(x,f),g=g==null?f:c({},f,g),h.memoizedState=g,h.lanes===0&&(h.updateQueue.baseState=g)}var r2={enqueueSetState:function(h,f,g){h=h._reactInternals;var x=Xs(),k=Wi(x);k.payload=f,g!=null&&(k.callback=g),f=Gi(h,k,x),f!==null&&(Ys(f,h,x),Uf(f,h,x))},enqueueReplaceState:function(h,f,g){h=h._reactInternals;var x=Xs(),k=Wi(x);k.tag=1,k.payload=f,g!=null&&(k.callback=g),f=Gi(h,k,x),f!==null&&(Ys(f,h,x),Uf(f,h,x))},enqueueForceUpdate:function(h,f){h=h._reactInternals;var g=Xs(),x=Wi(g);x.tag=2,f!=null&&(x.callback=f),f=Gi(h,x,g),f!==null&&(Ys(f,h,g),Uf(f,h,g))}};function DR(h,f,g,x,k,I,F){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(x,I,F):f.prototype&&f.prototype.isPureReactComponent?!Df(g,x)||!Df(k,I):!0}function $R(h,f,g,x){h=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(g,x),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(g,x),f.state!==h&&r2.enqueueReplaceState(f,f.state,null)}function gl(h,f){var g=f;if("ref"in f){g={};for(var x in f)x!=="ref"&&(g[x]=f[x])}if(h=h.defaultProps){g===f&&(g=c({},g));for(var k in h)g[k]===void 0&&(g[k]=h[k])}return g}var jv=typeof reportError=="function"?reportError:function(h){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof h=="object"&&h!==null&&typeof h.message=="string"?String(h.message):String(h),error:h});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",h);return}console.error(h)};function OR(h){jv(h)}function FR(h){console.error(h)}function MR(h){jv(h)}function qv(h,f){try{var g=h.onUncaughtError;g(f.value,{componentStack:f.stack})}catch(x){setTimeout(function(){throw x})}}function LR(h,f,g){try{var x=h.onCaughtError;x(g.value,{componentStack:g.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(k){setTimeout(function(){throw k})}}function s2(h,f,g){return g=Wi(g),g.tag=3,g.payload={element:null},g.callback=function(){qv(h,f)},g}function PR(h){return h=Wi(h),h.tag=3,h}function BR(h,f,g,x){var k=g.type.getDerivedStateFromError;if(typeof k=="function"){var I=x.value;h.payload=function(){return k(I)},h.callback=function(){LR(f,g,x)}}var F=g.stateNode;F!==null&&typeof F.componentDidCatch=="function"&&(h.callback=function(){LR(f,g,x),typeof k!="function"&&(Ji===null?Ji=new Set([this]):Ji.add(this));var W=x.stack;this.componentDidCatch(x.value,{componentStack:W!==null?W:""})})}function QG(h,f,g,x,k){if(g.flags|=32768,x!==null&&typeof x=="object"&&typeof x.then=="function"){if(f=g.alternate,f!==null&&Lf(f,g,k,!0),g=ya.current,g!==null){switch(g.tag){case 13:return lo===null?E2():g.alternate===null&&Dn===0&&(Dn=3),g.flags&=-257,g.flags|=65536,g.lanes=k,x===$w?g.flags|=16384:(f=g.updateQueue,f===null?g.updateQueue=new Set([x]):f.add(x),R2(h,x,k)),!1;case 22:return g.flags|=65536,x===$w?g.flags|=16384:(f=g.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([x])},g.updateQueue=f):(g=f.retryQueue,g===null?f.retryQueue=new Set([x]):g.add(x)),R2(h,x,k)),!1}throw Error(r(435,g.tag))}return R2(h,x,k),E2(),!1}if(Wt)return f=ya.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=k,x!==Tw&&(h=Error(r(422),{cause:x}),Mf(pa(h,g)))):(x!==Tw&&(f=Error(r(423),{cause:x}),Mf(pa(f,g))),h=h.current.alternate,h.flags|=65536,k&=-k,h.lanes|=k,x=pa(x,g),k=s2(h.stateNode,x,k),Mw(h,k),Dn!==4&&(Dn=2)),!1;var I=Error(r(520),{cause:x});if(I=pa(I,g),rp===null?rp=[I]:rp.push(I),Dn!==4&&(Dn=2),f===null)return!0;x=pa(x,g),g=f;do{switch(g.tag){case 3:return g.flags|=65536,h=k&-k,g.lanes|=h,h=s2(g.stateNode,x,h),Mw(g,h),!1;case 1:if(f=g.type,I=g.stateNode,(g.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||I!==null&&typeof I.componentDidCatch=="function"&&(Ji===null||!Ji.has(I))))return g.flags|=65536,k&=-k,g.lanes|=k,k=PR(k),BR(k,h,g,x),Mw(g,k),!1}g=g.return}while(g!==null);return!1}var zR=Error(r(461)),Sr=!1;function Lr(h,f,g,x){f.child=h===null?RR(f,null,g,x):eh(f,h.child,g,x)}function VR(h,f,g,x,k){g=g.render;var I=f.ref;if("ref"in x){var F={};for(var W in x)W!=="ref"&&(F[W]=x[W])}else F=x;return fl(f),x=Vw(h,f,g,F,I,k),W=Uw(),h!==null&&!Sr?(Ww(h,f,k),ti(h,f,k)):(Wt&&W&&Nw(f),f.flags|=1,Lr(h,f,x,k),f.child)}function UR(h,f,g,x,k){if(h===null){var I=g.type;return typeof I=="function"&&!ww(I)&&I.defaultProps===void 0&&g.compare===null?(f.tag=15,f.type=I,WR(h,f,I,x,k)):(h=Tv(g.type,null,x,f,f.mode,k),h.ref=f.ref,h.return=f,f.child=h)}if(I=h.child,!d2(h,k)){var F=I.memoizedProps;if(g=g.compare,g=g!==null?g:Df,g(F,x)&&h.ref===f.ref)return ti(h,f,k)}return f.flags|=1,h=Ko(I,x),h.ref=f.ref,h.return=f,f.child=h}function WR(h,f,g,x,k){if(h!==null){var I=h.memoizedProps;if(Df(I,x)&&h.ref===f.ref)if(Sr=!1,f.pendingProps=x=I,d2(h,k))(h.flags&131072)!==0&&(Sr=!0);else return f.lanes=h.lanes,ti(h,f,k)}return a2(h,f,g,x,k)}function GR(h,f,g){var x=f.pendingProps,k=x.children,I=h!==null?h.memoizedState:null;if(x.mode==="hidden"){if((f.flags&128)!==0){if(x=I!==null?I.baseLanes|g:g,h!==null){for(k=f.child=h.child,I=0;k!==null;)I=I|k.lanes|k.childLanes,k=k.sibling;f.childLanes=I&~x}else f.childLanes=0,f.child=null;return HR(h,f,x,g)}if((g&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},h!==null&&Av(f,I!==null?I.cachePool:null),I!==null?W_(f,I):Pw(),AR(f);else return f.lanes=f.childLanes=536870912,HR(h,f,I!==null?I.baseLanes|g:g,g)}else I!==null?(Av(f,I.cachePool),W_(f,I),qi(),f.memoizedState=null):(h!==null&&Av(f,null),Pw(),qi());return Lr(h,f,k,g),f.child}function HR(h,f,g,x){var k=Dw();return k=k===null?null:{parent:sr._currentValue,pool:k},f.memoizedState={baseLanes:g,cachePool:k},h!==null&&Av(f,null),Pw(),AR(f),h!==null&&Lf(h,f,x,!0),null}function Kv(h,f){var g=f.ref;if(g===null)h!==null&&h.ref!==null&&(f.flags|=4194816);else{if(typeof g!="function"&&typeof g!="object")throw Error(r(284));(h===null||h.ref!==g)&&(f.flags|=4194816)}}function a2(h,f,g,x,k){return fl(f),g=Vw(h,f,g,x,void 0,k),x=Uw(),h!==null&&!Sr?(Ww(h,f,k),ti(h,f,k)):(Wt&&x&&Nw(f),f.flags|=1,Lr(h,f,g,k),f.child)}function jR(h,f,g,x,k,I){return fl(f),f.updateQueue=null,g=H_(f,x,g,k),G_(h),x=Uw(),h!==null&&!Sr?(Ww(h,f,I),ti(h,f,I)):(Wt&&x&&Nw(f),f.flags|=1,Lr(h,f,g,I),f.child)}function qR(h,f,g,x,k){if(fl(f),f.stateNode===null){var I=Gc,F=g.contextType;typeof F=="object"&&F!==null&&(I=Kr(F)),I=new g(x,I),f.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,I.updater=r2,f.stateNode=I,I._reactInternals=f,I=f.stateNode,I.props=x,I.state=f.memoizedState,I.refs={},Ow(f),F=g.contextType,I.context=typeof F=="object"&&F!==null?Kr(F):Gc,I.state=f.memoizedState,F=g.getDerivedStateFromProps,typeof F=="function"&&(n2(f,g,F,x),I.state=f.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(F=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),F!==I.state&&r2.enqueueReplaceState(I,I.state,null),Gf(f,x,I,k),Wf(),I.state=f.memoizedState),typeof I.componentDidMount=="function"&&(f.flags|=4194308),x=!0}else if(h===null){I=f.stateNode;var W=f.memoizedProps,te=gl(g,W);I.props=te;var me=I.context,ke=g.contextType;F=Gc,typeof ke=="object"&&ke!==null&&(F=Kr(ke));var Ee=g.getDerivedStateFromProps;ke=typeof Ee=="function"||typeof I.getSnapshotBeforeUpdate=="function",W=f.pendingProps!==W,ke||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(W||me!==F)&&$R(f,I,x,F),Ui=!1;var ve=f.memoizedState;I.state=ve,Gf(f,x,I,k),Wf(),me=f.memoizedState,W||ve!==me||Ui?(typeof Ee=="function"&&(n2(f,g,Ee,x),me=f.memoizedState),(te=Ui||DR(f,g,te,x,ve,me,F))?(ke||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount()),typeof I.componentDidMount=="function"&&(f.flags|=4194308)):(typeof I.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=x,f.memoizedState=me),I.props=x,I.state=me,I.context=F,x=te):(typeof I.componentDidMount=="function"&&(f.flags|=4194308),x=!1)}else{I=f.stateNode,Fw(h,f),F=f.memoizedProps,ke=gl(g,F),I.props=ke,Ee=f.pendingProps,ve=I.context,me=g.contextType,te=Gc,typeof me=="object"&&me!==null&&(te=Kr(me)),W=g.getDerivedStateFromProps,(me=typeof W=="function"||typeof I.getSnapshotBeforeUpdate=="function")||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(F!==Ee||ve!==te)&&$R(f,I,x,te),Ui=!1,ve=f.memoizedState,I.state=ve,Gf(f,x,I,k),Wf();var ye=f.memoizedState;F!==Ee||ve!==ye||Ui||h!==null&&h.dependencies!==null&&_v(h.dependencies)?(typeof W=="function"&&(n2(f,g,W,x),ye=f.memoizedState),(ke=Ui||DR(f,g,ke,x,ve,ye,te)||h!==null&&h.dependencies!==null&&_v(h.dependencies))?(me||typeof I.UNSAFE_componentWillUpdate!="function"&&typeof I.componentWillUpdate!="function"||(typeof I.componentWillUpdate=="function"&&I.componentWillUpdate(x,ye,te),typeof I.UNSAFE_componentWillUpdate=="function"&&I.UNSAFE_componentWillUpdate(x,ye,te)),typeof I.componentDidUpdate=="function"&&(f.flags|=4),typeof I.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof I.componentDidUpdate!="function"||F===h.memoizedProps&&ve===h.memoizedState||(f.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||F===h.memoizedProps&&ve===h.memoizedState||(f.flags|=1024),f.memoizedProps=x,f.memoizedState=ye),I.props=x,I.state=ye,I.context=te,x=ke):(typeof I.componentDidUpdate!="function"||F===h.memoizedProps&&ve===h.memoizedState||(f.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||F===h.memoizedProps&&ve===h.memoizedState||(f.flags|=1024),x=!1)}return I=x,Kv(h,f),x=(f.flags&128)!==0,I||x?(I=f.stateNode,g=x&&typeof g.getDerivedStateFromError!="function"?null:I.render(),f.flags|=1,h!==null&&x?(f.child=eh(f,h.child,null,k),f.child=eh(f,null,g,k)):Lr(h,f,g,k),f.memoizedState=I.state,h=f.child):h=ti(h,f,k),h}function KR(h,f,g,x){return Ff(),f.flags|=256,Lr(h,f,g,x),f.child}var o2={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function i2(h){return{baseLanes:h,cachePool:F_()}}function u2(h,f,g){return h=h!==null?h.childLanes&~g:0,f&&(h|=ba),h}function XR(h,f,g){var x=f.pendingProps,k=!1,I=(f.flags&128)!==0,F;if((F=I)||(F=h!==null&&h.memoizedState===null?!1:(ar.current&2)!==0),F&&(k=!0,f.flags&=-129),F=(f.flags&32)!==0,f.flags&=-33,h===null){if(Wt){if(k?ji(f):qi(),Wt){var W=An,te;if(te=W){e:{for(te=W,W=uo;te.nodeType!==8;){if(!W){W=null;break e}if(te=Pa(te.nextSibling),te===null){W=null;break e}}W=te}W!==null?(f.memoizedState={dehydrated:W,treeContext:ul!==null?{id:Xo,overflow:Yo}:null,retryLane:536870912,hydrationErrors:null},te=Hs(18,null,null,0),te.stateNode=W,te.return=f,f.child=te,cs=f,An=null,te=!0):te=!1}te||hl(f)}if(W=f.memoizedState,W!==null&&(W=W.dehydrated,W!==null))return H2(W)?f.lanes=32:f.lanes=536870912,null;ei(f)}return W=x.children,x=x.fallback,k?(qi(),k=f.mode,W=Xv({mode:"hidden",children:W},k),x=il(x,k,g,null),W.return=f,x.return=f,W.sibling=x,f.child=W,k=f.child,k.memoizedState=i2(g),k.childLanes=u2(h,F,g),f.memoizedState=o2,x):(ji(f),l2(f,W))}if(te=h.memoizedState,te!==null&&(W=te.dehydrated,W!==null)){if(I)f.flags&256?(ji(f),f.flags&=-257,f=c2(h,f,g)):f.memoizedState!==null?(qi(),f.child=h.child,f.flags|=128,f=null):(qi(),k=x.fallback,W=f.mode,x=Xv({mode:"visible",children:x.children},W),k=il(k,W,g,null),k.flags|=2,x.return=f,k.return=f,x.sibling=k,f.child=x,eh(f,h.child,null,g),x=f.child,x.memoizedState=i2(g),x.childLanes=u2(h,F,g),f.memoizedState=o2,f=k);else if(ji(f),H2(W)){if(F=W.nextSibling&&W.nextSibling.dataset,F)var me=F.dgst;F=me,x=Error(r(419)),x.stack="",x.digest=F,Mf({value:x,source:null,stack:null}),f=c2(h,f,g)}else if(Sr||Lf(h,f,g,!1),F=(g&h.childLanes)!==0,Sr||F){if(F=dn,F!==null&&(x=g&-g,x=(x&42)!==0?1:j1(x),x=(x&(F.suspendedLanes|g))!==0?0:x,x!==0&&x!==te.retryLane))throw te.retryLane=x,Wc(h,x),Ys(F,h,x),zR;W.data==="$?"||E2(),f=c2(h,f,g)}else W.data==="$?"?(f.flags|=192,f.child=h.child,f=null):(h=te.treeContext,An=Pa(W.nextSibling),cs=f,Wt=!0,cl=null,uo=!1,h!==null&&(ga[va++]=Xo,ga[va++]=Yo,ga[va++]=ul,Xo=h.id,Yo=h.overflow,ul=f),f=l2(f,x.children),f.flags|=4096);return f}return k?(qi(),k=x.fallback,W=f.mode,te=h.child,me=te.sibling,x=Ko(te,{mode:"hidden",children:x.children}),x.subtreeFlags=te.subtreeFlags&65011712,me!==null?k=Ko(me,k):(k=il(k,W,g,null),k.flags|=2),k.return=f,x.return=f,x.sibling=k,f.child=x,x=k,k=f.child,W=h.child.memoizedState,W===null?W=i2(g):(te=W.cachePool,te!==null?(me=sr._currentValue,te=te.parent!==me?{parent:me,pool:me}:te):te=F_(),W={baseLanes:W.baseLanes|g,cachePool:te}),k.memoizedState=W,k.childLanes=u2(h,F,g),f.memoizedState=o2,x):(ji(f),g=h.child,h=g.sibling,g=Ko(g,{mode:"visible",children:x.children}),g.return=f,g.sibling=null,h!==null&&(F=f.deletions,F===null?(f.deletions=[h],f.flags|=16):F.push(h)),f.child=g,f.memoizedState=null,g)}function l2(h,f){return f=Xv({mode:"visible",children:f},h.mode),f.return=h,h.child=f}function Xv(h,f){return h=Hs(22,h,null,f),h.lanes=0,h.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},h}function c2(h,f,g){return eh(f,h.child,null,g),h=l2(f,f.pendingProps.children),h.flags|=2,f.memoizedState=null,h}function YR(h,f,g){h.lanes|=f;var x=h.alternate;x!==null&&(x.lanes|=f),Ew(h.return,f,g)}function h2(h,f,g,x,k){var I=h.memoizedState;I===null?h.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:x,tail:g,tailMode:k}:(I.isBackwards=f,I.rendering=null,I.renderingStartTime=0,I.last=x,I.tail=g,I.tailMode=k)}function ZR(h,f,g){var x=f.pendingProps,k=x.revealOrder,I=x.tail;if(Lr(h,f,x.children,g),x=ar.current,(x&2)!==0)x=x&1|2,f.flags|=128;else{if(h!==null&&(h.flags&128)!==0)e:for(h=f.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&YR(h,g,f);else if(h.tag===19)YR(h,g,f);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===f)break e;for(;h.sibling===null;){if(h.return===null||h.return===f)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}x&=1}switch(Z(ar,x),k){case"forwards":for(g=f.child,k=null;g!==null;)h=g.alternate,h!==null&&Hv(h)===null&&(k=g),g=g.sibling;g=k,g===null?(k=f.child,f.child=null):(k=g.sibling,g.sibling=null),h2(f,!1,k,g,I);break;case"backwards":for(g=null,k=f.child,f.child=null;k!==null;){if(h=k.alternate,h!==null&&Hv(h)===null){f.child=k;break}h=k.sibling,k.sibling=g,g=k,k=h}h2(f,!0,g,null,I);break;case"together":h2(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function ti(h,f,g){if(h!==null&&(f.dependencies=h.dependencies),Qi|=f.lanes,(g&f.childLanes)===0)if(h!==null){if(Lf(h,f,g,!1),(g&f.childLanes)===0)return null}else return null;if(h!==null&&f.child!==h.child)throw Error(r(153));if(f.child!==null){for(h=f.child,g=Ko(h,h.pendingProps),f.child=g,g.return=f;h.sibling!==null;)h=h.sibling,g=g.sibling=Ko(h,h.pendingProps),g.return=f;g.sibling=null}return f.child}function d2(h,f){return(h.lanes&f)!==0?!0:(h=h.dependencies,!!(h!==null&&_v(h)))}function JG(h,f,g){switch(f.tag){case 3:Ie(f,f.stateNode.containerInfo),Vi(f,sr,h.memoizedState.cache),Ff();break;case 27:case 5:Be(f);break;case 4:Ie(f,f.stateNode.containerInfo);break;case 10:Vi(f,f.type,f.memoizedProps.value);break;case 13:var x=f.memoizedState;if(x!==null)return x.dehydrated!==null?(ji(f),f.flags|=128,null):(g&f.child.childLanes)!==0?XR(h,f,g):(ji(f),h=ti(h,f,g),h!==null?h.sibling:null);ji(f);break;case 19:var k=(h.flags&128)!==0;if(x=(g&f.childLanes)!==0,x||(Lf(h,f,g,!1),x=(g&f.childLanes)!==0),k){if(x)return ZR(h,f,g);f.flags|=128}if(k=f.memoizedState,k!==null&&(k.rendering=null,k.tail=null,k.lastEffect=null),Z(ar,ar.current),x)break;return null;case 22:case 23:return f.lanes=0,GR(h,f,g);case 24:Vi(f,sr,h.memoizedState.cache)}return ti(h,f,g)}function QR(h,f,g){if(h!==null)if(h.memoizedProps!==f.pendingProps)Sr=!0;else{if(!d2(h,g)&&(f.flags&128)===0)return Sr=!1,JG(h,f,g);Sr=(h.flags&131072)!==0}else Sr=!1,Wt&&(f.flags&1048576)!==0&&E_(f,Ev,f.index);switch(f.lanes=0,f.tag){case 16:e:{h=f.pendingProps;var x=f.elementType,k=x._init;if(x=k(x._payload),f.type=x,typeof x=="function")ww(x)?(h=gl(x,h),f.tag=1,f=qR(null,f,x,h,g)):(f.tag=0,f=a2(null,f,x,h,g));else{if(x!=null){if(k=x.$$typeof,k===C){f.tag=11,f=VR(null,f,x,h,g);break e}else if(k===$){f.tag=14,f=UR(null,f,x,h,g);break e}}throw f=j(x)||x,Error(r(306,f,""))}}return f;case 0:return a2(h,f,f.type,f.pendingProps,g);case 1:return x=f.type,k=gl(x,f.pendingProps),qR(h,f,x,k,g);case 3:e:{if(Ie(f,f.stateNode.containerInfo),h===null)throw Error(r(387));x=f.pendingProps;var I=f.memoizedState;k=I.element,Fw(h,f),Gf(f,x,null,g);var F=f.memoizedState;if(x=F.cache,Vi(f,sr,x),x!==I.cache&&_w(f,[sr],g,!0),Wf(),x=F.element,I.isDehydrated)if(I={element:x,isDehydrated:!1,cache:F.cache},f.updateQueue.baseState=I,f.memoizedState=I,f.flags&256){f=KR(h,f,x,g);break e}else if(x!==k){k=pa(Error(r(424)),f),Mf(k),f=KR(h,f,x,g);break e}else{switch(h=f.stateNode.containerInfo,h.nodeType){case 9:h=h.body;break;default:h=h.nodeName==="HTML"?h.ownerDocument.body:h}for(An=Pa(h.firstChild),cs=f,Wt=!0,cl=null,uo=!0,g=RR(f,null,x,g),f.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling}else{if(Ff(),x===k){f=ti(h,f,g);break e}Lr(h,f,x,g)}f=f.child}return f;case 26:return Kv(h,f),h===null?(g=nD(f.type,null,f.pendingProps,null))?f.memoizedState=g:Wt||(g=f.type,h=f.pendingProps,x=ly(ge.current).createElement(g),x[qr]=f,x[Cs]=h,Br(x,g,h),wr(x),f.stateNode=x):f.memoizedState=nD(f.type,h.memoizedProps,f.pendingProps,h.memoizedState),null;case 27:return Be(f),h===null&&Wt&&(x=f.stateNode=JA(f.type,f.pendingProps,ge.current),cs=f,uo=!0,k=An,nu(f.type)?(j2=k,An=Pa(x.firstChild)):An=k),Lr(h,f,f.pendingProps.children,g),Kv(h,f),h===null&&(f.flags|=4194304),f.child;case 5:return h===null&&Wt&&((k=x=An)&&(x=I6(x,f.type,f.pendingProps,uo),x!==null?(f.stateNode=x,cs=f,An=Pa(x.firstChild),uo=!1,k=!0):k=!1),k||hl(f)),Be(f),k=f.type,I=f.pendingProps,F=h!==null?h.memoizedProps:null,x=I.children,U2(k,I)?x=null:F!==null&&U2(k,F)&&(f.flags|=32),f.memoizedState!==null&&(k=Vw(h,f,HG,null,null,g),dp._currentValue=k),Kv(h,f),Lr(h,f,x,g),f.child;case 6:return h===null&&Wt&&((h=g=An)&&(g=E6(g,f.pendingProps,uo),g!==null?(f.stateNode=g,cs=f,An=null,h=!0):h=!1),h||hl(f)),null;case 13:return XR(h,f,g);case 4:return Ie(f,f.stateNode.containerInfo),x=f.pendingProps,h===null?f.child=eh(f,null,x,g):Lr(h,f,x,g),f.child;case 11:return VR(h,f,f.type,f.pendingProps,g);case 7:return Lr(h,f,f.pendingProps,g),f.child;case 8:return Lr(h,f,f.pendingProps.children,g),f.child;case 12:return Lr(h,f,f.pendingProps.children,g),f.child;case 10:return x=f.pendingProps,Vi(f,f.type,x.value),Lr(h,f,x.children,g),f.child;case 9:return k=f.type._context,x=f.pendingProps.children,fl(f),k=Kr(k),x=x(k),f.flags|=1,Lr(h,f,x,g),f.child;case 14:return UR(h,f,f.type,f.pendingProps,g);case 15:return WR(h,f,f.type,f.pendingProps,g);case 19:return ZR(h,f,g);case 31:return x=f.pendingProps,g=f.mode,x={mode:x.mode,children:x.children},h===null?(g=Xv(x,g),g.ref=f.ref,f.child=g,g.return=f,f=g):(g=Ko(h.child,x),g.ref=f.ref,f.child=g,g.return=f,f=g),f;case 22:return GR(h,f,g);case 24:return fl(f),x=Kr(sr),h===null?(k=Dw(),k===null&&(k=dn,I=Rw(),k.pooledCache=I,I.refCount++,I!==null&&(k.pooledCacheLanes|=g),k=I),f.memoizedState={parent:x,cache:k},Ow(f),Vi(f,sr,k)):((h.lanes&g)!==0&&(Fw(h,f),Gf(f,null,null,g),Wf()),k=h.memoizedState,I=f.memoizedState,k.parent!==x?(k={parent:x,cache:x},f.memoizedState=k,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=k),Vi(f,sr,x)):(x=I.cache,Vi(f,sr,x),x!==k.cache&&_w(f,[sr],g,!0))),Lr(h,f,f.pendingProps.children,g),f.child;case 29:throw f.pendingProps}throw Error(r(156,f.tag))}function ni(h){h.flags|=4}function JR(h,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)h.flags&=-16777217;else if(h.flags|=16777216,!iD(f)){if(f=ya.current,f!==null&&((Bt&4194048)===Bt?lo!==null:(Bt&62914560)!==Bt&&(Bt&536870912)===0||f!==lo))throw Vf=$w,M_;h.flags|=8192}}function Yv(h,f){f!==null&&(h.flags|=4),h.flags&16384&&(f=h.tag!==22?AE():536870912,h.lanes|=f,sh|=f)}function Zf(h,f){if(!Wt)switch(h.tailMode){case"hidden":f=h.tail;for(var g=null;f!==null;)f.alternate!==null&&(g=f),f=f.sibling;g===null?h.tail=null:g.sibling=null;break;case"collapsed":g=h.tail;for(var x=null;g!==null;)g.alternate!==null&&(x=g),g=g.sibling;x===null?f||h.tail===null?h.tail=null:h.tail.sibling=null:x.sibling=null}}function Tn(h){var f=h.alternate!==null&&h.alternate.child===h.child,g=0,x=0;if(f)for(var k=h.child;k!==null;)g|=k.lanes|k.childLanes,x|=k.subtreeFlags&65011712,x|=k.flags&65011712,k.return=h,k=k.sibling;else for(k=h.child;k!==null;)g|=k.lanes|k.childLanes,x|=k.subtreeFlags,x|=k.flags,k.return=h,k=k.sibling;return h.subtreeFlags|=x,h.childLanes=g,f}function e6(h,f,g){var x=f.pendingProps;switch(kw(f),f.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Tn(f),null;case 1:return Tn(f),null;case 3:return g=f.stateNode,x=null,h!==null&&(x=h.memoizedState.cache),f.memoizedState.cache!==x&&(f.flags|=2048),Qo(sr),$e(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(h===null||h.child===null)&&(Of(f)?ni(f):h===null||h.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,A_())),Tn(f),null;case 26:return g=f.memoizedState,h===null?(ni(f),g!==null?(Tn(f),JR(f,g)):(Tn(f),f.flags&=-16777217)):g?g!==h.memoizedState?(ni(f),Tn(f),JR(f,g)):(Tn(f),f.flags&=-16777217):(h.memoizedProps!==x&&ni(f),Tn(f),f.flags&=-16777217),null;case 27:Oe(f),g=ge.current;var k=f.type;if(h!==null&&f.stateNode!=null)h.memoizedProps!==x&&ni(f);else{if(!x){if(f.stateNode===null)throw Error(r(166));return Tn(f),null}h=le.current,Of(f)?__(f):(h=JA(k,x,g),f.stateNode=h,ni(f))}return Tn(f),null;case 5:if(Oe(f),g=f.type,h!==null&&f.stateNode!=null)h.memoizedProps!==x&&ni(f);else{if(!x){if(f.stateNode===null)throw Error(r(166));return Tn(f),null}if(h=le.current,Of(f))__(f);else{switch(k=ly(ge.current),h){case 1:h=k.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:h=k.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":h=k.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":h=k.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":h=k.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild);break;case"select":h=typeof x.is=="string"?k.createElement("select",{is:x.is}):k.createElement("select"),x.multiple?h.multiple=!0:x.size&&(h.size=x.size);break;default:h=typeof x.is=="string"?k.createElement(g,{is:x.is}):k.createElement(g)}}h[qr]=f,h[Cs]=x;e:for(k=f.child;k!==null;){if(k.tag===5||k.tag===6)h.appendChild(k.stateNode);else if(k.tag!==4&&k.tag!==27&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===f)break e;for(;k.sibling===null;){if(k.return===null||k.return===f)break e;k=k.return}k.sibling.return=k.return,k=k.sibling}f.stateNode=h;e:switch(Br(h,g,x),g){case"button":case"input":case"select":case"textarea":h=!!x.autoFocus;break e;case"img":h=!0;break e;default:h=!1}h&&ni(f)}}return Tn(f),f.flags&=-16777217,null;case 6:if(h&&f.stateNode!=null)h.memoizedProps!==x&&ni(f);else{if(typeof x!="string"&&f.stateNode===null)throw Error(r(166));if(h=ge.current,Of(f)){if(h=f.stateNode,g=f.memoizedProps,x=null,k=cs,k!==null)switch(k.tag){case 27:case 5:x=k.memoizedProps}h[qr]=f,h=!!(h.nodeValue===g||x!==null&&x.suppressHydrationWarning===!0||jA(h.nodeValue,g)),h||hl(f)}else h=ly(h).createTextNode(x),h[qr]=f,f.stateNode=h}return Tn(f),null;case 13:if(x=f.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(k=Of(f),x!==null&&x.dehydrated!==null){if(h===null){if(!k)throw Error(r(318));if(k=f.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(r(317));k[qr]=f}else Ff(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;Tn(f),k=!1}else k=A_(),h!==null&&h.memoizedState!==null&&(h.memoizedState.hydrationErrors=k),k=!0;if(!k)return f.flags&256?(ei(f),f):(ei(f),null)}if(ei(f),(f.flags&128)!==0)return f.lanes=g,f;if(g=x!==null,h=h!==null&&h.memoizedState!==null,g){x=f.child,k=null,x.alternate!==null&&x.alternate.memoizedState!==null&&x.alternate.memoizedState.cachePool!==null&&(k=x.alternate.memoizedState.cachePool.pool);var I=null;x.memoizedState!==null&&x.memoizedState.cachePool!==null&&(I=x.memoizedState.cachePool.pool),I!==k&&(x.flags|=2048)}return g!==h&&g&&(f.child.flags|=8192),Yv(f,f.updateQueue),Tn(f),null;case 4:return $e(),h===null&&L2(f.stateNode.containerInfo),Tn(f),null;case 10:return Qo(f.type),Tn(f),null;case 19:if(J(ar),k=f.memoizedState,k===null)return Tn(f),null;if(x=(f.flags&128)!==0,I=k.rendering,I===null)if(x)Zf(k,!1);else{if(Dn!==0||h!==null&&(h.flags&128)!==0)for(h=f.child;h!==null;){if(I=Hv(h),I!==null){for(f.flags|=128,Zf(k,!1),h=I.updateQueue,f.updateQueue=h,Yv(f,h),f.subtreeFlags=0,h=g,g=f.child;g!==null;)I_(g,h),g=g.sibling;return Z(ar,ar.current&1|2),f.child}h=h.sibling}k.tail!==null&&pt()>Jv&&(f.flags|=128,x=!0,Zf(k,!1),f.lanes=4194304)}else{if(!x)if(h=Hv(I),h!==null){if(f.flags|=128,x=!0,h=h.updateQueue,f.updateQueue=h,Yv(f,h),Zf(k,!0),k.tail===null&&k.tailMode==="hidden"&&!I.alternate&&!Wt)return Tn(f),null}else 2*pt()-k.renderingStartTime>Jv&&g!==536870912&&(f.flags|=128,x=!0,Zf(k,!1),f.lanes=4194304);k.isBackwards?(I.sibling=f.child,f.child=I):(h=k.last,h!==null?h.sibling=I:f.child=I,k.last=I)}return k.tail!==null?(f=k.tail,k.rendering=f,k.tail=f.sibling,k.renderingStartTime=pt(),f.sibling=null,h=ar.current,Z(ar,x?h&1|2:h&1),f):(Tn(f),null);case 22:case 23:return ei(f),Bw(),x=f.memoizedState!==null,h!==null?h.memoizedState!==null!==x&&(f.flags|=8192):x&&(f.flags|=8192),x?(g&536870912)!==0&&(f.flags&128)===0&&(Tn(f),f.subtreeFlags&6&&(f.flags|=8192)):Tn(f),g=f.updateQueue,g!==null&&Yv(f,g.retryQueue),g=null,h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(g=h.memoizedState.cachePool.pool),x=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(x=f.memoizedState.cachePool.pool),x!==g&&(f.flags|=2048),h!==null&&J(pl),null;case 24:return g=null,h!==null&&(g=h.memoizedState.cache),f.memoizedState.cache!==g&&(f.flags|=2048),Qo(sr),Tn(f),null;case 25:return null;case 30:return null}throw Error(r(156,f.tag))}function t6(h,f){switch(kw(f),f.tag){case 1:return h=f.flags,h&65536?(f.flags=h&-65537|128,f):null;case 3:return Qo(sr),$e(),h=f.flags,(h&65536)!==0&&(h&128)===0?(f.flags=h&-65537|128,f):null;case 26:case 27:case 5:return Oe(f),null;case 13:if(ei(f),h=f.memoizedState,h!==null&&h.dehydrated!==null){if(f.alternate===null)throw Error(r(340));Ff()}return h=f.flags,h&65536?(f.flags=h&-65537|128,f):null;case 19:return J(ar),null;case 4:return $e(),null;case 10:return Qo(f.type),null;case 22:case 23:return ei(f),Bw(),h!==null&&J(pl),h=f.flags,h&65536?(f.flags=h&-65537|128,f):null;case 24:return Qo(sr),null;case 25:return null;default:return null}}function eA(h,f){switch(kw(f),f.tag){case 3:Qo(sr),$e();break;case 26:case 27:case 5:Oe(f);break;case 4:$e();break;case 13:ei(f);break;case 19:J(ar);break;case 10:Qo(f.type);break;case 22:case 23:ei(f),Bw(),h!==null&&J(pl);break;case 24:Qo(sr)}}function Qf(h,f){try{var g=f.updateQueue,x=g!==null?g.lastEffect:null;if(x!==null){var k=x.next;g=k;do{if((g.tag&h)===h){x=void 0;var I=g.create,F=g.inst;x=I(),F.destroy=x}g=g.next}while(g!==k)}}catch(W){on(f,f.return,W)}}function Ki(h,f,g){try{var x=f.updateQueue,k=x!==null?x.lastEffect:null;if(k!==null){var I=k.next;x=I;do{if((x.tag&h)===h){var F=x.inst,W=F.destroy;if(W!==void 0){F.destroy=void 0,k=f;var te=g,me=W;try{me()}catch(ke){on(k,te,ke)}}}x=x.next}while(x!==I)}}catch(ke){on(f,f.return,ke)}}function tA(h){var f=h.updateQueue;if(f!==null){var g=h.stateNode;try{U_(f,g)}catch(x){on(h,h.return,x)}}}function nA(h,f,g){g.props=gl(h.type,h.memoizedProps),g.state=h.memoizedState;try{g.componentWillUnmount()}catch(x){on(h,f,x)}}function Jf(h,f){try{var g=h.ref;if(g!==null){switch(h.tag){case 26:case 27:case 5:var x=h.stateNode;break;case 30:x=h.stateNode;break;default:x=h.stateNode}typeof g=="function"?h.refCleanup=g(x):g.current=x}}catch(k){on(h,f,k)}}function co(h,f){var g=h.ref,x=h.refCleanup;if(g!==null)if(typeof x=="function")try{x()}catch(k){on(h,f,k)}finally{h.refCleanup=null,h=h.alternate,h!=null&&(h.refCleanup=null)}else if(typeof g=="function")try{g(null)}catch(k){on(h,f,k)}else g.current=null}function rA(h){var f=h.type,g=h.memoizedProps,x=h.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":g.autoFocus&&x.focus();break e;case"img":g.src?x.src=g.src:g.srcSet&&(x.srcset=g.srcSet)}}catch(k){on(h,h.return,k)}}function f2(h,f,g){try{var x=h.stateNode;S6(x,h.type,g,f),x[Cs]=f}catch(k){on(h,h.return,k)}}function sA(h){return h.tag===5||h.tag===3||h.tag===26||h.tag===27&&nu(h.type)||h.tag===4}function p2(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||sA(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.tag===27&&nu(h.type)||h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function m2(h,f,g){var x=h.tag;if(x===5||x===6)h=h.stateNode,f?(g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g).insertBefore(h,f):(f=g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g,f.appendChild(h),g=g._reactRootContainer,g!=null||f.onclick!==null||(f.onclick=uy));else if(x!==4&&(x===27&&nu(h.type)&&(g=h.stateNode,f=null),h=h.child,h!==null))for(m2(h,f,g),h=h.sibling;h!==null;)m2(h,f,g),h=h.sibling}function Zv(h,f,g){var x=h.tag;if(x===5||x===6)h=h.stateNode,f?g.insertBefore(h,f):g.appendChild(h);else if(x!==4&&(x===27&&nu(h.type)&&(g=h.stateNode),h=h.child,h!==null))for(Zv(h,f,g),h=h.sibling;h!==null;)Zv(h,f,g),h=h.sibling}function aA(h){var f=h.stateNode,g=h.memoizedProps;try{for(var x=h.type,k=f.attributes;k.length;)f.removeAttributeNode(k[0]);Br(f,x,g),f[qr]=h,f[Cs]=g}catch(I){on(h,h.return,I)}}var ri=!1,Vn=!1,g2=!1,oA=typeof WeakSet=="function"?WeakSet:Set,Cr=null;function n6(h,f){if(h=h.containerInfo,z2=my,h=v_(h),pw(h)){if("selectionStart"in h)var g={start:h.selectionStart,end:h.selectionEnd};else e:{g=(g=h.ownerDocument)&&g.defaultView||window;var x=g.getSelection&&g.getSelection();if(x&&x.rangeCount!==0){g=x.anchorNode;var k=x.anchorOffset,I=x.focusNode;x=x.focusOffset;try{g.nodeType,I.nodeType}catch{g=null;break e}var F=0,W=-1,te=-1,me=0,ke=0,Ee=h,ve=null;t:for(;;){for(var ye;Ee!==g||k!==0&&Ee.nodeType!==3||(W=F+k),Ee!==I||x!==0&&Ee.nodeType!==3||(te=F+x),Ee.nodeType===3&&(F+=Ee.nodeValue.length),(ye=Ee.firstChild)!==null;)ve=Ee,Ee=ye;for(;;){if(Ee===h)break t;if(ve===g&&++me===k&&(W=F),ve===I&&++ke===x&&(te=F),(ye=Ee.nextSibling)!==null)break;Ee=ve,ve=Ee.parentNode}Ee=ye}g=W===-1||te===-1?null:{start:W,end:te}}else g=null}g=g||{start:0,end:0}}else g=null;for(V2={focusedElem:h,selectionRange:g},my=!1,Cr=f;Cr!==null;)if(f=Cr,h=f.child,(f.subtreeFlags&1024)!==0&&h!==null)h.return=f,Cr=h;else for(;Cr!==null;){switch(f=Cr,I=f.alternate,h=f.flags,f.tag){case 0:break;case 11:case 15:break;case 1:if((h&1024)!==0&&I!==null){h=void 0,g=f,k=I.memoizedProps,I=I.memoizedState,x=g.stateNode;try{var dt=gl(g.type,k,g.elementType===g.type);h=x.getSnapshotBeforeUpdate(dt,I),x.__reactInternalSnapshotBeforeUpdate=h}catch(ut){on(g,g.return,ut)}}break;case 3:if((h&1024)!==0){if(h=f.stateNode.containerInfo,g=h.nodeType,g===9)G2(h);else if(g===1)switch(h.nodeName){case"HEAD":case"HTML":case"BODY":G2(h);break;default:h.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((h&1024)!==0)throw Error(r(163))}if(h=f.sibling,h!==null){h.return=f.return,Cr=h;break}Cr=f.return}}function iA(h,f,g){var x=g.flags;switch(g.tag){case 0:case 11:case 15:Xi(h,g),x&4&&Qf(5,g);break;case 1:if(Xi(h,g),x&4)if(h=g.stateNode,f===null)try{h.componentDidMount()}catch(F){on(g,g.return,F)}else{var k=gl(g.type,f.memoizedProps);f=f.memoizedState;try{h.componentDidUpdate(k,f,h.__reactInternalSnapshotBeforeUpdate)}catch(F){on(g,g.return,F)}}x&64&&tA(g),x&512&&Jf(g,g.return);break;case 3:if(Xi(h,g),x&64&&(h=g.updateQueue,h!==null)){if(f=null,g.child!==null)switch(g.child.tag){case 27:case 5:f=g.child.stateNode;break;case 1:f=g.child.stateNode}try{U_(h,f)}catch(F){on(g,g.return,F)}}break;case 27:f===null&&x&4&&aA(g);case 26:case 5:Xi(h,g),f===null&&x&4&&rA(g),x&512&&Jf(g,g.return);break;case 12:Xi(h,g);break;case 13:Xi(h,g),x&4&&cA(h,g),x&64&&(h=g.memoizedState,h!==null&&(h=h.dehydrated,h!==null&&(g=h6.bind(null,g),_6(h,g))));break;case 22:if(x=g.memoizedState!==null||ri,!x){f=f!==null&&f.memoizedState!==null||Vn,k=ri;var I=Vn;ri=x,(Vn=f)&&!I?Yi(h,g,(g.subtreeFlags&8772)!==0):Xi(h,g),ri=k,Vn=I}break;case 30:break;default:Xi(h,g)}}function uA(h){var f=h.alternate;f!==null&&(h.alternate=null,uA(f)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(f=h.stateNode,f!==null&&X1(f)),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}var yn=null,Ts=!1;function si(h,f,g){for(g=g.child;g!==null;)lA(h,f,g),g=g.sibling}function lA(h,f,g){if(Xt&&typeof Xt.onCommitFiberUnmount=="function")try{Xt.onCommitFiberUnmount(xr,g)}catch{}switch(g.tag){case 26:Vn||co(g,f),si(h,f,g),g.memoizedState?g.memoizedState.count--:g.stateNode&&(g=g.stateNode,g.parentNode.removeChild(g));break;case 27:Vn||co(g,f);var x=yn,k=Ts;nu(g.type)&&(yn=g.stateNode,Ts=!1),si(h,f,g),up(g.stateNode),yn=x,Ts=k;break;case 5:Vn||co(g,f);case 6:if(x=yn,k=Ts,yn=null,si(h,f,g),yn=x,Ts=k,yn!==null)if(Ts)try{(yn.nodeType===9?yn.body:yn.nodeName==="HTML"?yn.ownerDocument.body:yn).removeChild(g.stateNode)}catch(I){on(g,f,I)}else try{yn.removeChild(g.stateNode)}catch(I){on(g,f,I)}break;case 18:yn!==null&&(Ts?(h=yn,ZA(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,g.stateNode),gp(h)):ZA(yn,g.stateNode));break;case 4:x=yn,k=Ts,yn=g.stateNode.containerInfo,Ts=!0,si(h,f,g),yn=x,Ts=k;break;case 0:case 11:case 14:case 15:Vn||Ki(2,g,f),Vn||Ki(4,g,f),si(h,f,g);break;case 1:Vn||(co(g,f),x=g.stateNode,typeof x.componentWillUnmount=="function"&&nA(g,f,x)),si(h,f,g);break;case 21:si(h,f,g);break;case 22:Vn=(x=Vn)||g.memoizedState!==null,si(h,f,g),Vn=x;break;default:si(h,f,g)}}function cA(h,f){if(f.memoizedState===null&&(h=f.alternate,h!==null&&(h=h.memoizedState,h!==null&&(h=h.dehydrated,h!==null))))try{gp(h)}catch(g){on(f,f.return,g)}}function r6(h){switch(h.tag){case 13:case 19:var f=h.stateNode;return f===null&&(f=h.stateNode=new oA),f;case 22:return h=h.stateNode,f=h._retryCache,f===null&&(f=h._retryCache=new oA),f;default:throw Error(r(435,h.tag))}}function v2(h,f){var g=r6(h);f.forEach(function(x){var k=d6.bind(null,h,x);g.has(x)||(g.add(x),x.then(k,k))})}function js(h,f){var g=f.deletions;if(g!==null)for(var x=0;x<g.length;x++){var k=g[x],I=h,F=f,W=F;e:for(;W!==null;){switch(W.tag){case 27:if(nu(W.type)){yn=W.stateNode,Ts=!1;break e}break;case 5:yn=W.stateNode,Ts=!1;break e;case 3:case 4:yn=W.stateNode.containerInfo,Ts=!0;break e}W=W.return}if(yn===null)throw Error(r(160));lA(I,F,k),yn=null,Ts=!1,I=k.alternate,I!==null&&(I.return=null),k.return=null}if(f.subtreeFlags&13878)for(f=f.child;f!==null;)hA(f,h),f=f.sibling}var La=null;function hA(h,f){var g=h.alternate,x=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:js(f,h),qs(h),x&4&&(Ki(3,h,h.return),Qf(3,h),Ki(5,h,h.return));break;case 1:js(f,h),qs(h),x&512&&(Vn||g===null||co(g,g.return)),x&64&&ri&&(h=h.updateQueue,h!==null&&(x=h.callbacks,x!==null&&(g=h.shared.hiddenCallbacks,h.shared.hiddenCallbacks=g===null?x:g.concat(x))));break;case 26:var k=La;if(js(f,h),qs(h),x&512&&(Vn||g===null||co(g,g.return)),x&4){var I=g!==null?g.memoizedState:null;if(x=h.memoizedState,g===null)if(x===null)if(h.stateNode===null){e:{x=h.type,g=h.memoizedProps,k=k.ownerDocument||k;t:switch(x){case"title":I=k.getElementsByTagName("title")[0],(!I||I[Cf]||I[qr]||I.namespaceURI==="http://www.w3.org/2000/svg"||I.hasAttribute("itemprop"))&&(I=k.createElement(x),k.head.insertBefore(I,k.querySelector("head > title"))),Br(I,x,g),I[qr]=h,wr(I),x=I;break e;case"link":var F=aD("link","href",k).get(x+(g.href||""));if(F){for(var W=0;W<F.length;W++)if(I=F[W],I.getAttribute("href")===(g.href==null||g.href===""?null:g.href)&&I.getAttribute("rel")===(g.rel==null?null:g.rel)&&I.getAttribute("title")===(g.title==null?null:g.title)&&I.getAttribute("crossorigin")===(g.crossOrigin==null?null:g.crossOrigin)){F.splice(W,1);break t}}I=k.createElement(x),Br(I,x,g),k.head.appendChild(I);break;case"meta":if(F=aD("meta","content",k).get(x+(g.content||""))){for(W=0;W<F.length;W++)if(I=F[W],I.getAttribute("content")===(g.content==null?null:""+g.content)&&I.getAttribute("name")===(g.name==null?null:g.name)&&I.getAttribute("property")===(g.property==null?null:g.property)&&I.getAttribute("http-equiv")===(g.httpEquiv==null?null:g.httpEquiv)&&I.getAttribute("charset")===(g.charSet==null?null:g.charSet)){F.splice(W,1);break t}}I=k.createElement(x),Br(I,x,g),k.head.appendChild(I);break;default:throw Error(r(468,x))}I[qr]=h,wr(I),x=I}h.stateNode=x}else oD(k,h.type,h.stateNode);else h.stateNode=sD(k,x,h.memoizedProps);else I!==x?(I===null?g.stateNode!==null&&(g=g.stateNode,g.parentNode.removeChild(g)):I.count--,x===null?oD(k,h.type,h.stateNode):sD(k,x,h.memoizedProps)):x===null&&h.stateNode!==null&&f2(h,h.memoizedProps,g.memoizedProps)}break;case 27:js(f,h),qs(h),x&512&&(Vn||g===null||co(g,g.return)),g!==null&&x&4&&f2(h,h.memoizedProps,g.memoizedProps);break;case 5:if(js(f,h),qs(h),x&512&&(Vn||g===null||co(g,g.return)),h.flags&32){k=h.stateNode;try{Mc(k,"")}catch(ye){on(h,h.return,ye)}}x&4&&h.stateNode!=null&&(k=h.memoizedProps,f2(h,k,g!==null?g.memoizedProps:k)),x&1024&&(g2=!0);break;case 6:if(js(f,h),qs(h),x&4){if(h.stateNode===null)throw Error(r(162));x=h.memoizedProps,g=h.stateNode;try{g.nodeValue=x}catch(ye){on(h,h.return,ye)}}break;case 3:if(dy=null,k=La,La=cy(f.containerInfo),js(f,h),La=k,qs(h),x&4&&g!==null&&g.memoizedState.isDehydrated)try{gp(f.containerInfo)}catch(ye){on(h,h.return,ye)}g2&&(g2=!1,dA(h));break;case 4:x=La,La=cy(h.stateNode.containerInfo),js(f,h),qs(h),La=x;break;case 12:js(f,h),qs(h);break;case 13:js(f,h),qs(h),h.child.flags&8192&&h.memoizedState!==null!=(g!==null&&g.memoizedState!==null)&&(C2=pt()),x&4&&(x=h.updateQueue,x!==null&&(h.updateQueue=null,v2(h,x)));break;case 22:k=h.memoizedState!==null;var te=g!==null&&g.memoizedState!==null,me=ri,ke=Vn;if(ri=me||k,Vn=ke||te,js(f,h),Vn=ke,ri=me,qs(h),x&8192)e:for(f=h.stateNode,f._visibility=k?f._visibility&-2:f._visibility|1,k&&(g===null||te||ri||Vn||vl(h)),g=null,f=h;;){if(f.tag===5||f.tag===26){if(g===null){te=g=f;try{if(I=te.stateNode,k)F=I.style,typeof F.setProperty=="function"?F.setProperty("display","none","important"):F.display="none";else{W=te.stateNode;var Ee=te.memoizedProps.style,ve=Ee!=null&&Ee.hasOwnProperty("display")?Ee.display:null;W.style.display=ve==null||typeof ve=="boolean"?"":(""+ve).trim()}}catch(ye){on(te,te.return,ye)}}}else if(f.tag===6){if(g===null){te=f;try{te.stateNode.nodeValue=k?"":te.memoizedProps}catch(ye){on(te,te.return,ye)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===h)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===h)break e;for(;f.sibling===null;){if(f.return===null||f.return===h)break e;g===f&&(g=null),f=f.return}g===f&&(g=null),f.sibling.return=f.return,f=f.sibling}x&4&&(x=h.updateQueue,x!==null&&(g=x.retryQueue,g!==null&&(x.retryQueue=null,v2(h,g))));break;case 19:js(f,h),qs(h),x&4&&(x=h.updateQueue,x!==null&&(h.updateQueue=null,v2(h,x)));break;case 30:break;case 21:break;default:js(f,h),qs(h)}}function qs(h){var f=h.flags;if(f&2){try{for(var g,x=h.return;x!==null;){if(sA(x)){g=x;break}x=x.return}if(g==null)throw Error(r(160));switch(g.tag){case 27:var k=g.stateNode,I=p2(h);Zv(h,I,k);break;case 5:var F=g.stateNode;g.flags&32&&(Mc(F,""),g.flags&=-33);var W=p2(h);Zv(h,W,F);break;case 3:case 4:var te=g.stateNode.containerInfo,me=p2(h);m2(h,me,te);break;default:throw Error(r(161))}}catch(ke){on(h,h.return,ke)}h.flags&=-3}f&4096&&(h.flags&=-4097)}function dA(h){if(h.subtreeFlags&1024)for(h=h.child;h!==null;){var f=h;dA(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),h=h.sibling}}function Xi(h,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)iA(h,f.alternate,f),f=f.sibling}function vl(h){for(h=h.child;h!==null;){var f=h;switch(f.tag){case 0:case 11:case 14:case 15:Ki(4,f,f.return),vl(f);break;case 1:co(f,f.return);var g=f.stateNode;typeof g.componentWillUnmount=="function"&&nA(f,f.return,g),vl(f);break;case 27:up(f.stateNode);case 26:case 5:co(f,f.return),vl(f);break;case 22:f.memoizedState===null&&vl(f);break;case 30:vl(f);break;default:vl(f)}h=h.sibling}}function Yi(h,f,g){for(g=g&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var x=f.alternate,k=h,I=f,F=I.flags;switch(I.tag){case 0:case 11:case 15:Yi(k,I,g),Qf(4,I);break;case 1:if(Yi(k,I,g),x=I,k=x.stateNode,typeof k.componentDidMount=="function")try{k.componentDidMount()}catch(me){on(x,x.return,me)}if(x=I,k=x.updateQueue,k!==null){var W=x.stateNode;try{var te=k.shared.hiddenCallbacks;if(te!==null)for(k.shared.hiddenCallbacks=null,k=0;k<te.length;k++)V_(te[k],W)}catch(me){on(x,x.return,me)}}g&&F&64&&tA(I),Jf(I,I.return);break;case 27:aA(I);case 26:case 5:Yi(k,I,g),g&&x===null&&F&4&&rA(I),Jf(I,I.return);break;case 12:Yi(k,I,g);break;case 13:Yi(k,I,g),g&&F&4&&cA(k,I);break;case 22:I.memoizedState===null&&Yi(k,I,g),Jf(I,I.return);break;case 30:break;default:Yi(k,I,g)}f=f.sibling}}function y2(h,f){var g=null;h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(g=h.memoizedState.cachePool.pool),h=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(h=f.memoizedState.cachePool.pool),h!==g&&(h!=null&&h.refCount++,g!=null&&Pf(g))}function b2(h,f){h=null,f.alternate!==null&&(h=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==h&&(f.refCount++,h!=null&&Pf(h))}function ho(h,f,g,x){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)fA(h,f,g,x),f=f.sibling}function fA(h,f,g,x){var k=f.flags;switch(f.tag){case 0:case 11:case 15:ho(h,f,g,x),k&2048&&Qf(9,f);break;case 1:ho(h,f,g,x);break;case 3:ho(h,f,g,x),k&2048&&(h=null,f.alternate!==null&&(h=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==h&&(f.refCount++,h!=null&&Pf(h)));break;case 12:if(k&2048){ho(h,f,g,x),h=f.stateNode;try{var I=f.memoizedProps,F=I.id,W=I.onPostCommit;typeof W=="function"&&W(F,f.alternate===null?"mount":"update",h.passiveEffectDuration,-0)}catch(te){on(f,f.return,te)}}else ho(h,f,g,x);break;case 13:ho(h,f,g,x);break;case 23:break;case 22:I=f.stateNode,F=f.alternate,f.memoizedState!==null?I._visibility&2?ho(h,f,g,x):ep(h,f):I._visibility&2?ho(h,f,g,x):(I._visibility|=2,th(h,f,g,x,(f.subtreeFlags&10256)!==0)),k&2048&&y2(F,f);break;case 24:ho(h,f,g,x),k&2048&&b2(f.alternate,f);break;default:ho(h,f,g,x)}}function th(h,f,g,x,k){for(k=k&&(f.subtreeFlags&10256)!==0,f=f.child;f!==null;){var I=h,F=f,W=g,te=x,me=F.flags;switch(F.tag){case 0:case 11:case 15:th(I,F,W,te,k),Qf(8,F);break;case 23:break;case 22:var ke=F.stateNode;F.memoizedState!==null?ke._visibility&2?th(I,F,W,te,k):ep(I,F):(ke._visibility|=2,th(I,F,W,te,k)),k&&me&2048&&y2(F.alternate,F);break;case 24:th(I,F,W,te,k),k&&me&2048&&b2(F.alternate,F);break;default:th(I,F,W,te,k)}f=f.sibling}}function ep(h,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var g=h,x=f,k=x.flags;switch(x.tag){case 22:ep(g,x),k&2048&&y2(x.alternate,x);break;case 24:ep(g,x),k&2048&&b2(x.alternate,x);break;default:ep(g,x)}f=f.sibling}}var tp=8192;function nh(h){if(h.subtreeFlags&tp)for(h=h.child;h!==null;)pA(h),h=h.sibling}function pA(h){switch(h.tag){case 26:nh(h),h.flags&tp&&h.memoizedState!==null&&U6(La,h.memoizedState,h.memoizedProps);break;case 5:nh(h);break;case 3:case 4:var f=La;La=cy(h.stateNode.containerInfo),nh(h),La=f;break;case 22:h.memoizedState===null&&(f=h.alternate,f!==null&&f.memoizedState!==null?(f=tp,tp=16777216,nh(h),tp=f):nh(h));break;default:nh(h)}}function mA(h){var f=h.alternate;if(f!==null&&(h=f.child,h!==null)){f.child=null;do f=h.sibling,h.sibling=null,h=f;while(h!==null)}}function np(h){var f=h.deletions;if((h.flags&16)!==0){if(f!==null)for(var g=0;g<f.length;g++){var x=f[g];Cr=x,vA(x,h)}mA(h)}if(h.subtreeFlags&10256)for(h=h.child;h!==null;)gA(h),h=h.sibling}function gA(h){switch(h.tag){case 0:case 11:case 15:np(h),h.flags&2048&&Ki(9,h,h.return);break;case 3:np(h);break;case 12:np(h);break;case 22:var f=h.stateNode;h.memoizedState!==null&&f._visibility&2&&(h.return===null||h.return.tag!==13)?(f._visibility&=-3,Qv(h)):np(h);break;default:np(h)}}function Qv(h){var f=h.deletions;if((h.flags&16)!==0){if(f!==null)for(var g=0;g<f.length;g++){var x=f[g];Cr=x,vA(x,h)}mA(h)}for(h=h.child;h!==null;){switch(f=h,f.tag){case 0:case 11:case 15:Ki(8,f,f.return),Qv(f);break;case 22:g=f.stateNode,g._visibility&2&&(g._visibility&=-3,Qv(f));break;default:Qv(f)}h=h.sibling}}function vA(h,f){for(;Cr!==null;){var g=Cr;switch(g.tag){case 0:case 11:case 15:Ki(8,g,f);break;case 23:case 22:if(g.memoizedState!==null&&g.memoizedState.cachePool!==null){var x=g.memoizedState.cachePool.pool;x!=null&&x.refCount++}break;case 24:Pf(g.memoizedState.cache)}if(x=g.child,x!==null)x.return=g,Cr=x;else e:for(g=h;Cr!==null;){x=Cr;var k=x.sibling,I=x.return;if(uA(x),x===g){Cr=null;break e}if(k!==null){k.return=I,Cr=k;break e}Cr=I}}}var s6={getCacheForType:function(h){var f=Kr(sr),g=f.data.get(h);return g===void 0&&(g=h(),f.data.set(h,g)),g}},a6=typeof WeakMap=="function"?WeakMap:Map,Yt=0,dn=null,$t=null,Bt=0,Zt=0,Ks=null,Zi=!1,rh=!1,x2=!1,ai=0,Dn=0,Qi=0,yl=0,w2=0,ba=0,sh=0,rp=null,Is=null,S2=!1,C2=0,Jv=1/0,ey=null,Ji=null,Pr=0,eu=null,ah=null,oh=0,N2=0,k2=null,yA=null,sp=0,T2=null;function Xs(){if((Yt&2)!==0&&Bt!==0)return Bt&-Bt;if(P.T!==null){var h=qc;return h!==0?h:$2()}return OE()}function bA(){ba===0&&(ba=(Bt&536870912)===0||Wt?RE():536870912);var h=ya.current;return h!==null&&(h.flags|=32),ba}function Ys(h,f,g){(h===dn&&(Zt===2||Zt===9)||h.cancelPendingCommit!==null)&&(ih(h,0),tu(h,Bt,ba,!1)),Sf(h,g),((Yt&2)===0||h!==dn)&&(h===dn&&((Yt&2)===0&&(yl|=g),Dn===4&&tu(h,Bt,ba,!1)),fo(h))}function xA(h,f,g){if((Yt&6)!==0)throw Error(r(327));var x=!g&&(f&124)===0&&(f&h.expiredLanes)===0||wf(h,f),k=x?u6(h,f):_2(h,f,!0),I=x;do{if(k===0){rh&&!x&&tu(h,f,0,!1);break}else{if(g=h.current.alternate,I&&!o6(g)){k=_2(h,f,!1),I=!1;continue}if(k===2){if(I=f,h.errorRecoveryDisabledLanes&I)var F=0;else F=h.pendingLanes&-536870913,F=F!==0?F:F&536870912?536870912:0;if(F!==0){f=F;e:{var W=h;k=rp;var te=W.current.memoizedState.isDehydrated;if(te&&(ih(W,F).flags|=256),F=_2(W,F,!1),F!==2){if(x2&&!te){W.errorRecoveryDisabledLanes|=I,yl|=I,k=4;break e}I=Is,Is=k,I!==null&&(Is===null?Is=I:Is.push.apply(Is,I))}k=F}if(I=!1,k!==2)continue}}if(k===1){ih(h,0),tu(h,f,0,!0);break}e:{switch(x=h,I=k,I){case 0:case 1:throw Error(r(345));case 4:if((f&4194048)!==f)break;case 6:tu(x,f,ba,!Zi);break e;case 2:Is=null;break;case 3:case 5:break;default:throw Error(r(329))}if((f&62914560)===f&&(k=C2+300-pt(),10<k)){if(tu(x,f,ba,!Zi),hv(x,0,!0)!==0)break e;x.timeoutHandle=XA(wA.bind(null,x,g,Is,ey,S2,f,ba,yl,sh,Zi,I,2,-0,0),k);break e}wA(x,g,Is,ey,S2,f,ba,yl,sh,Zi,I,0,-0,0)}}break}while(!0);fo(h)}function wA(h,f,g,x,k,I,F,W,te,me,ke,Ee,ve,ye){if(h.timeoutHandle=-1,Ee=f.subtreeFlags,(Ee&8192||(Ee&16785408)===16785408)&&(hp={stylesheets:null,count:0,unsuspend:V6},pA(f),Ee=W6(),Ee!==null)){h.cancelPendingCommit=Ee(EA.bind(null,h,f,I,g,x,k,F,W,te,ke,1,ve,ye)),tu(h,I,F,!me);return}EA(h,f,I,g,x,k,F,W,te)}function o6(h){for(var f=h;;){var g=f.tag;if((g===0||g===11||g===15)&&f.flags&16384&&(g=f.updateQueue,g!==null&&(g=g.stores,g!==null)))for(var x=0;x<g.length;x++){var k=g[x],I=k.getSnapshot;k=k.value;try{if(!Gs(I(),k))return!1}catch{return!1}}if(g=f.child,f.subtreeFlags&16384&&g!==null)g.return=f,f=g;else{if(f===h)break;for(;f.sibling===null;){if(f.return===null||f.return===h)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function tu(h,f,g,x){f&=~w2,f&=~yl,h.suspendedLanes|=f,h.pingedLanes&=~f,x&&(h.warmLanes|=f),x=h.expirationTimes;for(var k=f;0<k;){var I=31-kn(k),F=1<<I;x[I]=-1,k&=~F}g!==0&&DE(h,g,f)}function ty(){return(Yt&6)===0?(ap(0),!1):!0}function I2(){if($t!==null){if(Zt===0)var h=$t.return;else h=$t,Zo=dl=null,Gw(h),Jc=null,Xf=0,h=$t;for(;h!==null;)eA(h.alternate,h),h=h.return;$t=null}}function ih(h,f){var g=h.timeoutHandle;g!==-1&&(h.timeoutHandle=-1,N6(g)),g=h.cancelPendingCommit,g!==null&&(h.cancelPendingCommit=null,g()),I2(),dn=h,$t=g=Ko(h.current,null),Bt=f,Zt=0,Ks=null,Zi=!1,rh=wf(h,f),x2=!1,sh=ba=w2=yl=Qi=Dn=0,Is=rp=null,S2=!1,(f&8)!==0&&(f|=f&32);var x=h.entangledLanes;if(x!==0)for(h=h.entanglements,x&=f;0<x;){var k=31-kn(x),I=1<<k;f|=h[k],x&=~I}return ai=f,Cv(),g}function SA(h,f){Tt=null,P.H=Uv,f===zf||f===Dv?(f=B_(),Zt=3):f===M_?(f=B_(),Zt=4):Zt=f===zR?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,Ks=f,$t===null&&(Dn=1,qv(h,pa(f,h.current)))}function CA(){var h=P.H;return P.H=Uv,h===null?Uv:h}function NA(){var h=P.A;return P.A=s6,h}function E2(){Dn=4,Zi||(Bt&4194048)!==Bt&&ya.current!==null||(rh=!0),(Qi&134217727)===0&&(yl&134217727)===0||dn===null||tu(dn,Bt,ba,!1)}function _2(h,f,g){var x=Yt;Yt|=2;var k=CA(),I=NA();(dn!==h||Bt!==f)&&(ey=null,ih(h,f)),f=!1;var F=Dn;e:do try{if(Zt!==0&&$t!==null){var W=$t,te=Ks;switch(Zt){case 8:I2(),F=6;break e;case 3:case 2:case 9:case 6:ya.current===null&&(f=!0);var me=Zt;if(Zt=0,Ks=null,uh(h,W,te,me),g&&rh){F=0;break e}break;default:me=Zt,Zt=0,Ks=null,uh(h,W,te,me)}}i6(),F=Dn;break}catch(ke){SA(h,ke)}while(!0);return f&&h.shellSuspendCounter++,Zo=dl=null,Yt=x,P.H=k,P.A=I,$t===null&&(dn=null,Bt=0,Cv()),F}function i6(){for(;$t!==null;)kA($t)}function u6(h,f){var g=Yt;Yt|=2;var x=CA(),k=NA();dn!==h||Bt!==f?(ey=null,Jv=pt()+500,ih(h,f)):rh=wf(h,f);e:do try{if(Zt!==0&&$t!==null){f=$t;var I=Ks;t:switch(Zt){case 1:Zt=0,Ks=null,uh(h,f,I,1);break;case 2:case 9:if(L_(I)){Zt=0,Ks=null,TA(f);break}f=function(){Zt!==2&&Zt!==9||dn!==h||(Zt=7),fo(h)},I.then(f,f);break e;case 3:Zt=7;break e;case 4:Zt=5;break e;case 7:L_(I)?(Zt=0,Ks=null,TA(f)):(Zt=0,Ks=null,uh(h,f,I,7));break;case 5:var F=null;switch($t.tag){case 26:F=$t.memoizedState;case 5:case 27:var W=$t;if(!F||iD(F)){Zt=0,Ks=null;var te=W.sibling;if(te!==null)$t=te;else{var me=W.return;me!==null?($t=me,ny(me)):$t=null}break t}}Zt=0,Ks=null,uh(h,f,I,5);break;case 6:Zt=0,Ks=null,uh(h,f,I,6);break;case 8:I2(),Dn=6;break e;default:throw Error(r(462))}}l6();break}catch(ke){SA(h,ke)}while(!0);return Zo=dl=null,P.H=x,P.A=k,Yt=g,$t!==null?0:(dn=null,Bt=0,Cv(),Dn)}function l6(){for(;$t!==null&&!it();)kA($t)}function kA(h){var f=QR(h.alternate,h,ai);h.memoizedProps=h.pendingProps,f===null?ny(h):$t=f}function TA(h){var f=h,g=f.alternate;switch(f.tag){case 15:case 0:f=jR(g,f,f.pendingProps,f.type,void 0,Bt);break;case 11:f=jR(g,f,f.pendingProps,f.type.render,f.ref,Bt);break;case 5:Gw(f);default:eA(g,f),f=$t=I_(f,ai),f=QR(g,f,ai)}h.memoizedProps=h.pendingProps,f===null?ny(h):$t=f}function uh(h,f,g,x){Zo=dl=null,Gw(f),Jc=null,Xf=0;var k=f.return;try{if(QG(h,k,f,g,Bt)){Dn=1,qv(h,pa(g,h.current)),$t=null;return}}catch(I){if(k!==null)throw $t=k,I;Dn=1,qv(h,pa(g,h.current)),$t=null;return}f.flags&32768?(Wt||x===1?h=!0:rh||(Bt&536870912)!==0?h=!1:(Zi=h=!0,(x===2||x===9||x===3||x===6)&&(x=ya.current,x!==null&&x.tag===13&&(x.flags|=16384))),IA(f,h)):ny(f)}function ny(h){var f=h;do{if((f.flags&32768)!==0){IA(f,Zi);return}h=f.return;var g=e6(f.alternate,f,ai);if(g!==null){$t=g;return}if(f=f.sibling,f!==null){$t=f;return}$t=f=h}while(f!==null);Dn===0&&(Dn=5)}function IA(h,f){do{var g=t6(h.alternate,h);if(g!==null){g.flags&=32767,$t=g;return}if(g=h.return,g!==null&&(g.flags|=32768,g.subtreeFlags=0,g.deletions=null),!f&&(h=h.sibling,h!==null)){$t=h;return}$t=h=g}while(h!==null);Dn=6,$t=null}function EA(h,f,g,x,k,I,F,W,te){h.cancelPendingCommit=null;do ry();while(Pr!==0);if((Yt&6)!==0)throw Error(r(327));if(f!==null){if(f===h.current)throw Error(r(177));if(I=f.lanes|f.childLanes,I|=bw,VW(h,g,I,F,W,te),h===dn&&($t=dn=null,Bt=0),ah=f,eu=h,oh=g,N2=I,k2=k,yA=x,(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?(h.callbackNode=null,h.callbackPriority=0,f6(Nn,function(){return $A(),null})):(h.callbackNode=null,h.callbackPriority=0),x=(f.flags&13878)!==0,(f.subtreeFlags&13878)!==0||x){x=P.T,P.T=null,k=V.p,V.p=2,F=Yt,Yt|=4;try{n6(h,f,g)}finally{Yt=F,V.p=k,P.T=x}}Pr=1,_A(),RA(),AA()}}function _A(){if(Pr===1){Pr=0;var h=eu,f=ah,g=(f.flags&13878)!==0;if((f.subtreeFlags&13878)!==0||g){g=P.T,P.T=null;var x=V.p;V.p=2;var k=Yt;Yt|=4;try{hA(f,h);var I=V2,F=v_(h.containerInfo),W=I.focusedElem,te=I.selectionRange;if(F!==W&&W&&W.ownerDocument&&g_(W.ownerDocument.documentElement,W)){if(te!==null&&pw(W)){var me=te.start,ke=te.end;if(ke===void 0&&(ke=me),"selectionStart"in W)W.selectionStart=me,W.selectionEnd=Math.min(ke,W.value.length);else{var Ee=W.ownerDocument||document,ve=Ee&&Ee.defaultView||window;if(ve.getSelection){var ye=ve.getSelection(),dt=W.textContent.length,ut=Math.min(te.start,dt),sn=te.end===void 0?ut:Math.min(te.end,dt);!ye.extend&&ut>sn&&(F=sn,sn=ut,ut=F);var ce=m_(W,ut),ie=m_(W,sn);if(ce&&ie&&(ye.rangeCount!==1||ye.anchorNode!==ce.node||ye.anchorOffset!==ce.offset||ye.focusNode!==ie.node||ye.focusOffset!==ie.offset)){var fe=Ee.createRange();fe.setStart(ce.node,ce.offset),ye.removeAllRanges(),ut>sn?(ye.addRange(fe),ye.extend(ie.node,ie.offset)):(fe.setEnd(ie.node,ie.offset),ye.addRange(fe))}}}}for(Ee=[],ye=W;ye=ye.parentNode;)ye.nodeType===1&&Ee.push({element:ye,left:ye.scrollLeft,top:ye.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<Ee.length;W++){var Te=Ee[W];Te.element.scrollLeft=Te.left,Te.element.scrollTop=Te.top}}my=!!z2,V2=z2=null}finally{Yt=k,V.p=x,P.T=g}}h.current=f,Pr=2}}function RA(){if(Pr===2){Pr=0;var h=eu,f=ah,g=(f.flags&8772)!==0;if((f.subtreeFlags&8772)!==0||g){g=P.T,P.T=null;var x=V.p;V.p=2;var k=Yt;Yt|=4;try{iA(h,f.alternate,f)}finally{Yt=k,V.p=x,P.T=g}}Pr=3}}function AA(){if(Pr===4||Pr===3){Pr=0,ot();var h=eu,f=ah,g=oh,x=yA;(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?Pr=5:(Pr=0,ah=eu=null,DA(h,h.pendingLanes));var k=h.pendingLanes;if(k===0&&(Ji=null),q1(g),f=f.stateNode,Xt&&typeof Xt.onCommitFiberRoot=="function")try{Xt.onCommitFiberRoot(xr,f,void 0,(f.current.flags&128)===128)}catch{}if(x!==null){f=P.T,k=V.p,V.p=2,P.T=null;try{for(var I=h.onRecoverableError,F=0;F<x.length;F++){var W=x[F];I(W.value,{componentStack:W.stack})}}finally{P.T=f,V.p=k}}(oh&3)!==0&&ry(),fo(h),k=h.pendingLanes,(g&4194090)!==0&&(k&42)!==0?h===T2?sp++:(sp=0,T2=h):sp=0,ap(0)}}function DA(h,f){(h.pooledCacheLanes&=f)===0&&(f=h.pooledCache,f!=null&&(h.pooledCache=null,Pf(f)))}function ry(h){return _A(),RA(),AA(),$A()}function $A(){if(Pr!==5)return!1;var h=eu,f=N2;N2=0;var g=q1(oh),x=P.T,k=V.p;try{V.p=32>g?32:g,P.T=null,g=k2,k2=null;var I=eu,F=oh;if(Pr=0,ah=eu=null,oh=0,(Yt&6)!==0)throw Error(r(331));var W=Yt;if(Yt|=4,gA(I.current),fA(I,I.current,F,g),Yt=W,ap(0,!1),Xt&&typeof Xt.onPostCommitFiberRoot=="function")try{Xt.onPostCommitFiberRoot(xr,I)}catch{}return!0}finally{V.p=k,P.T=x,DA(h,f)}}function OA(h,f,g){f=pa(g,f),f=s2(h.stateNode,f,2),h=Gi(h,f,2),h!==null&&(Sf(h,2),fo(h))}function on(h,f,g){if(h.tag===3)OA(h,h,g);else for(;f!==null;){if(f.tag===3){OA(f,h,g);break}else if(f.tag===1){var x=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(Ji===null||!Ji.has(x))){h=pa(g,h),g=PR(2),x=Gi(f,g,2),x!==null&&(BR(g,x,f,h),Sf(x,2),fo(x));break}}f=f.return}}function R2(h,f,g){var x=h.pingCache;if(x===null){x=h.pingCache=new a6;var k=new Set;x.set(f,k)}else k=x.get(f),k===void 0&&(k=new Set,x.set(f,k));k.has(g)||(x2=!0,k.add(g),h=c6.bind(null,h,f,g),f.then(h,h))}function c6(h,f,g){var x=h.pingCache;x!==null&&x.delete(f),h.pingedLanes|=h.suspendedLanes&g,h.warmLanes&=~g,dn===h&&(Bt&g)===g&&(Dn===4||Dn===3&&(Bt&62914560)===Bt&&300>pt()-C2?(Yt&2)===0&&ih(h,0):w2|=g,sh===Bt&&(sh=0)),fo(h)}function FA(h,f){f===0&&(f=AE()),h=Wc(h,f),h!==null&&(Sf(h,f),fo(h))}function h6(h){var f=h.memoizedState,g=0;f!==null&&(g=f.retryLane),FA(h,g)}function d6(h,f){var g=0;switch(h.tag){case 13:var x=h.stateNode,k=h.memoizedState;k!==null&&(g=k.retryLane);break;case 19:x=h.stateNode;break;case 22:x=h.stateNode._retryCache;break;default:throw Error(r(314))}x!==null&&x.delete(f),FA(h,g)}function f6(h,f){return Ze(h,f)}var sy=null,lh=null,A2=!1,ay=!1,D2=!1,bl=0;function fo(h){h!==lh&&h.next===null&&(lh===null?sy=lh=h:lh=lh.next=h),ay=!0,A2||(A2=!0,m6())}function ap(h,f){if(!D2&&ay){D2=!0;do for(var g=!1,x=sy;x!==null;){if(h!==0){var k=x.pendingLanes;if(k===0)var I=0;else{var F=x.suspendedLanes,W=x.pingedLanes;I=(1<<31-kn(42|h)+1)-1,I&=k&~(F&~W),I=I&201326741?I&201326741|1:I?I|2:0}I!==0&&(g=!0,BA(x,I))}else I=Bt,I=hv(x,x===dn?I:0,x.cancelPendingCommit!==null||x.timeoutHandle!==-1),(I&3)===0||wf(x,I)||(g=!0,BA(x,I));x=x.next}while(g);D2=!1}}function p6(){MA()}function MA(){ay=A2=!1;var h=0;bl!==0&&(C6()&&(h=bl),bl=0);for(var f=pt(),g=null,x=sy;x!==null;){var k=x.next,I=LA(x,f);I===0?(x.next=null,g===null?sy=k:g.next=k,k===null&&(lh=g)):(g=x,(h!==0||(I&3)!==0)&&(ay=!0)),x=k}ap(h)}function LA(h,f){for(var g=h.suspendedLanes,x=h.pingedLanes,k=h.expirationTimes,I=h.pendingLanes&-62914561;0<I;){var F=31-kn(I),W=1<<F,te=k[F];te===-1?((W&g)===0||(W&x)!==0)&&(k[F]=zW(W,f)):te<=f&&(h.expiredLanes|=W),I&=~W}if(f=dn,g=Bt,g=hv(h,h===f?g:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),x=h.callbackNode,g===0||h===f&&(Zt===2||Zt===9)||h.cancelPendingCommit!==null)return x!==null&&x!==null&&lt(x),h.callbackNode=null,h.callbackPriority=0;if((g&3)===0||wf(h,g)){if(f=g&-g,f===h.callbackPriority)return f;switch(x!==null&&lt(x),q1(g)){case 2:case 8:g=en;break;case 32:g=Nn;break;case 268435456:g=qn;break;default:g=Nn}return x=PA.bind(null,h),g=Ze(g,x),h.callbackPriority=f,h.callbackNode=g,f}return x!==null&&x!==null&&lt(x),h.callbackPriority=2,h.callbackNode=null,2}function PA(h,f){if(Pr!==0&&Pr!==5)return h.callbackNode=null,h.callbackPriority=0,null;var g=h.callbackNode;if(ry()&&h.callbackNode!==g)return null;var x=Bt;return x=hv(h,h===dn?x:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),x===0?null:(xA(h,x,f),LA(h,pt()),h.callbackNode!=null&&h.callbackNode===g?PA.bind(null,h):null)}function BA(h,f){if(ry())return null;xA(h,f,!0)}function m6(){k6(function(){(Yt&6)!==0?Ze(hn,p6):MA()})}function $2(){return bl===0&&(bl=RE()),bl}function zA(h){return h==null||typeof h=="symbol"||typeof h=="boolean"?null:typeof h=="function"?h:gv(""+h)}function VA(h,f){var g=f.ownerDocument.createElement("input");return g.name=f.name,g.value=f.value,h.id&&g.setAttribute("form",h.id),f.parentNode.insertBefore(g,f),h=new FormData(h),g.parentNode.removeChild(g),h}function g6(h,f,g,x,k){if(f==="submit"&&g&&g.stateNode===k){var I=zA((k[Cs]||null).action),F=x.submitter;F&&(f=(f=F[Cs]||null)?zA(f.formAction):F.getAttribute("formAction"),f!==null&&(I=f,F=null));var W=new xv("action","action",null,x,k);h.push({event:W,listeners:[{instance:null,listener:function(){if(x.defaultPrevented){if(bl!==0){var te=F?VA(k,F):new FormData(k);Jw(g,{pending:!0,data:te,method:k.method,action:I},null,te)}}else typeof I=="function"&&(W.preventDefault(),te=F?VA(k,F):new FormData(k),Jw(g,{pending:!0,data:te,method:k.method,action:I},I,te))},currentTarget:k}]})}}for(var O2=0;O2<yw.length;O2++){var F2=yw[O2],v6=F2.toLowerCase(),y6=F2[0].toUpperCase()+F2.slice(1);Ma(v6,"on"+y6)}Ma(x_,"onAnimationEnd"),Ma(w_,"onAnimationIteration"),Ma(S_,"onAnimationStart"),Ma("dblclick","onDoubleClick"),Ma("focusin","onFocus"),Ma("focusout","onBlur"),Ma(FG,"onTransitionRun"),Ma(MG,"onTransitionStart"),Ma(LG,"onTransitionCancel"),Ma(C_,"onTransitionEnd"),$c("onMouseEnter",["mouseout","mouseover"]),$c("onMouseLeave",["mouseout","mouseover"]),$c("onPointerEnter",["pointerout","pointerover"]),$c("onPointerLeave",["pointerout","pointerover"]),rl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),rl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),rl("onBeforeInput",["compositionend","keypress","textInput","paste"]),rl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),rl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),rl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var op="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),b6=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(op));function UA(h,f){f=(f&4)!==0;for(var g=0;g<h.length;g++){var x=h[g],k=x.event;x=x.listeners;e:{var I=void 0;if(f)for(var F=x.length-1;0<=F;F--){var W=x[F],te=W.instance,me=W.currentTarget;if(W=W.listener,te!==I&&k.isPropagationStopped())break e;I=W,k.currentTarget=me;try{I(k)}catch(ke){jv(ke)}k.currentTarget=null,I=te}else for(F=0;F<x.length;F++){if(W=x[F],te=W.instance,me=W.currentTarget,W=W.listener,te!==I&&k.isPropagationStopped())break e;I=W,k.currentTarget=me;try{I(k)}catch(ke){jv(ke)}k.currentTarget=null,I=te}}}}function Ot(h,f){var g=f[K1];g===void 0&&(g=f[K1]=new Set);var x=h+"__bubble";g.has(x)||(WA(f,h,2,!1),g.add(x))}function M2(h,f,g){var x=0;f&&(x|=4),WA(g,h,x,f)}var oy="_reactListening"+Math.random().toString(36).slice(2);function L2(h){if(!h[oy]){h[oy]=!0,ME.forEach(function(g){g!=="selectionchange"&&(b6.has(g)||M2(g,!1,h),M2(g,!0,h))});var f=h.nodeType===9?h:h.ownerDocument;f===null||f[oy]||(f[oy]=!0,M2("selectionchange",!1,f))}}function WA(h,f,g,x){switch(fD(f)){case 2:var k=j6;break;case 8:k=q6;break;default:k=Z2}g=k.bind(null,f,g,h),k=void 0,!aw||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(k=!0),x?k!==void 0?h.addEventListener(f,g,{capture:!0,passive:k}):h.addEventListener(f,g,!0):k!==void 0?h.addEventListener(f,g,{passive:k}):h.addEventListener(f,g,!1)}function P2(h,f,g,x,k){var I=x;if((f&1)===0&&(f&2)===0&&x!==null)e:for(;;){if(x===null)return;var F=x.tag;if(F===3||F===4){var W=x.stateNode.containerInfo;if(W===k)break;if(F===4)for(F=x.return;F!==null;){var te=F.tag;if((te===3||te===4)&&F.stateNode.containerInfo===k)return;F=F.return}for(;W!==null;){if(F=Rc(W),F===null)return;if(te=F.tag,te===5||te===6||te===26||te===27){x=I=F;continue e}W=W.parentNode}}x=x.return}YE(function(){var me=I,ke=rw(g),Ee=[];e:{var ve=N_.get(h);if(ve!==void 0){var ye=xv,dt=h;switch(h){case"keypress":if(yv(g)===0)break e;case"keydown":case"keyup":ye=fG;break;case"focusin":dt="focus",ye=lw;break;case"focusout":dt="blur",ye=lw;break;case"beforeblur":case"afterblur":ye=lw;break;case"click":if(g.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ye=JE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ye=tG;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ye=gG;break;case x_:case w_:case S_:ye=sG;break;case C_:ye=yG;break;case"scroll":case"scrollend":ye=JW;break;case"wheel":ye=xG;break;case"copy":case"cut":case"paste":ye=oG;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ye=t_;break;case"toggle":case"beforetoggle":ye=SG}var ut=(f&4)!==0,sn=!ut&&(h==="scroll"||h==="scrollend"),ce=ut?ve!==null?ve+"Capture":null:ve;ut=[];for(var ie=me,fe;ie!==null;){var Te=ie;if(fe=Te.stateNode,Te=Te.tag,Te!==5&&Te!==26&&Te!==27||fe===null||ce===null||(Te=kf(ie,ce),Te!=null&&ut.push(ip(ie,Te,fe))),sn)break;ie=ie.return}0<ut.length&&(ve=new ye(ve,dt,null,g,ke),Ee.push({event:ve,listeners:ut}))}}if((f&7)===0){e:{if(ve=h==="mouseover"||h==="pointerover",ye=h==="mouseout"||h==="pointerout",ve&&g!==nw&&(dt=g.relatedTarget||g.fromElement)&&(Rc(dt)||dt[_c]))break e;if((ye||ve)&&(ve=ke.window===ke?ke:(ve=ke.ownerDocument)?ve.defaultView||ve.parentWindow:window,ye?(dt=g.relatedTarget||g.toElement,ye=me,dt=dt?Rc(dt):null,dt!==null&&(sn=a(dt),ut=dt.tag,dt!==sn||ut!==5&&ut!==27&&ut!==6)&&(dt=null)):(ye=null,dt=me),ye!==dt)){if(ut=JE,Te="onMouseLeave",ce="onMouseEnter",ie="mouse",(h==="pointerout"||h==="pointerover")&&(ut=t_,Te="onPointerLeave",ce="onPointerEnter",ie="pointer"),sn=ye==null?ve:Nf(ye),fe=dt==null?ve:Nf(dt),ve=new ut(Te,ie+"leave",ye,g,ke),ve.target=sn,ve.relatedTarget=fe,Te=null,Rc(ke)===me&&(ut=new ut(ce,ie+"enter",dt,g,ke),ut.target=fe,ut.relatedTarget=sn,Te=ut),sn=Te,ye&&dt)t:{for(ut=ye,ce=dt,ie=0,fe=ut;fe;fe=ch(fe))ie++;for(fe=0,Te=ce;Te;Te=ch(Te))fe++;for(;0<ie-fe;)ut=ch(ut),ie--;for(;0<fe-ie;)ce=ch(ce),fe--;for(;ie--;){if(ut===ce||ce!==null&&ut===ce.alternate)break t;ut=ch(ut),ce=ch(ce)}ut=null}else ut=null;ye!==null&&GA(Ee,ve,ye,ut,!1),dt!==null&&sn!==null&&GA(Ee,sn,dt,ut,!0)}}e:{if(ve=me?Nf(me):window,ye=ve.nodeName&&ve.nodeName.toLowerCase(),ye==="select"||ye==="input"&&ve.type==="file")var He=l_;else if(i_(ve))if(c_)He=DG;else{He=RG;var Rt=_G}else ye=ve.nodeName,!ye||ye.toLowerCase()!=="input"||ve.type!=="checkbox"&&ve.type!=="radio"?me&&tw(me.elementType)&&(He=l_):He=AG;if(He&&(He=He(h,me))){u_(Ee,He,g,ke);break e}Rt&&Rt(h,ve,me),h==="focusout"&&me&&ve.type==="number"&&me.memoizedProps.value!=null&&ew(ve,"number",ve.value)}switch(Rt=me?Nf(me):window,h){case"focusin":(i_(Rt)||Rt.contentEditable==="true")&&(zc=Rt,mw=me,$f=null);break;case"focusout":$f=mw=zc=null;break;case"mousedown":gw=!0;break;case"contextmenu":case"mouseup":case"dragend":gw=!1,y_(Ee,g,ke);break;case"selectionchange":if(OG)break;case"keydown":case"keyup":y_(Ee,g,ke)}var at;if(hw)e:{switch(h){case"compositionstart":var ct="onCompositionStart";break e;case"compositionend":ct="onCompositionEnd";break e;case"compositionupdate":ct="onCompositionUpdate";break e}ct=void 0}else Bc?a_(h,g)&&(ct="onCompositionEnd"):h==="keydown"&&g.keyCode===229&&(ct="onCompositionStart");ct&&(n_&&g.locale!=="ko"&&(Bc||ct!=="onCompositionStart"?ct==="onCompositionEnd"&&Bc&&(at=ZE()):(zi=ke,ow="value"in zi?zi.value:zi.textContent,Bc=!0)),Rt=iy(me,ct),0<Rt.length&&(ct=new e_(ct,h,null,g,ke),Ee.push({event:ct,listeners:Rt}),at?ct.data=at:(at=o_(g),at!==null&&(ct.data=at)))),(at=NG?kG(h,g):TG(h,g))&&(ct=iy(me,"onBeforeInput"),0<ct.length&&(Rt=new e_("onBeforeInput","beforeinput",null,g,ke),Ee.push({event:Rt,listeners:ct}),Rt.data=at)),g6(Ee,h,me,g,ke)}UA(Ee,f)})}function ip(h,f,g){return{instance:h,listener:f,currentTarget:g}}function iy(h,f){for(var g=f+"Capture",x=[];h!==null;){var k=h,I=k.stateNode;if(k=k.tag,k!==5&&k!==26&&k!==27||I===null||(k=kf(h,g),k!=null&&x.unshift(ip(h,k,I)),k=kf(h,f),k!=null&&x.push(ip(h,k,I))),h.tag===3)return x;h=h.return}return[]}function ch(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5&&h.tag!==27);return h||null}function GA(h,f,g,x,k){for(var I=f._reactName,F=[];g!==null&&g!==x;){var W=g,te=W.alternate,me=W.stateNode;if(W=W.tag,te!==null&&te===x)break;W!==5&&W!==26&&W!==27||me===null||(te=me,k?(me=kf(g,I),me!=null&&F.unshift(ip(g,me,te))):k||(me=kf(g,I),me!=null&&F.push(ip(g,me,te)))),g=g.return}F.length!==0&&h.push({event:f,listeners:F})}var x6=/\r\n?/g,w6=/\u0000|\uFFFD/g;function HA(h){return(typeof h=="string"?h:""+h).replace(x6,`
`).replace(w6,"")}function jA(h,f){return f=HA(f),HA(h)===f}function uy(){}function rn(h,f,g,x,k,I){switch(g){case"children":typeof x=="string"?f==="body"||f==="textarea"&&x===""||Mc(h,x):(typeof x=="number"||typeof x=="bigint")&&f!=="body"&&Mc(h,""+x);break;case"className":fv(h,"class",x);break;case"tabIndex":fv(h,"tabindex",x);break;case"dir":case"role":case"viewBox":case"width":case"height":fv(h,g,x);break;case"style":KE(h,x,I);break;case"data":if(f!=="object"){fv(h,"data",x);break}case"src":case"href":if(x===""&&(f!=="a"||g!=="href")){h.removeAttribute(g);break}if(x==null||typeof x=="function"||typeof x=="symbol"||typeof x=="boolean"){h.removeAttribute(g);break}x=gv(""+x),h.setAttribute(g,x);break;case"action":case"formAction":if(typeof x=="function"){h.setAttribute(g,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof I=="function"&&(g==="formAction"?(f!=="input"&&rn(h,f,"name",k.name,k,null),rn(h,f,"formEncType",k.formEncType,k,null),rn(h,f,"formMethod",k.formMethod,k,null),rn(h,f,"formTarget",k.formTarget,k,null)):(rn(h,f,"encType",k.encType,k,null),rn(h,f,"method",k.method,k,null),rn(h,f,"target",k.target,k,null)));if(x==null||typeof x=="symbol"||typeof x=="boolean"){h.removeAttribute(g);break}x=gv(""+x),h.setAttribute(g,x);break;case"onClick":x!=null&&(h.onclick=uy);break;case"onScroll":x!=null&&Ot("scroll",h);break;case"onScrollEnd":x!=null&&Ot("scrollend",h);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(r(61));if(g=x.__html,g!=null){if(k.children!=null)throw Error(r(60));h.innerHTML=g}}break;case"multiple":h.multiple=x&&typeof x!="function"&&typeof x!="symbol";break;case"muted":h.muted=x&&typeof x!="function"&&typeof x!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(x==null||typeof x=="function"||typeof x=="boolean"||typeof x=="symbol"){h.removeAttribute("xlink:href");break}g=gv(""+x),h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",g);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":x!=null&&typeof x!="function"&&typeof x!="symbol"?h.setAttribute(g,""+x):h.removeAttribute(g);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":x&&typeof x!="function"&&typeof x!="symbol"?h.setAttribute(g,""):h.removeAttribute(g);break;case"capture":case"download":x===!0?h.setAttribute(g,""):x!==!1&&x!=null&&typeof x!="function"&&typeof x!="symbol"?h.setAttribute(g,x):h.removeAttribute(g);break;case"cols":case"rows":case"size":case"span":x!=null&&typeof x!="function"&&typeof x!="symbol"&&!isNaN(x)&&1<=x?h.setAttribute(g,x):h.removeAttribute(g);break;case"rowSpan":case"start":x==null||typeof x=="function"||typeof x=="symbol"||isNaN(x)?h.removeAttribute(g):h.setAttribute(g,x);break;case"popover":Ot("beforetoggle",h),Ot("toggle",h),dv(h,"popover",x);break;case"xlinkActuate":jo(h,"http://www.w3.org/1999/xlink","xlink:actuate",x);break;case"xlinkArcrole":jo(h,"http://www.w3.org/1999/xlink","xlink:arcrole",x);break;case"xlinkRole":jo(h,"http://www.w3.org/1999/xlink","xlink:role",x);break;case"xlinkShow":jo(h,"http://www.w3.org/1999/xlink","xlink:show",x);break;case"xlinkTitle":jo(h,"http://www.w3.org/1999/xlink","xlink:title",x);break;case"xlinkType":jo(h,"http://www.w3.org/1999/xlink","xlink:type",x);break;case"xmlBase":jo(h,"http://www.w3.org/XML/1998/namespace","xml:base",x);break;case"xmlLang":jo(h,"http://www.w3.org/XML/1998/namespace","xml:lang",x);break;case"xmlSpace":jo(h,"http://www.w3.org/XML/1998/namespace","xml:space",x);break;case"is":dv(h,"is",x);break;case"innerText":case"textContent":break;default:(!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(g=ZW.get(g)||g,dv(h,g,x))}}function B2(h,f,g,x,k,I){switch(g){case"style":KE(h,x,I);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(r(61));if(g=x.__html,g!=null){if(k.children!=null)throw Error(r(60));h.innerHTML=g}}break;case"children":typeof x=="string"?Mc(h,x):(typeof x=="number"||typeof x=="bigint")&&Mc(h,""+x);break;case"onScroll":x!=null&&Ot("scroll",h);break;case"onScrollEnd":x!=null&&Ot("scrollend",h);break;case"onClick":x!=null&&(h.onclick=uy);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!LE.hasOwnProperty(g))e:{if(g[0]==="o"&&g[1]==="n"&&(k=g.endsWith("Capture"),f=g.slice(2,k?g.length-7:void 0),I=h[Cs]||null,I=I!=null?I[g]:null,typeof I=="function"&&h.removeEventListener(f,I,k),typeof x=="function")){typeof I!="function"&&I!==null&&(g in h?h[g]=null:h.hasAttribute(g)&&h.removeAttribute(g)),h.addEventListener(f,x,k);break e}g in h?h[g]=x:x===!0?h.setAttribute(g,""):dv(h,g,x)}}}function Br(h,f,g){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ot("error",h),Ot("load",h);var x=!1,k=!1,I;for(I in g)if(g.hasOwnProperty(I)){var F=g[I];if(F!=null)switch(I){case"src":x=!0;break;case"srcSet":k=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,f));default:rn(h,f,I,F,g,null)}}k&&rn(h,f,"srcSet",g.srcSet,g,null),x&&rn(h,f,"src",g.src,g,null);return;case"input":Ot("invalid",h);var W=I=F=k=null,te=null,me=null;for(x in g)if(g.hasOwnProperty(x)){var ke=g[x];if(ke!=null)switch(x){case"name":k=ke;break;case"type":F=ke;break;case"checked":te=ke;break;case"defaultChecked":me=ke;break;case"value":I=ke;break;case"defaultValue":W=ke;break;case"children":case"dangerouslySetInnerHTML":if(ke!=null)throw Error(r(137,f));break;default:rn(h,f,x,ke,g,null)}}GE(h,I,W,te,me,F,k,!1),pv(h);return;case"select":Ot("invalid",h),x=F=I=null;for(k in g)if(g.hasOwnProperty(k)&&(W=g[k],W!=null))switch(k){case"value":I=W;break;case"defaultValue":F=W;break;case"multiple":x=W;default:rn(h,f,k,W,g,null)}f=I,g=F,h.multiple=!!x,f!=null?Fc(h,!!x,f,!1):g!=null&&Fc(h,!!x,g,!0);return;case"textarea":Ot("invalid",h),I=k=x=null;for(F in g)if(g.hasOwnProperty(F)&&(W=g[F],W!=null))switch(F){case"value":x=W;break;case"defaultValue":k=W;break;case"children":I=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(r(91));break;default:rn(h,f,F,W,g,null)}jE(h,x,k,I),pv(h);return;case"option":for(te in g)if(g.hasOwnProperty(te)&&(x=g[te],x!=null))switch(te){case"selected":h.selected=x&&typeof x!="function"&&typeof x!="symbol";break;default:rn(h,f,te,x,g,null)}return;case"dialog":Ot("beforetoggle",h),Ot("toggle",h),Ot("cancel",h),Ot("close",h);break;case"iframe":case"object":Ot("load",h);break;case"video":case"audio":for(x=0;x<op.length;x++)Ot(op[x],h);break;case"image":Ot("error",h),Ot("load",h);break;case"details":Ot("toggle",h);break;case"embed":case"source":case"link":Ot("error",h),Ot("load",h);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(me in g)if(g.hasOwnProperty(me)&&(x=g[me],x!=null))switch(me){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,f));default:rn(h,f,me,x,g,null)}return;default:if(tw(f)){for(ke in g)g.hasOwnProperty(ke)&&(x=g[ke],x!==void 0&&B2(h,f,ke,x,g,void 0));return}}for(W in g)g.hasOwnProperty(W)&&(x=g[W],x!=null&&rn(h,f,W,x,g,null))}function S6(h,f,g,x){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var k=null,I=null,F=null,W=null,te=null,me=null,ke=null;for(ye in g){var Ee=g[ye];if(g.hasOwnProperty(ye)&&Ee!=null)switch(ye){case"checked":break;case"value":break;case"defaultValue":te=Ee;default:x.hasOwnProperty(ye)||rn(h,f,ye,null,x,Ee)}}for(var ve in x){var ye=x[ve];if(Ee=g[ve],x.hasOwnProperty(ve)&&(ye!=null||Ee!=null))switch(ve){case"type":I=ye;break;case"name":k=ye;break;case"checked":me=ye;break;case"defaultChecked":ke=ye;break;case"value":F=ye;break;case"defaultValue":W=ye;break;case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(r(137,f));break;default:ye!==Ee&&rn(h,f,ve,ye,x,Ee)}}J1(h,F,W,te,me,ke,I,k);return;case"select":ye=F=W=ve=null;for(I in g)if(te=g[I],g.hasOwnProperty(I)&&te!=null)switch(I){case"value":break;case"multiple":ye=te;default:x.hasOwnProperty(I)||rn(h,f,I,null,x,te)}for(k in x)if(I=x[k],te=g[k],x.hasOwnProperty(k)&&(I!=null||te!=null))switch(k){case"value":ve=I;break;case"defaultValue":W=I;break;case"multiple":F=I;default:I!==te&&rn(h,f,k,I,x,te)}f=W,g=F,x=ye,ve!=null?Fc(h,!!g,ve,!1):!!x!=!!g&&(f!=null?Fc(h,!!g,f,!0):Fc(h,!!g,g?[]:"",!1));return;case"textarea":ye=ve=null;for(W in g)if(k=g[W],g.hasOwnProperty(W)&&k!=null&&!x.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:rn(h,f,W,null,x,k)}for(F in x)if(k=x[F],I=g[F],x.hasOwnProperty(F)&&(k!=null||I!=null))switch(F){case"value":ve=k;break;case"defaultValue":ye=k;break;case"children":break;case"dangerouslySetInnerHTML":if(k!=null)throw Error(r(91));break;default:k!==I&&rn(h,f,F,k,x,I)}HE(h,ve,ye);return;case"option":for(var dt in g)if(ve=g[dt],g.hasOwnProperty(dt)&&ve!=null&&!x.hasOwnProperty(dt))switch(dt){case"selected":h.selected=!1;break;default:rn(h,f,dt,null,x,ve)}for(te in x)if(ve=x[te],ye=g[te],x.hasOwnProperty(te)&&ve!==ye&&(ve!=null||ye!=null))switch(te){case"selected":h.selected=ve&&typeof ve!="function"&&typeof ve!="symbol";break;default:rn(h,f,te,ve,x,ye)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ut in g)ve=g[ut],g.hasOwnProperty(ut)&&ve!=null&&!x.hasOwnProperty(ut)&&rn(h,f,ut,null,x,ve);for(me in x)if(ve=x[me],ye=g[me],x.hasOwnProperty(me)&&ve!==ye&&(ve!=null||ye!=null))switch(me){case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(r(137,f));break;default:rn(h,f,me,ve,x,ye)}return;default:if(tw(f)){for(var sn in g)ve=g[sn],g.hasOwnProperty(sn)&&ve!==void 0&&!x.hasOwnProperty(sn)&&B2(h,f,sn,void 0,x,ve);for(ke in x)ve=x[ke],ye=g[ke],!x.hasOwnProperty(ke)||ve===ye||ve===void 0&&ye===void 0||B2(h,f,ke,ve,x,ye);return}}for(var ce in g)ve=g[ce],g.hasOwnProperty(ce)&&ve!=null&&!x.hasOwnProperty(ce)&&rn(h,f,ce,null,x,ve);for(Ee in x)ve=x[Ee],ye=g[Ee],!x.hasOwnProperty(Ee)||ve===ye||ve==null&&ye==null||rn(h,f,Ee,ve,x,ye)}var z2=null,V2=null;function ly(h){return h.nodeType===9?h:h.ownerDocument}function qA(h){switch(h){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function KA(h,f){if(h===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return h===1&&f==="foreignObject"?0:h}function U2(h,f){return h==="textarea"||h==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var W2=null;function C6(){var h=window.event;return h&&h.type==="popstate"?h===W2?!1:(W2=h,!0):(W2=null,!1)}var XA=typeof setTimeout=="function"?setTimeout:void 0,N6=typeof clearTimeout=="function"?clearTimeout:void 0,YA=typeof Promise=="function"?Promise:void 0,k6=typeof queueMicrotask=="function"?queueMicrotask:typeof YA<"u"?function(h){return YA.resolve(null).then(h).catch(T6)}:XA;function T6(h){setTimeout(function(){throw h})}function nu(h){return h==="head"}function ZA(h,f){var g=f,x=0,k=0;do{var I=g.nextSibling;if(h.removeChild(g),I&&I.nodeType===8)if(g=I.data,g==="/$"){if(0<x&&8>x){g=x;var F=h.ownerDocument;if(g&1&&up(F.documentElement),g&2&&up(F.body),g&4)for(g=F.head,up(g),F=g.firstChild;F;){var W=F.nextSibling,te=F.nodeName;F[Cf]||te==="SCRIPT"||te==="STYLE"||te==="LINK"&&F.rel.toLowerCase()==="stylesheet"||g.removeChild(F),F=W}}if(k===0){h.removeChild(I),gp(f);return}k--}else g==="$"||g==="$?"||g==="$!"?k++:x=g.charCodeAt(0)-48;else x=0;g=I}while(g);gp(f)}function G2(h){var f=h.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var g=f;switch(f=f.nextSibling,g.nodeName){case"HTML":case"HEAD":case"BODY":G2(g),X1(g);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(g.rel.toLowerCase()==="stylesheet")continue}h.removeChild(g)}}function I6(h,f,g,x){for(;h.nodeType===1;){var k=g;if(h.nodeName.toLowerCase()!==f.toLowerCase()){if(!x&&(h.nodeName!=="INPUT"||h.type!=="hidden"))break}else if(x){if(!h[Cf])switch(f){case"meta":if(!h.hasAttribute("itemprop"))break;return h;case"link":if(I=h.getAttribute("rel"),I==="stylesheet"&&h.hasAttribute("data-precedence"))break;if(I!==k.rel||h.getAttribute("href")!==(k.href==null||k.href===""?null:k.href)||h.getAttribute("crossorigin")!==(k.crossOrigin==null?null:k.crossOrigin)||h.getAttribute("title")!==(k.title==null?null:k.title))break;return h;case"style":if(h.hasAttribute("data-precedence"))break;return h;case"script":if(I=h.getAttribute("src"),(I!==(k.src==null?null:k.src)||h.getAttribute("type")!==(k.type==null?null:k.type)||h.getAttribute("crossorigin")!==(k.crossOrigin==null?null:k.crossOrigin))&&I&&h.hasAttribute("async")&&!h.hasAttribute("itemprop"))break;return h;default:return h}}else if(f==="input"&&h.type==="hidden"){var I=k.name==null?null:""+k.name;if(k.type==="hidden"&&h.getAttribute("name")===I)return h}else return h;if(h=Pa(h.nextSibling),h===null)break}return null}function E6(h,f,g){if(f==="")return null;for(;h.nodeType!==3;)if((h.nodeType!==1||h.nodeName!=="INPUT"||h.type!=="hidden")&&!g||(h=Pa(h.nextSibling),h===null))return null;return h}function H2(h){return h.data==="$!"||h.data==="$?"&&h.ownerDocument.readyState==="complete"}function _6(h,f){var g=h.ownerDocument;if(h.data!=="$?"||g.readyState==="complete")f();else{var x=function(){f(),g.removeEventListener("DOMContentLoaded",x)};g.addEventListener("DOMContentLoaded",x),h._reactRetry=x}}function Pa(h){for(;h!=null;h=h.nextSibling){var f=h.nodeType;if(f===1||f===3)break;if(f===8){if(f=h.data,f==="$"||f==="$!"||f==="$?"||f==="F!"||f==="F")break;if(f==="/$")return null}}return h}var j2=null;function QA(h){h=h.previousSibling;for(var f=0;h;){if(h.nodeType===8){var g=h.data;if(g==="$"||g==="$!"||g==="$?"){if(f===0)return h;f--}else g==="/$"&&f++}h=h.previousSibling}return null}function JA(h,f,g){switch(f=ly(g),h){case"html":if(h=f.documentElement,!h)throw Error(r(452));return h;case"head":if(h=f.head,!h)throw Error(r(453));return h;case"body":if(h=f.body,!h)throw Error(r(454));return h;default:throw Error(r(451))}}function up(h){for(var f=h.attributes;f.length;)h.removeAttributeNode(f[0]);X1(h)}var xa=new Map,eD=new Set;function cy(h){return typeof h.getRootNode=="function"?h.getRootNode():h.nodeType===9?h:h.ownerDocument}var oi=V.d;V.d={f:R6,r:A6,D:D6,C:$6,L:O6,m:F6,X:L6,S:M6,M:P6};function R6(){var h=oi.f(),f=ty();return h||f}function A6(h){var f=Ac(h);f!==null&&f.tag===5&&f.type==="form"?xR(f):oi.r(h)}var hh=typeof document>"u"?null:document;function tD(h,f,g){var x=hh;if(x&&typeof f=="string"&&f){var k=fa(f);k='link[rel="'+h+'"][href="'+k+'"]',typeof g=="string"&&(k+='[crossorigin="'+g+'"]'),eD.has(k)||(eD.add(k),h={rel:h,crossOrigin:g,href:f},x.querySelector(k)===null&&(f=x.createElement("link"),Br(f,"link",h),wr(f),x.head.appendChild(f)))}}function D6(h){oi.D(h),tD("dns-prefetch",h,null)}function $6(h,f){oi.C(h,f),tD("preconnect",h,f)}function O6(h,f,g){oi.L(h,f,g);var x=hh;if(x&&h&&f){var k='link[rel="preload"][as="'+fa(f)+'"]';f==="image"&&g&&g.imageSrcSet?(k+='[imagesrcset="'+fa(g.imageSrcSet)+'"]',typeof g.imageSizes=="string"&&(k+='[imagesizes="'+fa(g.imageSizes)+'"]')):k+='[href="'+fa(h)+'"]';var I=k;switch(f){case"style":I=dh(h);break;case"script":I=fh(h)}xa.has(I)||(h=c({rel:"preload",href:f==="image"&&g&&g.imageSrcSet?void 0:h,as:f},g),xa.set(I,h),x.querySelector(k)!==null||f==="style"&&x.querySelector(lp(I))||f==="script"&&x.querySelector(cp(I))||(f=x.createElement("link"),Br(f,"link",h),wr(f),x.head.appendChild(f)))}}function F6(h,f){oi.m(h,f);var g=hh;if(g&&h){var x=f&&typeof f.as=="string"?f.as:"script",k='link[rel="modulepreload"][as="'+fa(x)+'"][href="'+fa(h)+'"]',I=k;switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":I=fh(h)}if(!xa.has(I)&&(h=c({rel:"modulepreload",href:h},f),xa.set(I,h),g.querySelector(k)===null)){switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(g.querySelector(cp(I)))return}x=g.createElement("link"),Br(x,"link",h),wr(x),g.head.appendChild(x)}}}function M6(h,f,g){oi.S(h,f,g);var x=hh;if(x&&h){var k=Dc(x).hoistableStyles,I=dh(h);f=f||"default";var F=k.get(I);if(!F){var W={loading:0,preload:null};if(F=x.querySelector(lp(I)))W.loading=5;else{h=c({rel:"stylesheet",href:h,"data-precedence":f},g),(g=xa.get(I))&&q2(h,g);var te=F=x.createElement("link");wr(te),Br(te,"link",h),te._p=new Promise(function(me,ke){te.onload=me,te.onerror=ke}),te.addEventListener("load",function(){W.loading|=1}),te.addEventListener("error",function(){W.loading|=2}),W.loading|=4,hy(F,f,x)}F={type:"stylesheet",instance:F,count:1,state:W},k.set(I,F)}}}function L6(h,f){oi.X(h,f);var g=hh;if(g&&h){var x=Dc(g).hoistableScripts,k=fh(h),I=x.get(k);I||(I=g.querySelector(cp(k)),I||(h=c({src:h,async:!0},f),(f=xa.get(k))&&K2(h,f),I=g.createElement("script"),wr(I),Br(I,"link",h),g.head.appendChild(I)),I={type:"script",instance:I,count:1,state:null},x.set(k,I))}}function P6(h,f){oi.M(h,f);var g=hh;if(g&&h){var x=Dc(g).hoistableScripts,k=fh(h),I=x.get(k);I||(I=g.querySelector(cp(k)),I||(h=c({src:h,async:!0,type:"module"},f),(f=xa.get(k))&&K2(h,f),I=g.createElement("script"),wr(I),Br(I,"link",h),g.head.appendChild(I)),I={type:"script",instance:I,count:1,state:null},x.set(k,I))}}function nD(h,f,g,x){var k=(k=ge.current)?cy(k):null;if(!k)throw Error(r(446));switch(h){case"meta":case"title":return null;case"style":return typeof g.precedence=="string"&&typeof g.href=="string"?(f=dh(g.href),g=Dc(k).hoistableStyles,x=g.get(f),x||(x={type:"style",instance:null,count:0,state:null},g.set(f,x)),x):{type:"void",instance:null,count:0,state:null};case"link":if(g.rel==="stylesheet"&&typeof g.href=="string"&&typeof g.precedence=="string"){h=dh(g.href);var I=Dc(k).hoistableStyles,F=I.get(h);if(F||(k=k.ownerDocument||k,F={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},I.set(h,F),(I=k.querySelector(lp(h)))&&!I._p&&(F.instance=I,F.state.loading=5),xa.has(h)||(g={rel:"preload",as:"style",href:g.href,crossOrigin:g.crossOrigin,integrity:g.integrity,media:g.media,hrefLang:g.hrefLang,referrerPolicy:g.referrerPolicy},xa.set(h,g),I||B6(k,h,g,F.state))),f&&x===null)throw Error(r(528,""));return F}if(f&&x!==null)throw Error(r(529,""));return null;case"script":return f=g.async,g=g.src,typeof g=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=fh(g),g=Dc(k).hoistableScripts,x=g.get(f),x||(x={type:"script",instance:null,count:0,state:null},g.set(f,x)),x):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,h))}}function dh(h){return'href="'+fa(h)+'"'}function lp(h){return'link[rel="stylesheet"]['+h+"]"}function rD(h){return c({},h,{"data-precedence":h.precedence,precedence:null})}function B6(h,f,g,x){h.querySelector('link[rel="preload"][as="style"]['+f+"]")?x.loading=1:(f=h.createElement("link"),x.preload=f,f.addEventListener("load",function(){return x.loading|=1}),f.addEventListener("error",function(){return x.loading|=2}),Br(f,"link",g),wr(f),h.head.appendChild(f))}function fh(h){return'[src="'+fa(h)+'"]'}function cp(h){return"script[async]"+h}function sD(h,f,g){if(f.count++,f.instance===null)switch(f.type){case"style":var x=h.querySelector('style[data-href~="'+fa(g.href)+'"]');if(x)return f.instance=x,wr(x),x;var k=c({},g,{"data-href":g.href,"data-precedence":g.precedence,href:null,precedence:null});return x=(h.ownerDocument||h).createElement("style"),wr(x),Br(x,"style",k),hy(x,g.precedence,h),f.instance=x;case"stylesheet":k=dh(g.href);var I=h.querySelector(lp(k));if(I)return f.state.loading|=4,f.instance=I,wr(I),I;x=rD(g),(k=xa.get(k))&&q2(x,k),I=(h.ownerDocument||h).createElement("link"),wr(I);var F=I;return F._p=new Promise(function(W,te){F.onload=W,F.onerror=te}),Br(I,"link",x),f.state.loading|=4,hy(I,g.precedence,h),f.instance=I;case"script":return I=fh(g.src),(k=h.querySelector(cp(I)))?(f.instance=k,wr(k),k):(x=g,(k=xa.get(I))&&(x=c({},g),K2(x,k)),h=h.ownerDocument||h,k=h.createElement("script"),wr(k),Br(k,"link",x),h.head.appendChild(k),f.instance=k);case"void":return null;default:throw Error(r(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(x=f.instance,f.state.loading|=4,hy(x,g.precedence,h));return f.instance}function hy(h,f,g){for(var x=g.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),k=x.length?x[x.length-1]:null,I=k,F=0;F<x.length;F++){var W=x[F];if(W.dataset.precedence===f)I=W;else if(I!==k)break}I?I.parentNode.insertBefore(h,I.nextSibling):(f=g.nodeType===9?g.head:g,f.insertBefore(h,f.firstChild))}function q2(h,f){h.crossOrigin==null&&(h.crossOrigin=f.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=f.referrerPolicy),h.title==null&&(h.title=f.title)}function K2(h,f){h.crossOrigin==null&&(h.crossOrigin=f.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=f.referrerPolicy),h.integrity==null&&(h.integrity=f.integrity)}var dy=null;function aD(h,f,g){if(dy===null){var x=new Map,k=dy=new Map;k.set(g,x)}else k=dy,x=k.get(g),x||(x=new Map,k.set(g,x));if(x.has(h))return x;for(x.set(h,null),g=g.getElementsByTagName(h),k=0;k<g.length;k++){var I=g[k];if(!(I[Cf]||I[qr]||h==="link"&&I.getAttribute("rel")==="stylesheet")&&I.namespaceURI!=="http://www.w3.org/2000/svg"){var F=I.getAttribute(f)||"";F=h+F;var W=x.get(F);W?W.push(I):x.set(F,[I])}}return x}function oD(h,f,g){h=h.ownerDocument||h,h.head.insertBefore(g,f==="title"?h.querySelector("head > title"):null)}function z6(h,f,g){if(g===1||f.itemProp!=null)return!1;switch(h){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;switch(f.rel){case"stylesheet":return h=f.disabled,typeof f.precedence=="string"&&h==null;default:return!0}case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function iD(h){return!(h.type==="stylesheet"&&(h.state.loading&3)===0)}var hp=null;function V6(){}function U6(h,f,g){if(hp===null)throw Error(r(475));var x=hp;if(f.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var k=dh(g.href),I=h.querySelector(lp(k));if(I){h=I._p,h!==null&&typeof h=="object"&&typeof h.then=="function"&&(x.count++,x=fy.bind(x),h.then(x,x)),f.state.loading|=4,f.instance=I,wr(I);return}I=h.ownerDocument||h,g=rD(g),(k=xa.get(k))&&q2(g,k),I=I.createElement("link"),wr(I);var F=I;F._p=new Promise(function(W,te){F.onload=W,F.onerror=te}),Br(I,"link",g),f.instance=I}x.stylesheets===null&&(x.stylesheets=new Map),x.stylesheets.set(f,h),(h=f.state.preload)&&(f.state.loading&3)===0&&(x.count++,f=fy.bind(x),h.addEventListener("load",f),h.addEventListener("error",f))}}function W6(){if(hp===null)throw Error(r(475));var h=hp;return h.stylesheets&&h.count===0&&X2(h,h.stylesheets),0<h.count?function(f){var g=setTimeout(function(){if(h.stylesheets&&X2(h,h.stylesheets),h.unsuspend){var x=h.unsuspend;h.unsuspend=null,x()}},6e4);return h.unsuspend=f,function(){h.unsuspend=null,clearTimeout(g)}}:null}function fy(){if(this.count--,this.count===0){if(this.stylesheets)X2(this,this.stylesheets);else if(this.unsuspend){var h=this.unsuspend;this.unsuspend=null,h()}}}var py=null;function X2(h,f){h.stylesheets=null,h.unsuspend!==null&&(h.count++,py=new Map,f.forEach(G6,h),py=null,fy.call(h))}function G6(h,f){if(!(f.state.loading&4)){var g=py.get(h);if(g)var x=g.get(null);else{g=new Map,py.set(h,g);for(var k=h.querySelectorAll("link[data-precedence],style[data-precedence]"),I=0;I<k.length;I++){var F=k[I];(F.nodeName==="LINK"||F.getAttribute("media")!=="not all")&&(g.set(F.dataset.precedence,F),x=F)}x&&g.set(null,x)}k=f.instance,F=k.getAttribute("data-precedence"),I=g.get(F)||x,I===x&&g.set(null,k),g.set(F,k),this.count++,x=fy.bind(this),k.addEventListener("load",x),k.addEventListener("error",x),I?I.parentNode.insertBefore(k,I.nextSibling):(h=h.nodeType===9?h.head:h,h.insertBefore(k,h.firstChild)),f.state.loading|=4}}var dp={$$typeof:N,Provider:null,Consumer:null,_currentValue:z,_currentValue2:z,_threadCount:0};function H6(h,f,g,x,k,I,F,W){this.tag=1,this.containerInfo=h,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=H1(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=H1(0),this.hiddenUpdates=H1(null),this.identifierPrefix=x,this.onUncaughtError=k,this.onCaughtError=I,this.onRecoverableError=F,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=W,this.incompleteTransitions=new Map}function uD(h,f,g,x,k,I,F,W,te,me,ke,Ee){return h=new H6(h,f,g,F,W,te,me,Ee),f=1,I===!0&&(f|=24),I=Hs(3,null,null,f),h.current=I,I.stateNode=h,f=Rw(),f.refCount++,h.pooledCache=f,f.refCount++,I.memoizedState={element:x,isDehydrated:g,cache:f},Ow(I),h}function lD(h){return h?(h=Gc,h):Gc}function cD(h,f,g,x,k,I){k=lD(k),x.context===null?x.context=k:x.pendingContext=k,x=Wi(f),x.payload={element:g},I=I===void 0?null:I,I!==null&&(x.callback=I),g=Gi(h,x,f),g!==null&&(Ys(g,h,f),Uf(g,h,f))}function hD(h,f){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var g=h.retryLane;h.retryLane=g!==0&&g<f?g:f}}function Y2(h,f){hD(h,f),(h=h.alternate)&&hD(h,f)}function dD(h){if(h.tag===13){var f=Wc(h,67108864);f!==null&&Ys(f,h,67108864),Y2(h,67108864)}}var my=!0;function j6(h,f,g,x){var k=P.T;P.T=null;var I=V.p;try{V.p=2,Z2(h,f,g,x)}finally{V.p=I,P.T=k}}function q6(h,f,g,x){var k=P.T;P.T=null;var I=V.p;try{V.p=8,Z2(h,f,g,x)}finally{V.p=I,P.T=k}}function Z2(h,f,g,x){if(my){var k=Q2(x);if(k===null)P2(h,f,x,gy,g),pD(h,x);else if(X6(k,h,f,g,x))x.stopPropagation();else if(pD(h,x),f&4&&-1<K6.indexOf(h)){for(;k!==null;){var I=Ac(k);if(I!==null)switch(I.tag){case 3:if(I=I.stateNode,I.current.memoizedState.isDehydrated){var F=Ws(I.pendingLanes);if(F!==0){var W=I;for(W.pendingLanes|=2,W.entangledLanes|=2;F;){var te=1<<31-kn(F);W.entanglements[1]|=te,F&=~te}fo(I),(Yt&6)===0&&(Jv=pt()+500,ap(0))}}break;case 13:W=Wc(I,2),W!==null&&Ys(W,I,2),ty(),Y2(I,2)}if(I=Q2(x),I===null&&P2(h,f,x,gy,g),I===k)break;k=I}k!==null&&x.stopPropagation()}else P2(h,f,x,null,g)}}function Q2(h){return h=rw(h),J2(h)}var gy=null;function J2(h){if(gy=null,h=Rc(h),h!==null){var f=a(h);if(f===null)h=null;else{var g=f.tag;if(g===13){if(h=o(f),h!==null)return h;h=null}else if(g===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;h=null}else f!==h&&(h=null)}}return gy=h,null}function fD(h){switch(h){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(_t()){case hn:return 2;case en:return 8;case Nn:case vn:return 32;case qn:return 268435456;default:return 32}default:return 32}}var eS=!1,ru=null,su=null,au=null,fp=new Map,pp=new Map,ou=[],K6="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function pD(h,f){switch(h){case"focusin":case"focusout":ru=null;break;case"dragenter":case"dragleave":su=null;break;case"mouseover":case"mouseout":au=null;break;case"pointerover":case"pointerout":fp.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":pp.delete(f.pointerId)}}function mp(h,f,g,x,k,I){return h===null||h.nativeEvent!==I?(h={blockedOn:f,domEventName:g,eventSystemFlags:x,nativeEvent:I,targetContainers:[k]},f!==null&&(f=Ac(f),f!==null&&dD(f)),h):(h.eventSystemFlags|=x,f=h.targetContainers,k!==null&&f.indexOf(k)===-1&&f.push(k),h)}function X6(h,f,g,x,k){switch(f){case"focusin":return ru=mp(ru,h,f,g,x,k),!0;case"dragenter":return su=mp(su,h,f,g,x,k),!0;case"mouseover":return au=mp(au,h,f,g,x,k),!0;case"pointerover":var I=k.pointerId;return fp.set(I,mp(fp.get(I)||null,h,f,g,x,k)),!0;case"gotpointercapture":return I=k.pointerId,pp.set(I,mp(pp.get(I)||null,h,f,g,x,k)),!0}return!1}function mD(h){var f=Rc(h.target);if(f!==null){var g=a(f);if(g!==null){if(f=g.tag,f===13){if(f=o(g),f!==null){h.blockedOn=f,UW(h.priority,function(){if(g.tag===13){var x=Xs();x=j1(x);var k=Wc(g,x);k!==null&&Ys(k,g,x),Y2(g,x)}});return}}else if(f===3&&g.stateNode.current.memoizedState.isDehydrated){h.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}h.blockedOn=null}function vy(h){if(h.blockedOn!==null)return!1;for(var f=h.targetContainers;0<f.length;){var g=Q2(h.nativeEvent);if(g===null){g=h.nativeEvent;var x=new g.constructor(g.type,g);nw=x,g.target.dispatchEvent(x),nw=null}else return f=Ac(g),f!==null&&dD(f),h.blockedOn=g,!1;f.shift()}return!0}function gD(h,f,g){vy(h)&&g.delete(f)}function Y6(){eS=!1,ru!==null&&vy(ru)&&(ru=null),su!==null&&vy(su)&&(su=null),au!==null&&vy(au)&&(au=null),fp.forEach(gD),pp.forEach(gD)}function yy(h,f){h.blockedOn===f&&(h.blockedOn=null,eS||(eS=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Y6)))}var by=null;function vD(h){by!==h&&(by=h,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){by===h&&(by=null);for(var f=0;f<h.length;f+=3){var g=h[f],x=h[f+1],k=h[f+2];if(typeof x!="function"){if(J2(x||g)===null)continue;break}var I=Ac(g);I!==null&&(h.splice(f,3),f-=3,Jw(I,{pending:!0,data:k,method:g.method,action:x},x,k))}}))}function gp(h){function f(te){return yy(te,h)}ru!==null&&yy(ru,h),su!==null&&yy(su,h),au!==null&&yy(au,h),fp.forEach(f),pp.forEach(f);for(var g=0;g<ou.length;g++){var x=ou[g];x.blockedOn===h&&(x.blockedOn=null)}for(;0<ou.length&&(g=ou[0],g.blockedOn===null);)mD(g),g.blockedOn===null&&ou.shift();if(g=(h.ownerDocument||h).$$reactFormReplay,g!=null)for(x=0;x<g.length;x+=3){var k=g[x],I=g[x+1],F=k[Cs]||null;if(typeof I=="function")F||vD(g);else if(F){var W=null;if(I&&I.hasAttribute("formAction")){if(k=I,F=I[Cs]||null)W=F.formAction;else if(J2(k)!==null)continue}else W=F.action;typeof W=="function"?g[x+1]=W:(g.splice(x,3),x-=3),vD(g)}}}function tS(h){this._internalRoot=h}xy.prototype.render=tS.prototype.render=function(h){var f=this._internalRoot;if(f===null)throw Error(r(409));var g=f.current,x=Xs();cD(g,x,h,f,null,null)},xy.prototype.unmount=tS.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var f=h.containerInfo;cD(h.current,2,null,h,null,null),ty(),f[_c]=null}};function xy(h){this._internalRoot=h}xy.prototype.unstable_scheduleHydration=function(h){if(h){var f=OE();h={blockedOn:null,target:h,priority:f};for(var g=0;g<ou.length&&f!==0&&f<ou[g].priority;g++);ou.splice(g,0,h),g===0&&mD(h)}};var yD=e.version;if(yD!=="19.1.0")throw Error(r(527,yD,"19.1.0"));V.findDOMNode=function(h){var f=h._reactInternals;if(f===void 0)throw typeof h.render=="function"?Error(r(188)):(h=Object.keys(h).join(","),Error(r(268,h)));return h=u(f),h=h!==null?l(h):null,h=h===null?null:h.stateNode,h};var Z6={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:P,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wy.isDisabled&&wy.supportsFiber)try{xr=wy.inject(Z6),Xt=wy}catch{}}return yp.createRoot=function(h,f){if(!s(h))throw Error(r(299));var g=!1,x="",k=OR,I=FR,F=MR,W=null;return f!=null&&(f.unstable_strictMode===!0&&(g=!0),f.identifierPrefix!==void 0&&(x=f.identifierPrefix),f.onUncaughtError!==void 0&&(k=f.onUncaughtError),f.onCaughtError!==void 0&&(I=f.onCaughtError),f.onRecoverableError!==void 0&&(F=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(W=f.unstable_transitionCallbacks)),f=uD(h,1,!1,null,null,g,x,k,I,F,W,null),h[_c]=f.current,L2(h),new tS(f)},yp.hydrateRoot=function(h,f,g){if(!s(h))throw Error(r(299));var x=!1,k="",I=OR,F=FR,W=MR,te=null,me=null;return g!=null&&(g.unstable_strictMode===!0&&(x=!0),g.identifierPrefix!==void 0&&(k=g.identifierPrefix),g.onUncaughtError!==void 0&&(I=g.onUncaughtError),g.onCaughtError!==void 0&&(F=g.onCaughtError),g.onRecoverableError!==void 0&&(W=g.onRecoverableError),g.unstable_transitionCallbacks!==void 0&&(te=g.unstable_transitionCallbacks),g.formState!==void 0&&(me=g.formState)),f=uD(h,1,!0,f,g??null,x,k,I,F,W,te,me),f.context=lD(null),g=f.current,x=Xs(),x=j1(x),k=Wi(x),k.callback=null,Gi(g,k,x),g=x,f.current.lanes=g,Sf(f,g),fo(f),h[_c]=f.current,L2(h),new xy(f)},yp.version="19.1.0",yp}var ED;function iH(){if(ED)return sS.exports;ED=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),sS.exports=oH(),sS.exports}var uH=iH();function _D(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function lH(...n){return e=>{let t=!1;const r=n.map(s=>{const a=_D(s,e);return!t&&typeof a=="function"&&(t=!0),a});if(t)return()=>{for(let s=0;s<r.length;s++){const a=r[s];typeof a=="function"?a():_D(n[s],null)}}}}function zp(...n){return _e.useCallback(lH(...n),n)}function db(n){const e=cH(n),t=_e.forwardRef((r,s)=>{const{children:a,...o}=r,i=_e.Children.toArray(a),u=i.find(dH);if(u){const l=u.props.children,c=i.map(d=>d===u?_e.Children.count(l)>1?_e.Children.only(null):_e.isValidElement(l)?l.props.children:null:d);return ne.jsx(e,{...o,ref:s,children:_e.isValidElement(l)?_e.cloneElement(l,void 0,c):null})}return ne.jsx(e,{...o,ref:s,children:a})});return t.displayName=`${n}.Slot`,t}var P3=db("Slot");function cH(n){const e=_e.forwardRef((t,r)=>{const{children:s,...a}=t,o=_e.isValidElement(s)?pH(s):void 0,i=zp(o,r);if(_e.isValidElement(s)){const u=fH(a,s.props);return s.type!==_e.Fragment&&(u.ref=i),_e.cloneElement(s,u)}return _e.Children.count(s)>1?_e.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var hH=Symbol("radix.slottable");function dH(n){return _e.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===hH}function fH(n,e){const t={...e};for(const r in e){const s=n[r],a=e[r];/^on[A-Z]/.test(r)?s&&a?t[r]=(...i)=>{const u=a(...i);return s(...i),u}:s&&(t[r]=s):r==="style"?t[r]={...s,...a}:r==="className"&&(t[r]=[s,a].filter(Boolean).join(" "))}return{...n,...t}}function pH(n){var r,s;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(s=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}function B3(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=B3(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function z3(){for(var n,e,t=0,r="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=B3(n))&&(r&&(r+=" "),r+=e);return r}const RD=n=>typeof n=="boolean"?`${n}`:n===0?"0":n,AD=z3,DN=(n,e)=>t=>{var r;if((e==null?void 0:e.variants)==null)return AD(n,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:s,defaultVariants:a}=e,o=Object.keys(s).map(l=>{const c=t==null?void 0:t[l],d=a==null?void 0:a[l];if(c===null)return null;const p=RD(c)||RD(d);return s[l][p]}),i=t&&Object.entries(t).reduce((l,c)=>{let[d,p]=c;return p===void 0||(l[d]=p),l},{}),u=e==null||(r=e.compoundVariants)===null||r===void 0?void 0:r.reduce((l,c)=>{let{class:d,className:p,...m}=c;return Object.entries(m).every(v=>{let[b,y]=v;return Array.isArray(y)?y.includes({...a,...i}[b]):{...a,...i}[b]===y})?[...l,d,p]:l},[]);return AD(n,o,u,t==null?void 0:t.class,t==null?void 0:t.className)},$N="-",mH=n=>{const e=vH(n),{conflictingClassGroups:t,conflictingClassGroupModifiers:r}=n;return{getClassGroupId:o=>{const i=o.split($N);return i[0]===""&&i.length!==1&&i.shift(),V3(i,e)||gH(o)},getConflictingClassGroupIds:(o,i)=>{const u=t[o]||[];return i&&r[o]?[...u,...r[o]]:u}}},V3=(n,e)=>{var o;if(n.length===0)return e.classGroupId;const t=n[0],r=e.nextPart.get(t),s=r?V3(n.slice(1),r):void 0;if(s)return s;if(e.validators.length===0)return;const a=n.join($N);return(o=e.validators.find(({validator:i})=>i(a)))==null?void 0:o.classGroupId},DD=/^\[(.+)\]$/,gH=n=>{if(DD.test(n)){const e=DD.exec(n)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},vH=n=>{const{theme:e,classGroups:t}=n,r={nextPart:new Map,validators:[]};for(const s in t)iC(t[s],r,s,e);return r},iC=(n,e,t,r)=>{n.forEach(s=>{if(typeof s=="string"){const a=s===""?e:$D(e,s);a.classGroupId=t;return}if(typeof s=="function"){if(yH(s)){iC(s(r),e,t,r);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([a,o])=>{iC(o,$D(e,a),t,r)})})},$D=(n,e)=>{let t=n;return e.split($N).forEach(r=>{t.nextPart.has(r)||t.nextPart.set(r,{nextPart:new Map,validators:[]}),t=t.nextPart.get(r)}),t},yH=n=>n.isThemeGetter,bH=n=>{if(n<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,r=new Map;const s=(a,o)=>{t.set(a,o),e++,e>n&&(e=0,r=t,t=new Map)};return{get(a){let o=t.get(a);if(o!==void 0)return o;if((o=r.get(a))!==void 0)return s(a,o),o},set(a,o){t.has(a)?t.set(a,o):s(a,o)}}},uC="!",lC=":",xH=lC.length,wH=n=>{const{prefix:e,experimentalParseClassName:t}=n;let r=s=>{const a=[];let o=0,i=0,u=0,l;for(let v=0;v<s.length;v++){let b=s[v];if(o===0&&i===0){if(b===lC){a.push(s.slice(u,v)),u=v+xH;continue}if(b==="/"){l=v;continue}}b==="["?o++:b==="]"?o--:b==="("?i++:b===")"&&i--}const c=a.length===0?s:s.substring(u),d=SH(c),p=d!==c,m=l&&l>u?l-u:void 0;return{modifiers:a,hasImportantModifier:p,baseClassName:d,maybePostfixModifierPosition:m}};if(e){const s=e+lC,a=r;r=o=>o.startsWith(s)?a(o.substring(s.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:o,maybePostfixModifierPosition:void 0}}if(t){const s=r;r=a=>t({className:a,parseClassName:s})}return r},SH=n=>n.endsWith(uC)?n.substring(0,n.length-1):n.startsWith(uC)?n.substring(1):n,CH=n=>{const e=Object.fromEntries(n.orderSensitiveModifiers.map(r=>[r,!0]));return r=>{if(r.length<=1)return r;const s=[];let a=[];return r.forEach(o=>{o[0]==="["||e[o]?(s.push(...a.sort(),o),a=[]):a.push(o)}),s.push(...a.sort()),s}},NH=n=>({cache:bH(n.cacheSize),parseClassName:wH(n),sortModifiers:CH(n),...mH(n)}),kH=/\s+/,TH=(n,e)=>{const{parseClassName:t,getClassGroupId:r,getConflictingClassGroupIds:s,sortModifiers:a}=e,o=[],i=n.trim().split(kH);let u="";for(let l=i.length-1;l>=0;l-=1){const c=i[l],{isExternal:d,modifiers:p,hasImportantModifier:m,baseClassName:v,maybePostfixModifierPosition:b}=t(c);if(d){u=c+(u.length>0?" "+u:u);continue}let y=!!b,w=r(y?v.substring(0,b):v);if(!w){if(!y){u=c+(u.length>0?" "+u:u);continue}if(w=r(v),!w){u=c+(u.length>0?" "+u:u);continue}y=!1}const S=a(p).join(":"),N=m?S+uC:S,C=N+w;if(o.includes(C))continue;o.push(C);const T=s(w,y);for(let E=0;E<T.length;++E){const $=T[E];o.push(N+$)}u=c+(u.length>0?" "+u:u)}return u};function IH(){let n=0,e,t,r="";for(;n<arguments.length;)(e=arguments[n++])&&(t=U3(e))&&(r&&(r+=" "),r+=t);return r}const U3=n=>{if(typeof n=="string")return n;let e,t="";for(let r=0;r<n.length;r++)n[r]&&(e=U3(n[r]))&&(t&&(t+=" "),t+=e);return t};function EH(n,...e){let t,r,s,a=o;function o(u){const l=e.reduce((c,d)=>d(c),n());return t=NH(l),r=t.cache.get,s=t.cache.set,a=i,i(u)}function i(u){const l=r(u);if(l)return l;const c=TH(u,t);return s(u,c),c}return function(){return a(IH.apply(null,arguments))}}const or=n=>{const e=t=>t[n]||[];return e.isThemeGetter=!0,e},W3=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,G3=/^\((?:(\w[\w-]*):)?(.+)\)$/i,_H=/^\d+\/\d+$/,RH=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,AH=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,DH=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,$H=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,OH=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ph=n=>_H.test(n),It=n=>!!n&&!Number.isNaN(Number(n)),uu=n=>!!n&&Number.isInteger(Number(n)),uS=n=>n.endsWith("%")&&It(n.slice(0,-1)),ii=n=>RH.test(n),FH=()=>!0,MH=n=>AH.test(n)&&!DH.test(n),H3=()=>!1,LH=n=>$H.test(n),PH=n=>OH.test(n),BH=n=>!je(n)&&!qe(n),zH=n=>sd(n,K3,H3),je=n=>W3.test(n),xl=n=>sd(n,X3,MH),lS=n=>sd(n,HH,It),OD=n=>sd(n,j3,H3),VH=n=>sd(n,q3,PH),Sy=n=>sd(n,Y3,LH),qe=n=>G3.test(n),bp=n=>ad(n,X3),UH=n=>ad(n,jH),FD=n=>ad(n,j3),WH=n=>ad(n,K3),GH=n=>ad(n,q3),Cy=n=>ad(n,Y3,!0),sd=(n,e,t)=>{const r=W3.exec(n);return r?r[1]?e(r[1]):t(r[2]):!1},ad=(n,e,t=!1)=>{const r=G3.exec(n);return r?r[1]?e(r[1]):t:!1},j3=n=>n==="position"||n==="percentage",q3=n=>n==="image"||n==="url",K3=n=>n==="length"||n==="size"||n==="bg-size",X3=n=>n==="length",HH=n=>n==="number",jH=n=>n==="family-name",Y3=n=>n==="shadow",qH=()=>{const n=or("color"),e=or("font"),t=or("text"),r=or("font-weight"),s=or("tracking"),a=or("leading"),o=or("breakpoint"),i=or("container"),u=or("spacing"),l=or("radius"),c=or("shadow"),d=or("inset-shadow"),p=or("text-shadow"),m=or("drop-shadow"),v=or("blur"),b=or("perspective"),y=or("aspect"),w=or("ease"),S=or("animate"),N=()=>["auto","avoid","all","avoid-page","page","left","right","column"],C=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],T=()=>[...C(),qe,je],E=()=>["auto","hidden","clip","visible","scroll"],$=()=>["auto","contain","none"],_=()=>[qe,je,u],R=()=>[ph,"full","auto",..._()],D=()=>[uu,"none","subgrid",qe,je],A=()=>["auto",{span:["full",uu,qe,je]},uu,qe,je],M=()=>[uu,"auto",qe,je],H=()=>["auto","min","max","fr",qe,je],j=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],G=()=>["start","end","center","stretch","center-safe","end-safe"],P=()=>["auto",..._()],V=()=>[ph,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",..._()],z=()=>[n,qe,je],Y=()=>[...C(),FD,OD,{position:[qe,je]}],L=()=>["no-repeat",{repeat:["","x","y","space","round"]}],K=()=>["auto","cover","contain",WH,zH,{size:[qe,je]}],J=()=>[uS,bp,xl],Z=()=>["","none","full",l,qe,je],le=()=>["",It,bp,xl],pe=()=>["solid","dashed","dotted","double"],ge=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ce=()=>[It,uS,FD,OD],Ie=()=>["","none",v,qe,je],$e=()=>["none",It,qe,je],Be=()=>["none",It,qe,je],Oe=()=>[It,qe,je],Ve=()=>[ph,"full",..._()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[ii],breakpoint:[ii],color:[FH],container:[ii],"drop-shadow":[ii],ease:["in","out","in-out"],font:[BH],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[ii],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[ii],shadow:[ii],spacing:["px",It],text:[ii],"text-shadow":[ii],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",ph,je,qe,y]}],container:["container"],columns:[{columns:[It,je,qe,i]}],"break-after":[{"break-after":N()}],"break-before":[{"break-before":N()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:T()}],overflow:[{overflow:E()}],"overflow-x":[{"overflow-x":E()}],"overflow-y":[{"overflow-y":E()}],overscroll:[{overscroll:$()}],"overscroll-x":[{"overscroll-x":$()}],"overscroll-y":[{"overscroll-y":$()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:R()}],"inset-x":[{"inset-x":R()}],"inset-y":[{"inset-y":R()}],start:[{start:R()}],end:[{end:R()}],top:[{top:R()}],right:[{right:R()}],bottom:[{bottom:R()}],left:[{left:R()}],visibility:["visible","invisible","collapse"],z:[{z:[uu,"auto",qe,je]}],basis:[{basis:[ph,"full","auto",i,..._()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[It,ph,"auto","initial","none",je]}],grow:[{grow:["",It,qe,je]}],shrink:[{shrink:["",It,qe,je]}],order:[{order:[uu,"first","last","none",qe,je]}],"grid-cols":[{"grid-cols":D()}],"col-start-end":[{col:A()}],"col-start":[{"col-start":M()}],"col-end":[{"col-end":M()}],"grid-rows":[{"grid-rows":D()}],"row-start-end":[{row:A()}],"row-start":[{"row-start":M()}],"row-end":[{"row-end":M()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":H()}],"auto-rows":[{"auto-rows":H()}],gap:[{gap:_()}],"gap-x":[{"gap-x":_()}],"gap-y":[{"gap-y":_()}],"justify-content":[{justify:[...j(),"normal"]}],"justify-items":[{"justify-items":[...G(),"normal"]}],"justify-self":[{"justify-self":["auto",...G()]}],"align-content":[{content:["normal",...j()]}],"align-items":[{items:[...G(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...G(),{baseline:["","last"]}]}],"place-content":[{"place-content":j()}],"place-items":[{"place-items":[...G(),"baseline"]}],"place-self":[{"place-self":["auto",...G()]}],p:[{p:_()}],px:[{px:_()}],py:[{py:_()}],ps:[{ps:_()}],pe:[{pe:_()}],pt:[{pt:_()}],pr:[{pr:_()}],pb:[{pb:_()}],pl:[{pl:_()}],m:[{m:P()}],mx:[{mx:P()}],my:[{my:P()}],ms:[{ms:P()}],me:[{me:P()}],mt:[{mt:P()}],mr:[{mr:P()}],mb:[{mb:P()}],ml:[{ml:P()}],"space-x":[{"space-x":_()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":_()}],"space-y-reverse":["space-y-reverse"],size:[{size:V()}],w:[{w:[i,"screen",...V()]}],"min-w":[{"min-w":[i,"screen","none",...V()]}],"max-w":[{"max-w":[i,"screen","none","prose",{screen:[o]},...V()]}],h:[{h:["screen","lh",...V()]}],"min-h":[{"min-h":["screen","lh","none",...V()]}],"max-h":[{"max-h":["screen","lh",...V()]}],"font-size":[{text:["base",t,bp,xl]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,qe,lS]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",uS,je]}],"font-family":[{font:[UH,je,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[s,qe,je]}],"line-clamp":[{"line-clamp":[It,"none",qe,lS]}],leading:[{leading:[a,..._()]}],"list-image":[{"list-image":["none",qe,je]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",qe,je]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:z()}],"text-color":[{text:z()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...pe(),"wavy"]}],"text-decoration-thickness":[{decoration:[It,"from-font","auto",qe,xl]}],"text-decoration-color":[{decoration:z()}],"underline-offset":[{"underline-offset":[It,"auto",qe,je]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:_()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",qe,je]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",qe,je]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Y()}],"bg-repeat":[{bg:L()}],"bg-size":[{bg:K()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},uu,qe,je],radial:["",qe,je],conic:[uu,qe,je]},GH,VH]}],"bg-color":[{bg:z()}],"gradient-from-pos":[{from:J()}],"gradient-via-pos":[{via:J()}],"gradient-to-pos":[{to:J()}],"gradient-from":[{from:z()}],"gradient-via":[{via:z()}],"gradient-to":[{to:z()}],rounded:[{rounded:Z()}],"rounded-s":[{"rounded-s":Z()}],"rounded-e":[{"rounded-e":Z()}],"rounded-t":[{"rounded-t":Z()}],"rounded-r":[{"rounded-r":Z()}],"rounded-b":[{"rounded-b":Z()}],"rounded-l":[{"rounded-l":Z()}],"rounded-ss":[{"rounded-ss":Z()}],"rounded-se":[{"rounded-se":Z()}],"rounded-ee":[{"rounded-ee":Z()}],"rounded-es":[{"rounded-es":Z()}],"rounded-tl":[{"rounded-tl":Z()}],"rounded-tr":[{"rounded-tr":Z()}],"rounded-br":[{"rounded-br":Z()}],"rounded-bl":[{"rounded-bl":Z()}],"border-w":[{border:le()}],"border-w-x":[{"border-x":le()}],"border-w-y":[{"border-y":le()}],"border-w-s":[{"border-s":le()}],"border-w-e":[{"border-e":le()}],"border-w-t":[{"border-t":le()}],"border-w-r":[{"border-r":le()}],"border-w-b":[{"border-b":le()}],"border-w-l":[{"border-l":le()}],"divide-x":[{"divide-x":le()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":le()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...pe(),"hidden","none"]}],"divide-style":[{divide:[...pe(),"hidden","none"]}],"border-color":[{border:z()}],"border-color-x":[{"border-x":z()}],"border-color-y":[{"border-y":z()}],"border-color-s":[{"border-s":z()}],"border-color-e":[{"border-e":z()}],"border-color-t":[{"border-t":z()}],"border-color-r":[{"border-r":z()}],"border-color-b":[{"border-b":z()}],"border-color-l":[{"border-l":z()}],"divide-color":[{divide:z()}],"outline-style":[{outline:[...pe(),"none","hidden"]}],"outline-offset":[{"outline-offset":[It,qe,je]}],"outline-w":[{outline:["",It,bp,xl]}],"outline-color":[{outline:z()}],shadow:[{shadow:["","none",c,Cy,Sy]}],"shadow-color":[{shadow:z()}],"inset-shadow":[{"inset-shadow":["none",d,Cy,Sy]}],"inset-shadow-color":[{"inset-shadow":z()}],"ring-w":[{ring:le()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:z()}],"ring-offset-w":[{"ring-offset":[It,xl]}],"ring-offset-color":[{"ring-offset":z()}],"inset-ring-w":[{"inset-ring":le()}],"inset-ring-color":[{"inset-ring":z()}],"text-shadow":[{"text-shadow":["none",p,Cy,Sy]}],"text-shadow-color":[{"text-shadow":z()}],opacity:[{opacity:[It,qe,je]}],"mix-blend":[{"mix-blend":[...ge(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":ge()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[It]}],"mask-image-linear-from-pos":[{"mask-linear-from":Ce()}],"mask-image-linear-to-pos":[{"mask-linear-to":Ce()}],"mask-image-linear-from-color":[{"mask-linear-from":z()}],"mask-image-linear-to-color":[{"mask-linear-to":z()}],"mask-image-t-from-pos":[{"mask-t-from":Ce()}],"mask-image-t-to-pos":[{"mask-t-to":Ce()}],"mask-image-t-from-color":[{"mask-t-from":z()}],"mask-image-t-to-color":[{"mask-t-to":z()}],"mask-image-r-from-pos":[{"mask-r-from":Ce()}],"mask-image-r-to-pos":[{"mask-r-to":Ce()}],"mask-image-r-from-color":[{"mask-r-from":z()}],"mask-image-r-to-color":[{"mask-r-to":z()}],"mask-image-b-from-pos":[{"mask-b-from":Ce()}],"mask-image-b-to-pos":[{"mask-b-to":Ce()}],"mask-image-b-from-color":[{"mask-b-from":z()}],"mask-image-b-to-color":[{"mask-b-to":z()}],"mask-image-l-from-pos":[{"mask-l-from":Ce()}],"mask-image-l-to-pos":[{"mask-l-to":Ce()}],"mask-image-l-from-color":[{"mask-l-from":z()}],"mask-image-l-to-color":[{"mask-l-to":z()}],"mask-image-x-from-pos":[{"mask-x-from":Ce()}],"mask-image-x-to-pos":[{"mask-x-to":Ce()}],"mask-image-x-from-color":[{"mask-x-from":z()}],"mask-image-x-to-color":[{"mask-x-to":z()}],"mask-image-y-from-pos":[{"mask-y-from":Ce()}],"mask-image-y-to-pos":[{"mask-y-to":Ce()}],"mask-image-y-from-color":[{"mask-y-from":z()}],"mask-image-y-to-color":[{"mask-y-to":z()}],"mask-image-radial":[{"mask-radial":[qe,je]}],"mask-image-radial-from-pos":[{"mask-radial-from":Ce()}],"mask-image-radial-to-pos":[{"mask-radial-to":Ce()}],"mask-image-radial-from-color":[{"mask-radial-from":z()}],"mask-image-radial-to-color":[{"mask-radial-to":z()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":C()}],"mask-image-conic-pos":[{"mask-conic":[It]}],"mask-image-conic-from-pos":[{"mask-conic-from":Ce()}],"mask-image-conic-to-pos":[{"mask-conic-to":Ce()}],"mask-image-conic-from-color":[{"mask-conic-from":z()}],"mask-image-conic-to-color":[{"mask-conic-to":z()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Y()}],"mask-repeat":[{mask:L()}],"mask-size":[{mask:K()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",qe,je]}],filter:[{filter:["","none",qe,je]}],blur:[{blur:Ie()}],brightness:[{brightness:[It,qe,je]}],contrast:[{contrast:[It,qe,je]}],"drop-shadow":[{"drop-shadow":["","none",m,Cy,Sy]}],"drop-shadow-color":[{"drop-shadow":z()}],grayscale:[{grayscale:["",It,qe,je]}],"hue-rotate":[{"hue-rotate":[It,qe,je]}],invert:[{invert:["",It,qe,je]}],saturate:[{saturate:[It,qe,je]}],sepia:[{sepia:["",It,qe,je]}],"backdrop-filter":[{"backdrop-filter":["","none",qe,je]}],"backdrop-blur":[{"backdrop-blur":Ie()}],"backdrop-brightness":[{"backdrop-brightness":[It,qe,je]}],"backdrop-contrast":[{"backdrop-contrast":[It,qe,je]}],"backdrop-grayscale":[{"backdrop-grayscale":["",It,qe,je]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[It,qe,je]}],"backdrop-invert":[{"backdrop-invert":["",It,qe,je]}],"backdrop-opacity":[{"backdrop-opacity":[It,qe,je]}],"backdrop-saturate":[{"backdrop-saturate":[It,qe,je]}],"backdrop-sepia":[{"backdrop-sepia":["",It,qe,je]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":_()}],"border-spacing-x":[{"border-spacing-x":_()}],"border-spacing-y":[{"border-spacing-y":_()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",qe,je]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[It,"initial",qe,je]}],ease:[{ease:["linear","initial",w,qe,je]}],delay:[{delay:[It,qe,je]}],animate:[{animate:["none",S,qe,je]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[b,qe,je]}],"perspective-origin":[{"perspective-origin":T()}],rotate:[{rotate:$e()}],"rotate-x":[{"rotate-x":$e()}],"rotate-y":[{"rotate-y":$e()}],"rotate-z":[{"rotate-z":$e()}],scale:[{scale:Be()}],"scale-x":[{"scale-x":Be()}],"scale-y":[{"scale-y":Be()}],"scale-z":[{"scale-z":Be()}],"scale-3d":["scale-3d"],skew:[{skew:Oe()}],"skew-x":[{"skew-x":Oe()}],"skew-y":[{"skew-y":Oe()}],transform:[{transform:[qe,je,"","none","gpu","cpu"]}],"transform-origin":[{origin:T()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Ve()}],"translate-x":[{"translate-x":Ve()}],"translate-y":[{"translate-y":Ve()}],"translate-z":[{"translate-z":Ve()}],"translate-none":["translate-none"],accent:[{accent:z()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:z()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",qe,je]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":_()}],"scroll-mx":[{"scroll-mx":_()}],"scroll-my":[{"scroll-my":_()}],"scroll-ms":[{"scroll-ms":_()}],"scroll-me":[{"scroll-me":_()}],"scroll-mt":[{"scroll-mt":_()}],"scroll-mr":[{"scroll-mr":_()}],"scroll-mb":[{"scroll-mb":_()}],"scroll-ml":[{"scroll-ml":_()}],"scroll-p":[{"scroll-p":_()}],"scroll-px":[{"scroll-px":_()}],"scroll-py":[{"scroll-py":_()}],"scroll-ps":[{"scroll-ps":_()}],"scroll-pe":[{"scroll-pe":_()}],"scroll-pt":[{"scroll-pt":_()}],"scroll-pr":[{"scroll-pr":_()}],"scroll-pb":[{"scroll-pb":_()}],"scroll-pl":[{"scroll-pl":_()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",qe,je]}],fill:[{fill:["none",...z()]}],"stroke-w":[{stroke:[It,bp,xl,lS]}],stroke:[{stroke:["none",...z()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},KH=EH(qH);function ws(...n){return KH(z3(n))}const XH=DN("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function Fp({className:n,variant:e,size:t,asChild:r=!1,...s}){const a=r?P3:"button";return ne.jsx(a,{"data-slot":"button",className:ws(XH({variant:e,size:t,className:n})),...s})}function hu({className:n,...e}){return ne.jsx("div",{"data-slot":"card",className:ws("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",n),...e})}function du({className:n,...e}){return ne.jsx("div",{"data-slot":"card-header",className:ws("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",n),...e})}function fu({className:n,...e}){return ne.jsx("div",{"data-slot":"card-title",className:ws("leading-none font-semibold",n),...e})}function cC({className:n,...e}){return ne.jsx("div",{"data-slot":"card-description",className:ws("text-muted-foreground text-sm",n),...e})}function pu({className:n,...e}){return ne.jsx("div",{"data-slot":"card-content",className:ws("px-6",n),...e})}const YH=DN("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function cS({className:n,variant:e,asChild:t=!1,...r}){const s=t?P3:"span";return ne.jsx(s,{"data-slot":"badge",className:ws(YH({variant:e}),n),...r})}const ZH=DN("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function Z3({className:n,variant:e,...t}){return ne.jsx("div",{"data-slot":"alert",role:"alert",className:ws(ZH({variant:e}),n),...t})}function Q3({className:n,...e}){return ne.jsx("div",{"data-slot":"alert-description",className:ws("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",n),...e})}function vi(n,e,{checkForDefaultPrevented:t=!0}={}){return function(s){if(n==null||n(s),t===!1||!s.defaultPrevented)return e==null?void 0:e(s)}}function ON(n,e=[]){let t=[];function r(a,o){const i=_e.createContext(o),u=t.length;t=[...t,o];const l=d=>{var w;const{scope:p,children:m,...v}=d,b=((w=p==null?void 0:p[n])==null?void 0:w[u])||i,y=_e.useMemo(()=>v,Object.values(v));return ne.jsx(b.Provider,{value:y,children:m})};l.displayName=a+"Provider";function c(d,p){var b;const m=((b=p==null?void 0:p[n])==null?void 0:b[u])||i,v=_e.useContext(m);if(v)return v;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${a}\``)}return[l,c]}const s=()=>{const a=t.map(o=>_e.createContext(o));return function(i){const u=(i==null?void 0:i[n])||a;return _e.useMemo(()=>({[`__scope${n}`]:{...i,[n]:u}}),[i,u])}};return s.scopeName=n,[r,QH(s,...e)]}function QH(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(a){const o=r.reduce((i,{useScope:u,scopeName:l})=>{const d=u(a)[`__scope${l}`];return{...i,...d}},{});return _e.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function JH(n){const e=n+"CollectionProvider",[t,r]=ON(e),[s,a]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=b=>{const{scope:y,children:w}=b,S=ci.useRef(null),N=ci.useRef(new Map).current;return ne.jsx(s,{scope:y,itemMap:N,collectionRef:S,children:w})};o.displayName=e;const i=n+"CollectionSlot",u=db(i),l=ci.forwardRef((b,y)=>{const{scope:w,children:S}=b,N=a(i,w),C=zp(y,N.collectionRef);return ne.jsx(u,{ref:C,children:S})});l.displayName=i;const c=n+"CollectionItemSlot",d="data-radix-collection-item",p=db(c),m=ci.forwardRef((b,y)=>{const{scope:w,children:S,...N}=b,C=ci.useRef(null),T=zp(y,C),E=a(c,w);return ci.useEffect(()=>(E.itemMap.set(C,{ref:C,...N}),()=>void E.itemMap.delete(C))),ne.jsx(p,{[d]:"",ref:T,children:S})});m.displayName=c;function v(b){const y=a(n+"CollectionConsumer",b);return ci.useCallback(()=>{const S=y.collectionRef.current;if(!S)return[];const N=Array.from(S.querySelectorAll(`[${d}]`));return Array.from(y.itemMap.values()).sort((E,$)=>N.indexOf(E.ref.current)-N.indexOf($.ref.current))},[y.collectionRef,y.itemMap])}return[{Provider:o,Slot:l,ItemSlot:m},v,r]}var fb=globalThis!=null&&globalThis.document?_e.useLayoutEffect:()=>{},ej=M3[" useId ".trim().toString()]||(()=>{}),tj=0;function J3(n){const[e,t]=_e.useState(ej());return fb(()=>{t(r=>r??String(tj++))},[n]),n||(e?`radix-${e}`:"")}L3();var nj=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],lc=nj.reduce((n,e)=>{const t=db(`Primitive.${e}`),r=_e.forwardRef((s,a)=>{const{asChild:o,...i}=s,u=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),ne.jsx(u,{...i,ref:a})});return r.displayName=`Primitive.${e}`,{...n,[e]:r}},{});function rj(n){const e=_e.useRef(n);return _e.useEffect(()=>{e.current=n}),_e.useMemo(()=>(...t)=>{var r;return(r=e.current)==null?void 0:r.call(e,...t)},[])}var sj=M3[" useInsertionEffect ".trim().toString()]||fb;function eF({prop:n,defaultProp:e,onChange:t=()=>{},caller:r}){const[s,a,o]=aj({defaultProp:e,onChange:t}),i=n!==void 0,u=i?n:s;{const c=_e.useRef(n!==void 0);_e.useEffect(()=>{const d=c.current;d!==i&&console.warn(`${r} is changing from ${d?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),c.current=i},[i,r])}const l=_e.useCallback(c=>{var d;if(i){const p=oj(c)?c(n):c;p!==n&&((d=o.current)==null||d.call(o,p))}else a(c)},[i,n,a,o]);return[u,l]}function aj({defaultProp:n,onChange:e}){const[t,r]=_e.useState(n),s=_e.useRef(t),a=_e.useRef(e);return sj(()=>{a.current=e},[e]),_e.useEffect(()=>{var o;s.current!==t&&((o=a.current)==null||o.call(a,t),s.current=t)},[t,s]),[t,r,a]}function oj(n){return typeof n=="function"}var ij=_e.createContext(void 0);function tF(n){const e=_e.useContext(ij);return n||e||"ltr"}var hS="rovingFocusGroup.onEntryFocus",uj={bubbles:!1,cancelable:!0},pm="RovingFocusGroup",[hC,nF,lj]=JH(pm),[cj,rF]=ON(pm,[lj]),[hj,dj]=cj(pm),sF=_e.forwardRef((n,e)=>ne.jsx(hC.Provider,{scope:n.__scopeRovingFocusGroup,children:ne.jsx(hC.Slot,{scope:n.__scopeRovingFocusGroup,children:ne.jsx(fj,{...n,ref:e})})}));sF.displayName=pm;var fj=_e.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,orientation:r,loop:s=!1,dir:a,currentTabStopId:o,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:u,onEntryFocus:l,preventScrollOnEntryFocus:c=!1,...d}=n,p=_e.useRef(null),m=zp(e,p),v=tF(a),[b,y]=eF({prop:o,defaultProp:i??null,onChange:u,caller:pm}),[w,S]=_e.useState(!1),N=rj(l),C=nF(t),T=_e.useRef(!1),[E,$]=_e.useState(0);return _e.useEffect(()=>{const _=p.current;if(_)return _.addEventListener(hS,N),()=>_.removeEventListener(hS,N)},[N]),ne.jsx(hj,{scope:t,orientation:r,dir:v,loop:s,currentTabStopId:b,onItemFocus:_e.useCallback(_=>y(_),[y]),onItemShiftTab:_e.useCallback(()=>S(!0),[]),onFocusableItemAdd:_e.useCallback(()=>$(_=>_+1),[]),onFocusableItemRemove:_e.useCallback(()=>$(_=>_-1),[]),children:ne.jsx(lc.div,{tabIndex:w||E===0?-1:0,"data-orientation":r,...d,ref:m,style:{outline:"none",...n.style},onMouseDown:vi(n.onMouseDown,()=>{T.current=!0}),onFocus:vi(n.onFocus,_=>{const R=!T.current;if(_.target===_.currentTarget&&R&&!w){const D=new CustomEvent(hS,uj);if(_.currentTarget.dispatchEvent(D),!D.defaultPrevented){const A=C().filter(P=>P.focusable),M=A.find(P=>P.active),H=A.find(P=>P.id===b),G=[M,H,...A].filter(Boolean).map(P=>P.ref.current);iF(G,c)}}T.current=!1}),onBlur:vi(n.onBlur,()=>S(!1))})})}),aF="RovingFocusGroupItem",oF=_e.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,focusable:r=!0,active:s=!1,tabStopId:a,children:o,...i}=n,u=J3(),l=a||u,c=dj(aF,t),d=c.currentTabStopId===l,p=nF(t),{onFocusableItemAdd:m,onFocusableItemRemove:v,currentTabStopId:b}=c;return _e.useEffect(()=>{if(r)return m(),()=>v()},[r,m,v]),ne.jsx(hC.ItemSlot,{scope:t,id:l,focusable:r,active:s,children:ne.jsx(lc.span,{tabIndex:d?0:-1,"data-orientation":c.orientation,...i,ref:e,onMouseDown:vi(n.onMouseDown,y=>{r?c.onItemFocus(l):y.preventDefault()}),onFocus:vi(n.onFocus,()=>c.onItemFocus(l)),onKeyDown:vi(n.onKeyDown,y=>{if(y.key==="Tab"&&y.shiftKey){c.onItemShiftTab();return}if(y.target!==y.currentTarget)return;const w=gj(y,c.orientation,c.dir);if(w!==void 0){if(y.metaKey||y.ctrlKey||y.altKey||y.shiftKey)return;y.preventDefault();let N=p().filter(C=>C.focusable).map(C=>C.ref.current);if(w==="last")N.reverse();else if(w==="prev"||w==="next"){w==="prev"&&N.reverse();const C=N.indexOf(y.currentTarget);N=c.loop?vj(N,C+1):N.slice(C+1)}setTimeout(()=>iF(N))}}),children:typeof o=="function"?o({isCurrentTabStop:d,hasTabStop:b!=null}):o})})});oF.displayName=aF;var pj={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function mj(n,e){return e!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function gj(n,e,t){const r=mj(n.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return pj[r]}function iF(n,e=!1){const t=document.activeElement;for(const r of n)if(r===t||(r.focus({preventScroll:e}),document.activeElement!==t))return}function vj(n,e){return n.map((t,r)=>n[(e+r)%n.length])}var yj=sF,bj=oF;function xj(n,e){return _e.useReducer((t,r)=>e[t][r]??t,n)}var uF=n=>{const{present:e,children:t}=n,r=wj(e),s=typeof t=="function"?t({present:r.isPresent}):_e.Children.only(t),a=zp(r.ref,Sj(s));return typeof t=="function"||r.isPresent?_e.cloneElement(s,{ref:a}):null};uF.displayName="Presence";function wj(n){const[e,t]=_e.useState(),r=_e.useRef(null),s=_e.useRef(n),a=_e.useRef("none"),o=n?"mounted":"unmounted",[i,u]=xj(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return _e.useEffect(()=>{const l=Ny(r.current);a.current=i==="mounted"?l:"none"},[i]),fb(()=>{const l=r.current,c=s.current;if(c!==n){const p=a.current,m=Ny(l);n?u("MOUNT"):m==="none"||(l==null?void 0:l.display)==="none"?u("UNMOUNT"):u(c&&p!==m?"ANIMATION_OUT":"UNMOUNT"),s.current=n}},[n,u]),fb(()=>{if(e){let l;const c=e.ownerDocument.defaultView??window,d=m=>{const b=Ny(r.current).includes(m.animationName);if(m.target===e&&b&&(u("ANIMATION_END"),!s.current)){const y=e.style.animationFillMode;e.style.animationFillMode="forwards",l=c.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=y)})}},p=m=>{m.target===e&&(a.current=Ny(r.current))};return e.addEventListener("animationstart",p),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{c.clearTimeout(l),e.removeEventListener("animationstart",p),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else u("ANIMATION_END")},[e,u]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:_e.useCallback(l=>{r.current=l?getComputedStyle(l):null,t(l)},[])}}function Ny(n){return(n==null?void 0:n.animationName)||"none"}function Sj(n){var r,s;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(s=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var f0="Tabs",[Cj,iIe]=ON(f0,[rF]),lF=rF(),[Nj,FN]=Cj(f0),cF=_e.forwardRef((n,e)=>{const{__scopeTabs:t,value:r,onValueChange:s,defaultValue:a,orientation:o="horizontal",dir:i,activationMode:u="automatic",...l}=n,c=tF(i),[d,p]=eF({prop:r,onChange:s,defaultProp:a??"",caller:f0});return ne.jsx(Nj,{scope:t,baseId:J3(),value:d,onValueChange:p,orientation:o,dir:c,activationMode:u,children:ne.jsx(lc.div,{dir:c,"data-orientation":o,...l,ref:e})})});cF.displayName=f0;var hF="TabsList",dF=_e.forwardRef((n,e)=>{const{__scopeTabs:t,loop:r=!0,...s}=n,a=FN(hF,t),o=lF(t);return ne.jsx(yj,{asChild:!0,...o,orientation:a.orientation,dir:a.dir,loop:r,children:ne.jsx(lc.div,{role:"tablist","aria-orientation":a.orientation,...s,ref:e})})});dF.displayName=hF;var fF="TabsTrigger",pF=_e.forwardRef((n,e)=>{const{__scopeTabs:t,value:r,disabled:s=!1,...a}=n,o=FN(fF,t),i=lF(t),u=vF(o.baseId,r),l=yF(o.baseId,r),c=r===o.value;return ne.jsx(bj,{asChild:!0,...i,focusable:!s,active:c,children:ne.jsx(lc.button,{type:"button",role:"tab","aria-selected":c,"aria-controls":l,"data-state":c?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:u,...a,ref:e,onMouseDown:vi(n.onMouseDown,d=>{!s&&d.button===0&&d.ctrlKey===!1?o.onValueChange(r):d.preventDefault()}),onKeyDown:vi(n.onKeyDown,d=>{[" ","Enter"].includes(d.key)&&o.onValueChange(r)}),onFocus:vi(n.onFocus,()=>{const d=o.activationMode!=="manual";!c&&!s&&d&&o.onValueChange(r)})})})});pF.displayName=fF;var mF="TabsContent",gF=_e.forwardRef((n,e)=>{const{__scopeTabs:t,value:r,forceMount:s,children:a,...o}=n,i=FN(mF,t),u=vF(i.baseId,r),l=yF(i.baseId,r),c=r===i.value,d=_e.useRef(c);return _e.useEffect(()=>{const p=requestAnimationFrame(()=>d.current=!1);return()=>cancelAnimationFrame(p)},[]),ne.jsx(uF,{present:s||c,children:({present:p})=>ne.jsx(lc.div,{"data-state":c?"active":"inactive","data-orientation":i.orientation,role:"tabpanel","aria-labelledby":u,hidden:!p,id:l,tabIndex:0,...o,ref:e,style:{...n.style,animationDuration:d.current?"0s":void 0},children:p&&a})})});gF.displayName=mF;function vF(n,e){return`${n}-trigger-${e}`}function yF(n,e){return`${n}-content-${e}`}var kj=cF,Tj=dF,Ij=pF,Ej=gF;function _j({className:n,...e}){return ne.jsx(kj,{"data-slot":"tabs",className:ws("flex flex-col gap-2",n),...e})}function Rj({className:n,...e}){return ne.jsx(Tj,{"data-slot":"tabs-list",className:ws("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",n),...e})}function MD({className:n,...e}){return ne.jsx(Ij,{"data-slot":"tabs-trigger",className:ws("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",n),...e})}function LD({className:n,...e}){return ne.jsx(Ej,{"data-slot":"tabs-content",className:ws("flex-1 outline-none",n),...e})}/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aj=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Dj=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),PD=n=>{const e=Dj(n);return e.charAt(0).toUpperCase()+e.slice(1)},bF=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),$j=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Oj={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fj=_e.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:s="",children:a,iconNode:o,...i},u)=>_e.createElement("svg",{ref:u,...Oj,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:bF("lucide",s),...!a&&!$j(i)&&{"aria-hidden":"true"},...i},[...o.map(([l,c])=>_e.createElement(l,c)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const to=(n,e)=>{const t=_e.forwardRef(({className:r,...s},a)=>_e.createElement(Fj,{ref:a,iconNode:e,className:bF(`lucide-${Aj(PD(n))}`,`lucide-${n}`,r),...s}));return t.displayName=PD(n),t};/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mj=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]],Lj=to("brain",Mj);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pj=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16",key:"qmtpty"}],["path",{d:"M9.5 4h5L17 7h3a2 2 0 0 1 2 2v7.5",key:"1ufyfc"}],["path",{d:"M14.121 15.121A3 3 0 1 1 9.88 10.88",key:"11zox6"}]],Bj=to("camera-off",Pj);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zj=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],dC=to("camera",zj);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],xF=to("circle-alert",Vj);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uj=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Wj=to("circle-check-big",Uj);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gj=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],BD=to("eye",Gj);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hj=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],zD=to("loader-circle",Hj);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jj=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],qj=to("trash-2",jj);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kj=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],Xj=to("upload",Kj);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yj=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],VD=to("user-plus",Yj);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zj=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],UD=to("users",Zj);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qj=1e-7,Jj=1e-4;class MN{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class p0{refCount(e){return Es("refCount")}incRef(e){return Es("incRef")}timerAvailable(){return!0}time(e){return Es("time")}read(e){return Es("read")}readSync(e){return Es("readSync")}readToGPU(e,t){return Es("readToGPU")}numDataIds(){return Es("numDataIds")}disposeData(e,t){return Es("disposeData")}write(e,t,r){return Es("write")}move(e,t,r,s,a){return Es("move")}createTensorFromGPUData(e,t,r){return Es("createTensorFromGPUData")}memory(){return Es("memory")}floatPrecision(){return Es("floatPrecision")}epsilon(){return this.floatPrecision()===32?Qj:Jj}dispose(){return Es("dispose")}}function Es(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LN(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,pi(n,e,t)}function e5(n,e){if(n.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${n.length}Second array length was ${e.length}`);let t=n.length,r=0;for(;t>0;)r=Math.random()*t|0,t--,pi(n,t,r),pi(e,t,r)}function Iu(n,e,t){return Math.max(n,Math.min(e,t))}function m0(n){return n%2===0?n:n+1}function pi(n,e,t){const r=n[e];n[e]=n[t],n[t]=r}function wF(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function t5(n,e){const t=Math.random();return e*t+(1-t)*n}function n5(n,e){let t=0;for(let r=0;r<n.length;r++){const s=Number(n[r])-Number(e[r]);t+=s*s}return t}function B(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Dr(n,e,t=""){B(Et(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function cc(n){B(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function xe(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function r5(n){return n.length===0}function SF(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==null&&e[t]!==null&&n[t]!==e[t])return!1;return!0}function Et(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function jl(n){return n%1===0}function s5(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;{const e=Math.exp(2*n);return(e-1)/(e+1)}}function pb(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function a5(n){const e=new Uint32Array(n);for(let t=0;t<n;++t)e[t]=t;return LN(e),e}function zl(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function fC(n,e=s=>0,t,r){return new Promise((s,a)=>{let o=0;const i=()=>{if(n()){s();return}o++;const u=e(o);if(t!=null&&o>=t){a();return}r!=null?r(i,u):setTimeout(i,u)};i()})}function PN(n,e){let t=1,r=-1;for(let a=0;a<n.length;++a)if(n[a]>=0)t*=n[a];else if(n[a]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${a}`);r=a}else if(n[a]<0)throw Error(`Shapes can not be < 0. Found ${n[a]} at dim ${a}`);if(r===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const s=n.slice();return s[r]=e/t,s}function Nt(n,e){const t=e.length;return n=n==null?e.map((r,s)=>s):[].concat(n),B(n.every(r=>r>=-t&&r<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),B(n.every(r=>jl(r)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(r=>r<0?t+r:r)}function Ni(n,e){const t=[],r=[],s=e!=null&&Array.isArray(e)&&e.length===0,a=e==null||s?null:Nt(e,n).sort();let o=0;for(let i=0;i<n.length;++i){if(a!=null){if(a[o]===i&&n[i]!==1)throw new Error(`Can't squeeze axis ${i} since its dim '${n[i]}' is not 1`);(a[o]==null||a[o]>i)&&n[i]===1&&(t.push(n[i]),r.push(i)),a[o]<=i&&o++}n[i]!==1&&(t.push(n[i]),r.push(i))}return{newShape:t,keptDims:r}}function fr(n,e){return En(n,e)}function En(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function CF(n,e){for(let t=0;t<n.length;t++){const r=n[t];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function NF(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function BN(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Vp(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function kF(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function So(n){return typeof n=="string"||n instanceof String}function TF(n){return typeof n=="boolean"}function mb(n){return typeof n=="number"}function hc(n){return Array.isArray(n)?hc(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":mb(n)?"float32":So(n)?"string":TF(n)?"bool":"float32"}function Eu(n){return!!(n&&n.constructor&&n.call&&n.apply)}function gb(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function rt(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function IF(n,e,t,r=!1){const s=new Array;if(e.length===1){const a=e[0]*(r?2:1);for(let o=0;o<a;o++)s[o]=t[n+o]}else{const a=e[0],o=e.slice(1),i=o.reduce((u,l)=>u*l)*(r?2:1);for(let u=0;u<a;u++)s[u]=IF(n+u*i,o,t,r)}return s}function oa(n,e,t=!1){if(n.length===0)return e[0];const r=n.reduce((s,a)=>s*a)*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return IF(0,n,e,t)}function EF(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function g0(n,e){const t=Rr(n,e);for(let r=0;r<t.length;r++)t[r]=1;return t}function Rr(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function zN(n,e){const t=n.reduce((r,s)=>r*s,1);if(e==null||e==="float32")return oa(n,new Float32Array(t));if(e==="int32")return oa(n,new Int32Array(t));if(e==="bool")return oa(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function Vs(n){n.forEach(e=>{B(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function qa(n,e,t){if(e===0)return 0;if(e===1)return n[0];let r=n[n.length-1];for(let s=0;s<n.length-1;++s)r+=t[s]*n[s];return r}function dc(n,e,t){if(e===0)return[];if(e===1)return[n];const r=new Array(e);for(let s=0;s<r.length-1;++s)r[s]=Math.floor(n/t[s]),n-=r[s]*t[s];return r[r.length-1]=n,r}function _u(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WD="tfjsflags";class _F{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=o5,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(de().getBool("IS_TEST")||de().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){const s=this.urlFlags[e];de().getBool("IS_TEST")||de().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${s}.`),this.set(e,s)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(_u(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);WD in e&&e[WD].split(",").forEach(r=>{const[s,a]=r.split(":");this.urlFlags[s]=u5(s,a)})}}function o5(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...r)=>(i5(e,r[0],r[1]),r.join("="))),e}function i5(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function u5(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function de(){return VN}let VN=null;function l5(n){VN=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let dS;function RF(){if(dS==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");dS=n}return dS}function c5(){const n=RF();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function UN(n,e){const t=c5();if(t.has(n))return t.get(n);{const r=e();return t.set(n,r),t.get(n)}}const mm="Abs",od="Acos",id="Acosh",fc="Add",gm="AddN",v0="All",y0="Any",vm="ArgMax",ym="ArgMin",ud="Asin",ld="Asinh",cd="Atan",hd="Atanh",dd="Atan2",bm="AvgPool",b0="AvgPoolGrad",xm="AvgPool3D",x0="AvgPool3DGrad",wm="BatchMatMul",Sm="BatchToSpaceND",w0="Bincount",Cm="BitwiseAnd",AF="BroadcastTo",S0="BroadcastArgs",fd="Cast",pd="Ceil",md="ClipByValue",C0="Complex",Nm="ComplexAbs",km="Concat",Tm="Conv2D",N0="Conv2DBackpropFilter",Im="Conv2DBackpropInput",Em="Conv3D",k0="Conv3DBackpropFilterV2",T0="Conv3DBackpropInputV2",gd="Cos",vd="Cosh",I0="Cumprod",_m="Cumsum",E0="CropAndResize",_0="DenseBincount",R0="DepthToSpace",Rm="DepthwiseConv2dNative",A0="DepthwiseConv2dNativeBackpropFilter",D0="DepthwiseConv2dNativeBackpropInput",$0="Diag",Am="Dilation2D",vb="Dilation2DBackpropInput",yb="Dilation2DBackpropFilter",O0="Draw",yd="RealDiv",F0="Einsum",bd="Elu",M0="EluGrad",xd="Erf",Dm="Equal",wd="Exp",$m="ExpandDims",Sd="Expm1",L0="FFT",P0="Fill",B0="FlipLeftRight",Cd="Floor",Nd="FloorDiv",Om="FusedBatchNorm",Fm="GatherV2",z0="GatherNd",Mm="Greater",kd="GreaterEqual",Td="Identity",V0="IFFT",U0="Imag",Id="IsFinite",Ed="IsInf",_d="IsNan",Lm="LeakyRelu",Pm="Less",Bm="LessEqual",W0="LinSpace",Rd="Log",Ad="Log1p",zm="LogicalAnd",Vm="LogicalNot",Um="LogicalOr",h5="LogicalXor",DF="LogSoftmax",d5="LowerBound",Wm="LRN",G0="LRNGrad",f5="MatrixBandPart",Gm="Max",Dd="Maximum",Hm="MaxPool",H0="MaxPoolGrad",jm="MaxPool3D",j0="MaxPool3DGrad",q0="MaxPoolWithArgmax",qm="Mean",Km="Min",$d="Minimum",Xm="MirrorPad",Od="Mod",K0="Multinomial",Fd="Multiply",Ym="Neg",Zm="NotEqual",X0="NonMaxSuppressionV3",Y0="NonMaxSuppressionV4",Z0="NonMaxSuppressionV5",Qm="OnesLike",Jm="OneHot",eg="Pack",tg="PadV2",p5="Pool",Md="Pow",ng="Prelu",rg="Prod",Q0="RaggedGather",J0="RaggedRange",ex="RaggedTensorToTensor",tx="Range",nx="Real",Ld="Reciprocal",Pd="Relu",sg="Reshape",ag="ResizeNearestNeighbor",rx="ResizeNearestNeighborGrad",og="ResizeBilinear",sx="ResizeBilinearGrad",Bd="Relu6",ig="Reverse",zd="Round",Vd="Rsqrt",ax="ScatterNd",ox="TensorScatterUpdate",ix="SearchSorted",ug="Select",Ud="Selu",lg="Slice",Wd="Sin",Gd="Sinh",Hd="Sign",jd="Sigmoid",qd="Softplus",Kd="Sqrt",cg="Sum",hg="SpaceToBatchND",dg="SplitV",fg="Softmax",ux="SparseFillEmptyRows",lx="SparseReshape",cx="SparseSegmentMean",hx="SparseSegmentSum",dx="SparseToDense",Xd="SquaredDifference",fx="Square",pg="StaticRegexReplace",px="StridedSlice",mx="StringNGrams",gx="StringSplit",vx="StringToHashBucketFast",Yd="Sub",Zd="Tan",Qd="Tanh",Jd="Tile",yx="TopK",bx="Transform",Vl="Transpose",xx="Unique",mg="Unpack",gg="UnsortedSegmentSum",m5="UpperBound",vg="ZerosLike",ef="Step",bb="FromPixels",wx="RotateWithOffset",Up="_FusedMatMul",Wp="FusedConv2D",Gp="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Js(...n){de().getBool("IS_TEST")||de().getBool("PROD")||console.warn(...n)}function g5(...n){de().getBool("IS_TEST")||de().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zh=UN("kernelRegistry",()=>new Map),Hp=UN("gradRegistry",()=>new Map);function jp(n,e){const t=WN(n,e);return zh.get(t)}function pC(n){return Hp.get(n)}function xb(n){const e=zh.entries(),t=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[a,o]=s,[i]=a.split("_");i===n&&t.push(o)}return t}function Sx(n){const{kernelName:e,backendName:t}=n,r=WN(e,t);zh.has(r)&&Js(`The kernel '${e}' for backend '${t}' is already registered`),zh.set(r,n)}function $F(n){const{kernelName:e}=n;Hp.has(e)&&de().getBool("DEBUG")&&Js(`Overriding the gradient for '${e}'`),Hp.set(e,n)}function v5(n,e){const t=WN(n,e);if(!zh.has(t))throw new Error(`The kernel '${n}' for backend '${e}' is not registered`);zh.delete(t)}function y5(n){if(!Hp.has(n))throw new Error(`The gradient '${n}' for backend is not registered`);Hp.delete(n)}function b5(n,e){xb(n).forEach(r=>{const s=Object.assign({},r,{backendName:e});Sx(s)})}function WN(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OF(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var fS,GD;function x5(){if(GD)return fS;GD=1,fS=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(D,A,M){this.low=D|0,this.high=A|0,this.unsigned=!!M}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(D){return(D&&D.__isLong__)===!0}e.isLong=t;var r={},s={};function a(D,A){var M,H,j;return A?(D>>>=0,(j=0<=D&&D<256)&&(H=s[D],H)?H:(M=i(D,(D|0)<0?-1:0,!0),j&&(s[D]=M),M)):(D|=0,(j=-128<=D&&D<128)&&(H=r[D],H)?H:(M=i(D,D<0?-1:0,!1),j&&(r[D]=M),M))}e.fromInt=a;function o(D,A){if(isNaN(D))return A?S:w;if(A){if(D<0)return S;if(D>=v)return $}else{if(D<=-9223372036854776e3)return _;if(D+1>=b)return E}return D<0?o(-D,A).neg():i(D%m|0,D/m|0,A)}e.fromNumber=o;function i(D,A,M){return new e(D,A,M)}e.fromBits=i;var u=Math.pow;function l(D,A,M){if(D.length===0)throw Error("empty string");if(D==="NaN"||D==="Infinity"||D==="+Infinity"||D==="-Infinity")return w;if(typeof A=="number"?(M=A,A=!1):A=!!A,M=M||10,M<2||36<M)throw RangeError("radix");var H;if((H=D.indexOf("-"))>0)throw Error("interior hyphen");if(H===0)return l(D.substring(1),A,M).neg();for(var j=o(u(M,8)),G=w,P=0;P<D.length;P+=8){var V=Math.min(8,D.length-P),z=parseInt(D.substring(P,P+V),M);if(V<8){var Y=o(u(M,V));G=G.mul(Y).add(o(z))}else G=G.mul(j),G=G.add(o(z))}return G.unsigned=A,G}e.fromString=l;function c(D,A){return typeof D=="number"?o(D,A):typeof D=="string"?l(D,A):i(D.low,D.high,typeof A=="boolean"?A:D.unsigned)}e.fromValue=c;var d=65536,p=1<<24,m=d*d,v=m*m,b=v/2,y=a(p),w=a(0);e.ZERO=w;var S=a(0,!0);e.UZERO=S;var N=a(1);e.ONE=N;var C=a(1,!0);e.UONE=C;var T=a(-1);e.NEG_ONE=T;var E=i(-1,2147483647,!1);e.MAX_VALUE=E;var $=i(-1,-1,!0);e.MAX_UNSIGNED_VALUE=$;var _=i(0,-2147483648,!1);e.MIN_VALUE=_;var R=e.prototype;return R.toInt=function(){return this.unsigned?this.low>>>0:this.low},R.toNumber=function(){return this.unsigned?(this.high>>>0)*m+(this.low>>>0):this.high*m+(this.low>>>0)},R.toString=function(A){if(A=A||10,A<2||36<A)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(_)){var M=o(A),H=this.div(M),j=H.mul(M).sub(this);return H.toString(A)+j.toInt().toString(A)}else return"-"+this.neg().toString(A);for(var G=o(u(A,6),this.unsigned),P=this,V="";;){var z=P.div(G),Y=P.sub(z.mul(G)).toInt()>>>0,L=Y.toString(A);if(P=z,P.isZero())return L+V;for(;L.length<6;)L="0"+L;V=""+L+V}},R.getHighBits=function(){return this.high},R.getHighBitsUnsigned=function(){return this.high>>>0},R.getLowBits=function(){return this.low},R.getLowBitsUnsigned=function(){return this.low>>>0},R.getNumBitsAbs=function(){if(this.isNegative())return this.eq(_)?64:this.neg().getNumBitsAbs();for(var A=this.high!=0?this.high:this.low,M=31;M>0&&(A&1<<M)==0;M--);return this.high!=0?M+33:M+1},R.isZero=function(){return this.high===0&&this.low===0},R.eqz=R.isZero,R.isNegative=function(){return!this.unsigned&&this.high<0},R.isPositive=function(){return this.unsigned||this.high>=0},R.isOdd=function(){return(this.low&1)===1},R.isEven=function(){return(this.low&1)===0},R.equals=function(A){return t(A)||(A=c(A)),this.unsigned!==A.unsigned&&this.high>>>31===1&&A.high>>>31===1?!1:this.high===A.high&&this.low===A.low},R.eq=R.equals,R.notEquals=function(A){return!this.eq(A)},R.neq=R.notEquals,R.ne=R.notEquals,R.lessThan=function(A){return this.comp(A)<0},R.lt=R.lessThan,R.lessThanOrEqual=function(A){return this.comp(A)<=0},R.lte=R.lessThanOrEqual,R.le=R.lessThanOrEqual,R.greaterThan=function(A){return this.comp(A)>0},R.gt=R.greaterThan,R.greaterThanOrEqual=function(A){return this.comp(A)>=0},R.gte=R.greaterThanOrEqual,R.ge=R.greaterThanOrEqual,R.compare=function(A){if(t(A)||(A=c(A)),this.eq(A))return 0;var M=this.isNegative(),H=A.isNegative();return M&&!H?-1:!M&&H?1:this.unsigned?A.high>>>0>this.high>>>0||A.high===this.high&&A.low>>>0>this.low>>>0?-1:1:this.sub(A).isNegative()?-1:1},R.comp=R.compare,R.negate=function(){return!this.unsigned&&this.eq(_)?_:this.not().add(N)},R.neg=R.negate,R.add=function(A){t(A)||(A=c(A));var M=this.high>>>16,H=this.high&65535,j=this.low>>>16,G=this.low&65535,P=A.high>>>16,V=A.high&65535,z=A.low>>>16,Y=A.low&65535,L=0,K=0,J=0,Z=0;return Z+=G+Y,J+=Z>>>16,Z&=65535,J+=j+z,K+=J>>>16,J&=65535,K+=H+V,L+=K>>>16,K&=65535,L+=M+P,L&=65535,i(J<<16|Z,L<<16|K,this.unsigned)},R.subtract=function(A){return t(A)||(A=c(A)),this.add(A.neg())},R.sub=R.subtract,R.multiply=function(A){if(this.isZero())return w;if(t(A)||(A=c(A)),n){var M=n.mul(this.low,this.high,A.low,A.high);return i(M,n.get_high(),this.unsigned)}if(A.isZero())return w;if(this.eq(_))return A.isOdd()?_:w;if(A.eq(_))return this.isOdd()?_:w;if(this.isNegative())return A.isNegative()?this.neg().mul(A.neg()):this.neg().mul(A).neg();if(A.isNegative())return this.mul(A.neg()).neg();if(this.lt(y)&&A.lt(y))return o(this.toNumber()*A.toNumber(),this.unsigned);var H=this.high>>>16,j=this.high&65535,G=this.low>>>16,P=this.low&65535,V=A.high>>>16,z=A.high&65535,Y=A.low>>>16,L=A.low&65535,K=0,J=0,Z=0,le=0;return le+=P*L,Z+=le>>>16,le&=65535,Z+=G*L,J+=Z>>>16,Z&=65535,Z+=P*Y,J+=Z>>>16,Z&=65535,J+=j*L,K+=J>>>16,J&=65535,J+=G*Y,K+=J>>>16,J&=65535,J+=P*z,K+=J>>>16,J&=65535,K+=H*L+j*Y+G*z+P*V,K&=65535,i(Z<<16|le,K<<16|J,this.unsigned)},R.mul=R.multiply,R.divide=function(A){if(t(A)||(A=c(A)),A.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&A.low===-1&&A.high===-1)return this;var M=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,A.low,A.high);return i(M,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?S:w;var H,j,G;if(this.unsigned){if(A.unsigned||(A=A.toUnsigned()),A.gt(this))return S;if(A.gt(this.shru(1)))return C;G=S}else{if(this.eq(_)){if(A.eq(N)||A.eq(T))return _;if(A.eq(_))return N;var P=this.shr(1);return H=P.div(A).shl(1),H.eq(w)?A.isNegative()?N:T:(j=this.sub(A.mul(H)),G=H.add(j.div(A)),G)}else if(A.eq(_))return this.unsigned?S:w;if(this.isNegative())return A.isNegative()?this.neg().div(A.neg()):this.neg().div(A).neg();if(A.isNegative())return this.div(A.neg()).neg();G=w}for(j=this;j.gte(A);){H=Math.max(1,Math.floor(j.toNumber()/A.toNumber()));for(var V=Math.ceil(Math.log(H)/Math.LN2),z=V<=48?1:u(2,V-48),Y=o(H),L=Y.mul(A);L.isNegative()||L.gt(j);)H-=z,Y=o(H,this.unsigned),L=Y.mul(A);Y.isZero()&&(Y=N),G=G.add(Y),j=j.sub(L)}return G},R.div=R.divide,R.modulo=function(A){if(t(A)||(A=c(A)),n){var M=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,A.low,A.high);return i(M,n.get_high(),this.unsigned)}return this.sub(this.div(A).mul(A))},R.mod=R.modulo,R.rem=R.modulo,R.not=function(){return i(~this.low,~this.high,this.unsigned)},R.and=function(A){return t(A)||(A=c(A)),i(this.low&A.low,this.high&A.high,this.unsigned)},R.or=function(A){return t(A)||(A=c(A)),i(this.low|A.low,this.high|A.high,this.unsigned)},R.xor=function(A){return t(A)||(A=c(A)),i(this.low^A.low,this.high^A.high,this.unsigned)},R.shiftLeft=function(A){return t(A)&&(A=A.toInt()),(A&=63)===0?this:A<32?i(this.low<<A,this.high<<A|this.low>>>32-A,this.unsigned):i(0,this.low<<A-32,this.unsigned)},R.shl=R.shiftLeft,R.shiftRight=function(A){return t(A)&&(A=A.toInt()),(A&=63)===0?this:A<32?i(this.low>>>A|this.high<<32-A,this.high>>A,this.unsigned):i(this.high>>A-32,this.high>=0?0:-1,this.unsigned)},R.shr=R.shiftRight,R.shiftRightUnsigned=function(A){if(t(A)&&(A=A.toInt()),A&=63,A===0)return this;var M=this.high;if(A<32){var H=this.low;return i(H>>>A|M<<32-A,M>>>A,this.unsigned)}else return A===32?i(M,0,this.unsigned):i(M>>>A-32,0,this.unsigned)},R.shru=R.shiftRightUnsigned,R.shr_u=R.shiftRightUnsigned,R.toSigned=function(){return this.unsigned?i(this.low,this.high,!1):this},R.toUnsigned=function(){return this.unsigned?this:i(this.low,this.high,!0)},R.toBytes=function(A){return A?this.toBytesLE():this.toBytesBE()},R.toBytesLE=function(){var A=this.high,M=this.low;return[M&255,M>>>8&255,M>>>16&255,M>>>24,A&255,A>>>8&255,A>>>16&255,A>>>24]},R.toBytesBE=function(){var A=this.high,M=this.low;return[A>>>24,A>>>16&255,A>>>8&255,A&255,M>>>24,M>>>16&255,M>>>8&255,M&255]},e.fromBytes=function(A,M,H){return H?e.fromBytesLE(A,M):e.fromBytesBE(A,M)},e.fromBytesLE=function(A,M){return new e(A[0]|A[1]<<8|A[2]<<16|A[3]<<24,A[4]|A[5]<<8|A[6]<<16|A[7]<<24,M)},e.fromBytesBE=function(A,M){return new e(A[4]<<24|A[5]<<16|A[6]<<8|A[7],A[0]<<24|A[1]<<16|A[2]<<8|A[3],M)},fS}var FF=x5();const MF=F3(FF),w5=O3({__proto__:null,default:MF},[FF]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _l=MF||w5;function yg(n){return _l.fromString(n,!0,16)}const LF=yg("c3a5c85c97cb3127"),kl=yg("b492b66fbe98f273"),Jr=yg("9ae16a3b2f90404f");function mC(n){return n.xor(n.shru(47))}function PF(n,e,t){const r=n.slice(e,e+t);return _l.fromBytes(Array.from(r),!0,!0)}function un(n,e){return PF(n,e,8)}function HD(n,e){return PF(n,e,4)}function ur(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function wu(n,e,t=yg("9ddfea08eb382d69")){let r=n.xor(e).mul(t);r=r.xor(r.shru(47));let s=e.xor(r).mul(t);return s=s.xor(s.shru(47)),s=s.mul(t),s}function S5(n,e,t,r,s,a){s=s.add(n),a=ur(a.add(s).add(r),21);const o=s;return s=s.add(e),s=s.add(t),a=a.add(ur(s,44)),[s.add(r),a.add(o)]}function ky(n,e,t,r){return S5(un(n,e),un(n,e+8),un(n,e+16),un(n,e+24),t,r)}function C5(n,e=n.length){if(e>=8){const t=Jr.add(e*2),r=un(n,0).add(Jr),s=un(n,e-8),a=ur(s,37).mul(t).add(r),o=ur(r,25).add(s).mul(t);return wu(a,o,t)}if(e>=4){const t=Jr.add(e*2),r=HD(n,0);return wu(r.shl(3).add(e),HD(n,e-4),t)}if(e>0){const t=n[0],r=n[e>>1],s=n[e-1],a=t+(r<<8),o=e+(s<<2);return mC(Jr.mul(a).xor(LF.mul(o))).mul(Jr)}return Jr}function N5(n,e=n.length){const t=Jr.add(e*2),r=un(n,0).mul(kl),s=un(n,8),a=un(n,e-8).mul(t),o=un(n,e-16).mul(Jr);return wu(ur(r.add(s),43).add(ur(a,30)).add(o),r.add(ur(s.add(Jr),18)).add(a),t)}function k5(n,e=n.length){const t=Jr.add(e*2),r=un(n,0).mul(Jr),s=un(n,8),a=un(n,e-8).mul(t),o=un(n,e-16).mul(Jr),i=ur(r.add(s),43).add(ur(a,30)).add(o),u=wu(i,r.add(ur(s.add(Jr),18)).add(a),t),l=un(n,16).mul(t),c=un(n,24),d=i.add(un(n,e-32)).mul(t),p=u.add(un(n,e-24)).mul(t);return wu(ur(l.add(c),43).add(ur(d,30)).add(p),l.add(ur(c.add(r),18)).add(d),t)}function BF(n,e=n.length){const t=_l.fromNumber(81,!0);if(e<=32)return e<=16?C5(n,e):N5(n,e);if(e<=64)return k5(n,e);let r=t,s=t.mul(kl).add(113),a=mC(s.mul(Jr).add(113)).mul(Jr),o=[_l.UZERO,_l.UZERO],i=[_l.UZERO,_l.UZERO];r=r.mul(Jr).add(un(n,0));let u=0;const l=(e-1>>6)*64,c=l+(e-1&63)-63;do r=ur(r.add(s).add(o[0]).add(un(n,u+8)),37).mul(kl),s=ur(s.add(o[1]).add(un(n,u+48)),42).mul(kl),r=r.xor(i[1]),s=s.add(o[0]).add(un(n,u+40)),a=ur(a.add(i[0]),33).mul(kl),o=ky(n,u,o[1].mul(kl),r.add(i[0])),i=ky(n,u+32,a.add(i[1]),s.add(un(n,u+16))),[a,r]=[r,a],u+=64;while(u!==l);const d=kl.add(a.and(255).shl(1));return u=c,i[0]=i[0].add(e-1&63),o[0]=o[0].add(i[0]),i[0]=i[0].add(o[0]),r=ur(r.add(s).add(o[0]).add(un(n,u+8)),37).mul(d),s=ur(s.add(o[1]).add(un(n,u+48)),42).mul(d),r=r.xor(i[1].mul(9)),s=s.add(o[0].mul(9).add(un(n,u+40))),a=ur(a.add(i[0]),33).mul(d),o=ky(n,u,o[1].mul(d),r.add(i[0])),i=ky(n,u+32,a.add(i[1]),s.add(un(n,u+16))),[a,r]=[r,a],wu(wu(o[0],i[0],d).add(mC(s).mul(LF)).add(a),wu(o[1],i[1],d).add(r),d)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ki(n,e){return e==="string"?ko(n):Vu([n],e)}function T5(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function Vu(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=$o(n)),de().getBool("DEBUG")&&CF(n,e),T5(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Zr(){return de().platform.now()}function I5(n,e){return de().platform.fetch(n,e)}function ko(n,e="utf-8"){return e=e||"utf-8",de().platform.encode(n,e)}function bi(n,e="utf-8"){return e=e||"utf-8",de().platform.decode(n,e)}function lr(n){return de().platform.isTypedArray!=null?de().platform.isTypedArray(n):OF(n)}function $o(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||_u(n)||n==null||lr(n)&&t)e.push(n);else if(Array.isArray(n)||lr(n))for(let r=0;r<n.length;++r)$o(n[r],e,t);else{let r=-1;for(const s of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(s)&&(r=Math.max(r,Number(s)));for(let s=0;s<=r;s++)$o(n[s],e,t)}return e}const E5=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:Et,arraysEqualWithNull:SF,assert:B,assertNonNegativeIntegerDimensions:Vs,assertNonNull:cc,assertShapesMatch:Dr,bytesFromStringArray:kF,bytesPerElement:Vp,checkConversionForErrors:CF,clamp:Iu,computeStrides:rt,convertBackendValuesAndArrayBuffer:EF,createScalarValue:ki,createShuffledIndices:a5,decodeString:bi,distSquared:n5,encodeString:ko,fetch:I5,fingerPrint64:BF,flatten:$o,getArrayFromDType:En,getTypedArrayFromDType:fr,hasEncodingLoss:BN,hexToLong:yg,indexToLoc:dc,inferDtype:hc,inferFromImplicitShape:PN,isBoolean:TF,isFunction:Eu,isInt:jl,isNumber:mb,isPromise:_u,isScalarShape:r5,isString:So,isTypedArray:lr,isValidDtype:NF,locToIndex:qa,makeOnesTypedArray:g0,makeZerosNestedTypedArray:zN,makeZerosTypedArray:Rr,nearestDivisor:gb,nearestLargerEven:m0,now:Zr,parseAxisParam:Nt,randUniform:t5,repeatedTry:fC,rightPad:zl,shuffle:LN,shuffleCombo:e5,sizeFromShape:xe,sizeToSquarishShape:pb,squeezeShape:Ni,sum:wF,swap:pi,tanh:s5,toNestedArray:oa,toTypedArray:Vu},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _5{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new A5)}profileKernel(e,t,r){let s;const a=()=>{s=r()};let o;const i=Zr();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(a);else{a();for(const l of s)l.dataSync();o=Promise.resolve({kernelMs:Zr()-i})}if(de().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<s.length;l++){const c=s[l];c.data().then(d=>{R5(d,c.dtype,e)})}return{kernelName:e,outputs:s,inputs:t,timeMs:o.then(l=>l.kernelMs),extraInfo:o.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:r,timeMs:s,inputs:a,extraInfo:o}=e;r.forEach(i=>{Promise.all([i.data(),s,o]).then(u=>{this.logger.logKernelProfile(t,i,u[0],u[1],a,u[2])})})}}function R5(n,e,t){if(e!=="float32")return!1;for(let r=0;r<n.length;r++){const s=n[r];if(isNaN(s)||!isFinite(s))return console.warn(`Found ${s} in the result of '${t}'`),!0}return!1}class A5{logKernelProfile(e,t,r,s,a,o){const i=typeof s=="number"?zl(`${s}ms`,9):s.error,u=zl(e,25),l=t.rank,c=t.size,d=zl(t.shape.toString(),14);let p="";for(const m in a){const v=a[m];if(v!=null){const b=v.shape||t.shape,y=b.length;p+=`${m}: ${y}D ${y>0?b:""} `}}console.log(`%c${u}	%c${i}	%c${l}D ${d}	%c${c}	%c${p}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D5(n,e,t){const r={},s={};for(let u=0;u<e.length;u++)r[e[u].id]=!0;for(let u=0;u<n.length;u++){const l=n[u],c=l.inputs;for(const d in c){const p=c[d];let m=!1;for(let v=0;v<e.length;v++)if(r[p.id]){l.outputs.forEach(b=>r[b.id]=!0),m=!0,s[l.id]=!0;break}if(m)break}}const a={};a[t.id]=!0;const o={};for(let u=n.length-1;u>=0;u--){const l=n[u],c=l.inputs;for(let d=0;d<l.outputs.length;d++)if(a[l.outputs[d].id]){for(const p in c)a[c[p].id]=!0,o[l.id]=!0;break}}const i=[];for(let u=0;u<n.length;u++){const l=n[u];if(s[l.id]&&o[l.id]){const c={};for(const p in l.inputs){const m=l.inputs[p];r[m.id]&&(c[p]=m)}const d=Object.assign({},l);d.inputs=c,d.outputs=l.outputs,i.push(d)}}return i}function $5(n,e,t,r){for(let s=e.length-1;s>=0;s--){const a=e[s],o=[];if(a.outputs.forEach(u=>{const l=n[u.id];l!=null?o.push(l):o.push(null)}),a.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${a.kernelName}.`);const i=a.gradient(o);for(const u in a.inputs){if(!(u in i))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(i)}.`);const l=t(()=>i[u]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${l.dtype}'`);const c=a.inputs[u];if(!Et(l.shape,c.shape))throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input '${u}' has shape '${l.shape}', which does not match the shape of the input '${c.shape}'`);if(n[c.id]==null)n[c.id]=l;else{const d=n[c.id];n[c.id]=r(d,l),d.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jD=20,xp=3,pS=7;function O5(n,e,t,r){const s=rt(e),a=F5(n,e,t,s),o=e.length,i=eb(n,e,t,s,a),u=["Tensor"];return r&&(u.push(`  dtype: ${t}`),u.push(`  rank: ${o}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(i.map(l=>"    "+l).join(`
`)),u.join(`
`)}function F5(n,e,t,r){const s=xe(e),a=r[r.length-1],o=new Array(a).fill(0),i=e.length,u=t==="complex64"?_p(n):n;if(i>1)for(let l=0;l<s/a;l++){const c=l*a;for(let d=0;d<a;d++)o[d]=Math.max(o[d],Ep(u[c+d],0,t).length)}return o}function Ep(n,e,t){let r;return Array.isArray(n)?r=`${parseFloat(n[0].toFixed(pS))} + ${parseFloat(n[1].toFixed(pS))}j`:So(n)?r=`'${n}'`:t==="bool"?r=zF(n):r=parseFloat(n.toFixed(pS)).toString(),zl(r,e)}function zF(n){return n===0?"false":"true"}function eb(n,e,t,r,s,a=!0){const o=t==="complex64"?2:1,i=e[0],u=e.length;if(u===0){if(t==="complex64"){const b=_p(n);return[Ep(b[0],0,t)]}return t==="bool"?[zF(n[0])]:[n[0].toString()]}if(u===1){if(i>jD){const y=xp*o;let w=Array.from(n.slice(0,y)),S=Array.from(n.slice((i-xp)*o,i*o));return t==="complex64"&&(w=_p(w),S=_p(S)),["["+w.map((N,C)=>Ep(N,s[C],t)).join(", ")+", ..., "+S.map((N,C)=>Ep(N,s[i-xp+C],t)).join(", ")+"]"]}return["["+(t==="complex64"?_p(n):Array.from(n)).map((y,w)=>Ep(y,s[w],t)).join(", ")+"]"]}const l=e.slice(1),c=r.slice(1),d=r[0]*o,p=[];if(i>jD){for(let b=0;b<xp;b++){const y=b*d,w=y+d;p.push(...eb(n.slice(y,w),l,t,c,s,!1))}p.push("...");for(let b=i-xp;b<i;b++){const y=b*d,w=y+d;p.push(...eb(n.slice(y,w),l,t,c,s,b===i-1))}}else for(let b=0;b<i;b++){const y=b*d,w=y+d;p.push(...eb(n.slice(y,w),l,t,c,s,b===i-1))}const m=u===2?",":"";p[0]="["+(i>0?p[0]+m:"");for(let b=1;b<p.length-1;b++)p[b]=" "+p[b]+m;let v=`,
`;for(let b=2;b<u;b++)v+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(a?"":v),p}function _p(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gn{constructor(e,t,r){if(this.dtype=t,this.shape=e.slice(),this.size=xe(e),r!=null){const s=r.length;B(s===this.size,()=>`Length of values '${s}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||En(t,this.size),this.strides=rt(e)}set(e,...t){t.length===0&&(t=[0]),B(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const r=this.locToIndex(t);this.values[r]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const s of e){if(s<0||s>=this.shape[t]){const a=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(a)}t++}let r=e[e.length-1];for(let s=0;s<e.length-1;++s)r+=this.strides[s]*e[s];return this.values[r]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Ua().makeTensor(this.values,this.shape,this.dtype)}}let Ua=null,wh=null;function M5(n){Ua=n}function L5(n){wh=n}class Gt{constructor(e,t,r,s){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=xe(e),this.strides=rt(e),this.dataId=r,this.id=s,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return wh.buffer(this.shape,this.dtype,e)}bufferSync(){return wh.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return oa(this.shape,e,this.dtype==="complex64")}arraySync(){return oa(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Ua().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(r=>bi(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Ua().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Ua().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>bi(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Ua().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Ua().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return wh.print(this,e)}clone(){return this.throwIfDisposed(),wh.clone(this)}toString(e=!1){const t=this.dataSync();return O5(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),wh.cast(this,e)}variable(e=!0,t,r){return this.throwIfDisposed(),Ua().makeVariable(this,e,t,r)}}Object.defineProperty(Gt,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function Se(){return UN("Tensor",()=>Gt)}Se();class qp extends Gt{constructor(e,t,r,s){super(e.shape,e.dtype,e.dataId,s),this.trainable=t,this.name=r}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Et(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Ua().disposeTensor(this),this.dataId=e.dataId,Ua().incRef(this,null)}dispose(){Ua().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(qp,Symbol.hasInstance,{value:n=>n instanceof Gt&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var gC;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(gC||(gC={}));var vC;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(vC||(vC={}));var yC;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(yC||(yC={}));var bC;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(bC||(bC={}));var xC;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(xC||(xC={}));const P5={float32:bC,int32:vC,bool:yC,complex64:xC};function ms(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return P5[n][e]}function Cx(n){return ms(n,"int32")}function VF(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function UF(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sn(n,e){if(n.dtype===e.dtype)return[n,e];const t=ms(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function WF(n,e){B(n.dtype===e.dtype,()=>`The dtypes of the first(${n.dtype}) and second(${e.dtype}) input must match`)}function B5(n,e){return e.some(t=>t.id===n.id)}function GN(n){const e=[];return GF(n,e,new Set),e}function GF(n,e,t){if(n==null)return;if(n instanceof Gt){e.push(n);return}if(!z5(n))return;const r=n;for(const s in r){const a=r[s];t.has(a)||(t.add(a),GF(a,e,t))}}function z5(n){return Array.isArray(n)||typeof n=="object"}const V5=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:WF,getTensorsInContainer:GN,isTensorInList:B5,makeTypesMatch:Sn},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mS(n){return n.kernelName!=null}class qD{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Vh{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new qD}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,r=1){return e in this.registryFactory?(Js(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:r},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:r}=this.initializeBackend(e);if(!(r?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new _5(this.backendInstance),!0}setupRegisteredKernels(){xb(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){xb(e).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const r=t.factory();if(r&&!(r instanceof p0)&&typeof r.then=="function"){const s=++this.pendingBackendInitId,a=r.then(o=>s<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(s<this.pendingBackendInitId||(this.pendingBackendInit=null,Js(`Initialization of backend ${e} failed`),Js(o.stack||o.message)),!1));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}else return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(r){return Js(`Initialization of backend ${e} failed`),Js(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t],{success:s,asyncInit:a}=this.initializeBackend(r);if(a||s)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const r=this.state.tensorInfo.get(t),s=r.backend,a=this.readSync(t),o=s.refCount(t);s.disposeData(t,!0),r.backend=e,e.move(t,a,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let r=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}let s;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(s),()=>(s=t(),s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),s))}scopedRun(e,t,r){e();try{const s=r();return t(),s}catch(s){throw t(),s}}nextTensorId(){return Vh.nextTensorId++}nextVariableId(){return Vh.nextVariableId++}clone(e){const t=Q.runKernel(Td,{x:e}),r={x:e},s=o=>({x:()=>{const i="float32",u={x:o},l={dtype:i};return Q.runKernel(fd,u,l)}}),a=[];return this.addTapeNode(this.state.activeScope.name,r,[t],s,a,{}),t}runKernel(e,t,r){if(this.backendName==null&&this.backend,!(jp(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,r){const s=this.backend.numDataIds();let a=0;r.forEach(u=>{a+=u.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=s-t-a-o;if(i>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${i} data ids) after running '${e}'`)}runKernelFunc(e){let t,r=[];const s=this.isTapeOn(),a=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let i;this.backendName==null&&this.backend;let u;const l=mS(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(mS(e)){const{kernelName:v,inputs:b,attrs:y}=e;this.backendName==null&&this.backend;const w=jp(v,this.backendName);B(w!=null,()=>`Cannot find registered kernel '${v}' for backend '${this.backendName}'`),i=()=>{const S=this.backend.numDataIds();u=w.kernelFunc({inputs:b,attrs:y,backend:this.backend});const N=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(v,S,N);const C=N.map(T=>T.rank!=null?T:this.makeTensorFromTensorInfo(T));if(s){const T=this.getTensorsForGradient(v,b,C);r=this.saveTensorsForBackwardMode(T)}return C}}else{const{forwardFunc:v}=e,b=y=>{s&&(r=y.map(w=>this.keep(this.clone(w))))};i=()=>{const y=this.backend.numDataIds();u=this.tidy(()=>v(this.backend,b));const w=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,y,w),w}}const{inputs:c,attrs:d}=e,p=mS(e)?null:e.backwardsFunc;let m;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=i():(m=this.profiler.profileKernel(l,c,()=>i()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),t=m.outputs)}),s&&this.addTapeNode(l,c,t,p,r,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-a,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(v=>c[v]!=null?c[v].shape:null),outputShapes:t.map(v=>v.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(u)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(e,t,r){const s=pC(e);if(s!=null){const a=s.inputsToSave||[],o=s.outputsToSave||[];let i;s.saveAllInputs?(B(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),i=Object.keys(t).map(l=>t[l])):i=a.map(l=>t[l]);const u=r.filter((l,c)=>o[c]);return i.concat(u)}return[]}makeTensor(e,t,r,s){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",s=s||this.backend;let a=e;r==="string"&&So(e[0])&&(a=e.map(u=>ko(u)));const o=s.write(a,t,r),i=new Gt(t,r,o,this.nextTensorId());if(this.trackTensor(i,s),r==="string"){const u=this.state.tensorInfo.get(o),l=kF(a);this.state.numBytes+=l-u.bytes,u.bytes=l}return i}makeTensorFromDataId(e,t,r,s){r=r||"float32";const a={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(a,s)}makeTensorFromTensorInfo(e,t){const{dataId:r,shape:s,dtype:a}=e,o=new Gt(s,a,r,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,r,s){r=r||this.nextVariableId().toString(),s!=null&&s!==e.dtype&&(e=e.cast(s));const a=new qp(e,t,r,this.nextTensorId());if(this.state.registeredVariables[a.name]!=null)throw new Error(`Variable with name ${a.name} was already registered`);return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*Vp(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof qp||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const r=e.size*Vp(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(s=>s.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const s of this.state.activeProfile.kernels)s.kernelTimeMs=await s.kernelTimeMs,s.extraInfo=await s.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,r,s,a,o){const i={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:a},u=pC(e);u!=null&&(s=u.gradFunc),s!=null&&(i.gradient=l=>(l=l.map((c,d)=>{if(c==null){const p=r[d],m=Rr(p.size,p.dtype);return this.makeTensor(m,p.shape,p.dtype)}return c}),s(l.length>1?l:l[0],a,o))),this.state.activeTape.push(i)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=GN(e),r=new Set(t.map(a=>a.id));for(let a=0;a<this.state.activeScope.track.length;a++){const o=this.state.activeScope.track[a];!o.kept&&!r.has(o.id)&&o.dispose()}const s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(a=>{!a.kept&&a.scopeId===s.id&&this.track(a)})}gradients(e,t,r,s=!1){if(B(t.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const a=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));B(a instanceof Gt,()=>"The result y returned by f() must be a tensor.");const o=D5(this.state.activeTape,t,a);if(!s&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const i={};i[a.id]=r??U5(a.shape),$5(i,o,l=>this.tidy(l),W5);const u=t.map(l=>i[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(const c of l.saved)c.dispose()}),this.state.activeTape=null),{value:a,grads:u}})}customGrad(e){return B(Eu(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{B(t.every(i=>i instanceof Gt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const s={};t.forEach((i,u)=>{s[u]=i});const a=(i,u)=>(r=e(...t,u),B(r.value instanceof Gt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),B(Eu(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),o=(i,u)=>{const l=r.gradFunc(i,u),c=Array.isArray(l)?l:[l];B(c.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),B(c.every(p=>p instanceof Gt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return c.forEach((p,m)=>{d[m]=()=>p}),d};return this.runKernelFunc({forwardFunc:a,backwardsFunc:o,inputs:s})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Zr(),r=await this.backend.time(e);return r.wallMs=Zr()-t,r}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new qD;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Vh.nextTensorId=0;Vh.nextVariableId=0;function U5(n){const e=g0(xe(n),"float32");return Q.makeTensor(e,n,"float32")}function HF(){const n=RF();if(n._tfengine==null){const e=new _F(n);n._tfengine=new Vh(e)}return l5(n._tfengine.ENV),M5(()=>n._tfengine),n._tfengine}const Q=HF();function W5(n,e){const t={a:n,b:e};return Q.runKernel(fc,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G5(){return typeof navigator<"u"&&navigator!=null}let wC;function H5(n){wC=n}function HN(n){if(wC!==void 0)return wC;if(n||G5()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function jN(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const j5=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:jN,isMobile:HN,mockIsMobile:H5},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gs=de();gs.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});gs.registerFlag("IS_BROWSER",()=>jN());gs.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");gs.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));gs.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));gs.registerFlag("PROD",()=>!1);gs.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>gs.getBool("DEBUG"));gs.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);gs.registerFlag("IS_TEST",()=>!1);gs.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>gs.getBool("DEBUG"));gs.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);gs.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);gs.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oo(n,e){let t=n;if(lr(n))return e==="string"?[]:[n.length];if(VF(n)){const s=n.channels||"RGBA";return[n.height,n.width*s.length]}else if(UF(n))return[n.buffer.size/(e==null?4:Vp(e))];if(!Array.isArray(n))return[];const r=[];for(;Array.isArray(t)||lr(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&de().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&jF(n,r,[]),r}function jF(n,e,t){if(t=t||[],!Array.isArray(n)&&!lr(n)){B(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}B(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),B(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const r=e.slice(1);for(let s=0;s<n.length;++s)jF(n[s],r,t.concat(s))}function KD(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${r}' must be ${n} tensor, but got ${e} tensor`)}}function U(n,e,t,r="numeric"){if(n instanceof Se())return KD(r,n.dtype,e,t),n;let s=hc(n);if(s!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),KD(r,s,e,t),n==null||!lr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const u=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${u}'`)}const a=Oo(n,s);!lr(n)&&!Array.isArray(n)&&(n=[n]);const i=s!=="string"?Vu(n,s):$o(n,[],!0);return Q.makeTensor(i,a,s)}function Kp(n,e,t,r="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((a,o)=>U(a,`${e}[${o}]`,t,r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qN="__op";function ee(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+qN;const s=(...a)=>{Q.startScope(t);try{const o=r(...a);return _u(o)&&console.error("Cannot return a Promise inside of tidy."),Q.endScope(o),o}catch(o){throw Q.endScope(null),o}};return Object.defineProperty(s,"name",{value:t,configurable:!0}),s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q5(n,e){const t=U(n,"real","complex"),r=U(e,"imag","complex");Dr(t.shape,r.shape,`real and imag shapes, ${t.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:t,imag:r};return Q.runKernel(C0,s)}const xi=ee({complex_:q5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uu(n,e,t,r){if(r==null)r=hc(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(UF(n)||VF(n)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return Q.backend.createTensorFromGPUData(n,e||t,r)}if(!lr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Vs(e);const s=xe(e),a=xe(t);B(s===a,()=>`Based on the provided shape, [${e}], the tensor should have ${s} values but has ${a}`);for(let o=0;o<t.length;++o){const i=t[o],u=o===t.length-1?i!==xe(e.slice(o)):!0;B(t[o]===e[o]||!u,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!lr(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?Vu(n,r):$o(n,[],!0),Q.makeTensor(n,e,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ra(n,e,t){const r=Oo(n,t);return Uu(n,e,r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ql={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class no{static join(e){return new no(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(r=>lr(r)?r.buffer:r),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let r=0;r<e.length;r++){const s=e[r];r!==e.length-1&&s.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const a=t+s.byteLength;this.shards.push({buffer:s,start:t,end:a}),t=a}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const r=this.findShardForByte(e);if(r===-1)throw new Error(`Could not find start shard for byte ${e}`);const s=t-e,a=new ArrayBuffer(s),o=new Uint8Array(a);let i=0;for(let u=r;u<this.shards.length;u++){const l=this.shards[u],d=e+i-l.start,p=i,v=Math.min(t,l.end)-l.start,b=new Uint8Array(l.buffer,d,v-d);if(o.set(b,p),i+=b.length,t<l.end)break}return a}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(s){return e<s.start?-1:e>=s.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const r=K5(this.shards,t);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}}function K5(n,e){let t=0,r=n.length;for(;t<=r;){const s=Math.floor((r-t)/2)+t,a=e(n[s]);if(a===0)return s;a<0?r=s:t=s+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X5(){de().set("PROD",!0)}function Y5(){de().set("DEBUG",!0)}function Z5(){de().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Q5(n){de().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function J5(){Q.disposeVariables()}function Va(){return Q}function SC(){return Q.memory()}function eq(n){return Q.profile(n)}function he(n,e){return Q.tidy(n,e)}function Ct(n){GN(n).forEach(t=>t.dispose())}function Qn(n){return Q.keep(n)}function tq(n){return Q.time(n)}function qF(n){return Q.setBackend(n)}function nq(){return Q.ready()}function KF(){return Q.backendName}function rq(n){Q.removeBackend(n)}function sq(n){return Q.findBackend(n)}function aq(n){return Q.findBackendFactory(n)}function KN(n,e,t=1){return Q.registerBackend(n,e,t)}function XN(){return Q.backend}function oq(n,e){de().setPlatform(n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ru=4;async function CC(n,e){const t=[],r=[],s=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<s.length;++o){const i=s[o],u=Array.isArray(n)?n[o].tensor:n[i];if(u.dtype!=="float32"&&u.dtype!=="int32"&&u.dtype!=="bool"&&u.dtype!=="string"&&u.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${i}': ${u.dtype}`);const l={name:i,shape:u.shape,dtype:u.dtype};if(u.dtype==="string"){const c=new Promise(async d=>{const p=await u.bytes(),m=p.reduce((y,w)=>y+w.length,0)+Ru*p.length,v=new Uint8Array(m);let b=0;for(let y=0;y<p.length;y++){const w=p[y],S=new Uint8Array(new Uint32Array([w.length]).buffer);v.set(S,b),b+=Ru,v.set(w,b),b+=w.length}d(v)});r.push(c)}else r.push(u.data());e!=null&&(l.group=e),t.push(l)}const a=await Promise.all(r);return{data:lq(a),specs:t}}function XF(n,e){const t=new no(n),r={};let s=0;for(const a of e){const o=iq(a,(i,u)=>t.slice(s+i,s+u));r[a.name]=YF(a,t.slice(s,s+o)),s+=o}return r}function iq(n,e){const t=xe(n.shape);let r;if("quantization"in n){const s=n.quantization;r=ql[s.dtype]}else if(n.dtype==="string"){let s=0;for(let a=0;a<t;a++)s+=Ru+new Uint32Array(e(s,s+Ru))[0];return s}else r=ql[n.dtype];return t*r}async function uq(n,e){const t=xe(n.shape);let r;if("quantization"in n){const s=n.quantization;r=ql[s.dtype]}else if(n.dtype==="string"){let s=0;for(let a=0;a<t;a++)s+=Ru+new Uint32Array(await e(s,s+Ru))[0];return s}else r=ql[n.dtype];return t*r}function YF(n,e){const t=n.name,r=n.dtype,s=n.shape,a=xe(s);let o,i=0;if("quantization"in n){const u=n.quantization;if(u.dtype==="uint8"||u.dtype==="uint16"){if(!("min"in u&&"scale"in u))throw new Error(`Weight ${n.name} with quantization ${u.dtype} doesn't have corresponding metadata min and scale.`)}else if(u.dtype==="float16"){if(r!=="float32")throw new Error(`Weight ${n.name} is quantized with ${u.dtype} which only supports weights of type float32 not ${r}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${u.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const l=ql[u.dtype],c=u.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(r==="float32")if(u.dtype==="uint8"||u.dtype==="uint16"){o=new Float32Array(c.length);for(let d=0;d<c.length;d++){const p=c[d];o[d]=p*u.scale+u.min}}else if(u.dtype==="float16")o=mq()(c);else throw new Error(`Unsupported quantization type ${u.dtype} for weight type float32.`);else if(r==="int32"){if(u.dtype!=="uint8"&&u.dtype!=="uint16")throw new Error(`Unsupported quantization type ${u.dtype} for weight type int32.`);o=new Int32Array(c.length);for(let d=0;d<c.length;d++){const p=c[d];o[d]=Math.round(p*u.scale+u.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${r}`);i+=a*l}else if(r==="string"){const u=xe(n.shape);o=[];for(let l=0;l<u;l++){const c=new Uint32Array(e.slice(i,i+Ru))[0];i+=Ru;const d=new Uint8Array(e.slice(i,i+c));o.push(d),i+=c}}else{const u=ql[r];if(r==="float32")o=new Float32Array(e);else if(r==="int32")o=new Int32Array(e);else if(r==="bool")o=new Uint8Array(e);else if(r==="complex64"){o=new Float32Array(e);const l=new Float32Array(o.length/2),c=new Float32Array(o.length/2);for(let v=0;v<l.length;v++)l[v]=o[v*2],c[v]=o[v*2+1];const d=Ra(l,s,"float32"),p=Ra(c,s,"float32"),m=xi(d,p);return d.dispose(),p.dispose(),m}else throw new Error(`Unsupported dtype in weight '${t}': ${r}`);i+=a*u}return Ra(o,s,r)}async function XD(n,e,t){let r=new Uint8Array(e);for(;r.byteLength<t;){const{done:s,value:a}=await n.read();if(s&&a==null){const i=t-r.byteLength;throw new Error(`Reader is done but ${i} bytes are still expected`)}const o=new Uint8Array(r.length+a.byteLength);o.set(r,0),o.set(new Uint8Array(a),r.length),r=o}return r.buffer}async function ZF(n,e){const t={},r=n.getReader();let s=new ArrayBuffer(0);for(const a of e){const o=await uq(a,async(l,c)=>(s=await XD(r,s,c),s.slice(l,c)));s=await XD(r,s,o);const i=s.slice(0,o);s=s.slice(o);const u=YF(a,i);if(t[a.name]=u,KF()==="webgpu"){const l=XN();"uploadToGPU"in l&&xe(u.shape)>=de().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&l.uploadToGPU(u.dataId)}}return t}function lq(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(a=>{if(e+=a.byteLength,t.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${a.constructor.name}`)});const r=new Uint8Array(e);let s=0;return t.forEach(a=>{r.set(new Uint8Array(a.buffer),s),s+=a.byteLength}),r.buffer}const YN=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function YD(n){return YN?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function cq(n){if(YN)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let r=0,s=e.length;r<s;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function hq(n){if(YN){const r=Buffer.from(n,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t.set([e.charCodeAt(r)],r);return t.buffer}function QF(n){return no.join(n)}function ZD(n){const e="/";for(n=n.trim();n.endsWith(e);)n=n.slice(0,n.length-1);const t=n.split(e);return t[t.length-1]}function JF(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function ZN(n,e,t){const r={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(r.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=t}return n.signature!=null&&(r.signature=n.signature),n.userDefinedMetadata!=null&&(r.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(r.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(r.initializerSignature=n.initializerSignature),r}async function QN(n,e){let t,r;return n.weightsManifest!=null&&([t,r]=await e(n.weightsManifest)),ZN(n,t,r)}function bg(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:YD(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:YD(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new no(n.weightData).byteLength}}function wb(n){const e=[];for(const t of n)e.push(...t.weights);return e}function dq(){const n=t=>{let r=t<<13,s=0;for(;(r&8388608)===0;)s-=8388608,r<<=1;return r&=-8388609,s+=947912704,r|s},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function fq(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function pq(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function mq(){const n=dq(),e=fq(),t=pq();return r=>{const s=new ArrayBuffer(4*r.length),a=new Uint32Array(s);for(let o=0;o<r.length;o++){const i=r[o],u=n[t[i>>10]+(i&1023)]+e[i>>10];a[o]=u}return new Float32Array(s)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return bn.instance==null&&(bn.instance=new bn),bn.instance}static registerSaveRouter(e){bn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){bn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return bn.getHandlers(e,"save")}static getLoadHandlers(e,t){return bn.getHandlers(e,"load",t)}static getHandlers(e,t,r){const s=[];return(t==="load"?bn.getInstance().loadRouters:bn.getInstance().saveRouters).forEach(o=>{const i=o(e,r);i!==null&&s.push(i)}),s}}const gq=n=>bn.registerSaveRouter(n),vq=n=>bn.registerLoadRouter(n),eM=n=>bn.getSaveHandlers(n),yq=(n,e)=>bn.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NC="tensorflowjs",kC=1,Fl="models_store",gu="model_info_store";function tM(){if(!de().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function TC(n){const e=n.result;e.createObjectStore(Fl,{keyPath:"modelPath"}),e.createObjectStore(gu,{keyPath:"modelPath"})}class Kl{constructor(e){if(this.indexedDB=tM(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((r,s)=>{const a=this.indexedDB.open(NC,kC);a.onupgradeneeded=()=>TC(a),a.onsuccess=()=>{const o=a.result;if(t==null){const i=o.transaction(Fl,"readonly"),l=i.objectStore(Fl).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return o.close(),s(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(l.result.modelArtifacts)},l.onerror=c=>(o.close(),s(l.error)),i.oncomplete=()=>o.close()}else{t.weightData=no.join(t.weightData);const i=bg(t),u=o.transaction(gu,"readwrite");let l=u.objectStore(gu),c;try{c=l.put({modelPath:this.modelPath,modelArtifactsInfo:i})}catch(p){return s(p)}let d;c.onsuccess=()=>{d=o.transaction(Fl,"readwrite");const p=d.objectStore(Fl);let m;try{m=p.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:i})}catch(v){return s(v)}m.onsuccess=()=>r({modelArtifactsInfo:i}),m.onerror=v=>{l=u.objectStore(gu);const b=l.delete(this.modelPath);b.onsuccess=()=>(o.close(),s(m.error)),b.onerror=y=>(o.close(),s(m.error))}},c.onerror=p=>(o.close(),s(c.error)),u.oncomplete=()=>{d==null?o.close():d.oncomplete=()=>o.close()}}},a.onerror=o=>s(a.error)})}}Kl.URL_SCHEME="indexeddb://";const nM=n=>de().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Kl.URL_SCHEME)?bq(n.slice(Kl.URL_SCHEME.length)):null;bn.registerSaveRouter(nM);bn.registerLoadRouter(nM);function bq(n){return new Kl(n)}function xq(n){return n.startsWith(Kl.URL_SCHEME)?n.slice(Kl.URL_SCHEME.length):n}class wq{constructor(){this.indexedDB=tM()}async listModels(){return new Promise((e,t)=>{const r=this.indexedDB.open(NC,kC);r.onupgradeneeded=()=>TC(r),r.onsuccess=()=>{const s=r.result,a=s.transaction(gu,"readonly"),i=a.objectStore(gu).getAll();i.onsuccess=()=>{const u={};for(const l of i.result)u[l.modelPath]=l.modelArtifactsInfo;e(u)},i.onerror=u=>(s.close(),t(i.error)),a.oncomplete=()=>s.close()},r.onerror=s=>t(r.error)})}async removeModel(e){return e=xq(e),new Promise((t,r)=>{const s=this.indexedDB.open(NC,kC);s.onupgradeneeded=()=>TC(s),s.onsuccess=()=>{const a=s.result,o=a.transaction(gu,"readwrite"),i=o.objectStore(gu),u=i.get(e);let l;u.onsuccess=()=>{if(u.result==null)return a.close(),r(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const c=i.delete(e),d=()=>{l=a.transaction(Fl,"readwrite");const m=l.objectStore(Fl).delete(e);m.onsuccess=()=>t(u.result.modelArtifactsInfo),m.onerror=v=>r(u.error)};c.onsuccess=d,c.onerror=p=>(d(),a.close(),r(u.error))}},u.onerror=c=>(a.close(),r(u.error)),o.oncomplete=()=>{l==null?a.close():l.oncomplete=()=>a.close()}},s.onerror=a=>r(s.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mi="/",Sh="tensorflowjs_models",rM="info",Sq="model_topology",Cq="weight_specs",Nq="weight_data",kq="model_metadata";function sM(n){return{info:[Sh,n,rM].join(mi),topology:[Sh,n,Sq].join(mi),weightSpecs:[Sh,n,Cq].join(mi),weightData:[Sh,n,Nq].join(mi),modelMetadata:[Sh,n,kq].join(mi)}}function aM(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function Tq(n){const e=n.split(mi);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(mi)}function Iq(n){return n.startsWith(Xl.URL_SCHEME)?n.slice(Xl.URL_SCHEME.length):n}class Xl{constructor(e){if(!de().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=sM(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),s=bg(e),a=no.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(s)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,cq(a));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:s}}catch{throw aM(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${s.modelTopologyBytes}, weightSpecsBytes=${s.weightSpecsBytes}, weightDataBytes=${s.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=r;const s=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(s==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=s;const a=this.LS.getItem(this.keys.modelMetadata);if(a!=null){const i=JSON.parse(a);t.format=i.format,t.generatedBy=i.generatedBy,t.convertedBy=i.convertedBy,i.signature!=null&&(t.signature=i.signature),i.userDefinedMetadata!=null&&(t.userDefinedMetadata=i.userDefinedMetadata),i.modelInitializer!=null&&(t.modelInitializer=i.modelInitializer),i.initializerSignature!=null&&(t.initializerSignature=i.initializerSignature),i.trainingConfig!=null&&(t.trainingConfig=i.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=hq(o),t}}Xl.URL_SCHEME="localstorage://";const oM=n=>de().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Xl.URL_SCHEME)?Eq(n.slice(Xl.URL_SCHEME.length)):null;bn.registerSaveRouter(oM);bn.registerLoadRouter(oM);function Eq(n){return new Xl(n)}class _q{constructor(){B(de().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),B(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Sh+mi,r=mi+rM;for(let s=0;s<this.LS.length;++s){const a=this.LS.key(s);if(a.startsWith(t)&&a.endsWith(r)){const o=Tq(a);e[o]=JSON.parse(this.LS.getItem(a))}}return e}async removeModel(e){e=Iq(e);const t=sM(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(t.info));return aM(t),r}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ih="://";class Qr{constructor(){this.managers={}}static getInstance(){return Qr.instance==null&&(Qr.instance=new Qr),Qr.instance}static registerManager(e,t){B(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Ih)&&(e=e.slice(0,e.indexOf(Ih))),B(e.length>0,()=>"scheme must not be an empty string.");const r=Qr.getInstance();B(r.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),r.managers[e]=t}static getManager(e){const t=Qr.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Qr.getInstance().managers)}}function tb(n){if(n.indexOf(Ih)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Qr.getSchemes().join(",")}`);return{scheme:n.split(Ih)[0],path:n.split(Ih)[1]}}async function iM(n,e,t=!1){B(n!==e,()=>`Old path and new path are the same: '${n}'`);const r=bn.getLoadHandlers(n);B(r.length>0,()=>`Copying failed because no load handler is found for source URL ${n}.`),B(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${n}.`);const s=r[0],a=bn.getSaveHandlers(e);B(a.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),B(a.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${e}.`);const o=a[0],i=tb(n).scheme,u=tb(n).path,l=i===tb(n).scheme,c=await s.load();t&&l&&await Qr.getManager(i).removeModel(u);const d=await o.save(c);return t&&!l&&await Qr.getManager(i).removeModel(u),d.modelArtifactsInfo}async function Rq(){const n=Qr.getSchemes(),e={};for(const t of n){const r=await Qr.getManager(t).listModels();for(const s in r){const a=t+Ih+s;e[a]=r[s]}}return e}async function Aq(n){const e=tb(n);return Qr.getManager(e.scheme).removeModel(e.path)}async function Dq(n,e){return iM(n,e,!1)}async function $q(n,e){return iM(n,e,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oq{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!de().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();const s=this.functionRefs[r.data.index];s(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return OF(e)}}if(de().get("IS_BROWSER")){de().setPlatform("browser",new Oq);try{Qr.registerManager(Xl.URL_SCHEME,new _q)}catch{}try{Qr.registerManager(Kl.URL_SCHEME,new wq)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fq={importFetch:()=>require("node-fetch")};let gS;class Mq{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return de().global.fetch!=null?de().global.fetch(e,t):(gS==null&&(gS=Fq.importFetch()),gS(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}de().get("IS_NODE")&&!de().get("IS_BROWSER")&&de().setPlatform("node",new Mq);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yt(n,e="float32",t){return e=e||"float32",Vs(n),new Gn(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lq(n,e){const t=U(n,"x","cast");if(!NF(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:t},s={dtype:e};return Q.runKernel(fd,r,s)}const Fe=ee({cast_:Lq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pq(n){const t={x:U(n,"x","clone","string_or_numeric")};return Q.runKernel(Td,t)}const To=ee({clone_:Pq});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JN(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */HF();const Bq={buffer:yt,cast:Fe,clone:To,print:JN};L5(Bq);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zq(n,e){let t=U(n,"a","add"),r=U(e,"b","add");[t,r]=Sn(t,r);const s={a:t,b:r};return Q.runKernel(fc,s)}const Re=ee({add_:zq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vq(n,e){let t=U(n,"a","floorDiv"),r=U(e,"b","floorDiv");[t,r]=Sn(t,r);const s={a:t,b:r};return Q.runKernel(Nd,s)}const Nx=ee({floorDiv_:Vq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uq(n,e){let t=U(n,"a","div"),r=U(e,"b","div");if([t,r]=Sn(t,r),t.dtype==="int32"&&r.dtype==="int32")return Nx(t,r);const s={a:t,b:r},a={};return Q.runKernel(yd,s,a)}const Qe=ee({div_:Uq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wq(n,e){let t=U(n,"a","mul"),r=U(e,"b","mul");[t,r]=Sn(t,r);const s={a:t,b:r};return Q.runKernel(Fd,s)}const re=ee({mul_:Wq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gq(n){const e=U(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return Q.runKernel(Nm,t)}else{const t={x:e};return Q.runKernel(mm,t)}}const Un=ee({abs_:Gq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hq(n){const t={x:U(n,"x","acos")};return Q.runKernel(od,t)}const ek=ee({acos_:Hq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jq(n){const t={x:U(n,"x","acosh")};return Q.runKernel(id,t)}const tk=ee({acosh_:jq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qq(n){B(Array.isArray(n),()=>"The argument passed to tf.addN() must be a list of tensors"),B(n.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${n.length}`);const e=n.map((s,a)=>U(s,`tensors${a}`,"addN")),t=e[0];e.forEach(s=>{if(s.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(s=>{if(!Et(s.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const r=e;return Q.runKernel(gm,r)}const uM=ee({addN_:qq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kq(n,e=null,t=!1){const s={x:U(n,"x","all","bool")},a={axis:e,keepDims:t};return Q.runKernel(v0,s,a)}const kx=ee({all_:Kq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xq(n,e=null,t=!1){const s={x:U(n,"x","any","bool")},a={axis:e,keepDims:t};return Q.runKernel(y0,s,a)}const Xp=ee({any_:Xq});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yq(n,e=0){const r={x:U(n,"x","argMax")},s={axis:e};return Q.runKernel(vm,r,s)}const Yl=ee({argMax_:Yq});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zq(n,e=0){const r={x:U(n,"x","argMin")},s={axis:e};return Q.runKernel(ym,r,s)}const nk=ee({argMin_:Zq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qq(n){const t={x:U(n,"x","asin")};return Q.runKernel(ud,t)}const rk=ee({asin_:Qq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jq(n){const t={x:U(n,"x","asinh")};return Q.runKernel(ld,t)}const sk=ee({asinh_:Jq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e8(n){const t={x:U(n,"x","atan")};return Q.runKernel(cd,t)}const ak=ee({atan_:e8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t8(n,e){let t=U(n,"a","atan2"),r=U(e,"b","atan2");[t,r]=Sn(t,r);const s={a:t,b:r};return Q.runKernel(dd,s)}const ok=ee({atan2_:t8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n8(n){const t={x:U(n,"x","atanh")};return Q.runKernel(hd,t)}const ik=ee({atanh_:n8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xg(n,e,t,r,s="NHWC",a){const o=n[3],i=[...e,o],u=Ii(s);return vr(n,i,t,a,r,null,null,u)}function Da(n,e,t,r,s,a,o="channelsLast"){const[i,u]=Yp(e);let l;if(o==="channelsLast")l=[i,u,n[3],n[3]];else if(o==="channelsFirst")l=[i,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return vr(n,l,t,r,s,a,!1,o)}function Ti(n,e,t,r,s,a,o="NDHWC"){const[i,u,l]=IC(e);let c,d;if(o==="NDHWC")d="channelsLast",c=[i,u,l,n[4],n[4]];else if(o==="NCDHW")d="channelsFirst",c=[i,u,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Wu(n,c,t,r,s,!1,d,a)}function vr(n,e,t,r,s,a,o=!1,i="channelsLast"){let[u,l,c,d]=[-1,-1,-1,-1];if(i==="channelsLast")[u,l,c,d]=n;else if(i==="channelsFirst")[u,d,l,c]=n;else throw new Error(`Unknown dataFormat ${i}`);const[p,m,,v]=e,[b,y]=Yp(t),[w,S]=Yp(r),N=Eh(p,w),C=Eh(m,S),{padInfo:T,outHeight:E,outWidth:$}=a8(s,l,c,b,y,N,C,a,i),_=o?v*d:v;let R;return i==="channelsFirst"?R=[u,_,E,$]:i==="channelsLast"&&(R=[u,E,$,_]),{batchSize:u,dataFormat:i,inHeight:l,inWidth:c,inChannels:d,outHeight:E,outWidth:$,outChannels:_,padInfo:T,strideHeight:b,strideWidth:y,filterHeight:p,filterWidth:m,effectiveFilterHeight:N,effectiveFilterWidth:C,dilationHeight:w,dilationWidth:S,inShape:n,outShape:R,filterShape:e}}function Wu(n,e,t,r,s,a=!1,o="channelsLast",i){let[u,l,c,d,p]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[u,l,c,d,p]=n;else if(o==="channelsFirst")[u,p,l,c,d]=n;else throw new Error(`Unknown dataFormat ${o}`);const[m,v,b,,y]=e,[w,S,N]=IC(t),[C,T,E]=IC(r),$=Eh(m,C),_=Eh(v,T),R=Eh(b,E),{padInfo:D,outDepth:A,outHeight:M,outWidth:H}=o8(s,l,c,d,w,S,N,$,_,R,i),j=a?y*p:y;let G;return o==="channelsFirst"?G=[u,j,A,M,H]:o==="channelsLast"&&(G=[u,A,M,H,j]),{batchSize:u,dataFormat:o,inDepth:l,inHeight:c,inWidth:d,inChannels:p,outDepth:A,outHeight:M,outWidth:H,outChannels:j,padInfo:D,strideDepth:w,strideHeight:S,strideWidth:N,filterDepth:m,filterHeight:v,filterWidth:b,effectiveFilterDepth:$,effectiveFilterHeight:_,effectiveFilterWidth:R,dilationDepth:C,dilationHeight:T,dilationWidth:E,inShape:n,outShape:G,filterShape:e}}function r8(n,e,t,r,s){r==null&&(r=uk(n,e,t));const a=n[0],o=n[1],i=Zp((a-e+2*r)/t+1,s),u=Zp((o-e+2*r)/t+1,s);return[i,u]}function s8(n,e,t,r,s,a){s==null&&(s=uk(n,e[0],r[0]));const o=[0,0,0,t];for(let i=0;i<3;i++)n[i]+2*s>=e[i]&&(o[i]=Zp((n[i]-e[i]+2*s)/r[i]+1,a));return o}function uk(n,e,t,r=1){const s=Eh(e,r);return Math.floor((n[0]*(t-1)-t+s)/2)}function Yp(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function IC(n){return typeof n=="number"?[n,n,n]:n}function Eh(n,e){return e<=1?n:n+(n-1)*(e-1)}function a8(n,e,t,r,s,a,o,i,u){let l,c,d;if(typeof n=="number"){l={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const m=r8([e,t],a,r,n,i);c=m[0],d=m[1]}else if(n==="same"){c=Math.ceil(e/r),d=Math.ceil(t/s);const p=Math.max(0,(c-1)*r+a-e),m=Math.max(0,(d-1)*s+o-t),v=Math.floor(p/2),b=p-v,y=Math.floor(m/2),w=m-y;l={top:v,bottom:b,left:y,right:w,type:"SAME"}}else if(n==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-a+1)/r),d=Math.ceil((t-o+1)/s);else if(typeof n=="object"){const p=u==="channelsLast"?n[1][0]:n[2][0],m=u==="channelsLast"?n[1][1]:n[2][1],v=u==="channelsLast"?n[2][0]:n[3][0],b=u==="channelsLast"?n[2][1]:n[3][1];l={top:p,bottom:m,left:v,right:b,type:p===0&&m===0&&v===0&&b===0?"VALID":"EXPLICIT"},c=Zp((e-a+p+m)/r+1,i),d=Zp((t-o+v+b)/s+1,i)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:l,outHeight:c,outWidth:d}}function o8(n,e,t,r,s,a,o,i,u,l,c){let d,p,m,v;if(n==="valid"&&(n=0),typeof n=="number"){d={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const y=s8([e,t,r,1],[i,u,l],1,[s,a,o],n,c);p=y[0],m=y[1],v=y[2]}else if(n==="same"){p=Math.ceil(e/s),m=Math.ceil(t/a),v=Math.ceil(r/o);const b=(p-1)*s+i-e,y=(m-1)*a+u-t,w=(v-1)*o+l-r,S=Math.floor(b/2),N=b-S,C=Math.floor(y/2),T=y-C,E=Math.floor(w/2),$=w-E;d={top:C,bottom:T,left:E,right:$,front:S,back:N,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:d,outDepth:p,outHeight:m,outWidth:v}}function Zp(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Au(n){const[e,t,r]=Yp(n);return e===1&&t===1&&r===1}function $r(n,e){return Au(n)||Au(e)}function Zl(n){return Yp(n).every(e=>e>0)}function Ii(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function us(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")B(jl(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(r=>{r.forEach(s=>{B(jl(s),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${s}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i8(n,e){const r={x:U(n,"x","reshape","string_or_numeric")},s={shape:e};return Q.runKernel(sg,r,s)}const ae=ee({reshape_:i8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u8(n,e,t,r,s){const a=U(n,"x","avgPool","float32"),o=1;B($r(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let i=a,u=!1;a.rank===3&&(u=!0,i=ae(a,[1,a.shape[0],a.shape[1],a.shape[2]])),B(i.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${i.rank}.`),us("avgPool",r,s);const l={x:i},c={filterSize:e,strides:t,pad:r,dimRoundingMode:s};let d=Q.runKernel(bm,l,c);return d=Fe(d,a.dtype),u?ae(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const wg=ee({avgPool_:u8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l8(n,e,t,r,s,a="NDHWC"){const o=U(n,"x","avgPool3d","float32");let i=o,u=!1;o.rank===4&&(u=!0,i=ae(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),B(i.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${i.rank}.`),B(a==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${a}`),B(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),us("avgPool3d",r,s);const l={x:i},c={filterSize:e,strides:t,pad:r,dimRoundingMode:s,dataFormat:a};let d=Q.runKernel(xm,l,c);return d=Fe(d,i.dtype),u?ae(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const lk=ee({avgPool3d_:l8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c8(n,e=0){B(n.length>=1,()=>"Pass at least one tensor to concat");const t=Kp(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(a=>{if(a.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${a.dtype}. `)}),t.length===1)return To(t[0]);const r=t,s={axis:e};return Q.runKernel(km,r,s)}const On=ee({concat_:c8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h8(n,e,t=!1,r=!1){let s=U(n,"a","matMul"),a=U(e,"b","matMul");[s,a]=Sn(s,a);const o={a:s,b:a},i={transposeA:t,transposeB:r};return Q.runKernel(wm,o,i)}const St=ee({matMul_:h8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d8(n){const t={x:U(n,"x","sigmoid","float32")};return Q.runKernel(jd,t)}const Ka=ee({sigmoid_:d8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f8(n,e,t){const r=U(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");const s={x:r},a={begin:e,size:t};return Q.runKernel(lg,s,a)}const Ft=ee({slice_:f8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p8(n){const t={x:U(n,"x","tanh","float32")};return Q.runKernel(Qd,t)}const Du=ee({tanh_:p8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m8(n,e,t,r,s,a){const o=U(n,"forgetBias","basicLSTMCell"),i=U(e,"lstmKernel","basicLSTMCell"),u=U(t,"lstmBias","basicLSTMCell"),l=U(r,"data","basicLSTMCell"),c=U(s,"c","basicLSTMCell"),d=U(a,"h","basicLSTMCell"),p=On([l,d],1),m=St(p,i),v=Re(m,u),b=v.shape[0],y=v.shape[1]/4,w=[b,y],S=Ft(v,[0,0],w),N=Ft(v,[0,y],w),C=Ft(v,[0,y*2],w),T=Ft(v,[0,y*3],w),E=Re(re(Ka(S),Du(N)),re(c,Ka(Re(o,C)))),$=re(Du(E),Ka(T));return[E,$]}const lM=ee({basicLSTMCell_:m8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g8(n,e,t){const r=U(n,"x","batchToSpaceND"),s=e.reduce((i,u)=>i*u);B(r.rank>=1+e.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`),B(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),B(r.shape[0]%s===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`);const a={x:r},o={blockShape:e,crops:t};return Q.runKernel(Sm,a,o)}const Sg=ee({batchToSpaceND_:g8});function v8(n){let e;return n.rank===0||n.rank===1?e=ae(n,[1,1,1,n.size]):n.rank===2?e=ae(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ae(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y8(n,e,t,r,s,a){a==null&&(a=.001);const o=U(n,"x","batchNorm"),i=U(e,"mean","batchNorm"),u=U(t,"variance","batchNorm");let l;s!=null&&(l=U(s,"scale","batchNorm"));let c;r!=null&&(c=U(r,"offset","batchNorm")),B(i.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),B(c==null||i.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),B(l==null||i.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:v8(o),scale:l,offset:c,mean:i,variance:u},m={varianceEpsilon:a},v=Q.runKernel(Om,p,m);return ae(v,o.shape)}const tf=ee({batchNorm_:y8});function b8(n,e,t,r,s,a){const o=U(n,"x","batchNorm"),i=U(e,"mean","batchNorm"),u=U(t,"variance","batchNorm");let l;s!=null&&(l=U(s,"scale","batchNorm"));let c;return r!=null&&(c=U(r,"offset","batchNorm")),B(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),B(i.rank===2||i.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${i.rank}.`),B(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),l!=null&&B(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&B(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),tf(o,i,u,c,l,a)}const ck=ee({batchNorm2d_:b8});function x8(n,e,t,r,s,a){const o=U(n,"x","batchNorm"),i=U(e,"mean","batchNorm"),u=U(t,"variance","batchNorm");let l;s!=null&&(l=U(s,"scale","batchNorm"));let c;return r!=null&&(c=U(r,"offset","batchNorm")),B(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),B(i.rank===3||i.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${i.rank}.`),B(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),l!=null&&B(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&B(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),tf(o,i,u,c,l,a)}const hk=ee({batchNorm3d_:x8});function w8(n,e,t,r,s,a){const o=U(n,"x","batchNorm"),i=U(e,"mean","batchNorm"),u=U(t,"variance","batchNorm");let l;s!=null&&(l=U(s,"scale","batchNorm"));let c;return r!=null&&(c=U(r,"offset","batchNorm")),B(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),B(i.rank===4||i.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${i.rank}.`),B(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),l!=null&&B(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&B(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),tf(o,i,u,c,l,a)}const dk=ee({batchNorm4d_:w8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S8(n,e,t){const r=U(n,"x","bincount"),s=U(e,"weights","bincount");B(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),B(t>=0,()=>`size must be non-negative, but got ${t}.`),B(s.size===r.size||s.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`);const a={x:r,weights:s},o={size:t};return Q.runKernel(w0,a,o)}const fk=ee({bincount_:S8});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C8(n,e){const t=U(n,"x","bitwiseAnd"),r=U(e,"y","bitwiseAnd");if(!Et(t.shape,r.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${t.shape}, y: ${r.shape}`);if(t.dtype!=="int32"||r.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${t.dtype} and type of y: ${r.dtype}`);const s={a:t,b:r};return Q.runKernel(Cm,s)}const cM=ee({bitwiseAnd_:C8});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N8(n,e){const t=U(n,"s0","broadcastArgs","int32"),r=U(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${t.rank}`);if(r.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const s={s0:t,s1:r};return Q.runKernel(S0,s)}const hM=ee({broadcastArgs_:N8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k8(n,e){let t=U(n,"broadcastTo","x");const r=t.shape;if(Vs(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const l=t.shape.slice();for(;l.length<e.length;)l.unshift(1);t=ae(t,l)}const s=t.shape,a=Array.from(e);for(let l=e.length-1;l>=0;l--)if(s[l]===e[l])a[l]=1;else if(t.shape[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);if(a.map((l,c)=>l>1?c:-1).filter(l=>l>=0).length===0)return To(t);const i={x:t},u={reps:a};return Q.runKernel(Jd,i,u)}const Ul=ee({broadcastTo_:k8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T8(n){const t={x:U(n,"x","ceil","float32")};return Q.runKernel(pd,t)}const pk=ee({ceil_:T8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pc(n,e,t){Vs(n),t=t||hc(e);const r={shape:n,value:e,dtype:t};return Q.runKernel(P0,{},r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I8(n,e,t){const r=U(n,"x","clipByValue");if(B(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return pc(r.shape,e,r.dtype);const s={x:r},a={clipValueMin:e,clipValueMax:t};return Q.runKernel(md,s,a)}const vs=ee({clipByValue_:I8});function E8(n){return On(n,0)}const mk=ee({concat1d_:E8});function _8(n,e){return On(n,e)}const gk=ee({concat2d_:_8});function R8(n,e){return On(n,e)}const vk=ee({concat3d_:R8});function A8(n,e){return On(n,e)}const yk=ee({concat4d_:A8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D8(n,e,t,r,s="NHWC",a=[1,1],o){const i=U(n,"x","conv2d","float32"),u=U(e,"filter","conv2d","float32");let l=i,c=!1;i.rank===3&&(c=!0,l=ae(i,[1,i.shape[0],i.shape[1],i.shape[2]])),B(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),B(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),us("conv2d",r,o);const d=s==="NHWC"?l.shape[3]:l.shape[1];B(d===u.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${u.shape[2]}.`),B($r(t,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${a}'`),B(Zl(a),()=>"Error in conv2D: Dilated rates should be larger than 0."),B(Zl(t),()=>"Error in conv2D: Strides should be larger than 0.");const p={x:l,filter:u},m={strides:t,pad:r,dataFormat:s,dilations:a,dimRoundingMode:o},v=Q.runKernel(Tm,p,m);return c?ae(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const wi=ee({conv2d_:D8});function $8(n,e,t,r,s="NWC",a=1,o){const i=U(n,"x","conv1d"),u=U(e,"filter","conv1d");let l=i,c=!1;i.rank===2&&(c=!0,l=ae(i,[1,i.shape[0],i.shape[1]])),B(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),B(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),us("conv1d",r,o),B(l.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${u.shape[1]}.`),B($r(t,a),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${a}'`),B(Zl(a),()=>"Error in conv1D: Dilated rates should be larger than 0."),B(Zl(t),()=>"Error in conv1D: Stride should be larger than 0."),B(s==="NWC",()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`);const d=ae(u,[1,u.shape[0],u.shape[1],u.shape[2]]),p=ae(l,[l.shape[0],1,l.shape[1],l.shape[2]]),y=wi(p,d,[1,t],r,"NHWC",[1,a],o);return c?ae(y,[y.shape[2],y.shape[3]]):ae(y,[y.shape[0],y.shape[2],y.shape[3]])}const Tx=ee({conv1d_:$8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O8(n,e,t,r,s,a="NHWC",o){B(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,u=e,l=!1;e.rank===3&&(l=!0,u=ae(e,[1,e.shape[0],e.shape[1],e.shape[2]]),i=[1,n[0],n[1],n[2]]),B(i.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${i.length}.`),B(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),B(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const c=a==="NHWC"?i[3]:i[1],d=a==="NHWC"?u.shape[3]:u.shape[1];B(c===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${t.shape[2]}.`),B(d===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${t.shape[3]}.`),us("conv2dDerInput",s,o);const p={dy:u,filter:t},m={strides:r,pad:s,dataFormat:a,dimRoundingMode:o,inputShape:i},v=Q.runKernel(Im,p,m);return l?ae(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const bk=ee({conv2DBackpropInput_:O8});function F8(n,e,t,r,s,a){const o=U(n,"x","conv2dTranspose"),i=U(e,"filter","conv2dTranspose");return bk(t,o,i,r,s,"NHWC",a)}const Ix=ee({conv2dTranspose_:F8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M8(n,e,t,r,s="NDHWC",a=[1,1,1]){const o=U(n,"x","conv3d"),i=U(e,"filter","conv3d");let u=o,l=!1;o.rank===4&&(l=!0,u=ae(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),B(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),B(i.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${i.rank}.`),B(u.shape[4]===i.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${i.shape[3]}.`),B($r(t,a),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${a}'`),B(s==="NDHWC",()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`),B(Zl(a),()=>"Error in conv3D: Dilated rates should be larger than 0."),B(Zl(t),()=>"Error in conv3D: Strides should be larger than 0.");const c={x:u,filter:i},d={strides:t,pad:r,dataFormat:s,dilations:a},p=Q.runKernel(Em,c,d);return l?ae(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const xk=ee({conv3d_:M8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L8(n,e,t,r,s){B(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,o=e,i=!1;e.rank===4&&(i=!0,o=ae(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),a=[1,n[0],n[1],n[2],n[3]]);const u=a[4],l=o.shape[4];B(a.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${a.length}.`),B(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),B(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),B(u===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[3]}.`),B(l===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${t.shape[4]}.`);const c={dy:o,filter:t},d={pad:s,strides:r,inputShape:a},p=Q.runKernel(T0,c,d);return i?ae(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const dM=ee({conv3DBackpropInput_:L8});function P8(n,e,t,r,s){const a=U(n,"x","conv3dTranspose"),o=U(e,"filter","conv3dTranspose");return dM(t,a,o,r,s)}const wk=ee({conv3dTranspose_:P8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B8(n){const t={x:U(n,"x","cos","float32")};return Q.runKernel(gd,t)}const Cg=ee({cos_:B8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z8(n){const t={x:U(n,"x","cosh","float32")};return Q.runKernel(vd,t)}const Ex=ee({cosh_:z8});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V8(n,e=0,t=!1,r=!1){const a={x:U(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:r};return Q.runKernel(I0,a,o)}const Qp=ee({cumprod_:V8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U8(n,e=0,t=!1,r=!1){const a={x:U(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:r};return Q.runKernel(_m,a,o)}const _x=ee({cumsum_:U8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W8(n,e,t,r=!1){const s=U(n,"x","denseBincount"),a=U(e,"weights","denseBincount");B(s.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`),B(s.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`),B(t>=0,()=>`size must be non-negative, but got ${t}.`),B(a.size===s.size||a.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${a.shape}.`);const o={x:s,weights:a},i={size:t,binaryOutput:r};return Q.runKernel(_0,o,i)}const Sb=ee({denseBincount_:W8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G8(n,e,t="NHWC"){const r=U(n,"x","depthToSpace","float32"),s=t==="NHWC"?r.shape[1]:r.shape[2],a=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];B(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),B(s*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${e}  for depthToSpace with input shape
    ${r.shape}`),B(a*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${e} for depthToSpace with input shape
        ${r.shape}`),B(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${r.shape}`);const i={x:r},u={blockSize:e,dataFormat:t};return Q.runKernel(R0,i,u)}const Sk=ee({depthToSpace_:G8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H8(n,e,t,r,s="NHWC",a=[1,1],o){const i=U(n,"x","depthwiseConv2d","float32"),u=U(e,"filter","depthwiseConv2d","float32");let l=i,c=!1;i.rank===3&&(c=!0,l=ae(i,[1,i.shape[0],i.shape[1],i.shape[2]])),B(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),B(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);const d=s==="NHWC"?l.shape[3]:l.shape[1];B(d===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${u.shape[2]}.`),us("depthwiseConv2d",r,o);const p={x:l,filter:u},m={strides:t,pad:r,dataFormat:s,dilations:a,dimRoundingMode:o},v=Q.runKernel(Rm,p,m);return c?ae(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const nf=ee({depthwiseConv2d_:H8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j8(n){const t={x:U(n,"x","diag")};return Q.runKernel($0,t)}const fM=ee({diag_:j8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q8(n,e,t,r,s=[1,1],a="NHWC"){const o=U(n,"x","dilation2d"),i=U(e,"filter","dilation2d");B(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),B(i.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${i.rank}.`),B(a==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${a}`);let u=o,l=!1;o.rank===3&&(u=ae(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0),B(u.shape[3]===i.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${i.shape[2]}`);const c={x:u,filter:i},d={strides:t,pad:r,dilations:s},p=Q.runKernel(Am,c,d);return l?ae(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Ck=ee({dilation2d_:q8});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ql(n,e){const t=n.length,r=[];for(let s=0;s<t;s++){const a=t-1-s,o=n[a]||1;(e[e.length-1-s]||1)>1&&o===1&&r.unshift(a)}return r}function jn(n,e){const t=[];for(let r=0;r<e.length;r++){const s=n[n.length-r-1],a=e.length-r-1,o=e[a];(s==null||s===1&&o>1)&&t.unshift(a)}return t}function mt(n,e){const t=Math.max(n.length,e.length),r=new Array(t);for(let s=0;s<t;s++){let a=n[n.length-s-1];a==null&&(a=1);let o=e[e.length-s-1];if(o==null&&(o=1),a===1)r[t-s-1]=o;else if(o===1)r[t-s-1]=a;else if(a!==o){const i=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(i)}else r[t-s-1]=a}return r}const K8=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:mt,getBroadcastDims:Ql,getReductionAxes:jn},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X8(n,e){let t=U(n,"a","equal","string_or_numeric"),r=U(e,"b","equal","string_or_numeric");[t,r]=Sn(t,r),mt(t.shape,r.shape);const s={a:t,b:r};return Q.runKernel(Dm,s)}const Aa=ee({equal_:X8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y8(n,e,t){const r=U(e,"a","where"),s=U(t,"b","where"),a=U(n,"condition","where","bool"),o=mt(mt(a.shape,r.shape),s.shape),i=Ul(a,o),u=Ul(r,o),l=Ul(s,o),c={condition:i,t:u,e:l};return Q.runKernel(ug,c)}const Er=ee({where_:Y8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z8(n){const t={x:U(n,"x","zerosLike")};return Q.runKernel(vg,t)}const Lt=ee({zerosLike_:Z8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q8(n,e){let t=U(n,"a","div"),r=U(e,"b","div");[t,r]=Sn(t,r);const s=Qe(t,r),a=Lt(s),o=Aa(r,a);return Er(o,a,s)}const Nk=ee({divNoNan_:Q8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J8(n,e){const t=U(n,"t1","dot"),r=U(e,"t2","dot");B((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${r.rank}.`);const s=t.rank===1?t.size:t.shape[1],a=r.rank===1?r.size:r.shape[0];if(B(s===a,()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${a}.`),t.rank===1&&r.rank===1){const o=ae(t,[1,-1]),i=ae(r,[-1,1]),u=St(o,i);return ae(u,[])}else if(t.rank===1&&r.rank===2){const o=ae(t,[1,-1]),i=ae(r,[r.shape[0],r.shape[1]]),u=St(o,i);return ae(u,[u.size])}else if(t.rank===2&&r.rank===1){const o=ae(r,[-1,1]),i=St(t,o);return ae(i,[i.size])}else{const o=ae(r,[r.shape[0],r.shape[1]]);return St(t,o)}}const kk=ee({dot_:J8});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eK(n,...e){const t=e.map((s,a)=>U(s,`tensors${a}`,"einsum")),r={equation:n};return Q.runKernel(F0,t,r)}const Rl=ee({einsum_:eK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tK(n){const t={x:U(n,"x","elu","float32")};return Q.runKernel(bd,t)}const rf=ee({elu_:tK});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nK(n,e){const t=U(n,"x","ensureShape","string_or_numeric");if(!SF(t.shape,e))throw new Error(`EnsureShape: Shape of tensor ${t.shape} is not compatible with expected shape ${e}`);return n}const pM=ee({ensureShape_:nK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rK(n){let e=U(n,"x","erf");B(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Fe(e,"float32"));const t={x:e};return Q.runKernel(xd,t)}const Rx=ee({erf_:rK});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tk(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function mM(n,e,t){const r=n.length+e.length,s=[];let a=0,o=0;for(let i=0;i<r;i++)t.indexOf(i)===-1?s.push(n[a++]):s.push(e[o++]);return s}function yr(n,e){const t=[],r=n.length;for(let a=0;a<r;a++)e.indexOf(a)===-1&&t.push(n[a]);const s=e.map(a=>n[a]);return[t,s]}function Fn(n,e){const t=e.map(r=>1);return mM(n,t,e)}function Or(n,e,t){B(Tk(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function Cn(n,e){if(Tk(n,e))return null;const t=[];for(let r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(r=>t.push(r)),t}function Gu(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function Mn(n,e){const t=[];for(let r=e-n;r<e;++r)t.push(r);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sK(n,e=null,t=!1){const s={x:U(n,"x","max")},a={reductionIndices:e,keepDims:t};return Q.runKernel(Gm,s,a)}const ia=ee({max_:sK});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aK(n,e=null,t=!1){const s={x:U(n,"x","min")},a={axis:e,keepDims:t};return Q.runKernel(Km,s,a)}const Uh=ee({min_:aK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oK(n,e){let t=U(n,"base","pow"),r=U(e,"exp","pow");[t,r]=Sn(t,r);const s={a:t,b:r};return Q.runKernel(Md,s)}const Fo=ee({pow_:oK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function st(n,e){if((lr(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&lr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Uu(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iK(n){const t={x:U(n,"x","sqrt","float32")};return Q.runKernel(Kd,t)}const pr=ee({sqrt_:iK});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uK(n){const e=U(n,"x","square"),t={};return Q.runKernel("Square",{x:e},t)}const Qt=ee({square_:uK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lK(n,e=null,t=!1){let r=U(n,"x","sum");r.dtype==="bool"&&(r=Fe(r,"int32"));const s={x:r},a={axis:e,keepDims:t};return Q.runKernel(cg,s,a)}const We=ee({sum_:lK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cK(n,e="euclidean",t=null,r=!1){n=U(n,"x","norm");const s=gM(n,e,t);let a=s.shape;if(r){const o=Nt(t,n.shape);a=Fn(s.shape,o)}return ae(s,a)}function gM(n,e,t=null){if(n.rank===0)return Un(n);if(n.rank!==1&&t===null)return gM(ae(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return We(Un(n),t);if(e===1/0)return ia(Un(n),t);if(e===-1/0)return Uh(Un(n),t);if(e==="euclidean"||e===2)return pr(We(Fo(Un(n),st(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return ia(We(Un(n),t[0]),t[1]-1);if(e===1/0)return ia(We(Un(n),t[1]),t[0]);if(e===-1/0)return Uh(We(Un(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return pr(We(Qt(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const sf=ee({norm_:cK});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hK(n,e=null,t=!1){return sf(n,"euclidean",e,t)}const Ik=ee({euclideanNorm_:hK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dK(n){const t={x:U(n,"x","exp")};return Q.runKernel(wd,t)}const ys=ee({exp_:dK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fK(n,e=0){const t=U(n,"x","expandDims","string_or_numeric");B(e<=t.rank,()=>"Axis must be <= rank of the tensor");const r={input:t},s={dim:e};return Q.runKernel($m,r,s)}const Wr=ee({expandDims_:fK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pK(n){const t={x:U(n,"x","expm1")};return Q.runKernel(Sd,t)}const Ek=ee({expm1_:pK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mK(n,e){const t=U(n,"x","tile","string_or_numeric");B(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const r={x:t},s={reps:e};return Q.runKernel(Jd,r,s)}const ta=ee({tile_:mK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gK(n,e,t,r="float32"){e==null&&(e=n);const s=yt([n,e],r),a=n<=e?n:e;for(let i=0;i<a;++i)s.set(1,i,i);const o=ae(s.toTensor(),[n,e]);if(t==null)return o;if(t.length===1)return ta(Wr(o,0),[t[0],1,1]);if(t.length===2)return ta(Wr(Wr(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return ta(Wr(Wr(Wr(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const Ax=ee({eye_:gK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vK(n){const t={x:U(n,"x","floor","float32")};return Q.runKernel(Cd,t)}const af=ee({floor_:vK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yK(n,e,t=0,r=0){const s=U(n,"x","gather"),a=U(e,"indices","gather","int32"),o={x:s,indices:a},i={axis:t,batchDims:r};return Q.runKernel(Fm,o,i)}const of=ee({gather_:yK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bK(n,e){let t=U(n,"a","greater","string_or_numeric"),r=U(e,"b","greater","string_or_numeric");[t,r]=Sn(t,r),mt(t.shape,r.shape);const s={a:t,b:r};return Q.runKernel(Mm,s)}const Ss=ee({greater_:bK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xK(n,e){let t=U(n,"a","greaterEqual","string_or_numeric"),r=U(e,"b","greaterEqual","string_or_numeric");[t,r]=Sn(t,r),mt(t.shape,r.shape);const s={a:t,b:r};return Q.runKernel(kd,s)}const Ei=ee({greaterEqual_:xK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wK(n){const t={input:U(n,"input","imag")};return Q.runKernel(U0,t)}const Ng=ee({imag_:wK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SK(n){const t={x:U(n,"x","isFinite")};return Q.runKernel(Id,t)}const _k=ee({isFinite_:SK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CK(n){const t={x:U(n,"x","isInf")};return Q.runKernel(Ed,t)}const Rk=ee({isInf_:CK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NK(n){const t={x:U(n,"x","isNaN")};return Q.runKernel(_d,t)}const Ak=ee({isNaN_:NK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kK(n,e=.2){const r={x:U(n,"x","leakyRelu")},s={alpha:e};return Q.runKernel(Lm,r,s)}const kg=ee({leakyRelu_:kK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TK(n,e){let t=U(n,"a","less","string_or_numeric"),r=U(e,"b","less","string_or_numeric");[t,r]=Sn(t,r),mt(t.shape,r.shape);const s={a:t,b:r};return Q.runKernel(Pm,s)}const Wh=ee({less_:TK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IK(n,e){let t=U(n,"a","lessEqual","string_or_numeric"),r=U(e,"b","lessEqual","string_or_numeric");[t,r]=Sn(t,r),mt(t.shape,r.shape);const s={a:t,b:r};return Q.runKernel(Bm,s)}const Hu=ee({lessEqual_:IK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vM(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");const r={start:n,stop:e,num:t};return Q.runKernel(W0,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EK(n,e=5,t=1,r=1,s=.5){const a=U(n,"x","localResponseNormalization");B(a.rank===4||a.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${a.rank}.`),B(jl(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=a,i=!1;a.rank===3&&(i=!0,o=ae(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const u={x:o},l={depthRadius:e,bias:t,alpha:r,beta:s},c=Q.runKernel(Wm,u,l);return i?ae(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const Dk=ee({localResponseNormalization_:EK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _K(n){const t={x:U(n,"x","log","float32")};return Q.runKernel(Rd,t)}const Fs=ee({log_:_K});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RK(n){const t={x:U(n,"x","log1p")};return Q.runKernel(Ad,t)}const Tg=ee({log1p_:RK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AK(n){return B(Eu(n),()=>"The f passed in grad(f) must be a function"),(e,t)=>{const r=U(e,"x","tf.grad","string_or_numeric"),s=t!=null?U(t,"dy","tf.grad"):null;return Q.tidy(()=>{const{value:a,grads:o}=Q.gradients(()=>n(r),[r],s);return s!=null&&Dr(a.shape,s.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Dx(o),o[0]})}}function DK(n){return B(Eu(n),()=>"The f passed in grads(f) must be a function"),(e,t)=>{B(Array.isArray(e),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const r=Kp(e,"args","tf.grads","string_or_numeric"),s=t!=null?U(t,"dy","tf.grads"):null;return Q.tidy(()=>{const{value:a,grads:o}=Q.gradients(()=>n(...r),r,s);return s!=null&&Dr(a.shape,s.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Dx(o),o})}}function $K(n){return B(Eu(n),()=>"The f passed in valueAndGrad(f) must be a function"),(e,t)=>{B(e instanceof Gt,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),B(t==null||t instanceof Gt,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:r,value:s}=Q.gradients(()=>n(e),[e],t);return Dx(r),{grad:r[0],value:s}}}function OK(n){return B(Eu(n),()=>"The f passed in valueAndGrads(f) must be a function"),(e,t)=>{B(Array.isArray(e)&&e.every(s=>s instanceof Gt),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),B(t==null||t instanceof Gt,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const r=Q.gradients(()=>n(...e),e,t);return t!=null&&Dr(r.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Dx(r.grads),r}}function yM(n,e){B(Eu(n),()=>"The f passed in variableGrads(f) must be a function"),B(e==null||Array.isArray(e)&&e.every(l=>l instanceof qp),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const l in Q.registeredVariables)e.push(Q.registeredVariables[l])}const r=t?e.filter(l=>!l.trainable):null,s=e.length;e=e.filter(l=>l.trainable),B(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`);const a=!0,{value:o,grads:i}=Q.gradients(n,e,null,a);B(i.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),B(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const u={};return e.forEach((l,c)=>{i[c]!=null&&(u[l.name]=i[c])}),r!=null&&r.forEach(l=>u[l.name]=null),{value:o,grads:u}}function Mo(n){return Q.customGrad(n)}function Dx(n){if(n.filter(t=>t==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FK(n){const t={x:U(n,"x","neg")};return Q.runKernel(Ym,t)}const ln=ee({neg_:FK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MK(n){const t={x:U(n,"x","softplus")};return Q.runKernel(qd,t)}const mc=ee({softplus_:MK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LK(n){const e=U(n,"x","logSigmoid");return Mo(r=>({value:ln(mc(ln(r))),gradFunc:o=>re(o,Ka(ln(r)))}))(e)}const $k=ee({logSigmoid_:LK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PK(n,e){let t=U(n,"a","sub"),r=U(e,"b","sub");[t,r]=Sn(t,r);const s={a:t,b:r};return Q.runKernel(Yd,s)}const ze=ee({sub_:PK});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BK(n,e=-1){const t=U(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return Mo((s,a)=>{const i=ia(s,e,!0),u=ze(s,i),l=ze(Fe(u,"float32"),Fs(We(ys(u),e,!0)));return a([l]),{value:l,gradFunc:(d,p)=>{const[m]=p,v=!0,b=ys(m);return ze(d,re(We(d,e,v),b))}}})(t)}const $x=ee({logSoftmax_:BK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zK(n,e=null,t=!1){const r=U(n,"x","logSumExp"),s=Nt(e,r.shape),a=ia(r,s,!0),o=ze(r,a),i=ys(o),u=We(i,s),l=Fs(u),c=Re(ae(a,l.shape),l);if(t){const d=Fn(c.shape,s);return ae(c,d)}return c}const Ig=ee({logSumExp_:zK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VK(n,e){const t=U(n,"a","logicalAnd","bool"),r=U(e,"b","logicalAnd","bool");mt(t.shape,r.shape);const s={a:t,b:r};return Q.runKernel(zm,s)}const Za=ee({logicalAnd_:VK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UK(n){const t={x:U(n,"x","logicalNot","bool")};return Q.runKernel(Vm,t)}const Eg=ee({logicalNot_:UK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WK(n,e){const t=U(n,"a","logicalOr","bool"),r=U(e,"b","logicalOr","bool");mt(t.shape,r.shape);const s={a:t,b:r};return Q.runKernel(Um,s)}const Ox=ee({logicalOr_:WK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GK(n,e){const t=U(n,"a","logicalXor","bool"),r=U(e,"b","logicalXor","bool");return mt(t.shape,r.shape),Za(Ox(n,e),Eg(Za(n,e)))}const Ok=ee({logicalXor_:GK});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ty=2147483648;function HK(n,e,t="left"){const r=U(n,"sortedSequence","searchSorted"),s=U(e,"values","searchSorted"),a=r.shape[r.shape.length-1],o=s.shape[s.shape.length-1],i=ae(r,[-1,a]),u=ae(s,[-1,o]);if(i.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(i.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(xe(u.shape)>=Ty)throw new Error(`values tensor size must less than ${Ty}`);if(i.shape[1]>=Ty)throw new Error(`trailing dim_size must less than ${Ty} for int32 output type, was ${i.shape[1]}`);const l={sortedSequence:i,values:u},c={side:t};return Q.runKernel(ix,l,c)}const Fx=ee({searchSorted_:HK});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bM(n,e){return Fx(n,e,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jK(n,e,t,r,s){const a=U(n,"x","maxPool"),o=1;let i=a,u=!1;a.rank===3&&(u=!0,i=ae(a,[1,a.shape[0],a.shape[1],a.shape[2]])),B(i.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${i.rank}.`),B($r(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),us("maxPool",r,s);const l={x:i},c={filterSize:e,strides:t,pad:r,dimRoundingMode:s},d=Q.runKernel(Hm,l,c);return u?ae(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const _g=ee({maxPool_:jK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qK(n,e=[1,1,1],t,r,s,a="NDHWC"){const o=U(n,"x","maxPool3d");let i=o,u=!1;o.rank===4&&(u=!0,i=ae(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),B(i.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${i.rank}.`),B(a==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${a}`),us("maxPool3d",r,s);const l={x:i},c={filterSize:e,strides:t,pad:r,dimRoundingMode:s,dataFormat:a},d=Q.runKernel(jm,l,c);return u?ae(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const Fk=ee({maxPool3d_:qK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KK(n,e,t,r,s=!1){const o={x:U(n,"x","maxPoolWithArgmax")},i={filterSize:e,strides:t,pad:r,includeBatchInIndex:s},u=Q.runKernel(q0,o,i);return{result:u[0],indexes:u[1]}}const xM=ee({maxPoolWithArgmax_:KK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XK(n,e){let t=U(n,"a","maximum"),r=U(e,"b","maximum");[t,r]=Sn(t,r),t.dtype==="bool"&&(t=Fe(t,"int32"),r=Fe(r,"int32")),mt(t.shape,r.shape);const s={a:t,b:r};return Q.runKernel(Dd,s)}const zo=ee({maximum_:XK});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YK(n,e=null,t=!1){const s={x:U(n,"x","mean")},a={axis:e,keepDims:t};return Q.runKernel(qm,s,a)}const xn=ee({mean_:YK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wn(n,e="float32"){if(Vs(n),e==="complex64"){const r=Wn(n,"float32"),s=Wn(n,"float32");return xi(r,s)}const t=Rr(xe(n),e);return Q.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ds(n,e="float32"){if(Vs(n),e==="complex64"){const r=ds(n,"float32"),s=Wn(n,"float32");return xi(r,s)}const t=g0(xe(n),e);return Q.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wM(n,e,{indexing:t="xy"}={}){if(t!=="xy"&&t!=="ij")throw new TypeError(`${t} is not a valid third argument to meshgrid`);if(n===void 0)return[];let r=U(n,"x","meshgrid",n instanceof Gt?n.dtype:"float32");if(e===void 0)return[r];let s=U(e,"y","meshgrid",e instanceof Gt?e.dtype:"float32");const a=xe(r.shape),o=xe(s.shape);return t==="xy"?(r=ae(r,[1,-1]),s=ae(s,[-1,1]),[St(ds([o,1],r.dtype),r),St(s,ds([1,a],s.dtype))]):(r=ae(r,[-1,1]),s=ae(s,[1,-1]),[St(r,ds([1,o],r.dtype)),St(ds([a,1],s.dtype),s)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZK(n,e){let t=U(n,"a","minimum"),r=U(e,"b","minimum");[t,r]=Sn(t,r),t.dtype==="bool"&&(t=Fe(t,"int32"),r=Fe(r,"int32")),mt(t.shape,r.shape);const s={a:t,b:r};return Q.runKernel($d,s)}const $u=ee({minimum_:ZK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QK(n,e,t){B(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const r=U(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");B(e.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`);const s=t==="reflect"?1:0;for(let i=0;i<r.rank;i++)B(e[i].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),B(e[i][0]>=0&&e[i][0]<=r.shape[i]-s&&e[i][1]>=0&&e[i][1]<=r.shape[i]-s,()=>`Padding in dimension ${i} cannot be greater than or equal to ${r.shape[i]-s} or less than 0 for input of shape ${r.shape}`);const a={paddings:e,mode:t},o={x:r};return Q.runKernel(Xm,o,a)}const Mk=ee({mirrorPad_:QK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JK(n,e){let t=U(n,"a","mod"),r=U(e,"b","mod");[t,r]=Sn(t,r);const s={a:t,b:r};return Q.runKernel(Od,s)}const Lk=ee({mod_:JK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eX(n,e=null,t=!1){n=U(n,"x","moments");const r=Nt(e,n.shape),s=xn(n,r,t);let a=s.shape;t||(a=Fn(s.shape,r));const o=Qt(ze(Fe(n,"float32"),ae(s,a))),i=xn(o,r,t);return{mean:s,variance:i}}const Rg=ee({moments_:eX});function tX(n,e,t,r){const s=U(e,"data","multiRNNCell"),a=Kp(t,"c","multiRNNCell"),o=Kp(r,"h","multiRNNCell");let i=s;const u=[];for(let d=0;d<n.length;d++){const p=n[d](i,a[d],o[d]);u.push(p[0]),u.push(p[1]),i=p[1]}const l=[],c=[];for(let d=0;d<u.length;d+=2)l.push(u[d]),c.push(u[d+1]);return[l,c]}const SM=ee({multiRNNCell_:tX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nX(n,e,t,r=!1){const s=U(n,"logits","multinomial"),a=s.size,o=s.rank;if(a<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${a}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);t=t||Math.random();const u={logits:o===1?ae(s,[1,-1]):s},l={numSamples:e,seed:t,normalized:r},c=Q.runKernel(K0,u,l);return o===1?ae(c,[c.size]):c}const CM=ee({multinomial_:nX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rX(n,e){let t=U(n,"a","notEqual","string_or_numeric"),r=U(e,"b","notEqual","string_or_numeric");[t,r]=Sn(t,r),mt(t.shape,r.shape);const s={a:t,b:r};return Q.runKernel(Zm,s)}const Jl=ee({notEqual_:rX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sX(n,e,t=1,r=0,s="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:U(n,"indices","oneHot","int32")},i={dtype:s,depth:e,onValue:t,offValue:r};return Q.runKernel(Jm,o,i)}const Gh=ee({oneHot_:sX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aX(n){const t={x:U(n,"x","onesLike")};return Q.runKernel(Qm,t)}const Ms=ee({onesLike_:aX});function oX(n,e){const t=U(n,"v1","outerProduct"),r=U(e,"v2","outerProduct");B(t.rank===1&&r.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${t.rank} and ${r.rank}.`);const s=ae(t,[-1,1]),a=ae(r,[1,-1]);return St(s,a)}const NM=ee({outerProduct_:oX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iX(n,e,t=0){const r=U(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:t},a={x:r};return Q.runKernel(tg,a,s)}const _i=ee({pad_:iX});function uX(n,e,t=0){return B(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),_i(n,[e],t)}const kM=ee({pad1d_:uX});function lX(n,e,t=0){return B(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),_i(n,e,t)}const TM=ee({pad2d_:lX});function cX(n,e,t=0){return B(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),_i(n,e,t)}const IM=ee({pad3d_:cX});function hX(n,e,t=0){return B(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),_i(n,e,t)}const EM=ee({pad4d_:hX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dX(n,e,t){const r=U(n,"x","spaceToBatchND");B(r.rank>=1+e.length,()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`),B(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),B(r.shape.reduce((o,i,u)=>u>0&&u<=e.length?o&&(i+t[u-1][0]+t[u-1][1])%e[u-1]===0:o,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const s={x:r},a={blockShape:e,paddings:t};return Q.runKernel(hg,s,a)}const Ag=ee({spaceToBatchND_:dX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fX(n,e,t,r,s,a,o){s==null&&(s=[1,1]),a==null&&(a=1),r===0&&(r="valid");const i=U(n,"x","maxPool");let u=i,l=!1;i.rank===3&&(l=!0,u=ae(i,[1,i.shape[0],i.shape[1],i.shape[2]])),B($r(a,s),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${a} and dilations '${s}'`);const c=Da(u.shape,e,a,s,r),d=[c.dilationHeight,c.dilationWidth];let p;r==="same"?p=mX([c.filterHeight,c.filterWidth],d):p=[[0,0],[0,0]];const m=d[0]===1&&d[1]===1,[v,b]=pX([c.inHeight,c.inWidth],d,p),y=m?r:"valid",w=m?u:Ag(u,d,v),N=(t==="avg"?()=>wg(w,e,a,y,o):()=>_g(w,e,a,y,o))(),C=m?N:Sg(N,d,b);return l?ae(C,[C.shape[1],C.shape[2],C.shape[3]]):C}function pX(n,e,t){const r=t.map(c=>c[0]),s=t.map(c=>c[1]),a=n.concat(r,s),o=e.map((c,d)=>(c-a[d]%c)%c),i=s.map((c,d)=>c+o[d]),u=e.map((c,d)=>[r[d],i[d]]),l=e.map((c,d)=>[0,o[d]]);return[u,l]}function mX(n,e){const r=n.map((o,i)=>o+(o-1)*(e[i]-1)).map(o=>o-1),s=r.map(o=>Math.floor(o/2)),a=r.map((o,i)=>o-s[i]);return r.map((o,i)=>[s[i],a[i]])}const Pk=ee({pool_:fX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gX(n,e){const t=U(n,"x","prelu"),r=U(e,"alpha","prelu"),s={x:t,alpha:r};return Q.runKernel(ng,s)}const Dg=ee({prelu_:gX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vX(n,e=null,t=!1){let r=U(n,"x","prod");r.dtype==="bool"&&(r=Fe(r,"int32"));const s={x:r},a={axis:e,keepDims:t};return Q.runKernel(rg,s,a)}const Bk=ee({prod_:vX});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yX(n,e,t,r){const s=n.map((c,d)=>U(c,`tensors${d}`,"raggedGather","int32")),a=U(e,"paramsDenseValues","raggedGather"),o=U(t,"indices","raggedGather","int32"),i={paramsNestedSplits:s,paramsDenseValues:a,indices:o},u={outputRaggedRank:r},l=Q.runKernel(Q0,i,u);return{outputNestedSplits:l.slice(0,l.length-1),outputDenseValues:l[l.length-1]}}const _M=ee({raggedGather_:yX});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bX(n,e,t){const r=U(n,"starts","raggedRange"),s=U(e,"limits","raggedRange",r.dtype),a=U(t,"deltas","raggedRange",r.dtype),o={starts:r,limits:s,deltas:a},i=Q.runKernel(J0,o);return{rtNestedSplits:i[0],rtDenseValues:i[1]}}const RM=ee({raggedRange_:bX});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xX(n,e,t,r,s){const a=U(n,"shape","raggedTensorToTensor","int32"),o=U(e,"values","raggedTensorToTensor"),i=U(t,"defaultValue","raggedTensorToTensor",o.dtype),u=r.map((d,p)=>U(d,`tensors${p}`,"raggedTensorToTensor","int32")),l={shape:a,values:o,defaultValue:i,rowPartitionTensors:u},c={rowPartitionTypes:s};return Q.runKernel(ex,l,c)}const AM=ee({raggedTensorToTensor_:xX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wX(n,e,t){Vs(n);const r=xe(n);let s=null;if(t==null||t==="float32")s=new Float32Array(r);else if(t==="int32")s=new Int32Array(r);else if(t==="bool")s=new Uint8Array(r);else throw new Error(`Unknown data type ${t}`);for(let a=0;a<r;a++)s[a]=e();return Q.makeTensor(s,n,t)}const DM=ee({rand_:wX});var nb={exports:{}},SX=nb.exports,QD;function CX(){return QD||(QD=1,function(n){(function(e,t,r){function s(u){var l=this,c=i();l.next=function(){var d=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=d-(l.c=d|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function a(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var c=new s(u),d=l&&l.state,p=c.next;return p.int32=function(){return c.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,d&&(typeof d=="object"&&a(d,c),p.state=function(){return a(c,{})}),p}function i(){var u=4022871197,l=function(c){c=String(c);for(var d=0;d<c.length;d++){u+=c.charCodeAt(d);var p=.02519603282416938*u;u=p>>>0,p-=u,p*=u,u=p>>>0,p-=u,u+=p*4294967296}return(u>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=o:this.alea=o})(SX,n)}(nb)),nb.exports}var rb={exports:{}},NX=rb.exports,JD;function kX(){return JD||(JD=1,function(n){(function(e,t,r){function s(i){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},i===(i|0)?u.x=i:l+=i;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function a(i,u){return u.x=i.x,u.y=i.y,u.z=i.z,u.w=i.w,u}function o(i,u){var l=new s(i),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var p=l.next()>>>11,m=(l.next()>>>0)/4294967296,v=(p+m)/(1<<21);while(v===0);return v},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&a(c,l),d.state=function(){return a(l,{})}),d}t&&t.exports?t.exports=o:this.xor128=o})(NX,n)}(rb)),rb.exports}var sb={exports:{}},TX=sb.exports,e$;function IX(){return e$||(e$=1,function(n){(function(e,t,r){function s(i){var u=this,l="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(d^d<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,i===(i|0)?u.x=i:l+=i;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function a(i,u){return u.x=i.x,u.y=i.y,u.z=i.z,u.w=i.w,u.v=i.v,u.d=i.d,u}function o(i,u){var l=new s(i),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var p=l.next()>>>11,m=(l.next()>>>0)/4294967296,v=(p+m)/(1<<21);while(v===0);return v},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&a(c,l),d.state=function(){return a(l,{})}),d}t&&t.exports?t.exports=o:this.xorwow=o})(TX,n)}(sb)),sb.exports}var ab={exports:{}},EX=ab.exports,t$;function _X(){return t$||(t$=1,function(n){(function(e,t,r){function s(i){var u=this;u.next=function(){var c=u.x,d=u.i,p,m;return p=c[d],p^=p>>>7,m=p^p<<24,p=c[d+1&7],m^=p^p>>>10,p=c[d+3&7],m^=p^p>>>3,p=c[d+4&7],m^=p^p<<7,p=c[d+7&7],p=p^p<<13,m^=p^p<<9,c[d]=m,u.i=d+1&7,m};function l(c,d){var p,m=[];if(d===(d|0))m[0]=d;else for(d=""+d,p=0;p<d.length;++p)m[p&7]=m[p&7]<<15^d.charCodeAt(p)+m[p+1&7]<<13;for(;m.length<8;)m.push(0);for(p=0;p<8&&m[p]===0;++p);for(p==8?m[7]=-1:m[p],c.x=m,c.i=0,p=256;p>0;--p)c.next()}l(u,i)}function a(i,u){return u.x=i.x.slice(),u.i=i.i,u}function o(i,u){i==null&&(i=+new Date);var l=new s(i),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var p=l.next()>>>11,m=(l.next()>>>0)/4294967296,v=(p+m)/(1<<21);while(v===0);return v},d.int32=l.next,d.quick=d,c&&(c.x&&a(c,l),d.state=function(){return a(l,{})}),d}t&&t.exports?t.exports=o:this.xorshift7=o})(EX,n)}(ab)),ab.exports}var ob={exports:{}},RX=ob.exports,n$;function AX(){return n$||(n$=1,function(n){(function(e,t,r){function s(i){var u=this;u.next=function(){var c=u.w,d=u.X,p=u.i,m,v;return u.w=c=c+1640531527|0,v=d[p+34&127],m=d[p=p+1&127],v^=v<<13,m^=m<<17,v^=v>>>15,m^=m>>>12,v=d[p]=v^m,u.i=p,v+(c^c>>>16)|0};function l(c,d){var p,m,v,b,y,w=[],S=128;for(d===(d|0)?(m=d,d=null):(d=d+"\0",m=0,S=Math.max(S,d.length)),v=0,b=-32;b<S;++b)d&&(m^=d.charCodeAt((b+32)%d.length)),b===0&&(y=m),m^=m<<10,m^=m>>>15,m^=m<<4,m^=m>>>13,b>=0&&(y=y+1640531527|0,p=w[b&127]^=m+y,v=p==0?v+1:0);for(v>=128&&(w[(d&&d.length||0)&127]=-1),v=127,b=4*128;b>0;--b)m=w[v+34&127],p=w[v=v+1&127],m^=m<<13,p^=p<<17,m^=m>>>15,p^=p>>>12,w[v]=m^p;c.w=y,c.X=w,c.i=v}l(u,i)}function a(i,u){return u.i=i.i,u.w=i.w,u.X=i.X.slice(),u}function o(i,u){i==null&&(i=+new Date);var l=new s(i),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var p=l.next()>>>11,m=(l.next()>>>0)/4294967296,v=(p+m)/(1<<21);while(v===0);return v},d.int32=l.next,d.quick=d,c&&(c.X&&a(c,l),d.state=function(){return a(l,{})}),d}t&&t.exports?t.exports=o:this.xor4096=o})(RX,n)}(ob)),ob.exports}var ib={exports:{}},DX=ib.exports,r$;function $X(){return r$||(r$=1,function(n){(function(e,t,r){function s(i){var u=this,l="";u.next=function(){var d=u.b,p=u.c,m=u.d,v=u.a;return d=d<<25^d>>>7^p,p=p-m|0,m=m<<24^m>>>8^v,v=v-d|0,u.b=d=d<<20^d>>>12^p,u.c=p=p-m|0,u.d=m<<16^p>>>16^v,u.a=v-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,i===Math.floor(i)?(u.a=i/4294967296|0,u.b=i|0):l+=i;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function a(i,u){return u.a=i.a,u.b=i.b,u.c=i.c,u.d=i.d,u}function o(i,u){var l=new s(i),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var p=l.next()>>>11,m=(l.next()>>>0)/4294967296,v=(p+m)/(1<<21);while(v===0);return v},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&a(c,l),d.state=function(){return a(l,{})}),d}t&&t.exports?t.exports=o:this.tychei=o})(DX,n)}(ib)),ib.exports}var ub={exports:{}};const OX={},FX=Object.freeze(Object.defineProperty({__proto__:null,default:OX},Symbol.toStringTag,{value:"Module"})),MX=RN(FX);var LX=ub.exports,s$;function PX(){return s$||(s$=1,function(n){(function(e,t,r){var s=256,a=6,o=52,i="random",u=r.pow(s,a),l=r.pow(2,o),c=l*2,d=s-1,p;function m(C,T,E){var $=[];T=T==!0?{entropy:!0}:T||{};var _=w(y(T.entropy?[C,N(t)]:C??S(),3),$),R=new v($),D=function(){for(var A=R.g(a),M=u,H=0;A<l;)A=(A+H)*s,M*=s,H=R.g(1);for(;A>=c;)A/=2,M/=2,H>>>=1;return(A+H)/M};return D.int32=function(){return R.g(4)|0},D.quick=function(){return R.g(4)/4294967296},D.double=D,w(N(R.S),t),(T.pass||E||function(A,M,H,j){return j&&(j.S&&b(j,R),A.state=function(){return b(R,{})}),H?(r[i]=A,M):A})(D,_,"global"in T?T.global:this==r,T.state)}function v(C){var T,E=C.length,$=this,_=0,R=$.i=$.j=0,D=$.S=[];for(E||(C=[E++]);_<s;)D[_]=_++;for(_=0;_<s;_++)D[_]=D[R=d&R+C[_%E]+(T=D[_])],D[R]=T;($.g=function(A){for(var M,H=0,j=$.i,G=$.j,P=$.S;A--;)M=P[j=d&j+1],H=H*s+P[d&(P[j]=P[G=d&G+M])+(P[G]=M)];return $.i=j,$.j=G,H})(s)}function b(C,T){return T.i=C.i,T.j=C.j,T.S=C.S.slice(),T}function y(C,T){var E=[],$=typeof C,_;if(T&&$=="object")for(_ in C)try{E.push(y(C[_],T-1))}catch{}return E.length?E:$=="string"?C:C+"\0"}function w(C,T){for(var E=C+"",$,_=0;_<E.length;)T[d&_]=d&($^=T[d&_]*19)+E.charCodeAt(_++);return N(T)}function S(){try{var C;return p&&(C=p.randomBytes)?C=C(s):(C=new Uint8Array(s),(e.crypto||e.msCrypto).getRandomValues(C)),N(C)}catch{var T=e.navigator,E=T&&T.plugins;return[+new Date,e,E,e.screen,N(t)]}}function N(C){return String.fromCharCode.apply(0,C)}if(w(r.random(),t),n.exports){n.exports=m;try{p=MX}catch{}}else r["seed"+i]=m})(typeof self<"u"?self:LX,[],Math)}(ub)),ub.exports}var vS,a$;function BX(){if(a$)return vS;a$=1;var n=CX(),e=kX(),t=IX(),r=_X(),s=AX(),a=$X(),o=PX();return o.alea=n,o.xor128=e,o.xorwow=t,o.xorshift7=r,o.xor4096=s,o.tychei=a,vS=o,vS}var Mx=BX();/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zX=.001,$M=.1;function VX(n,e,t){return t==null&&(t=zk()),EC(n,e,(r,s)=>Vk(r,s,t))}function zk(){return Q.backend.floatPrecision()===32?zX:$M}function EC(n,e,t){let r=!0;if((lr(n)||lr(e))&&(r=!1),lr(n)&&lr(e)&&(r=!0),r){const o=n.constructor.name,i=e.constructor.name;if(o!==i)throw new Error(`Arrays are of different type. Actual: ${o}. Expected: ${i}`)}if(Array.isArray(n)&&Array.isArray(e)){const o=Oo(n),i=Oo(e);if(!Et(o,i))throw new Error(`Arrays have different shapes. Actual: [${o}]. Expected: [${i}]`)}const s=lr(n)?n:$o(n),a=lr(e)?e:$o(e);if(s.length!==a.length)throw new Error(`Arrays have different lengths actual: ${s.length} vs expected: ${a.length}.
Actual:   ${s}.
Expected: ${a}.`);for(let o=0;o<a.length;++o){const i=s[o],u=a[o];if(!t(i,u))throw new Error(`Arrays differ: actual[${o}] = ${i}, expected[${o}] = ${u}.
Actual:   ${s}.
Expected: ${a}.`)}typeof expect<"u"&&expect().nothing()}function UX(n,e){n().then(()=>e.fail(),()=>e()),typeof expect<"u"&&expect().nothing()}function WX(n,e){const t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return So(n)||So(n[0])||So(e)||So(e[0])?EC(n,t,(r,s)=>r==s):EC(n,e,(r,s)=>Vk(r,s,0))}function GX(n,e,t){if(t==null&&(t=zk()),!Vk(n,e,t))throw new Error(`Numbers differ: actual === ${n}, expected === ${e}`);typeof expect<"u"&&expect().nothing()}function Vk(n,e,t){return!isFinite(n)&&!isFinite(e)?!0:!(isNaN(n)||isNaN(e)||Math.abs(n-e)>t)}function HX(n,e,t){for(let r=0;r<n.length;r++)if(n[r]<e||n[r]>t)throw new Error(`Value out of range:${n[r]} low: ${e}, high: ${t}`)}function jX(n,e){const t=new Float32Array(n),r=new Float32Array(e);if(t.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${t.length}`);for(let s=0;s<r.length;s++)if(t[s]!==r[s])throw new Error(`Expected ArrayBuffer value at ${s} to be ${r[s]} but got ${t[s]} instead`)}function OM(n){for(let e=0;e<n.length;e++){const t=n[e];Array.isArray(t)?OM(t):n[e]=ko(t)}return n}function qX(n){const e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(n),new Promise(t=>{e.addEventListener("loadeddata",r=>t(e)),e.load()})}async function KX(n){await n.play(),"requestVideoFrameCallback"in n&&await new Promise(e=>{n.requestVideoFrameCallback(e)})}const XX=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:$M,createVideoElement:qX,encodeStrings:OM,expectArrayBuffersEqual:jX,expectArraysClose:VX,expectArraysEqual:WX,expectNumbersClose:GX,expectPromiseToFail:UX,expectValuesInRange:HX,play:KX,testEpsilon:zk},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uk{constructor(e,t,r,s,a){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=s,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=a||Math.random();this.random=Mx.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const s=this.nextVal;return this.nextVal=NaN,s}let e,t,r=!1;for(;!r;){let s,a,o;do s=2*this.random()-1,a=2*this.random()-1,o=s*s+a*a;while(o>=1||o===0);const i=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*s*i,t=this.mean+this.stdDev*a*i,(!this.truncated||this.isValidTruncated(e))&&(r=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class YX{constructor(e,t,r,s){this.alpha=e,this.beta=1/t,this.dtype=r;const a=s||Math.random();this.randu=Mx.alea(a.toString()),this.randn=new Uk(0,1,r,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,r,s,a,o;for(;;){do s=this.randn.nextValue(),o=1+this.c*s;while(o<=0);if(o*=o*o,e=s*s,t=1-.331*e*e,r=.5*e+this.d*(1-o+Math.log(o)),a=this.randu(),a<t||Math.log(a)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}class ZX{constructor(e=0,t=1,r,s){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=r,s==null&&(s=Math.random()),typeof s=="number"&&(s=s.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=Mx.alea(s)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QX(n,e,t=1,r="float32",s){if(Vs(n),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error(`Unsupported data type ${r}`);const a=new YX(e,t,r,s),o=yt(n,r);for(let i=0;i<o.values.length;i++)o.values[i]=a.nextValue();return o.toTensor()}const FM=ee({randomGamma_:QX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JX(n,e=0,t=1,r,s){if(Vs(n),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);const a=new Uk(e,t,r,!1,s),o=yt(n,r);for(let i=0;i<o.values.length;i++)o.values[i]=a.nextValue();return o.toTensor()}const Lx=ee({randomNormal_:JX});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e7(n,e,t){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return Lx(n,0,1,e,t)}const MM=ee({randomStandardNormal_:e7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t7(n,e=0,t=1,r="float32",s){Vs(n);const a=yt(n,r),o=new ZX(e,t,null,s);for(let i=0;i<a.values.length;i++)a.values[i]=o.nextValue();return a.toTensor()}const ju=ee({randomUniform_:t7});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n7(n,e,t,r){return ju(n,e,t,"int32",r)}const LM=ee({randomUniformInt_:n7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ec(n,e,t=1,r="float32"){if(t===0)throw new Error("Cannot have a step of zero");const s={start:n,stop:e,step:t,dtype:r};return Q.runKernel(tx,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r7(n){const t={input:U(n,"input","real")};return Q.runKernel(nx,t)}const Hh=ee({real_:r7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s7(n){const t={x:U(n,"x","reciprocal")};return Q.runKernel(Ld,t)}const Wk=ee({reciprocal_:s7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a7(n){const t={x:U(n,"x","relu")};return Q.runKernel(Pd,t)}const ro=ee({relu_:a7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o7(n){const t={x:U(n,"x","relu6")};return Q.runKernel(Bd,t)}const Px=ee({relu6_:o7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i7(n,e){const r={x:U(n,"x","reverse")},s={dims:e};return Q.runKernel(ig,r,s)}const la=ee({reverse_:i7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u7(n){const e=U(n,"x","reverse");return B(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),la(e,0)}const PM=ee({reverse1d_:u7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l7(n,e){const t=U(n,"x","reverse");return B(t.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${t.rank}.`),la(t,e)}const BM=ee({reverse2d_:l7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c7(n,e){const t=U(n,"x","reverse");return B(t.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${t.rank}.`),la(t,e)}const zM=ee({reverse3d_:c7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h7(n,e){const t=U(n,"x","reverse");return B(t.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${t.rank}.`),la(t,e)}const VM=ee({reverse4d_:h7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d7(n){const t={x:U(n,"x","round")};return Q.runKernel(zd,t)}const Bx=ee({round_:d7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f7(n){const t={x:U(n,"x","rsqrt","float32")};return Q.runKernel(Vd,t)}const zx=ee({rsqrt_:f7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p7(n){const t={x:U(n,"x","selu")};return Q.runKernel(Ud,t)}const Vx=ee({selu_:p7});function m7(n,e,t,r,s,a=[1,1],o="NHWC"){const i=U(n,"x","separableConv2d"),u=U(e,"depthwiseFilter","separableConv2d"),l=U(t,"pointwiseFilter","separableConv2d");let c=i,d=!1;if(i.rank===3&&(d=!0,c=ae(i,[1,i.shape[0],i.shape[1],i.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");B(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),B(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),B(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),B(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),B(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);const p=u.shape[2],m=u.shape[3];B(l.shape[2]===p*m,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*m}, but got ${l.shape[2]}.`);const v=nf(c,u,r,s,o,a),y=wi(v,l,1,"valid",o);return d?ae(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const Ux=ee({separableConv2d_:m7});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function g7(n,e){const t=U(n,"x","setdiff1d"),r=U(e,"y","setdiff1d");B(t.dtype===r.dtype,()=>`x and y should have the same dtype, but got x (${t.dtype}) and y (${r.dtype}).`),B(t.rank===1,()=>`x should be 1D tensor, but got x (${t.shape}).`),B(r.rank===1,()=>`y should be 1D tensor, but got y (${r.shape}).`);const s=await t.data(),a=await r.data(),o=new Set(a);let i=0;for(let c=0;c<s.length;c++)o.has(s[c])||i++;const u=new Gn([i],t.dtype),l=new Gn([i],"int32");for(let c=0,d=0;c<s.length;c++)o.has(s[c])||(u.values[d]=s[c],l.values[d]=c,d++);return[u.toTensor(),l.toTensor()]}const UM=g7;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v7(n){const t={x:U(n,"x","sign")};return Q.runKernel(Hd,t)}const Gk=ee({sign_:v7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y7(n){const t={x:U(n,"x","sin","float32")};return Q.runKernel(Wd,t)}const Wx=ee({sin_:y7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b7(n){const t={x:U(n,"x","sinh")};return Q.runKernel(Gd,t)}const Gx=ee({sinh_:b7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x7(n,e,t){const r=U(n,"x","slice1d");return B(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),Ft(r,[e],[t])}const $g=ee({slice1d_:x7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w7(n,e,t){const r=U(n,"x","slice2d");return B(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),Ft(r,e,t)}const Hx=ee({slice2d_:w7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S7(n,e,t){const r=U(n,"x","slice3d");return B(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),Ft(r,e,t)}const Og=ee({slice3d_:S7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C7(n,e,t){const r=U(n,"x","slice4d");return B(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),Ft(r,e,t)}const jh=ee({slice4d_:C7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N7(n,e=-1){const t=U(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const r={logits:t},s={dim:e};return Q.runKernel(fg,r,s)}const Fg=ee({softmax_:N7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k7(n){B(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return Q.runKernel(L0,e)}const Mg=ee({fft_:k7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T7(n){B(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return Q.runKernel(V0,e)}const qh=ee({ifft_:T7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I7(n){const e=n.shape[n.shape.length-1],t=n.size/e;let r;if(e<=2){const s=ae(n,[t,e]);r=qh(s)}else{const s=[t,2*(e-1)],a=ae(Hh(n),[t,e]),o=ae(Ng(n),[t,e]),i=la(Ft(a,[0,1],[t,e-2]),1),u=re(la(Ft(o,[0,1],[t,e-2]),1),st(-1)),l=On([a,i],1),c=On([o,u],1),d=ae(xi(l,c),[s[0],s[1]]);r=qh(d)}if(r=Hh(r),n.rank===3&&n.shape[0]!==0){const s=r,a=n.shape[0];r=ae(r,[a,r.shape[0]/a,r.shape[1]]),s.dispose()}return r}const jx=ee({irfft_:I7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E7(n,e,t=0){const s={x:U(n,"x","split")},a={numOrSizeSplits:e,axis:t};return Q.runKernel(dg,s,a)}const ps=ee({split_:E7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _7(n,e){B(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const r=n.size/t;let s;if(e!=null&&e<t){const v=n.shape.map(y=>0),b=n.shape.map(y=>y);b[n.shape.length-1]=e,s=Ft(n,v,b),t=e}else if(e!=null&&e>t){const v=n.shape.map(b=>b);v[n.shape.length-1]=e-t,s=On([n,Wn(v)],n.shape.length-1),t=e}else s=n;const a=Lt(s),o=ae(xi(s,a),[r,t]),i=Mg(o),u=Math.floor(t/2)+1,l=Hh(i),c=Ng(i),d=ps(l,[u,t-u],l.shape.length-1),p=ps(c,[u,t-u],c.shape.length-1),m=s.shape.slice();return m[s.shape.length-1]=u,ae(xi(d[0],p[0]),m)}const Lg=ee({rfft_:_7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R7(n,e){let t=U(n,"a","squaredDifference"),r=U(e,"b","squaredDifference");[t,r]=Sn(t,r),mt(t.shape,r.shape);const s={a:t,b:r},a={};return Q.runKernel(Xd,s,a)}const qx=ee({squaredDifference_:R7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A7(n,e){const t=U(n,"x","squeeze","string_or_numeric");return ae(t,Ni(t.shape,e).newShape)}const qu=ee({squeeze_:A7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D7(n,e=0){const t=Kp(n,"tensors","stack","string_or_numeric");B(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&B(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const r=t,s={axis:e};return Q.runKernel(eg,r,s)}const bs=ee({stack_:D7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $7(n,e=0){const r={x:U(n,"x","step")},s={alpha:e};return Q.runKernel(ef,r,s)}const gc=ee({step_:$7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O7(n,e,t,r,s=0,a=0,o=0,i=0,u=0){const c={x:U(n,"x","stridedSlice","string_or_numeric")},d={begin:e,end:t,strides:r,beginMask:s,endMask:a,ellipsisMask:o,newAxisMask:i,shrinkAxisMask:u};return Q.runKernel(px,c,d)}const Hk=ee({stridedSlice_:O7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F7(n){const t={x:U(n,"x","tan","float32")};return Q.runKernel(Zd,t)}const jk=ee({tan_:F7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gr(n,e){cc(n);const t=Oo(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Uu(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _h(n,e,t){if(cc(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const r=Oo(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Uu(n,e,r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qk(n,e,t){if(cc(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const r=Oo(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Uu(n,e,r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WM(n,e,t){if(cc(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const r=Oo(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Uu(n,e,r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GM(n,e,t){if(cc(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const r=Oo(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Uu(n,e,r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HM(n,e,t){if(cc(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const r=Oo(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||r,Uu(n,e,r,t)}function Kk(n,e,t){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,a=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${r}, and batchDim: ${s}.`;if(t.rank<s)throw new Error(a+` update.rank < ${s}. `);if(n.length<r+(t.rank-s))throw new Error(a+` Output shape length < ${r+(t.rank-s)}`);if(t.rank!==s+n.length-r)throw new Error(a+` update.rank != ${s+n.length-r}`);for(let o=0;o<s;++o)if(t.shape[o]!==e.shape[o])throw new Error(a+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-s;++o)if(t.shape[o+s]!==n[o+r])throw new Error(a+` updates.shape[${o+s}] (${t.shape[o+s]}) != shape[${o+s}] (${n[o+s]})`)}function Kx(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}Kk(t,e,n)}function Ku(n,e,t){const r=e.shape.length,s=r>1?e.shape[r-1]:1,a=t.length;let o=1;for(let d=s;d<a;++d)o*=t[d];const i=s<1?1:s,u=xe(e.shape)/i,l=[...rt(t.slice(0,s)),1],c=xe(t);return{sliceRank:s,numUpdates:u,sliceSize:o,strides:l,outputSize:c}}const M7=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:Ku,validateInput:Kx,validateUpdateShape:Kk},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L7(n,e,t){const r=U(n,"tensor","tensorScatterupdate"),s=U(e,"indices","tensorScatterupdate","int32"),a=U(t,"updates","tensorScatterupdate");if(Kx(a,s,r.shape),r.dtype!==a.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${r.dtype} and ${a.dtype}.`);const o={tensor:r,indices:s,updates:a},i={};return Q.runKernel(ox,o,i)}const jM=ee({tensorScatterUpdate_:L7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P7(n,e=1,t=!0){const r=U(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const a={x:r},o={k:e,sorted:t},[i,u]=Q.runKernel(yx,a,o);return{values:i,indices:u}}const Xk=ee({topk_:P7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B7(n,e=0,t=1,r,s){if(Vs(n),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");const a=new Uk(e,t,r,!0,s),o=yt(n,r);for(let i=0;i<o.values.length;i++)o.values[i]=a.nextValue();return o.toTensor()}const Xx=ee({truncatedNormal_:B7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z7(n,e=0){const t=U(n,"x","unique","string_or_numeric");B(t.rank>0,()=>"The input tensor must be at least 1D");const r={x:t},s={axis:e},[a,o]=Q.runKernel(xx,r,s);return{values:a,indices:o}}const Yk=ee({unique_:z7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V7(n,e,t){const r=U(n,"x","unsortedSegmentSum"),s=U(e,"segmentIds","unsortedSegmentSum","int32");B(jl(t),()=>"numSegments must be of dtype int");const a={x:r,segmentIds:s},o={numSegments:t};return Q.runKernel(gg,a,o)}const Yx=ee({unsortedSegmentSum_:V7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U7(n,e=0){const t=U(n,"x","unstack","string_or_numeric");B(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const r={value:t},s={axis:e};return Q.runKernel(mg,r,s)}const ca=ee({unstack_:U7});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qM(n,e){return Fx(n,e,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zk(n,e=!0,t,r){return Q.makeVariable(n,e,t,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zx(n,e){const t=[];for(let a=0;a<e.length;a++)e[a]&&t.push(a);const r=yt(n,"int32"),s=yt([t.length,n.length],"int32");for(let a=0;a<t.length;a++){const o=r.indexToLoc(t[a]),i=a*n.length;s.values.set(o,i)}return s.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function W7(n){const e=U(n,"condition","whereAsync","bool"),t=await e.data(),r=Zx(e.shape,t);return n!==e&&e.dispose(),r}const Qk=W7;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function G7(n,e,t){const r=U(n,"tensor","boolMask"),s=U(e,"mask","boolMask","bool"),a=t??0,o=s.rank,i=r.shape;B(o>0,()=>"mask cannot be scalar"),Dr(i.slice(a,a+o),s.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let b=a;b<a+o;b++)u*=i[b];const l=i.slice(0,a).concat([u],i.slice(a+o)),c=ae(r,l),d=ae(s,[-1]),p=await Qk(d),m=qu(p,[1]),v=of(c,m,a);return n!==r&&r.dispose(),e!==s&&s.dispose(),m.dispose(),c.dispose(),d.dispose(),p.dispose(),v}const KM=G7;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H7(n,e,t){const r=U(n,"x","transpose");if(e==null&&(e=r.shape.map((o,i)=>i).reverse()),B(r.rank===e.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`),e.forEach(o=>{B(o>=0&&o<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${e}`)}),r.rank<=1)return r.clone();const s={x:r},a={perm:e};return r.dtype==="complex64"?he(()=>{let o=Hh(r),i=Ng(r);return o=Q.runKernel(Vl,{x:o},a),i=Q.runKernel(Vl,{x:i},a),t&&(i=ln(i)),xi(o,i)}):Q.runKernel(Vl,s,a)}const Dt=ee({transpose_:H7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j7(n,e,t,r,s=!0){const a=U(n,"v","movingAverage"),o=U(e,"x","movingAverage"),i=U(t,"decay","movingAverage");WF(a,o),B(Et(a.shape,o.shape),()=>"Shape mismatch in v and x");const u=st(1),l=ze(u,i);let c=re(ze(o,a),l);if(s){B(r!=null,()=>"When using zeroDebias: true, step is required.");const d=U(r,"step","movingAverage");c=Qe(c,ze(u,Fo(i,d)))}return Re(a,c)}const XM=ee({movingAverage_:j7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q7(n,e,t){Vs(t);const r=U(n,"indices","scatterND","int32"),s=U(e,"updates","scatterND");Kx(s,r,t);const a={indices:r,updates:s},o={shape:t};return Q.runKernel(ax,a,o)}const YM=ee({scatterND_:q7});function K7(n,e,t,r){if(n.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${n.shape}.`);const s=n.rank>0?n.shape[0]:1,a=n.rank>1?n.shape[1]:1;if(t.length!==a)throw new Error(`outputShape has incorrect number of elements:, ${t.length}, should be: ${a}.`);const o=e.size;if(!(e.rank===0||e.rank===1&&o===s))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${s}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X7(n,e,t,r=0){Vs(t);const s=U(n,"sparseIndices","sparseToDense","int32"),a=U(e,"sparseValues","sparseToDense","string_or_numeric"),o=U(r,"defaultValue","sparseToDense",a.dtype);K7(s,a,t,o);const i={sparseIndices:s,sparseValues:a,defaultValue:o},u={outputShape:t};return Q.runKernel(dx,i,u)}const ZM=ee({sparseToDense_:X7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y7(n,e){const t=U(e,"indices","gatherND","int32"),s={params:U(n,"x","gatherND","string_or_numeric"),indices:t};return Q.runKernel(z0,s)}const QM=ee({gatherND_:Y7});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z7(n,e){if(e==null)return n.shape.slice();if(Et(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let r=0;r<n.shape.length;r++)e[r]==null&&n.shape[r]!=null?t.push(n.shape[r]):t.push(e[r]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q7(n,e,t,r){const s=U(n,"x","dropout");if(B(s.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`),B(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof Gt?s.clone():s;const a=Z7(s,t),o=1-e,i=Qe(af(Re(ju(a,0,1,"float32",r),o)),o);return re(s,i)}const Jk=ee({dropout_:Q7});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eT(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function Qx(n,e,t){const r=1-n%2,s=new Float32Array(n);for(let a=0;a<n;++a){const o=2*Math.PI*a/(n+r-1);s[a]=e-t*Math.cos(o)}return Gr(s,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function J7(n,e,t=1){const r=U(n,"predictions","inTopK"),s=U(e,"targets","inTopK");B(r.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`),B(r.rank-1===s.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${s.rank}`),Dr(r.shape.slice(0,r.shape.length-1),s.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const a=r.shape[r.shape.length-1];B(t>0&&t<=a,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${a}), but got ${t}`);const o=await r.data(),i=await s.data(),[u,l]=[o.length/a,a],c=fr("bool",u);for(let d=0;d<u;d++){const p=d*l,m=o.subarray(p,p+l),v=[];for(let b=0;b<m.length;b++)v.push({value:m[b],index:b});v.sort((b,y)=>y.value-b.value),c[d]=0;for(let b=0;b<t;b++)if(v[b].index===i[d]){c[d]=1;break}}return n!==r&&r.dispose(),e!==s&&s.dispose(),Ra(c,s.shape,"bool")}const JM=J7;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e9(n,e,t,r,s,a="NHWC",o){let i=n;n.rank===3&&(i=ae(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=e;u.rank===3&&(u=ae(e,[1,e.shape[0],e.shape[1],e.shape[2]])),B(i.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${i.shape}.`),B(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),B(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const l=a==="NHWC"?i.shape[3]:i.shape[1],c=a==="NHWC"?u.shape[3]:u.shape[1];B(l===t[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${t[2]}.`),B(c===t[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${t[3]}).`),us("conv2dDerFilter",s,o);const d={x:i,dy:u},p={strides:r,pad:s,dataFormat:a,dimRoundingMode:o,filterShape:t};return Q.runKernel(N0,d,p)}const tT=ee({conv2DBackpropFilter_:e9});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jx(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return re(n,gc(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function e1(n,e){let t=e;const r=jn(n.shape,e.shape);return r.length>0&&(t=We(t,r)),ae(t,n.shape)}function t1(n,e,t,r){if(e==="linear")return n;if(e==="relu")return ro(n);if(e==="elu")return rf(n);if(e==="relu6")return Px(n);if(e==="prelu")return Dg(n,t);if(e==="leakyrelu")return kg(n,r);if(e==="sigmoid")return Ka(n);throw new Error(`Unknown fused activation ${e}.`)}const n1=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t9({x:n,filter:e,strides:t,pad:r,dataFormat:s="NHWC",dilations:a=[1,1],dimRoundingMode:o,bias:i,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(u=u||"linear",n1(Q.state.gradientDepth,u)===!1){B(s==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let E=wi(n,e,t,r,s,a,o);return i!=null&&(E=Re(E,i)),t1(E,u,l,c)}const d=U(n,"x","conv2d","float32"),p=U(e,"filter","conv2d","float32");let m=d,v=!1;d.rank===3&&(v=!0,m=ae(d,[1,d.shape[0],d.shape[1],d.shape[2]])),B(m.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${m.rank}.`),B(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),us("fused conv2d",r,o);const b=s==="NHWC"?m.shape[3]:m.shape[1];B(p.shape[2]===b,()=>`Error in conv2d: depth of input (${b}) must match input depth for filter ${p.shape[2]}.`),B($r(t,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${a}'`);const y=vr(m.shape,p.shape,t,a,r,o);let w;i!=null&&(w=U(i,"bias","fused conv2d"),[w]=Sn(w,d),s==="NHWC"?mt(y.outShape,w.shape):(B(w.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${w.shape.length}.`),B(w.shape.length===0||w.shape[0]===y.outChannels||w.shape[0]===1,()=>`Error in fused conv2d: bias shape (${w.shape}) is not compatible with the number of output channels (${y.outChannels})`)));let S;if(l!=null){const E=l.shape;if(B(E.length<=1||E.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${E.length}.`),E.length===1)B(E[0]===1||E[0]===y.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${E}) is not compatible with the number of output channels (${y.outChannels}).`);else if(E.length===3)try{mt(E,y.outShape)}catch{const _=`Error in fused conv2d: PReLU activation weights (${E}) is not compatible with the output shape of the conv2d (${y.outShape}).`;throw Error(_)}S=U(l,"prelu weights","fused conv2d")}const N=(E,$)=>{B(s==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`);const[_,R,D,A]=$,M=Jx(E,D,u);B(Au(a),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`);const H=bk(R.shape,M,_,t,r),j=tT(R,M,_.shape,t,r),G=[H,j];if(A!=null){const P=e1(A,M);G.push(P)}return G},C={x:m,filter:p,bias:w,preluActivationWeights:S},T={strides:t,pad:r,dataFormat:s,dilations:a,dimRoundingMode:o,activation:u,leakyreluAlpha:c};return i==null?Mo(($,_,R)=>{let D=Q.runKernel(Wp,C,T);return R([_,$,D]),v&&(D=ae(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:N}})(m,p):Mo(($,_,R,D)=>{let A=Q.runKernel(Wp,C,T);return D([_,$,A,R]),v&&(A=ae(A,[A.shape[1],A.shape[2],A.shape[3]])),{value:A,gradFunc:N}})(m,p,w)}const e4=ee({fusedConv2d_:t9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n9(n,e,t,r,s,a=[1,1],o){let i=n;n.rank===3&&(i=ae(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=e;u.rank===3&&(u=ae(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const l={x:i,dy:u},c={strides:r,pad:s,dimRoundingMode:o,dilations:a,filterShape:t};return Q.runKernel(A0,l,c)}const t4=ee({depthwiseConv2dNativeBackpropFilter_:n9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r9(n,e,t,r,s,a=[1,1],o){let i=e,u=!1;e.rank===3&&(u=!0,i=ae(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const l={dy:i,filter:t},c={strides:r,pad:s,dimRoundingMode:o,dilations:a,inputShape:n},d=Q.runKernel(D0,l,c);return u?ae(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const n4=ee({depthwiseConv2dNativeBackpropInput_:r9});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s9({x:n,filter:e,strides:t,pad:r,dataFormat:s="NHWC",dilations:a=[1,1],dimRoundingMode:o,bias:i,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(n1(Q.state.gradientDepth,u)===!1){let T=nf(n,e,t,r,s,a,o);return i!=null&&(T=Re(T,i)),t1(T,u,l,c)}const d=U(n,"x","depthwiseConv2d","float32"),p=U(e,"filter","depthwiseConv2d","float32");let m=d,v=!1;d.rank===3&&(v=!0,m=ae(d,[1,d.shape[0],d.shape[1],d.shape[2]])),B(m.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${m.rank}.`),B(p.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`),B(m.shape[3]===p.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${m.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`),a==null&&(a=[1,1]),B($r(t,a),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${t} and dilations '${a}'`),us("fused depthwiseConv2d",r,o);const b=vr(m.shape,p.shape,t,a,r,o,!0);let y;i!=null&&(y=U(i,"bias","fused conv2d"),[y]=Sn(y,d),mt(b.outShape,y.shape));let w;l!=null&&(w=U(l,"prelu weights","fused depthwiseConv2d"));const S=(T,E)=>{B(Au(a),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[$,_,R,D]=E,A=Jx(T,R,u),M=n4(_.shape,A,$,t,r,a,o),H=t4(_,A,$.shape,t,r,a,o);if(D!=null){const j=e1(y,A);return[M,H,j]}return[M,H]},N={x:m,filter:p,bias:y,preluActivationWeights:w},C={strides:t,pad:r,dataFormat:s,dilations:a,dimRoundingMode:o,activation:u,leakyreluAlpha:c};return i==null?Mo((E,$,_)=>{let R=Q.runKernel(Gp,N,C);return _([$,E,R]),v&&(R=ae(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:S}})(m,p):Mo((E,$,_,R)=>{let D=Q.runKernel(Gp,N,C);return R([$,E,D,_]),v&&(D=ae(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:S}})(m,p,y)}const a9=ee({fusedDepthwiseConv2d_:s9});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o9({a:n,b:e,transposeA:t=!1,transposeB:r=!1,bias:s,activation:a="linear",preluActivationWeights:o,leakyreluAlpha:i=.2}){if(n1(Q.state.gradientDepth,a)===!1){let A=St(n,e,t,r);return s!=null&&(A=Re(A,s)),t1(A,a,o,i)}let u=U(n,"a","fused matMul"),l=U(e,"b","fused matMul");[u,l]=Sn(u,l);const c=t?u.shape[u.rank-2]:u.shape[u.rank-1],d=r?l.shape[l.rank-1]:l.shape[l.rank-2],p=t?u.shape[u.rank-1]:u.shape[u.rank-2],m=r?l.shape[l.rank-2]:l.shape[l.rank-1],v=u.shape.slice(0,-2),b=l.shape.slice(0,-2),y=xe(v),w=xe(b);B(c===d,()=>`Error in fused matMul: inner shapes (${c}) and (${d}) of Tensors with shapes ${u.shape} and ${l.shape} and transposeA=${t} and transposeB=${r} must match.`);const N=mt(u.shape.slice(0,-2),l.shape.slice(0,-2)).concat([p,m]),C=t?ae(u,[y,c,p]):ae(u,[y,p,c]),T=r?ae(l,[w,m,d]):ae(l,[w,d,m]);let E;s!=null&&(E=U(s,"bias","fused matMul"),[E]=Sn(E,u),mt(N,E.shape));let $;o!=null&&($=U(o,"prelu weights","fused matMul"));const _=(A,M)=>{const[H,j,G,P]=M,V=Jx(ae(A,G.shape),G,a);let z,Y;if(!t&&!r?(z=St(V,j,!1,!0),Y=St(H,V,!0,!1)):!t&&r?(z=St(V,j,!1,!1),Y=St(V,H,!0,!1)):t&&!r?(z=St(j,V,!1,!0),Y=St(H,V,!1,!1)):(z=St(j,V,!0,!0),Y=St(V,H,!0,!0)),s!=null){const L=e1(P,V);return[z,Y,L]}else return[z,Y]},R={a:C,b:T,bias:E,preluActivationWeights:$},D={transposeA:t,transposeB:r,activation:a,leakyreluAlpha:i};return s==null?Mo((M,H,j)=>{const G=Q.runKernel(Up,R,D);return j([M,H,G]),{value:ae(G,N),gradFunc:_}})(C,T):Mo((M,H,j,G)=>{const P=Q.runKernel(Up,R,D);return G([M,H,P,j]),{value:ae(P,N),gradFunc:_}})(C,T,E)}const _C=ee({fusedMatMul_:o9});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r4=Object.freeze(Object.defineProperty({__proto__:null,conv2d:e4,depthwiseConv2d:a9,matMul:_C},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i9(n){return Qx(n,.54,.46)}const u9=ee({hammingWindow_:i9});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l9(n){return Qx(n,.5,.5)}const s4=ee({hannWindow_:l9});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c9(n,e,t,r=!1,s=0){let a=0;const o=[];for(;a+e<=n.size;)o.push(Ft(n,a,e)),a+=t;if(r)for(;a<n.size;){const i=a+e-n.size,u=On([Ft(n,a,e-i),pc([i],s)]);o.push(u),a+=t}return o.length===0?_h([],[0,e]):ae(On(o),[o.length,e])}const a4=ee({frame_:c9});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h9(n,e,t,r,s=s4){r==null&&(r=eT(e));const a=a4(n,e,t),o=re(a,s(e));return Lg(o,r)}const d9=ee({stft_:h9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f9(n,e,t,r,s="bilinear",a=0){const o=U(n,"image","cropAndResize"),i=U(e,"boxes","cropAndResize","float32"),u=U(t,"boxInd","cropAndResize","int32"),l=i.shape[0];B(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),B(i.rank===2&&i.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${i.shape}.`),B(u.rank===1&&u.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${i.shape}.`),B(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),B(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),B(s==="bilinear"||s==="nearest",()=>`method must be bilinear or nearest, but was ${s}`);const c={image:o,boxes:i,boxInd:u},d={method:s,extrapolationValue:a,cropSize:r};return Q.runKernel(E0,c,d)}const p9=ee({cropAndResize_:f9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m9(n){const e=U(n,"image","flipLeftRight","float32");B(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return Q.runKernel(B0,t,{})}const g9=ee({flipLeftRight_:m9});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v9(n){const e=U(n,"image","grayscaleToRGB"),t=e.rank-1,r=e.shape[t];B(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),B(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);const s=new Array(e.rank);return s.fill(1,0,t),s[t]=3,ta(e,s)}const y9=ee({grayscaleToRGB_:v9});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b9(n){const e=U(n,"image","RGBToGrayscale"),t=e.rank-1,r=e.shape[t];B(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),B(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);const s=e.dtype,a=Fe(e,"float32"),o=Gr([.2989,.587,.114]);let i;switch(e.rank){case 2:i=Rl("ij,j->i",a,o);break;case 3:i=Rl("ijk,k->ij",a,o);break;case 4:i=Rl("ijkl,l->ijk",a,o);break;case 5:i=Rl("ijklm,m->ijkl",a,o);break;case 6:i=Rl("ijklmn,n->ijklm",a,o);break;default:throw new Error("Not a valid tensor rank.")}return i=Wr(i,-1),Fe(i,s)}const x9=ee({rgbToGrayscale_:b9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w9(n,e,t=0,r=.5){const s=U(n,"image","rotateWithOffset","float32");B(s.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`);const a={image:s},o={radians:e,fillValue:t,center:r};return Q.runKernel(wx,a,o)}const S9=ee({rotateWithOffset_:w9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uf(n,e,t,r,s,a){r==null&&(r=.5),s==null&&(s=Number.NEGATIVE_INFINITY),a==null&&(a=0);const o=n.shape[0];return t=Math.min(t,o),B(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),B(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),B(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),B(e.rank===1,()=>"scores must be a 1D tensor"),B(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),B(0<=a&&a<=1,()=>`softNmsSigma must be in [0, 1], but was '${a}'`),{maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C9(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY){const a=U(n,"boxes","nonMaxSuppression","float32"),o=U(e,"scores","nonMaxSuppression","float32"),i=uf(a,o,t,r,s);t=i.maxOutputSize,r=i.iouThreshold,s=i.scoreThreshold;const u={maxOutputSize:t,iouThreshold:r,scoreThreshold:s};return Q.runKernel(X0,{boxes:a,scores:o},u)}const N9=ee({nonMaxSuppression_:C9});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k9(n,e,t){const r=T9(n,e,t),s=r<0?-(r+1):r;n.splice(s,0,e)}function T9(n,e,t){return E9(n,e,t||I9)}function I9(n,e){return n>e?1:n<e?-1:0}function E9(n,e,t){let r=0,s=n.length,a=0,o=!1;for(;r<s;){a=r+(s-r>>>1);const i=t(e,n[a]);i>0?r=a+1:(s=a,o=!i)}return o?r:-r-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r1(n,e,t,r,s){return nT(n,e,t,r,s,0)}function s1(n,e,t,r,s,a){return nT(n,e,t,r,s,0,!1,a,!0)}function a1(n,e,t,r,s,a){return nT(n,e,t,r,s,a,!0)}function nT(n,e,t,r,s,a,o=!1,i=!1,u=!1){const l=[];for(let y=0;y<e.length;y++)e[y]>s&&l.push({score:e[y],boxIndex:y,suppressBeginIndex:0});l.sort(o$);const c=a>0?-.5/a:0,d=[],p=[];for(;d.length<t&&l.length>0;){const y=l.pop(),{score:w,boxIndex:S,suppressBeginIndex:N}=y;if(w<s)break;let C=!1;for(let T=d.length-1;T>=N;--T){const E=_9(n,S,d[T]);if(E>=r){C=!0;break}if(y.score=y.score*R9(r,c,E),y.score<=s)break}y.suppressBeginIndex=d.length,C||(y.score===w?(d.push(S),p.push(y.score)):y.score>s&&k9(l,y,o$))}const m=d.length,v=t-m;i&&v>0&&(d.push(...new Array(v).fill(0)),p.push(...new Array(v).fill(0)));const b={selectedIndices:d};return o&&(b.selectedScores=p),u&&(b.validOutputs=m),b}function _9(n,e,t){const r=n.subarray(e*4,e*4+4),s=n.subarray(t*4,t*4+4),a=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),i=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(s[0],s[2]),c=Math.min(s[1],s[3]),d=Math.max(s[0],s[2]),p=Math.max(s[1],s[3]),m=(i-a)*(u-o),v=(d-l)*(p-c);if(m<=0||v<=0)return 0;const b=Math.max(a,l),y=Math.max(o,c),w=Math.min(i,d),S=Math.min(u,p),N=Math.max(w-b,0)*Math.max(S-y,0);return N/(m+v-N)}function R9(n,e,t){const r=Math.exp(e*t*t);return t<=n?r:0}function o$(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function A9(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY){const a=U(n,"boxes","nonMaxSuppressionAsync"),o=U(e,"scores","nonMaxSuppressionAsync"),i=uf(a,o,t,r,s);t=i.maxOutputSize,r=i.iouThreshold,s=i.scoreThreshold;const u=await Promise.all([a.data(),o.data()]),l=u[0],c=u[1],{selectedIndices:d}=r1(l,c,t,r,s);return a!==n&&a.dispose(),o!==e&&o.dispose(),Gr(d,"int32")}const D9=A9;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $9(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,a=0){const o=U(n,"boxes","nonMaxSuppression"),i=U(e,"scores","nonMaxSuppression"),u=uf(o,i,t,r,s,a);t=u.maxOutputSize,r=u.iouThreshold,s=u.scoreThreshold,a=u.softNmsSigma;const l={boxes:o,scores:i},c={maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:a},d=Q.runKernel(Z0,l,c);return{selectedIndices:d[0],selectedScores:d[1]}}const O9=ee({nonMaxSuppressionWithScore_:$9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function F9(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,a=0){const o=U(n,"boxes","nonMaxSuppressionAsync"),i=U(e,"scores","nonMaxSuppressionAsync"),u=uf(o,i,t,r,s,a);t=u.maxOutputSize,r=u.iouThreshold,s=u.scoreThreshold,a=u.softNmsSigma;const l=await Promise.all([o.data(),i.data()]),c=l[0],d=l[1],{selectedIndices:p,selectedScores:m}=a1(c,d,t,r,s,a);return o!==n&&o.dispose(),i!==e&&i.dispose(),{selectedIndices:Gr(p,"int32"),selectedScores:Gr(m)}}const M9=F9;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L9(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,a=!1){const o=U(n,"boxes","nonMaxSuppression"),i=U(e,"scores","nonMaxSuppression"),u=uf(o,i,t,r,s,null),l=u.maxOutputSize,c=u.iouThreshold,d=u.scoreThreshold,p={boxes:o,scores:i},m={maxOutputSize:l,iouThreshold:c,scoreThreshold:d,padToMaxOutputSize:a},v=Q.runKernel(Y0,p,m);return{selectedIndices:v[0],validOutputs:v[1]}}const P9=ee({nonMaxSuppressionPadded_:L9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function B9(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,a=!1){const o=U(n,"boxes","nonMaxSuppressionAsync"),i=U(e,"scores","nonMaxSuppressionAsync"),u=uf(o,i,t,r,s,null),l=u.maxOutputSize,c=u.iouThreshold,d=u.scoreThreshold,[p,m]=await Promise.all([o.data(),i.data()]),{selectedIndices:v,validOutputs:b}=s1(p,m,l,c,d,a);return o!==n&&o.dispose(),i!==e&&i.dispose(),{selectedIndices:Gr(v,"int32"),validOutputs:st(b,"int32")}}const z9=B9;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V9(n,e,t=!1,r=!1){const s=U(n,"images","resizeBilinear");B(s.rank===3||s.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`),B(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),B(r===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let a=s,o=!1;s.rank===3&&(o=!0,a=ae(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const i={images:a},u={alignCorners:t,halfPixelCenters:r,size:e},l=Q.runKernel(og,i,u);return o?ae(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const o4=ee({resizeBilinear_:V9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U9(n,e,t=!1,r=!1){const s=U(n,"images","resizeNearestNeighbor");B(s.rank===3||s.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`),B(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),B(s.dtype==="float32"||s.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),B(r===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let a=s,o=!1;s.rank===3&&(o=!0,a=ae(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const i={images:a},u={alignCorners:t,halfPixelCenters:r,size:e},l=Q.runKernel(ag,i,u);return o?ae(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const i4=ee({resizeNearestNeighbor_:U9});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W9(n,e="binary",t=!1,r=.5){const s=U(n,"image","threshold"),a=.2989,o=.587,i=.114,u=s.shape[0]*s.shape[1];let l=re(Gr([r]),255),c,d,p,m;if(B(s.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`),B(s.shape[2]===3||s.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`),B(s.dtype==="int32"||s.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`),B(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),s.shape[2]===3){[c,d,p]=ps(s,[1,1,1],-1);const y=re(c,a),w=re(d,o),S=re(p,i);m=Re(Re(y,w),S)}else m=n;if(e==="otsu"){const y=fk(Fe(Bx(m),"int32"),Ra([]),256);l=G9(y,u)}const v=t?Hu(m,l):Ss(m,l);return Fe(re(v,255),"int32")}function G9(n,e){let t=Gr([-1]),r=Gr([0]),s=Gr([0]),a,o,i,u,l,c;for(let d=0;d<n.size-1;d++){a=Ft(n,0,d+1),o=Ft(n,d+1),l=Qe(We(a),e),c=Qe(We(o),e);const p=We(re(a,ec(0,a.size)));i=Qe(p,We(a));const m=pc(o.shape,a.size),v=Re(ec(0,o.size),m),b=re(o,v);u=Qe(We(b),We(o));const y=ze(i,u),w=ze(i,u),S=re(l,c);s=re(re(S,y),w);const N=Ss(s,r);r=Er(N,s,r),t=Er(N,Gr([d]),t)}return t}const H9=ee({threshold_:W9});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j9(n,e,t="nearest",r="constant",s=0,a){const o=U(n,"image","transform","float32"),i=U(e,"transforms","transform","float32");B(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),B(i.rank===2&&(i.shape[0]===o.shape[0]||i.shape[0]===1)&&i.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),B(a==null||a.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${a}.`);const u={image:o,transforms:i},l={interpolation:t,fillMode:r,fillValue:s,outputShape:a};return Q.runKernel(bx,u,l)}const q9=ee({transform_:j9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K9(n,e,t){const r=U(n,"a","bandPart");B(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const s=r.shape,[a,o]=r.shape.slice(-2);let i,u;typeof e=="number"?(B(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),B(e<=a,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${a}).`),i=U(e<0?a:e,"numLower","bandPart")):(B(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),i=Er(Wh(e,0),a,$u(e,a))),typeof t=="number"?(B(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),B(t<=o,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`),u=U(t<0?o:t,"numUpper","bandPart")):(B(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),u=Er(Wh(t,0),o,$u(t,o)));const l=ae(ec(0,a,1,"int32"),[-1,1]),c=ec(0,o,1,"int32"),d=ze(l,c),p=Za(Hu(d,i),Ei(d,ln(u))),m=Wn([a,o],r.dtype);return ae(bs(ca(ae(r,[-1,a,o])).map(v=>Er(p,v,m))),s)}const X9=ee({bandPart_:K9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y9(n){let e;if(Array.isArray(n)){e=!1,B(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const s=n[0].shape[0];for(let a=1;a<n.length;++a)B(n[a].shape[0]===s,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[a].shape[0]} vs. ${s})`)}else e=!0,n=ps(n,n.shape[0],0).map(s=>qu(s,[0]));B(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],r=n;for(let s=0;s<n.length;++s)t.push(Q.tidy(()=>{let a=r[s];if(s>0)for(let o=0;o<s;++o){const i=re(We(re(t[o],a)),t[o]);a=ze(a,i)}return Qe(a,sf(a,"euclidean"))}));return e?bs(t,0):t}const Z9=ee({gramSchmidt_:Y9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q9(n,e=!1){if(B(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return i$(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((u,l)=>u*l),r=ca(ae(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),s=[],a=[];r.forEach(u=>{const[l,c]=i$(u,e);s.push(l),a.push(c)});const o=ae(bs(s,0),n.shape),i=ae(bs(a,0),n.shape);return[o,i]}}function i$(n,e=!1){return Q.tidy(()=>{B(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],r=n.shape[1];let s=Ax(t),a=To(n);const o=_h([[1]],[1,1]);let i=To(o);const u=t>=r?r:t;for(let l=0;l<u;++l){const c=a,d=i,p=s;[i,a,s]=Q.tidy(()=>{const m=Ft(a,[l,l],[t-l,1]),v=sf(m),b=Ft(a,[l,l],[1,1]),y=Er(Ss(b,0),_h([[-1]]),_h([[1]])),w=ze(b,re(y,v)),S=Qe(m,w);S.shape[0]===1?i=To(o):i=On([o,Ft(S,[1,0],[S.shape[0]-1,S.shape[1]])],0);const N=ln(Qe(St(y,w),v)),C=Ft(a,[l,0],[t-l,r]),T=re(N,i),E=Dt(i);if(l===0)a=ze(C,St(T,St(E,C)));else{const R=ze(C,St(T,St(E,C)));a=On([Ft(a,[0,0],[l,r]),R],0)}const $=Dt(T),_=Ft(s,[0,l],[t,s.shape[1]-l]);if(l===0)s=ze(_,St(St(_,i),$));else{const R=ze(_,St(St(_,i),$));s=On([Ft(s,[0,0],[t,l]),R],1)}return[i,a,s]}),Ct([c,d,p])}return!e&&t>r&&(s=Ft(s,[0,0],[t,r]),a=Ft(a,[0,0],[r,r])),[s,a]})}const J9=ee({qr_:Q9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ts;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(ts||(ts={}));function eY(n,e,t=ts.SUM_BY_NONZERO_WEIGHTS){const r=U(n,"losses","computeWeightedLoss");let s=null;e!=null&&(s=U(e,"weights","computeWeightedLoss"));const a=s==null?r:re(r,s);if(t===ts.NONE)return a;if(t===ts.SUM)return We(a);if(t===ts.MEAN){if(s==null)return xn(a);{const o=r.size/s.size,i=Qe(We(a),We(s));return o>1?Qe(i,st(o)):i}}if(t===ts.SUM_BY_NONZERO_WEIGHTS){if(s==null)return Qe(We(a),st(r.size));{const o=re(s,ds(r.shape)),i=Fe(We(Jl(o,st(0))),"float32");return Qe(We(a),i)}}throw Error(`Unknown reduction: ${t}`)}const Ri=ee({computeWeightedLoss_:eY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tY(n,e,t,r=ts.SUM_BY_NONZERO_WEIGHTS){const s=U(n,"labels","absoluteDifference"),a=U(e,"predictions","absoluteDifference");let o=null;t!=null&&(o=U(t,"weights","absoluteDifference")),Dr(s.shape,a.shape,"Error in absoluteDifference: ");const i=Un(ze(s,a));return Ri(i,o,r)}const nY=ee({absoluteDifference_:tY});function rY(n,e,t,r,s=ts.SUM_BY_NONZERO_WEIGHTS){const a=U(n,"labels","cosineDistance"),o=U(e,"predictions","cosineDistance");let i=null;r!=null&&(i=U(r,"weights","cosineDistance")),Dr(a.shape,o.shape,"Error in cosineDistance: ");const u=st(1),l=ze(u,We(re(a,o),t,!0));return Ri(l,i,s)}const sY=ee({cosineDistance_:rY});function aY(n,e,t,r=ts.SUM_BY_NONZERO_WEIGHTS){let s=U(n,"labels","hingeLoss");const a=U(e,"predictions","hingeLoss");let o=null;t!=null&&(o=U(t,"weights","hingeLoss")),Dr(s.shape,a.shape,"Error in hingeLoss: ");const i=st(1);s=ze(re(st(2),s),i);const u=ro(ze(i,re(s,a)));return Ri(u,o,r)}const oY=ee({hingeLoss_:aY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iY(n,e,t,r=1,s=ts.SUM_BY_NONZERO_WEIGHTS){const a=U(n,"labels","huberLoss"),o=U(e,"predictions","huberLoss");let i=null;t!=null&&(i=U(t,"weights","huberLoss")),Dr(a.shape,o.shape,"Error in huberLoss: ");const u=st(r),l=Un(ze(o,a)),c=$u(l,u),d=ze(l,c),p=Re(re(st(.5),Qt(c)),re(u,d));return Ri(p,i,s)}const uY=ee({huberLoss_:iY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lY(n,e,t,r=1e-7,s=ts.SUM_BY_NONZERO_WEIGHTS){const a=U(n,"labels","logLoss"),o=U(e,"predictions","logLoss");let i=null;t!=null&&(i=U(t,"weights","logLoss")),Dr(a.shape,o.shape,"Error in logLoss: ");const u=st(1),l=st(r),c=ln(re(a,Fs(Re(o,l)))),d=re(ze(u,a),Fs(Re(ze(u,o),l))),p=ze(c,d);return Ri(p,i,s)}const cY=ee({logLoss_:lY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hY(n,e,t,r=ts.SUM_BY_NONZERO_WEIGHTS){const s=U(n,"labels","meanSquaredError"),a=U(e,"predictions","meanSquaredError");let o=null;t!=null&&(o=U(t,"weights","meanSquaredError")),Dr(s.shape,a.shape,"Error in meanSquaredError: ");const i=qx(s,a);return Ri(i,o,r)}const dY=ee({meanSquaredError_:hY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fY(n,e){const t=U(n,"labels","sigmoidCrossEntropyWithLogits"),r=U(e,"logits","sigmoidCrossEntropyWithLogits");Dr(t.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const s=ro(r),a=re(r,t),o=Tg(ys(ln(Un(r))));return Re(ze(s,a),o)}function pY(n,e,t,r=0,s=ts.SUM_BY_NONZERO_WEIGHTS){let a=U(n,"multiClassLabels","sigmoidCrossEntropy");const o=U(e,"logits","sigmoidCrossEntropy");let i=null;if(t!=null&&(i=U(t,"weights","sigmoidCrossEntropy")),Dr(a.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){const l=st(r),c=st(1),d=st(.5);a=Re(re(a,ze(c,l)),re(d,l))}const u=fY(a,o);return Ri(u,i,s)}const mY=ee({sigmoidCrossEntropy_:pY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gY(n,e,t=-1){if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${t}`);return Mo((s,a,o)=>{const u=Ig(a,[t],!0),l=ze(Fe(a,"float32"),u);o([s,l]);const c=ln(re(l,s));return{value:We(c,[t]),gradFunc:(m,v)=>{const[b,y]=v,w=Fn(m.shape,[t]);return[re(ae(m,w),ze(Fe(b,"float32"),ys(y))),re(ae(m,w),ze(ys(y),Fe(b,"float32")))]}}})(n,e)}function vY(n,e,t,r=0,s=ts.SUM_BY_NONZERO_WEIGHTS){let a=U(n,"onehotLabels","softmaxCrossEntropy");const o=U(e,"logits","softmaxCrossEntropy");let i=null;if(t!=null&&(i=U(t,"weights","softmaxCrossEntropy")),Dr(a.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){const l=st(r),c=st(1),d=st(a.shape[1]);a=Re(re(a,ze(c,l)),Qe(l,d))}const u=gY(a,o);return Ri(u,i,s)}const yY=ee({softmaxCrossEntropy_:vY});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bY(n,e,t,r){const s=U(n,"indices","sparseFillEmptyRows","int32"),a=U(e,"values","sparseFillEmptyRows"),o=U(t,"denseShape","sparseFillEmptyRows","int32"),i=U(r,"defaultValue","sparseFillEmptyRows",a.dtype);if(s.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${s.shape}`);if(a.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${a.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(i.rank!==0)throw new Error(`Default value should be a scalar but received shape ${i.shape}`);const u={indices:s,values:a,denseShape:o,defaultValue:i},l=Q.runKernel(ux,u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}const xY=ee({sparseFillEmptyRows_:bY});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wY(n,e,t){const r=U(n,"inputIndices","sparseReshape","int32"),s=U(e,"inputShape","sparseReshape","int32"),a=U(t,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${r.shape}`);if(s.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${s.shape}`);if(a.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${a.shape}`);const o={inputIndices:r,inputShape:s,newShape:a},i=Q.runKernel(lx,o);return{outputIndices:i[0],outputShape:i[1]}}const SY=ee({sparseReshape_:wY});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CY(n,e,t){const r=U(n,"data","sparseSegmentMean"),s=U(e,"indices","sparseSegmentMean","int32"),a=U(t,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${s.shape}`);if(a.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${a.shape}`);const o={data:r,indices:s,segmentIds:a};return Q.runKernel(cx,o)}const NY=ee({sparseSegmentMean_:CY});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kY(n,e,t){const r=U(n,"data","sparseSegmentSum"),s=U(e,"indices","sparseSegmentSum","int32"),a=U(t,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${s.shape}`);if(a.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${a.shape}`);const o={data:r,indices:s,segmentIds:a};return Q.runKernel(hx,o)}const TY=ee({sparseSegmentSum_:kY});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IY(n,e,t,r,s,a,o,i){const u=U(n,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error(`Data must be a vector, saw: ${u.shape}`);const l=U(e,"dataSplits","stringNGrams");if(l.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const c={separator:t,nGramWidths:r,leftPad:s,rightPad:a,padWidth:o,preserveShortSequences:i},d={data:u,dataSplits:l},p=Q.runKernel(mx,d,c);return{nGrams:p[0],nGramsSplits:p[1]}}const EY=ee({stringNGrams_:IY});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Y(n,e,t=!0){const r=U(n,"input","stringSplit","string"),s=U(e,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(s.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${s.shape}`);const a={skipEmpty:t},o={input:r,delimiter:s},i=Q.runKernel(gx,o,a);return{indices:i[0],values:i[1],shape:i[2]}}const RY=ee({stringSplit_:_Y});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AY(n,e){const t=U(n,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const s={input:t};return Q.runKernel(vx,s,r)}const DY=ee({stringToHashBucketFast_:AY});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Y(n,e,t,r=!0){const s=U(n,"input","staticRegexReplace","string"),a={pattern:e,rewrite:t,replaceGlobal:r};return Q.runKernel(pg,{x:s},a)}const OY=ee({staticRegexReplace_:$Y});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u4={fft:Mg,ifft:qh,rfft:Lg,irfft:jx},l4={hammingWindow:u9,hannWindow:s4,frame:a4,stft:d9},Ha={flipLeftRight:g9,grayscaleToRGB:y9,resizeNearestNeighbor:i4,resizeBilinear:o4,rgbToGrayscale:x9,rotateWithOffset:S9,cropAndResize:p9,nonMaxSuppression:N9,nonMaxSuppressionAsync:D9,nonMaxSuppressionWithScore:O9,nonMaxSuppressionWithScoreAsync:M9,nonMaxSuppressionPadded:P9,nonMaxSuppressionPaddedAsync:z9,threshold:H9,transform:q9},rT={bandPart:X9,gramSchmidt:Z9,qr:J9},c4={absoluteDifference:nY,computeWeightedLoss:Ri,cosineDistance:sY,hingeLoss:oY,huberLoss:uY,logLoss:cY,meanSquaredError:dY,sigmoidCrossEntropy:mY,softmaxCrossEntropy:yY},h4={sparseFillEmptyRows:xY,sparseReshape:SY,sparseSegmentMean:NY,sparseSegmentSum:TY},d4={stringNGrams:EY,stringSplit:RY,stringToHashBucketFast:DY,staticRegexReplace:OY};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FY=new Map,RC=new Map;class vc{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class ea{constructor(){this.classNameMap={}}static getMap(){return ea.instance==null&&(ea.instance=new ea),ea.instance}static register(e){ea.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function De(n,e,t){B(n.className!=null,()=>"Class being registered does not have the static className property defined."),B(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),B(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const r=t,s=e+">"+r;return ea.register(n),FY.set(s,n),RC.set(n,s),n}function MY(n){return RC.has(n)?RC.get(n):n.className}const LY=Object.freeze(Object.defineProperty({__proto__:null,Serializable:vc,SerializationMap:ea,getRegisteredName:MY,registerClass:De},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ai extends vc{minimize(e,t=!1,r){const{value:s,grads:a}=this.computeGradients(e,r);if(r!=null){const o=r.map(i=>({name:i.name,tensor:a[i.name]}));this.applyGradients(o)}else this.applyGradients(a);return Ct(a),t?s:(s.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return yM(e,t)}dispose(){this.iterations_!=null&&Ct(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:st(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Ai,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sT extends Ai{static get className(){return"Adadelta"}constructor(e,t,r=null){super(),this.learningRate=e,this.rho=t,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=Q.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const a=Q.registeredVariables[r],o=!1;this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${r}/accum_grad`,variable:he(()=>Lt(a).variable(o))}),this.accumulatedUpdates[s]==null&&(this.accumulatedUpdates[s]={originalName:`${r}/accum_var`,variable:he(()=>Lt(a).variable(o))});const i=Array.isArray(e)?e[s].tensor:e[r];if(i==null)return;const u=this.accumulatedGrads[s].variable,l=this.accumulatedUpdates[s].variable;he(()=>{const c=Re(re(u,this.rho),re(Qt(i),1-this.rho)),d=re(Qe(pr(Re(l,this.epsilon)),pr(Re(u,this.epsilon))),i),p=Re(re(l,this.rho),re(Qt(d),1-this.rho));u.assign(c),l.assign(p);const m=Re(re(d,-this.learningRate),a);a.assign(m)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Ct(this.accumulatedGrads.map(e=>e.variable)),Ct(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,r=!1;this.accumulatedGrads=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedUpdates=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aT extends Ai{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const a=Q.registeredVariables[r];this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${r}/accumulator`,variable:he(()=>pc(a.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[s].tensor:e[r];if(o==null)return;const i=this.accumulatedGrads[s].variable;he(()=>{const u=Re(i,Qt(o));i.assign(u);const l=Re(re(Qe(o,pr(Re(u,Q.backend.epsilon()))),-this.learningRate),a);a.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Ct(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oT extends Ai{static get className(){return"Adam"}constructor(e,t,r,s=null){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=s,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],he(()=>{this.accBeta1=st(t).variable(),this.accBeta2=st(r).variable()}),s==null&&(this.epsilon=Q.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);he(()=>{const r=ze(1,this.accBeta1),s=ze(1,this.accBeta2);t.forEach((a,o)=>{const i=Q.registeredVariables[a],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${a}/m`,variable:he(()=>Lt(i).variable(u))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${a}/v`,variable:he(()=>Lt(i).variable(u))});const l=Array.isArray(e)?e[o].tensor:e[a];if(l==null)return;const c=this.accumulatedFirstMoment[o].variable,d=this.accumulatedSecondMoment[o].variable,p=Re(re(c,this.beta1),re(l,1-this.beta1)),m=Re(re(d,this.beta2),re(Qt(l),1-this.beta2)),v=Qe(p,r),b=Qe(m,s);c.assign(p),d.assign(m);const y=Re(re(Qe(v,Re(pr(b),this.epsilon)),-this.learningRate),i);i.assign(y)}),this.accBeta1.assign(re(this.accBeta1,this.beta1)),this.accBeta2.assign(re(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Ct(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Ct(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),he(()=>{this.accBeta1.assign(Fo(this.beta1,this.iterations_+1)),this.accBeta2.assign(Fo(this.beta2,this.iterations_+1))});const t=e.length/2,r=!1;this.accumulatedFirstMoment=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iT extends Ai{static get className(){return"Adamax"}constructor(e,t,r,s=null,a=0){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=s,this.decay=a,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],he(()=>{this.iteration=st(0).variable(),this.accBeta1=st(t).variable()}),s==null&&(this.epsilon=Q.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);he(()=>{const r=ze(1,this.accBeta1),s=Qe(-this.learningRate,Re(re(this.iteration,this.decay),1));t.forEach((a,o)=>{const i=Q.registeredVariables[a],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${a}/m`,variable:Lt(i).variable(u)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${a}/v`,variable:Lt(i).variable(u)});const l=Array.isArray(e)?e[o].tensor:e[a];if(l==null)return;const c=this.accumulatedFirstMoment[o].variable,d=this.accumulatedWeightedInfNorm[o].variable,p=Re(re(c,this.beta1),re(l,1-this.beta1)),m=re(d,this.beta2),v=Un(l),b=zo(m,v);c.assign(p),d.assign(b);const y=Re(re(Qe(s,r),Qe(p,Re(b,this.epsilon))),i);i.assign(y)}),this.iteration.assign(Re(this.iteration,1)),this.accBeta1.assign(re(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Ct(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Ct(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class o1 extends Ai{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const a=Array.isArray(e)?e[s].tensor:e[r];if(a==null)return;const o=Q.registeredVariables[r];he(()=>{const i=Re(re(this.c,a),o);o.assign(i)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Qn(st(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uT extends o1{static get className(){return"Momentum"}constructor(e,t,r=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=r,this.accumulations=[],this.m=st(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const a=Q.registeredVariables[r];this.accumulations[s]==null&&(this.accumulations[s]={originalName:`${r}/momentum`,variable:he(()=>Lt(a).variable(!1))});const o=this.accumulations[s].variable,i=Array.isArray(e)?e[s].tensor:e[r];i!=null&&he(()=>{let u;const l=Re(re(this.m,o),i);this.useNesterov?u=Re(re(this.c,Re(i,re(l,this.m))),a):u=Re(re(this.c,l),a),o.assign(l),a.assign(u)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Ct(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lT extends Ai{static get className(){return"RMSProp"}constructor(e,t=.9,r=0,s=null,a=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=r,this.epsilon=s,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=a,s==null&&(this.epsilon=Q.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const a=Q.registeredVariables[r],o=!1;this.accumulatedMeanSquares[s]==null&&(this.accumulatedMeanSquares[s]={originalName:`${r}/rms`,variable:he(()=>Lt(a).variable(o))}),this.accumulatedMoments[s]==null&&(this.accumulatedMoments[s]={originalName:`${r}/momentum`,variable:he(()=>Lt(a).variable(o))}),this.accumulatedMeanGrads[s]==null&&this.centered&&(this.accumulatedMeanGrads[s]={originalName:`${r}/mg`,variable:he(()=>Lt(a).variable(o))});const i=Array.isArray(e)?e[s].tensor:e[r];if(i==null)return;const u=this.accumulatedMeanSquares[s].variable,l=this.accumulatedMoments[s].variable;he(()=>{const c=Re(re(u,this.decay),re(Qt(i),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[s].variable,p=Re(re(d,this.decay),re(i,1-this.decay)),m=Qe(re(i,this.learningRate),pr(ze(c,Re(Qt(p),this.epsilon)))),v=Re(re(l,this.momentum),m);u.assign(c),d.assign(p),l.assign(v);const b=ze(a,v);a.assign(b)}else{const d=Re(re(u,this.decay),re(Qt(i),1-this.decay)),p=Re(re(l,this.momentum),Qe(re(i,this.learningRate),pr(Re(d,this.epsilon))));u.assign(d),l.assign(p);const m=ze(a,p);a.assign(m)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Ct(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Ct(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Ct(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,r=!1;this.accumulatedMeanSquares=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedMoments=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PY=[sT,aT,oT,iT,uT,lT,o1];function BY(){for(const n of PY)De(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zY="model",VY=".json",UY=".weights.bin";function u$(n){return new Promise(e=>setTimeout(e)).then(n)}class tc{constructor(e){if(!de().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(tc.URL_SCHEME)&&(e=e.slice(tc.URL_SCHEME.length)),(e==null||e.length===0)&&(e=zY),this.modelJsonFileName=e+VY,this.weightDataFileName=e+UY}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=no.join(e.weightData),r=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const s=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=JF(e,s),o=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),i=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(i.download=this.modelJsonFileName,i.href=o,await u$(()=>i.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;u.download=this.weightDataFileName,u.href=r,await u$(()=>u.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:bg(e)}}}}tc.URL_SCHEME="downloads://";class WY{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,t)=>{const r=new FileReader;r.onload=s=>{const a=JSON.parse(s.target.result),o=a.modelTopology;if(o==null){t(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(a.weightsManifest==null){t(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:o});return}const u=QN(a,l=>this.loadWeights(l));e(u)},r.onerror=s=>t(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),r.readAsText(this.jsonFile)})}loadWeights(e){const t=[],r=[];for(const o of e)t.push(...o.weights),r.push(...o.paths);const s=this.checkManifestAndWeightFiles(e),a=r.map(o=>this.loadWeightsFile(o,s[o]));return Promise.all(a).then(o=>[t,o])}loadWeightsFile(e,t){return new Promise((r,s)=>{const a=new FileReader;a.onload=o=>{const i=o.target.result;r(i)},a.onerror=o=>s(`Failed to weights data from file of path '${e}'.`),a.readAsArrayBuffer(t)})}checkManifestAndWeightFiles(e){const t=[],r=this.weightsFiles.map(a=>ZD(a.name)),s={};for(const a of e)a.paths.forEach(o=>{const i=ZD(o);if(t.indexOf(i)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${i}'`);if(t.push(i),r.indexOf(i)===-1)throw new Error(`Weight file with basename '${i}' is not provided.`);s[o]=this.weightsFiles[r.indexOf(i)]});if(t.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${t.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return s}}const GY=n=>de().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(tc.URL_SCHEME)?HY(n.slice(tc.URL_SCHEME.length)):null;bn.registerSaveRouter(GY);function HY(n="model"){return new tc(n)}function jY(n){return new WY(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l$(n,e,t,r){o(n),t=t??0,r=r??1,i(t,r);let s=0;const a=u=>(u.then(l=>{const c=t+ ++s/n.length*(r-t);return e(c),l}),u);function o(u){B(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function i(u,l){B(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),B(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${l}`),B(l>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${l}`)}return Promise.all(n.map(a))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function f4(n,e){e==null&&(e={});const t=e.fetchFunc==null?de().platform.fetch:e.fetchFunc,r=n.map(d=>t(d,e.requestInit,{isBinary:!0})),i=(e.onProgress==null?await Promise.all(r):await l$(r,e.onProgress,0,.5)).map(d=>d.arrayBuffer());return e.onProgress==null?await Promise.all(i):await l$(i,e.onProgress,.5,1)}function qY(n,e){var t;const r=e.fetchFunc==null?de().platform.fetch:e.fetchFunc;let s=0,a;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async o=>{for(var i;s<n.length;){a||(a=(await r(n[s],e.requestInit,{isBinary:!0})).body.getReader());const{done:u,value:l}=await a.read();if(u){s++,a=void 0,(i=e.onProgress)===null||i===void 0||i.call(e,s/n.length);continue}o.enqueue(l);return}o.close()}})}async function KY(n,e="",t,r){return p4(o=>f4(o,{requestInit:r}))(n,e,t)}function p4(n){return async(e,t="",r)=>{const s=e.map(()=>!1),a={},o=r!=null?r.map(()=>!1):[],i=[];if(e.forEach((m,v)=>{let b=0;m.weights.forEach(y=>{const w="quantization"in y?y.quantization.dtype:y.dtype,S=ql[w]*xe(y.shape),N=()=>{s[v]=!0,a[v]==null&&(a[v]=[]),a[v].push({manifestEntry:y,groupOffset:b,sizeBytes:S})};r!=null?r.forEach((C,T)=>{C===y.name&&(N(),o[T]=!0)}):N(),i.push(y.name),b+=S})}),!o.every(m=>m)){const m=r.filter((v,b)=>!o[b]);throw new Error(`Could not find weights in manifest with names: ${m.join(", ")}. 
Manifest JSON has weights with names: ${i.join(", ")}.`)}const u=s.reduce((m,v,b)=>(v&&m.push(b),m),[]),l=[];u.forEach(m=>{e[m].paths.forEach(v=>{const b=t+(t.endsWith("/")?"":"/")+v;l.push(b)})});const c=await n(l),d={};let p=0;return u.forEach(m=>{const v=e[m].paths.length,b=new no(c.slice(p,p+v));a[m].forEach(w=>{const S=b.slice(w.groupOffset,w.groupOffset+w.sizeBytes),N=XF(S,[w.manifestEntry]);for(const C in N)d[C]=N[C]}),p+=v}),d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XY="application/octet-stream",YY="application/json";class cT{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(B(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=de().platform.fetch,B(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&B(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],s=JF(e,r);if(t.body.append("model.json",new Blob([JSON.stringify(s)],{type:YY}),"model.json"),e.weightData!=null){const o=no.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:XY}),"model.weights.bin")}const a=await this.fetch(this.path,t);if(a.ok)return{modelArtifactsInfo:bg(e),responses:[a]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${a.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const r=t.modelTopology,s=t.weightsManifest;if(r==null&&s==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return QN(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),r=wb(e.weightsManifest),s=()=>qY(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:r,getWeightStream:s})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[r,s]=ZY(t),a=this.weightPathPrefix||r,o=[],i=[];for(const u of e)for(const l of u.paths)this.weightUrlConverter!=null?i.push(this.weightUrlConverter(l)):o.push(a+l+s);return this.weightUrlConverter&&o.push(...await Promise.all(i)),o}async loadWeights(e){const t=await this.getWeightUrls(e),r=wb(e),s=await f4(t,this.loadOptions);return[r,s]}}cT.URL_SCHEME_REGEX=/^https?:\/\//;function ZY(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),r=n.substring(0,e),s=t>e?n.substring(t):"";return[r+"/",s]}function AC(n){return n.match(cT.URL_SCHEME_REGEX)!=null}const m4=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(r=>AC(r)):t=AC(n),t)return hT(n,e)}return null};bn.registerSaveRouter(m4);bn.registerLoadRouter(m4);function hT(n,e){return new cT(n,e)}function QY(n,e){return hT(n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yS{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class g4{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class JY{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}}function eZ(n,e,t,r){const s=arguments;return new JY(Cb(...s))}function Cb(n,e,t,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new yS(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new yS({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new yS({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))}function tZ(n){return new g4(n)}function nZ(n){return new g4(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dT=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:no,browserFiles:jY,browserHTTPRequest:QY,concatenateArrayBuffers:QF,copyModel:Dq,decodeWeights:XF,decodeWeightsStream:ZF,encodeWeights:CC,fromMemory:eZ,fromMemorySync:Cb,getLoadHandlers:yq,getModelArtifactsForJSON:QN,getModelArtifactsForJSONSync:ZN,getModelArtifactsInfoForJSON:bg,getSaveHandlers:eM,getWeightSpecs:wb,http:hT,isHTTPScheme:AC,listModels:Rq,loadWeights:KY,moveModel:$q,registerLoadRouter:vq,registerSaveRouter:gq,removeModel:Aq,weightsLoaderFactory:p4,withSaveHandler:tZ,withSaveHandlerSync:nZ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rZ(n,e,t){const r=U(n,"labels","confusionMatrix"),s=U(e,"predictions","confusionMatrix");B(t==null||t>0&&Number.isInteger(t),()=>`If provided, numClasses must be a positive integer, but got ${t}`),B(r.rank===1,()=>`Expected the rank of labels to be 1, but got ${r.rank}`),B(s.rank===1,()=>`Expected the rank of predictions to be 1, but got ${s.rank}`),B(r.shape[0]===s.shape[0],()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${s.shape[0]}. Labels and predictions should have the same number of elements.`),B(t>0&&Number.isInteger(t),()=>`numClasses is required to be a positive integer, but got ${t}`);const a=Gh(Fe(r,"int32"),t),o=Gh(Fe(s,"int32"),t),i=Dt(a),u=St(i,o);return Fe(u,"int32")}const sZ=ee({confusionMatrix_:rZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aZ=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:sZ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let wl,c$=!1;function v4(n,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let t=!1,r=!1,s=!1,a=!1,o=!1,i=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)s=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)a=!0;else if(n.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)i=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${n.constructor.name}`);if(jp(bb,Q.backendName)!=null){const v={pixels:n},b={numChannels:e};return Q.runKernel(bb,v,b)}const[l,c]=s?[n.videoWidth,n.videoHeight]:[n.width,n.height];let d;if(o)d=n.getContext("2d").getImageData(0,0,l,c).data;else if(r||t)d=n.data;else if(a||s||i){if(wl==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")wl=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else wl=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});wl.canvas.width=l,wl.canvas.height=c,wl.drawImage(n,0,0,l,c),d=wl.getImageData(0,0,l,c).data}let p;if(e===4)p=new Int32Array(d);else{const v=l*c;p=new Int32Array(v*e);for(let b=0;b<v;b++)for(let y=0;y<e;++y)p[b*e+y]=d[b*4+y]}return qk(p,[c,l,e],"int32")}function oZ(n){return n!=null&&n.data instanceof Uint8Array}function iZ(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function uZ(n){return n!=null&&n.width!==0&&n.height!==0}function lZ(n){return iZ()&&!(n instanceof ImageBitmap)&&uZ(n)&&!oZ(n)}async function cZ(n,e=3){let t=null;if(de().getBool("WRAP_TO_IMAGEBITMAP")&&lZ(n)){let r;try{r=await createImageBitmap(n,{premultiplyAlpha:"none"})}catch{r=null}r!=null&&r.width===n.width&&r.height===n.height?t=r:t=n}else t=n;return v4(t,e)}function y4(n){if(n.rank!==2&&n.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const e=n.rank===2?1:n.shape[2];if(e>4||e===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${e}`);if(n.dtype!=="float32"&&n.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`)}function hZ(n){const e=(n==null?void 0:n.alpha)||1;if(e>1||e<0)throw new Error(`Alpha value ${e} is suppoed to be in range [0 - 1].`)}async function dZ(n,e){let t=U(n,"img","toPixels");if(!(n instanceof Gt)){const l=t;t=Fe(l,"int32"),l.dispose()}y4(t);const[r,s]=t.shape.slice(0,2),a=t.rank===2?1:t.shape[2],o=await t.data(),i=t.dtype==="float32"?255:1,u=new Uint8ClampedArray(s*r*4);for(let l=0;l<r*s;++l){const c=[0,0,0,255];for(let p=0;p<a;p++){const m=o[l*a+p];if(t.dtype==="float32"){if(m<0||m>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${m}.`)}else if(t.dtype==="int32"&&(m<0||m>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${m}.`);a===1?(c[0]=m*i,c[1]=m*i,c[2]=m*i):c[p]=m*i}const d=l*4;u[d+0]=Math.round(c[0]),u[d+1]=Math.round(c[1]),u[d+2]=Math.round(c[2]),u[d+3]=Math.round(c[3])}if(e!=null){c$||jp(O0,Q.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),c$=!0),e.width=s,e.height=r;const l=e.getContext("2d"),c=new ImageData(u,s,r);l.putImageData(c,0,0)}return t!==n&&t.dispose(),u}function fZ(n,e,t){let r=U(n,"img","draw");if(!(n instanceof Gt)){const o=r;r=Fe(o,"int32"),o.dispose()}y4(r),hZ(t==null?void 0:t.imageOptions);const s={image:r},a={canvas:e,options:t};Q.runKernel(O0,s,a)}const pZ=ee({fromPixels_:v4}),mZ=Object.freeze(Object.defineProperty({__proto__:null,draw:fZ,fromPixels:pZ,fromPixelsAsync:cZ,toPixels:dZ},Symbol.toStringTag,{value:"Module"}));function i1(n,e){const t=n.shape.length,r=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${t}`);if(xe(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const s=e.shape,a=s[s.length-1];let o=1;for(let d=0;d<s.length-1;++d)o*=s[d];const i=n.shape,u=s.slice();u.pop();let l=1;for(let d=a;d<t;++d)l*=i[d],u.push(i[d]);const c=[...rt(n.shape).map(d=>d/l),1].slice(0,a);return[u,o,l,c]}const gZ=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:i1},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DC=-2,vZ=-1;function fT(n,e,t){const r=n.shape.length;B(r===e.length,()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`),B(r===t.length,()=>`Error in slice${r}D: Length of size ${t} must match the rank of the array (${r}).`);for(let s=0;s<r;++s)B(e[s]+t[s]<=n.shape[s],()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+t[s]}) would overflow input.shape[${s}] (${n.shape[s]})`)}function yZ(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function pT(n,e,t){const r=[];for(let s=0;s<n.length;s++)r[s]=Math.ceil((e[s]-n[s])/t[s]);return r}function b4(n,e,t,r){const s=[...n];for(let a=s.length;a<r.length;a++)s.push(1);for(let a=0;a<t;a++)a===0?s[e]=1:(s.splice(e,0,1),s.pop());return s}function x4(n,e,t){return t<=n?t:t-(e-1)}function w4(n,e){const t=[];for(let r=0;r<n;r++)t.push(e+r);return t}function bZ(n,e,t,r,s,a,o,i,u){const l=n.length;let c=new Array(l),d=new Array(l),p=new Array(l);if(e.length&&t>0){const m=e[0],v=t+1;c=S4(o,m,v,r,n),d=C4(i,m,v,s,n),p=b4(a,m,v,n)}else for(let m=0;m<l;m++)c[m]=k4(o,r,a,n,m,u),d[m]=T4(i,s,a,n,m,u),p[m]=N4(a,m,u);return{begin:c,end:d,strides:p}}function S4(n,e,t,r,s){const a=[...s],o=w4(t,e);for(let i=0;i<a.length;i++)if(o.indexOf(i)>-1)a[i]=0;else{const u=x4(e,t,i);let l=r[u];n&1<<u&&(l=0),a[i]=l}return a}function C4(n,e,t,r,s){const a=[...s],o=w4(t,e);for(let i=0;i<a.length;i++)if(o.indexOf(i)>-1)a[i]=Number.MAX_SAFE_INTEGER;else{const u=x4(e,t,i);let l=r[u];n&1<<u&&(l=Number.MAX_SAFE_INTEGER),a[i]=l}for(let i=0;i<a.length;i++){const u=s[i];a[i]<0&&(a[i]+=u),a[i]=Iu(0,a[i],s[i])}return a}function N4(n,e,t){let r=n[e];return(t&1<<e||r==null)&&(r=1),r}function k4(n,e,t,r,s,a){let o=e[s];const i=t[s]||1;(n&1<<s||a&1<<s||o==null)&&(i>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const u=r[s];return o<0&&(o+=u),o=Iu(0,o,u-1),o}function T4(n,e,t,r,s,a){let o=e[s];const i=t[s]||1;(n&1<<s||a&1<<s||o==null)&&(i>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const u=r[s];return o<0&&(o+=u),i>0?o=Iu(0,o,u):o=Iu(-1,o,u-1),o}function mT(n,e,t){let r=t.length;for(let s=0;s<t.length;s++)if(t[s]>1){r=s;break}for(let s=r+1;s<t.length;s++)if(e[s]>0||t[s]!==n[s])return!1;return!0}function gT(n,e){let t=n.length>0?n[n.length-1]:1;for(let r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function u1(n,e,t){let r;const s=n.shape.length;typeof e=="number"?r=[e,...new Array(s-1).fill(0)]:e.length<s?r=e.concat(new Array(s-e.length).fill(0)):r=e.slice(),r.forEach(o=>{B(o!==-1,()=>"slice() does not support negative begin indexing.")});let a;return t==null?a=new Array(s).fill(-1):typeof t=="number"?a=[t,...new Array(s-1).fill(-1)]:t.length<s?a=t.concat(new Array(s-t.length).fill(-1)):a=t,a=a.map((o,i)=>o>=0?o:(B(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${i}.`),n.shape[i]-r[i])),[r,a]}function vT(n,e,t,r,s,a,o,i,u){let l;if(r==null?(l=new Array(e.length),l.fill(1)):l=r,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const d={dims:l.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:l.slice(),beginMask:s,endMask:a,ellipsisMask:o,newAxisMask:i,shrinkAxisMask:u};for(let N=0;N<d.dims;N++)c&&(1<<N&i)!==0&&d.numAddAxisAfterEllipsis++,1<<N&o&&(c=!0);c||(d.ellipsisMask|=1<<d.dims,d.dims++);const p={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};xZ(d,p);let m=!0,v=!0,b=!0;const y=[],w=[];for(let N=0;N<n.length;++N){if(p.strides[N]===0)throw Error(`strides[${N}] must be non-zero`);const C=!!(p.shrinkAxisMask&1<<N),T=n[N];if(T===-1){y.push(C?1:-1);continue}const E=[p.beginMask&1<<N,p.endMask&1<<N],$=[p.strides[N]>0?0:-1,p.strides[N]>0?T:T-1];if(C&&p.strides[N]<=0)throw Error("only stride 1 allowed on non-range indexing.");b=b&&p.strides[N]===1;const _=!!(p.beginMask&1<<N&&p.endMask&1<<N);if(p.beginValid&&p.endValid){if(C){const M=p.begin[N]<0?T+p.begin[N]:p.begin[N];if(p.begin[N]=M,p.end[N]=p.begin[N]+1,M<0||M>=T)throw Error(`slice index ${p.begin[N]} of dimension ${N} out of bounds.`)}else p.begin[N]=h$(p.begin[N],0,p.strides[N],T,E,$),p.end[N]=h$(p.end[N],1,p.strides[N],T,E,$);const A=p.strides[N]===1&&p.begin[N]===0&&p.end[N]===T;m=m&&A,v=v&&(N===0&&p.strides[N]===1||A)}else m=m&&p.strides[N]===1&&_,v=v&&(N===0&&p.strides[N]===1||_);let R,D=!1;if(p.beginValid&&p.endValid?(R=p.end[N]-p.begin[N],D=!0):C?(R=1,D=!0):_&&T>=0&&(p.strides[N]<0?R=-T:R=T,D=!0),D){let A;R===0||R<0!=p.strides[N]<0?A=0:A=Math.trunc(R/p.strides[N])+(R%p.strides[N]!==0?1:0),y.push(A)}else y.push(-1)}for(let N=0;N<p.finalShapeGatherIndices.length;++N){const C=p.finalShapeGatherIndices[N];C>=0?w.push(y[C]):C===DC&&w.push(1)}return{finalShapeSparse:w.filter((N,C)=>p.finalShapeGatherIndices[C]!==DC),finalShape:w,isIdentity:m,sliceDim0:v,isSimpleSlice:b,begin:p.begin,end:p.end,strides:p.strides}}function xZ(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<n.dims;r++)if(1<<r&n.ellipsisMask){const s=Math.min(e.dims-(n.dims-r)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<s;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=r}else if(1<<r&n.newAxisMask)e.finalShapeGatherIndices.push(DC),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[r]),n.end!=null&&(e.end[t]=n.end[r]),e.strides[t]=n.strides[r],n.beginMask&1<<r&&(e.beginMask|=1<<t),n.endMask&1<<r&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(vZ),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[t]=r,t++}}function h$(n,e,t,r,s,a){if(s[e])return t>0?a[e]:a[e+1&1];{const o=n<0?r+n:n;return o<a[0]?a[0]:o>a[1]?a[1]:o}}const I4=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:fT,computeFlatOffset:gT,computeOutShape:pT,getNormalizedAxes:bZ,isSliceContinous:mT,maskToAxes:yZ,parseSliceParams:u1,sliceInfo:vT,startForAxis:k4,startIndicesWithElidedDims:S4,stopForAxis:T4,stopIndicesWithElidedDims:C4,stridesForAxis:N4,stridesWithElidedDims:b4},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const wZ="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E4{static sgd(e){return new o1(e)}static momentum(e,t,r=!1){return new uT(e,t,r)}static rmsprop(e,t=.9,r=0,s=null,a=!1){return new lT(e,t,r,s,a)}static adam(e=.001,t=.9,r=.999,s=null){return new oT(e,t,r,s)}static adadelta(e=.001,t=.95,r=null){return new sT(e,t,r)}static adamax(e=.002,t=.9,r=.999,s=null,a=0){return new iT(e,t,r,s,a)}static adagrad(e,t=.1){return new aT(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tl=E4;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SZ=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function yT(){return new Promise(n=>SZ(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bT(n,e){const t=n[0].length;n.forEach((s,a)=>{B(s.length===t,()=>`Error in concat${t}D: rank of tensors[${a}] must be the same as the rank of the rest (${t})`)}),B(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const r=n[0];n.forEach((s,a)=>{for(let o=0;o<t;o++)B(o===e||s[o]===r[o],()=>`Error in concat${t}D: Shape of tensors[${a}] (${s}) does not match the shape of the rest (${r}) along the non-concatenated axis ${a}.`)})}function Io(n,e){const t=n[0].slice();for(let r=1;r<n.length;r++)t[e]+=n[r][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Wa;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Wa||(Wa={}));function _4(n,e,t){let r=new Array;if(t==null&&e==null)return r;if(e==null)for(;r.length<n+t.length;)r.push(-1);else r=e.slice();if(t==null)return r;if(n+t.length!==r.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${r.length}`);for(let s=1;s<t.length;++s){const a=t[s],o=r[r.length-t.length+s],i=r[o];if(a>=0)if(i>=0){if(i!==a)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${s+n}] = ${a} but shape[${s+n}] = ${i}`)}else r[o]=a}return r}function R4(n){const e={FIRST_DIM_SIZE:Wa.FIRST_DIM_SIZE,VALUE_ROWIDS:Wa.VALUE_ROWIDS,ROW_LENGTHS:Wa.ROW_LENGTHS,ROW_SPLITS:Wa.ROW_SPLITS,ROW_LIMITS:Wa.ROW_LIMITS,ROW_STARTS:Wa.ROW_STARTS},t=[];for(const r of n)if(r in e)t.push(e[r]);else break;return t}function A4(n){return n.length===0?0:n[0]===Wa.FIRST_DIM_SIZE?n.length-1:n.length}function D4(n,e){if(n==null||e==null)return;const t=n.length,r=e.length;if(t>=r)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${r})`);for(let s=0;s<Math.min(t,r-1);++s){const a=n[s],o=e[s+1];if(a>=0&&o>=0&&a!==1&&a!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${s-n.length}] = ${a} but ragged tensor input.flatValues.shape[${s-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xT=30;function l1(n){return n<=xT?n:gb(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wT(n,e,t){const r=t*(typeof n=="number"?n:n[0]),s=e*(typeof n=="number"?n:n[1]);return[r,s]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pg(n,e,t,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(n[0]/t),s=s.concat(n.slice(1));else{s=s.concat(n[0]);const a=e.length;for(let o=0;o<a;++o)s=s.concat([n[o+1]/e[o],e[o]]);s=s.concat(n.slice(a+1))}return s}function Bg(n,e,t=!0){const r=[];if(t){r.push(e);for(let s=e+1;s<n;++s)s<=2*e?(r.push(s),r.push(s-(e+1))):r.push(s)}else{const s=[],a=[];for(let o=1;o<n;++o)o>=e*2+1||o%2===1?a.push(o):s.push(o);r.push(...s),r.push(0),r.push(...a)}return r}function zg(n,e,t,r=!0){const s=[];r?s.push(n[0]/t):s.push(n[0]*t);for(let a=1;a<n.length;++a)a<=e.length?r?s.push(e[a-1]*n[a]):s.push(n[a]/e[a-1]):s.push(n[a]);return s}function ST(n,e){const t=[0];for(let r=0;r<e;++r)t.push(n[r][0]);return t}function CT(n,e,t){const r=n.slice(0,1);for(let s=0;s<t;++s)r.push(n[s+1]-e[s][0]-e[s][1]);return r}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c1=1.7580993408473768,h1=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NT=.3275911,kT=.254829592,TT=-.284496736,IT=1.421413741,ET=-1.453152027,_T=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Si(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function $4(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let r=0;r<n.length;r+=2)e[r/2]=n[r],t[r/2]=n[r+1];return{real:e,imag:t}}function O4(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let s=0;s<n.length;s+=4)t[Math.floor(s/4)]=n[s],r[Math.floor(s/4)]=n[s+1];return{real:t,imag:r}}function F4(n){const e=Math.floor(n.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let s=2;s<n.length;s+=4)t[Math.floor(s/4)]=n[s],r[Math.floor(s/4)]=n[s+1];return{real:t,imag:r}}function RT(n,e){const t=n[e*2],r=n[e*2+1];return{real:t,imag:r}}function M4(n,e,t,r){n[r*2]=e,n[r*2+1]=t}function L4(n,e){const t=new Float32Array(n/2),r=new Float32Array(n/2);for(let s=0;s<Math.ceil(n/2);s++){const a=(e?2:-2)*Math.PI*(s/n);t[s]=Math.cos(a),r[s]=Math.sin(a)}return{real:t,imag:r}}function P4(n,e,t){const r=(t?2:-2)*Math.PI*(n/e),s=Math.cos(r),a=Math.sin(r);return{real:s,imag:a}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bS="->",CZ=/->/g,d$=",",f$="...";function AT(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(CZ,"").length)/bS.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${bS}").`);const[r,s]=n.split(bS);B(r.indexOf(f$)===-1,()=>`The ellipsis notation ("${f$}") is not supported yet.`);const a=r.split(d$),o=a.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const i=[];for(let p=0;p<s.length;++p){const m=s[p];if(!a.some(v=>v.indexOf(m)!==-1))throw new Error(`Output subscripts contain the label ${m} not present in the input subscripts.`);i.indexOf(m)===-1&&i.push(m)}for(let p=0;p<r.length;++p){const m=r[p];i.indexOf(m)===-1&&m!==d$&&i.push(m)}const u=new Array(a.length);for(let p=0;p<o;++p){if(new Set(a[p].split("")).size!==a[p].length)throw new Error(`Found duplicate axes in input component ${a[p]}. Support for duplicate axes in input is not implemented yet.`);u[p]=[];for(let m=0;m<a[p].length;++m)u[p].push(i.indexOf(a[p][m]))}const l=i.length,c=s.length,d=[];for(let p=c;p<l;++p)d.push(p);return{allDims:i,summedDims:d,idDims:u}}function DT(n,e){let t=new Array(n);t.fill(-1);for(let s=0;s<e.length;++s)t[e[s]]=s;const r=[];for(let s=0;s<n;++s)t[s]===-1&&r.push(s);return t=t.filter(s=>s!==-1),{permutationIndices:t,expandDims:r}}function $T(n,e,t){const r=new Array(n);for(let s=0;s<t.length;++s){const a=t[s].shape;for(let o=0;o<e[s].length;++o)r[e[s][o]]===void 0?r[e[s][o]]=a[o]:B(r[e[s][o]]===a[o],()=>`Expected dimension ${r[e[s][o]]} at axis ${o} of input shaped ${JSON.stringify(a)}, but got dimension ${a[o]}`)}}function OT(n,e){const t=n,r=[];let s=0;n.length===0&&t.push(-1),s=n.length+1;for(let o=0;o<s;++o)r.push([]);const a=[];for(let o=0;o<t.length;++o){const i=t[o],u=NZ(e,i);for(const l of u)a.indexOf(l)===-1&&(r[o].push(l),a.push(l))}return{path:t,steps:r}}function FT(n){return n.every((e,t)=>e===t)}function NZ(n,e){const t=[];for(let r=0;r<n.length;++r)(n[r].length===0||n[r].indexOf(e)!==-1||e===-1)&&t.push(r);return t}function MT(n,e,t=0){let r=[];if(typeof e=="number")B(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),r=new Array(e).fill(n.shape[t]/e);else{const s=e.reduce((o,i)=>(i===-1&&(o+=1),o),0);B(s<=1,()=>"There should be only one negative value in split array.");const a=e.indexOf(-1);if(a!==-1){const o=e.reduce((i,u)=>u>0?i+u:i);e[a]=n.shape[t]-o}B(n.shape[t]===e.reduce((o,i)=>o+i),()=>"The sum of sizes must match the size of the axis dimension."),r=e}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B4(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function z4(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function V4(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U4(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function W4(n,e){return`size ${n} must be non-negative, not ${e}`}function G4(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function H4(n,e){const t=xe(n),r=xe(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${n} outputShape= ${e}`}function j4(n,e){const t=xe(n),r=xe(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${r}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $C(){return"segment ids must be >= 0"}function q4(){return"segment ids are not increasing"}function K4(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function X4(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y4(n,e){let t=!1,r;for(n<=xT?(r=n,t=!0):r=gb(n,Math.floor(Math.sqrt(n)));!t;)r>e||r===n?t=!0:r=gb(n,r+1);return r}function Z4(n,e,t){const r=[],s=n.length;for(let a=0;a<s;a++)a!==e?r.push(n[a]):r.push(t);return r}function LT(n,e,t,r){const s=e.shape.length,a=n.shape.length;if(r!==0&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>a)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${a}).`);if(t<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${t}).`);for(let d=0;d<r;++d)if(n.shape[d]!==e.shape[d])throw new Error(`x.shape[${d}]: ${n.shape[d]} should be equal to indices.shape[${d}]: ${e.shape[d]}.`);const o=n.shape[t],i=[];let u=1,l=1,c=1;for(let d=0;d<r;++d)i.push(n.shape[d]),u*=n.shape[d];for(let d=r;d<t;d++)i.push(n.shape[d]),l*=n.shape[d];for(let d=r;d<s;d++)i.push(e.shape[d]);for(let d=t+1;d<a;d++)i.push(n.shape[d]),c*=n.shape[d];return{batchSize:u,sliceSize:c,outerSize:l,dimSize:o,outputShape:i}}const kZ=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:LT,computeOutShape:Z4,segOpComputeOptimalWindowSize:Y4},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ci(n){try{return n.map(e=>bi(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function Q4(n){return n.map(e=>ko(e))}const J4=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:kT,ERF_A2:TT,ERF_A3:IT,ERF_A4:ET,ERF_A5:_T,ERF_P:NT,PARALLELIZE_THRESHOLD:xT,get RowPartitionType(){return Wa},SELU_SCALE:h1,SELU_SCALEALPHA:c1,applyActivation:t1,assertAndGetBroadcastShape:mt,assertAxesAreInnerMostDims:Or,assertParamsConsistent:bT,assignToTypedArray:M4,axesAreInnerMostDims:Tk,calculateShapes:Ku,checkEinsumDimSizes:$T,checkPadOnDimRoundingMode:us,combineLocations:mM,combineRaggedTensorToTensorShapes:_4,complexWithEvenIndex:O4,complexWithOddIndex:F4,computeConv2DInfo:vr,computeConv3DInfo:Wu,computeDefaultPad:uk,computeDilation2DInfo:xg,computeOptimalWindowSize:l1,computeOutAndReduceShapes:yr,computeOutShape:Io,computePool2DInfo:Da,computePool3DInfo:Ti,convertConv2DDataFormat:Ii,decodeEinsumEquation:AT,eitherStridesOrDilationsAreOne:$r,expandShapeToKeepDim:Fn,exponent:P4,exponents:L4,fromStringArrayToUint8:Q4,fromUint8ToStringArray:Ci,getAxesPermutation:Cn,getBroadcastDims:Ql,getComplexWithIndex:RT,getEinsumComputePath:OT,getEinsumPermutation:DT,getFusedBiasGradient:e1,getFusedDyActivation:Jx,getImageCenter:wT,getInnerMostAxes:Mn,getPermuted:Bg,getRaggedRank:A4,getReductionAxes:jn,getReshaped:Pg,getReshapedPermuted:zg,getRowPartitionTypesHelper:R4,getSliceBeginCoords:ST,getSliceSize:CT,getSparseFillEmptyRowsIndicesDenseShapeMismatch:B4,getSparseFillEmptyRowsNegativeIndexErrorMessage:z4,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:V4,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:G4,getSparseReshapeInputOutputMismatchErrorMessage:j4,getSparseReshapeInputOutputMultipleErrorMessage:H4,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:U4,getSparseReshapeNegativeOutputDimErrorMessage:W4,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:X4,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:$C,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:q4,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:K4,getUndoAxesPermutation:Gu,isIdentityPermutation:FT,log:g5,mergeRealAndImagArrays:Si,prepareAndValidate:i1,prepareSplitSize:MT,segment_util:kZ,shouldFuse:n1,slice_util:I4,splitRealAndImagArrays:$4,stridesOrDilationsArePositive:Zl,tupleValuesAreOne:Au,upcastType:ms,validateDefaultValueShape:D4,validateInput:Kx,validateUpdateShape:Kk,warn:Js},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TZ=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:r1,nonMaxSuppressionV4Impl:s1,nonMaxSuppressionV5Impl:a1,whereImpl:Zx},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */BY();const IZ=Object.freeze(Object.defineProperty({__proto__:null,Abs:mm,Acos:od,Acosh:id,AdadeltaOptimizer:sT,AdagradOptimizer:aT,AdamOptimizer:oT,AdamaxOptimizer:iT,Add:fc,AddN:gm,All:v0,Any:y0,ArgMax:vm,ArgMin:ym,Asin:ud,Asinh:ld,Atan:cd,Atan2:dd,Atanh:hd,AvgPool:bm,AvgPool3D:xm,AvgPool3DGrad:x0,AvgPoolGrad:b0,BatchMatMul:wm,BatchToSpaceND:Sm,Bincount:w0,BitwiseAnd:Cm,BroadcastArgs:S0,BroadcastTo:AF,Cast:fd,Ceil:pd,ClipByValue:md,Complex:C0,ComplexAbs:Nm,Concat:km,Conv2D:Tm,Conv2DBackpropFilter:N0,Conv2DBackpropInput:Im,Conv3D:Em,Conv3DBackpropFilterV2:k0,Conv3DBackpropInputV2:T0,Cos:gd,Cosh:vd,CropAndResize:E0,Cumprod:I0,Cumsum:_m,DataStorage:MN,DenseBincount:_0,DepthToSpace:R0,DepthwiseConv2dNative:Rm,DepthwiseConv2dNativeBackpropFilter:A0,DepthwiseConv2dNativeBackpropInput:D0,Diag:$0,Dilation2D:Am,Dilation2DBackpropFilter:yb,Dilation2DBackpropInput:vb,Draw:O0,get ENV(){return VN},Einsum:F0,Elu:bd,EluGrad:M0,Environment:_F,Equal:Dm,Erf:xd,Exp:wd,ExpandDims:$m,Expm1:Sd,FFT:L0,Fill:P0,FlipLeftRight:B0,Floor:Cd,FloorDiv:Nd,FromPixels:bb,FusedBatchNorm:Om,FusedConv2D:Wp,FusedDepthwiseConv2D:Gp,GatherNd:z0,GatherV2:Fm,Greater:Mm,GreaterEqual:kd,IFFT:V0,Identity:Td,Imag:U0,IsFinite:Id,IsInf:Ed,IsNan:_d,KernelBackend:p0,LRN:Wm,LRNGrad:G0,LeakyRelu:Lm,Less:Pm,LessEqual:Bm,LinSpace:W0,Log:Rd,Log1p:Ad,LogSoftmax:DF,LogicalAnd:zm,LogicalNot:Vm,LogicalOr:Um,LogicalXor:h5,LowerBound:d5,MatrixBandPart:f5,Max:Gm,MaxPool:Hm,MaxPool3D:jm,MaxPool3DGrad:j0,MaxPoolGrad:H0,MaxPoolWithArgmax:q0,Maximum:Dd,Mean:qm,Min:Km,Minimum:$d,MirrorPad:Xm,Mod:Od,MomentumOptimizer:uT,Multinomial:K0,Multiply:Fd,Neg:Ym,NonMaxSuppressionV3:X0,NonMaxSuppressionV4:Y0,NonMaxSuppressionV5:Z0,NotEqual:Zm,OP_SCOPE_SUFFIX:qN,OneHot:Jm,OnesLike:Qm,Optimizer:Ai,OptimizerConstructors:E4,Pack:eg,PadV2:tg,Pool:p5,Pow:Md,Prelu:ng,Prod:rg,RMSPropOptimizer:lT,RaggedGather:Q0,RaggedRange:J0,RaggedTensorToTensor:ex,Range:tx,get Rank(){return gC},Real:nx,RealDiv:yd,Reciprocal:Ld,get Reduction(){return ts},Relu:Pd,Relu6:Bd,Reshape:sg,ResizeBilinear:og,ResizeBilinearGrad:sx,ResizeNearestNeighbor:ag,ResizeNearestNeighborGrad:rx,Reverse:ig,RotateWithOffset:wx,Round:zd,Rsqrt:Vd,SGDOptimizer:o1,ScatterNd:ax,SearchSorted:ix,Select:ug,Selu:Ud,Sigmoid:jd,Sign:Hd,Sin:Wd,Sinh:Gd,Slice:lg,Softmax:fg,Softplus:qd,SpaceToBatchND:hg,SparseFillEmptyRows:ux,SparseReshape:lx,SparseSegmentMean:cx,SparseSegmentSum:hx,SparseToDense:dx,SplitV:dg,Sqrt:Kd,Square:fx,SquaredDifference:Xd,StaticRegexReplace:pg,Step:ef,StridedSlice:px,StringNGrams:mx,StringSplit:gx,StringToHashBucketFast:vx,Sub:Yd,Sum:cg,Tan:Zd,Tanh:Qd,Tensor:Gt,TensorBuffer:Gn,TensorScatterUpdate:ox,Tile:Jd,TopK:yx,Transform:bx,Transpose:Vl,Unique:xx,Unpack:mg,UnsortedSegmentSum:gg,UpperBound:m5,Variable:qp,ZerosLike:vg,_FusedMatMul:Up,abs:Un,acos:ek,acosh:tk,add:Re,addN:uM,all:kx,any:Xp,argMax:Yl,argMin:nk,asin:rk,asinh:sk,atan:ak,atan2:ok,atanh:ik,avgPool:wg,avgPool3d:lk,backend:XN,backend_util:J4,basicLSTMCell:lM,batchNorm:tf,batchNorm2d:ck,batchNorm3d:hk,batchNorm4d:dk,batchToSpaceND:Sg,bincount:fk,bitwiseAnd:cM,booleanMaskAsync:KM,broadcastArgs:hM,broadcastTo:Ul,broadcast_util:K8,browser:mZ,buffer:yt,cast:Fe,ceil:pk,clipByValue:vs,clone:To,complex:xi,concat:On,concat1d:mk,concat2d:gk,concat3d:vk,concat4d:yk,conv1d:Tx,conv2d:wi,conv2dTranspose:Ix,conv3d:xk,conv3dTranspose:wk,copyRegisteredKernels:b5,cos:Cg,cosh:Ex,cosineWindow:Qx,cumprod:Qp,cumsum:_x,customGrad:Mo,denseBincount:Sb,deprecationWarn:Q5,depthToSpace:Sk,depthwiseConv2d:nf,device_util:j5,diag:fM,dilation2d:Ck,disableDeprecationWarnings:Z5,dispose:Ct,disposeVariables:J5,div:Qe,divNoNan:Nk,dot:kk,dropout:Jk,einsum:Rl,elu:rf,enableDebugMode:Y5,enableProdMode:X5,enclosingPowerOfTwo:eT,engine:Va,ensureShape:pM,env:de,equal:Aa,erf:Rx,euclideanNorm:Ik,exp:ys,expandDims:Wr,expm1:Ek,eye:Ax,fft:Mg,fill:pc,findBackend:sq,findBackendFactory:aq,floor:af,floorDiv:Nx,fused:r4,gather:of,gatherND:QM,gather_util:gZ,getBackend:KF,getGradient:pC,getKernel:jp,getKernelsForBackend:xb,grad:AK,grads:DK,greater:Ss,greaterEqual:Ei,ifft:qh,imag:Ng,image:Ha,inTopKAsync:JM,io:dT,irfft:jx,isFinite:_k,isInf:Rk,isNaN:Ak,keep:Qn,kernel_impls:TZ,leakyRelu:kg,less:Wh,lessEqual:Hu,linalg:rT,linspace:vM,localResponseNormalization:Dk,log:Fs,log1p:Tg,logSigmoid:$k,logSoftmax:$x,logSumExp:Ig,logicalAnd:Za,logicalNot:Eg,logicalOr:Ox,logicalXor:Ok,losses:c4,lowerBound:bM,matMul:St,math:aZ,max:ia,maxPool:_g,maxPool3d:Fk,maxPoolWithArgmax:xM,maximum:zo,mean:xn,memory:SC,meshgrid:wM,min:Uh,minimum:$u,mirrorPad:Mk,mod:Lk,moments:Rg,movingAverage:XM,mul:re,multiRNNCell:SM,multinomial:CM,neg:ln,nextFrame:yT,norm:sf,notEqual:Jl,oneHot:Gh,ones:ds,onesLike:Ms,op:ee,outerProduct:NM,pad:_i,pad1d:kM,pad2d:TM,pad3d:IM,pad4d:EM,pool:Pk,pow:Fo,prelu:Dg,print:JN,prod:Bk,profile:eq,raggedGather:_M,raggedRange:RM,raggedTensorToTensor:AM,rand:DM,randomGamma:FM,randomNormal:Lx,randomStandardNormal:MM,randomUniform:ju,randomUniformInt:LM,range:ec,ready:nq,real:Hh,reciprocal:Wk,registerBackend:KN,registerGradient:$F,registerKernel:Sx,relu:ro,relu6:Px,removeBackend:rq,reshape:ae,reverse:la,reverse1d:PM,reverse2d:BM,reverse3d:zM,reverse4d:VM,rfft:Lg,round:Bx,rsqrt:zx,scalar:st,scatterND:YM,scatter_util:M7,searchSorted:Fx,selu:Vx,separableConv2d:Ux,serialization:LY,setBackend:qF,setPlatform:oq,setdiff1dAsync:UM,sigmoid:Ka,sign:Gk,signal:l4,sin:Wx,sinh:Gx,slice:Ft,slice1d:$g,slice2d:Hx,slice3d:Og,slice4d:jh,slice_util:I4,softmax:Fg,softplus:mc,spaceToBatchND:Ag,sparse:h4,sparseToDense:ZM,spectral:u4,split:ps,sqrt:pr,square:Qt,squaredDifference:qx,squeeze:qu,stack:bs,step:gc,stridedSlice:Hk,string:d4,sub:ze,sum:We,sumOutType:Cx,tan:jk,tanh:Du,tensor:Ra,tensor1d:Gr,tensor2d:_h,tensor3d:qk,tensor4d:WM,tensor5d:GM,tensor6d:HM,tensorScatterUpdate:jM,tensor_util:V5,test_util:XX,tidy:he,tile:ta,time:tq,topk:Xk,train:Tl,transpose:Dt,truncatedNormal:Xx,unique:Yk,unregisterGradient:y5,unregisterKernel:v5,unsortedSegmentSum:Yx,unstack:ca,upcastType:ms,upperBound:qM,util:E5,valueAndGrad:$K,valueAndGrads:OK,variable:Zk,variableGrads:yM,version_core:wZ,where:Er,whereAsync:Qk,zeros:Wn,zerosLike:Lt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eL={kernelName:mm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>re(n,gc(Fe(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EZ={kernelName:od,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Qt(Fe(t,"float32")),s=pr(ze(st(1),r));return ln(Qe(n,s))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Z={kernelName:id,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=pr(ze(Qt(Fe(t,"float32")),1));return Qe(n,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RZ={kernelName:fc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=mt(t.shape,r.shape);return{a:()=>{let i=n;const u=jn(t.shape,s);return u.length>0&&(i=We(i,u)),ae(i,t.shape)},b:()=>{let i=n;const u=jn(r.shape,s);return u.length>0&&(i=We(i,u)),ae(i,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AZ={kernelName:gm,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((r,s)=>{t[s]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DZ={kernelName:vm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Lt(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Z={kernelName:ym,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Lt(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OZ={kernelName:ud,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Qe(n,pr(ze(st(1),Qt(Fe(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FZ={kernelName:ld,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=pr(Re(st(1),Qt(Fe(t,"float32"))));return Qe(n,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MZ={kernelName:dd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=mt(t.shape,r.shape);return{a:()=>{const i=Re(Qt(t),Qt(r));let u=re(n,Qe(r,i));const l=jn(t.shape,s);return l.length>0&&(u=We(u,l)),ae(u,t.shape)},b:()=>{const i=Re(Qt(t),Qt(r));let u=ln(re(n,Qe(t,i)));const l=jn(r.shape,s);return l.length>0&&(u=We(u,l)),ae(u,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LZ={kernelName:cd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Qe(n,Re(Qt(Fe(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PZ={kernelName:hd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Qe(n,ze(st(1),Qt(Fe(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BZ(n,e,t,r,s,a){const o=U(n,"dy","avgPool3dGrad"),i=U(e,"input","avgPool3dGrad");let u=o,l=i,c=!1;i.rank===4&&(c=!0,u=ae(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),l=ae(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),B(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),B(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),us("avgPool3dGrad",s,a);const d={dy:u,input:l},p={filterSize:t,strides:r,pad:s,dimRoundingMode:a},m=Q.runKernel(x0,d,p);return c?ae(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const zZ=ee({avgPool3dGrad_:BZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VZ={kernelName:xm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{filterSize:s,strides:a,pad:o,dimRoundingMode:i}=t;return{x:()=>zZ(n,r,s,a,o,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UZ(n,e,t,r,s){const a=U(n,"dy","avgPoolGrad"),o=U(e,"input","avgPoolGrad");B(o.rank===a.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${a.rank})`);let i=o,u=a,l=!1;o.rank===3&&(l=!0,i=ae(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=ae(a,[1,a.shape[0],a.shape[1],a.shape[2]])),B(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),B(i.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${i.rank}.`);const c={dy:u,input:i},d={filterSize:t,strides:r,pad:s},p=Q.runKernel(b0,c,d);return l?ae(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const WZ=ee({avgPoolGrad_:UZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GZ={kernelName:bm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{filterSize:s,strides:a,pad:o}=t;return{x:()=>WZ(n,r,s,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HZ={kernelName:wm,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[r,s]=e,{transposeA:a,transposeB:o}=t;return!a&&!o?{a:()=>St(n,s,!1,!0),b:()=>St(r,n,!0,!1)}:!a&&o?{a:()=>St(n,s,!1,!1),b:()=>St(n,r,!0,!1)}:a&&!o?{a:()=>St(s,n,!1,!0),b:()=>St(r,n,!1,!1)}:{a:()=>St(s,n,!0,!0),b:()=>St(n,r,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jZ={kernelName:Sm,gradFunc:(n,e,t)=>{const{blockShape:r,crops:s}=t;return{x:()=>Ag(n,r,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qZ={kernelName:AF,gradFunc:(n,e,t)=>{const r=t,s=r.inputShape,a=r.shape,o=Array.from(a);for(let u=s.length-1;u>=0;u--)if(s[u]===a[u])o[u]=1;else if(s[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${a}].`);const i=[];for(let u=0;u<o.length;u++)o[u]>1&&i.push(u);return{x:()=>We(n,i,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KZ={kernelName:fd,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XZ={kernelName:pd,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YZ={kernelName:md,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{clipValueMin:s,clipValueMax:a}=t;return{x:()=>Er(Za(Ei(r,s),Hu(r,a)),n,Lt(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZZ={kernelName:Nm,inputsToSave:["x"],gradFunc:eL.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QZ={kernelName:km,saveAllInputs:!0,gradFunc:(n,e,t)=>{const r=e.map(u=>u.shape),{axis:s}=t,a=Nt(s,e[0].shape)[0],o=r.map(u=>u[a]);return ps(n,o,a).map(u=>()=>u)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JZ={kernelName:Tm,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,{dilations:a,strides:o,pad:i,dataFormat:u}=t;return B(Au(a),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`),{x:()=>bk(r.shape,n,s,o,i,u),filter:()=>tT(r,n,s.shape,o,i,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eQ={kernelName:Im,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,{strides:a,pad:o,dataFormat:i,dimRoundingMode:u}=t;return{dy:()=>wi(n,s,a,o,i,1,u),filter:()=>tT(n,r,s.shape,a,o,i,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tQ(n,e,t,r,s){let a=n;n.rank===4&&(a=ae(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=ae(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),B(a.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${a.shape}.`),B(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),B(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),B(a.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${a.shape[4]}) must match input depth in filter (${t[3]}.`),B(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);const i={x:a,dy:o},u={strides:r,pad:s,filterShape:t};return Q.runKernel(k0,i,u)}const nQ=ee({conv3DBackpropFilter_:tQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rQ={kernelName:Em,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:r,strides:s,pad:a}=t;B(Au(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[o,i]=e;return{x:()=>dM(o.shape,n,i,s,a),filter:()=>nQ(o,n,i.shape,s,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sQ={kernelName:gd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>re(ln(Wx(Fe(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aQ={kernelName:vd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>re(Gx(Fe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oQ={kernelName:_m,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s,exclusive:a,reverse:o}=t;return{x:()=>{const i=Cn([s],r.rank);let u=_x(n,s,a,!o);return i!=null&&(u=Dt(u,i)),u}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iQ={kernelName:Rm,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:r,strides:s,pad:a,dimRoundingMode:o}=t,i=r??[1,1];B(Au(i),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);const[u,l]=e;return B(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),B(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),B(u.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),B($r(s,i),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${s} and dilations '${i}'.`),us("depthwiseConv2d",a,o),{x:()=>n4(u.shape,n,l,s,a,i,o),filter:()=>t4(u,n,l.shape,s,a,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uQ={kernelName:Am,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,a={x:r,filter:s,dy:n},o={x:r,filter:s,dy:n};return{x:()=>Q.runKernel(vb,a,t),filter:()=>Q.runKernel(yb,o,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lQ={kernelName:bd,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,r={dy:n,y:t};return{x:()=>Q.runKernel(M0,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cQ={kernelName:xd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,r=re(ys(ln(Qt(t))),2/Math.sqrt(Math.PI));return{x:()=>re(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hQ={kernelName:wd,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>re(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dQ={kernelName:$m,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>ae(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fQ={kernelName:Sd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>re(n,ys(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pQ={kernelName:Cd,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mQ={kernelName:Nd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=mt(t.shape,r.shape);return{a:()=>{const i=Qe(n,Fe(r,"float32")),u=jn(t.shape,s);return u.length>0?ae(We(i,u),t.shape):i},b:()=>{let i=re(n,Fe(t,"float32"));const u=jn(r.shape,s);u.length>0&&(i=ae(We(i,u),r.shape));const l=Qt(r);return ln(Qe(i,Fe(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gQ={kernelName:Om,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:r}=t,[s,a,o,i]=e,u=i??st(1),l=jn(a.shape,s.shape),c=[];if(a.rank===1){for(let C=0;C<s.shape.length-1;++C)c.push(s.shape[C]);c.push(1)}const d=ze(s,a),p=re(n,u),m=zx(Re(o,st(r))),v=re(re(re(m,m),m),st(-.5));return{x:()=>a.rank===1?ae(re(re(n,ta(ae(m,[1,1,1,a.shape[0]]),c)),u),s.shape):ae(re(re(n,m),u),s.shape),mean:()=>{let C=re(re(m,st(-1)),p);return a.rank===1&&(C=We(C,l)),ae(C,a.shape)},variance:()=>{let C=re(re(v,d),p);return a.rank===1&&(C=We(C,l)),ae(C,a.shape)},scale:()=>{const C=re(d,m);let T=re(n,C);return a.rank===1&&(T=We(T,l)),ae(T,a.shape)},offset:()=>{let C=n;return a.rank===1&&(C=We(C,l)),ae(C,a.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vQ={kernelName:Fm,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[r,s]=e,{axis:a,batchDims:o}=t,i=Nt(a,r.shape)[0],u=(l,c,d)=>()=>{const p=l.shape,m=c.size,v=p.slice(0,i),b=v.length,y=p.slice(a,p.length).slice(1),w=y.length,S=p$(0,b),N=p$(b+1,b+1+w),C=m$([v,[m],y]),T=ae(d,C),E=ae(c,[m]),$=m$([[b],S,N]),_=Dt(T,$);let R=Yx(_,E,l.shape[i]);const D=Gu($);return R=Dt(R,D),R};if(o===1){const l=r.shape[0],c=r.split(l,0);return{x:()=>bs(c.map((m,v)=>u(m,s.slice(v,1),n.slice(v,1))())).reshape(r.shape),indices:()=>s}}else return{x:u(r,s,n),indices:()=>s}}};function p$(n,e){const t=[];for(let r=n;r<e;++r)t.push(r);return t}function m$(n){const e=[];for(let t=0;t<n.length;++t)for(let r=0;r<n[t].length;++r)e.push(n[t][r]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yQ={kernelName:kd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>Lt(t),b:()=>Lt(r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bQ={kernelName:Td,gradFunc:n=>({x:()=>Fe(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xQ={kernelName:Id,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wQ={kernelName:Ed,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SQ={kernelName:_d,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CQ={kernelName:Lm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{alpha:s}=t,a=Ss(r,0);return{x:()=>Er(a,n,re(n,s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NQ={kernelName:Ad,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Qe(n,Re(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kQ={kernelName:Rd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Qe(n,Fe(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TQ={kernelName:DF,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t;return{logits:()=>{const o=ys(r);return ze(n,re(We(n,s,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IQ(n,e,t,r=5,s=1,a=1,o=.5){const i={x:n,y:e,dy:t},u={depthRadius:r,bias:s,alpha:a,beta:o};return Q.runKernel(G0,i,u)}const EQ=ee({localResponseNormalizationBackprop_:IQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Q={kernelName:Wm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{depthRadius:a,bias:o,alpha:i,beta:u}=t;return{x:()=>EQ(r,s,n,a,o,i,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tL(n,e,t,r){return e.rank<t.rank&&(e=ae(e,Fn(e.shape,r))),n.rank<t.rank&&(n=ae(n,Fn(n.shape,r))),{x:()=>re(n,Fe(Aa(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g$={kernelName:Gm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const r=t,{reductionIndices:s}=r,a=e[0],o=e[1],i=Nt(s,a.shape),u=tL(n,o,a,i);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RQ={kernelName:Dd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>re(n,Fe(Ei(t,r),"float32")),b:()=>re(n,Fe(Wh(t,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AQ(n,e,t,r,s,a,o){const i=U(n,"dy","maxPool3dGrad"),u=U(e,"input","maxPool3dGrad"),l=U(t,"output","maxPool3dGrad");let c=i,d=u,p=l,m=!1;u.rank===4&&(m=!0,c=ae(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),d=ae(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),p=ae(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),B(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),B(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),B(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),us("maxPool3dGrad",a,o);const v={dy:c,input:d,output:p},b={filterSize:r,strides:s,pad:a,dimRoundingMode:o},y=Q.runKernel(j0,v,b);return m?ae(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}const DQ=ee({maxPool3dGrad_:AQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Q={kernelName:jm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{filterSize:a,strides:o,pad:i,dimRoundingMode:u}=t;return{x:()=>DQ(n,r,s,a,o,i,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OQ(n,e,t,r,s,a,o){const i=U(n,"dy","maxPoolGrad"),u=U(e,"input","maxPoolGrad"),l=U(t,"output","maxPoolGrad");B(u.rank===i.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${i.rank})`),B(i.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${i.rank}.`),B(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),us("maxPoolGrad",a,o);const c={dy:i,input:u,output:l},d={filterSize:r,strides:s,pad:a,dimRoundingMode:o};return Q.runKernel(H0,c,d)}const FQ=ee({maxPoolGrad_:OQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MQ={kernelName:Hm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{filterSize:a,strides:o,pad:i}=t;return{x:()=>FQ(n,r,s,a,o,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LQ={kernelName:qm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t,a=Nt(s,r.shape),i=yr(r.shape,a)[1],u=xe(i);return{x:()=>{const c=r.shape.slice();a.forEach(m=>{c[m]=1});const d=ae(n,c);return Qe(re(d,ds(r.shape,"float32")),u)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PQ={kernelName:Km,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const r=t,{axis:s}=r,[a,o]=e,i=Nt(s,a.shape),u=tL(n,o,a,i);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BQ={kernelName:$d,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>re(n,Fe(Hu(t,r),"float32")),b:()=>re(n,Fe(Ss(t,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zQ={kernelName:Xm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const r=e[0],{paddings:s}=t,a=s.map(o=>o[0]);return{x:()=>Ft(n,a,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VQ={kernelName:Od,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=mt(t.shape,r.shape);return{a:()=>{const i=jn(t.shape,s);return i.length>0?ae(We(n,i),t.shape):n},b:()=>{const i=re(n,ln(af(Qe(t,r)))),u=jn(r.shape,s);return u.length>0?ae(We(i,u),r.shape):i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UQ={kernelName:Fd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=mt(t.shape,r.shape);return{a:()=>{const i=re(n,Fe(r,"float32")),u=jn(t.shape,s);return u.length>0?ae(We(i,u),t.shape):i},b:()=>{const i=re(n,Fe(t,"float32")),u=jn(r.shape,s);return u.length>0?ae(We(i,u),r.shape):i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WQ={kernelName:Ym,gradFunc:n=>({x:()=>ln(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GQ={kernelName:Jm,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>Wn(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HQ={kernelName:Qm,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jQ={kernelName:eg,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:r}=t;return ca(n,r).map(a=>()=>a)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v$={kernelName:tg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const r=e[0],{paddings:s}=t,a=s.map(o=>o[0]);return{x:()=>Ft(n,a,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qQ={kernelName:Md,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,r,s]=e,a=t,o=r,i=mt(a.shape,o.shape);return{a:()=>{const c=Fe(o,"float32");let d=re(n,re(c,Fo(a,ze(c,st(1)))));const p=jn(a.shape,i);return p.length>0&&(d=We(d,p)),ae(d,a.shape)},b:()=>{const c=Ss(a,0),d=Er(c,Fs(a),Lt(a));let p=re(n,re(s,d));const m=jn(o.shape,i);return m.length>0&&(p=We(p,m)),ae(p,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KQ={kernelName:ng,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,r]=e,s=Ss(t,0);return{x:()=>Er(s,n,re(n,r)),alpha:()=>{let a=Er(s,Lt(n),re(n,t));const o=jn(r.shape,n.shape);return o.length>0&&(a=We(a,o)),ae(a,r.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XQ(n,e,t){const r=n.shape.slice();r[t]=1;const s=ae(e,r),a=Qp(n,t,!0,!1),o=Qp(n,t,!0,!0),i=re(a,o);return re(s,i)}function YQ(n,e,t){const r=n.shape.length,s=r-t.length,a=Cn(t,r);let o=n;a!=null&&(o=Dt(n,a));const i=o.shape.slice(),l=i.splice(r-t.length,t.length).reduce((p,m)=>p*m,1);i.push(l);const c=o.reshape(i);let d=XQ(c,e,s);if(d=d.reshape(o.shape),a!=null){const p=Gu(a);d=Dt(d,p)}return d}const ZQ={kernelName:rg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t;let a=[];return s==null?a=r.shape.map((o,i)=>i):typeof s=="number"?a=[s]:a=s,{x:()=>YQ(r,n,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QQ={kernelName:yd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=mt(t.shape,r.shape);return{a:()=>{const i=Qe(n,Fe(r,"float32")),u=jn(t.shape,s);return u.length>0?ae(We(i,u),t.shape):i},b:()=>{let i=re(n,Fe(t,"float32"));const u=jn(r.shape,s);u.length>0&&(i=ae(We(i,u),r.shape));const l=Qt(r);return ln(Qe(i,Fe(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JQ={kernelName:Ld,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Qe(n,ln(Qt(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eJ={kernelName:Bd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,r=re(Hu(t,6),gc(t));return{x:()=>re(n,Fe(r,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tJ={kernelName:Pd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>re(n,Fe(gc(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nJ={kernelName:sg,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rJ={kernelName:og,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[r]=e,s={dy:n,images:r};return{images:()=>Q.runKernel(sx,s,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sJ={kernelName:ag,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[r]=e,s={dy:n,images:r};return{images:()=>Q.runKernel(rx,s,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aJ={kernelName:ig,gradFunc:(n,e,t)=>{const{dims:r}=t,s=Nt(r,n.shape);return{x:()=>la(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oJ={kernelName:zd,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iJ={kernelName:Vd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ln(Qe(n,re(Fo(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uJ={kernelName:ug,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>Fe(Lt(t),"float32"),t:()=>re(n,Fe(t,n.dtype)),e:()=>re(n,Fe(Eg(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lJ={kernelName:Ud,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Ss(t,st(0)),s=st(c1),a=st(h1),o=re(n,a),i=re(re(n,s),ys(Fe(t,"float32")));return Er(r,o,i)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cJ={kernelName:jd,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>re(n,re(t,ze(st(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hJ={kernelName:Hd,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dJ={kernelName:Wd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>re(Cg(Fe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fJ={kernelName:Gd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>re(Ex(Fe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pJ={kernelName:lg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{begin:s,size:a}=t,o=r.shape,[i,u]=u1(r,s,a),l=[];for(let c=0;c<n.rank;c++)l.push([i[c],o[c]-i[c]-u[c]]);return{x:()=>_i(n,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mJ={kernelName:fg,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r]=e,{dim:s}=t,a=!0,o=re(n,r);return{logits:()=>ze(o,re(We(o,[s],a),r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gJ={kernelName:qd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>re(n,Ka(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y$={kernelName:hg,gradFunc:(n,e,t)=>{const{blockShape:r,paddings:s}=t;return{x:()=>Sg(n,r,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b$={kernelName:dg,gradFunc:(n,e,t)=>{const{axis:r}=t;return{x:()=>On(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vJ={kernelName:Kd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Qe(n,re(pr(Fe(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yJ={kernelName:fx,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>re(n,re(Fe(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bJ={kernelName:Xd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=st(2);return{a:()=>re(n,re(s,ze(t,r))),b:()=>re(n,re(s,ze(r,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xJ={kernelName:ef,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wJ={kernelName:Yd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=mt(t.shape,r.shape);return{a:()=>{let i=n;const u=jn(t.shape,s);return u.length>0&&(i=We(i,u)),ae(i,t.shape)},b:()=>{let i=n;const u=jn(r.shape,s);return u.length>0&&(i=We(i,u)),ae(ln(i),r.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SJ={kernelName:cg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,s=r.shape.slice(),{axis:a}=t;Nt(a,r.shape).forEach(l=>{s[l]=1});const i=ae(n,s),u=re(i,ds(r.shape,"float32"));return{x:()=>u}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CJ={kernelName:Zd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Qe(n,Qt(Cg(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NJ={kernelName:Qd,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>re(ze(st(1),Qt(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kJ={kernelName:Jd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{reps:s}=t;return{x:()=>{let o=Lt(r);if(r.rank===1)for(let i=0;i<s[0];++i)o=Re(o,Ft(n,[i*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let i=0;i<s[0];++i)for(let u=0;u<s[1];++u)o=Re(o,Ft(n,[i*r.shape[0],u*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let i=0;i<s[0];++i)for(let u=0;u<s[1];++u)for(let l=0;l<s[2];++l)o=Re(o,Ft(n,[i*r.shape[0],u*r.shape[1],l*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let i=0;i<s[0];++i)for(let u=0;u<s[1];++u)for(let l=0;l<s[2];++l)for(let c=0;c<s[3];++c)o=Re(o,Ft(n,[i*r.shape[0],u*r.shape[1],l*r.shape[2],c*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TJ={kernelName:Vl,gradFunc:(n,e,t)=>{const r=t,{perm:s}=r,a=Gu(s);return{x:()=>Dt(n,a)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IJ={kernelName:mg,gradFunc:(n,e,t)=>{const r=t,{axis:s}=r;return{value:()=>bs(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EJ={kernelName:gg,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>_J(n,t)}}};function _J(n,e){const t=zo(e,Lt(e)),r=of(n,t);let s=Ei(e,st(0,"int32"));const a=r.rank-s.rank;for(let i=0;i<a;++i)s=Wr(s,i+1);s=Za(s,ds(r.shape,"bool"));const o=Lt(r);return Er(s,r,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RJ={kernelName:vg,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AJ=[eL,EZ,_Z,RZ,AZ,DZ,$Z,OZ,FZ,MZ,LZ,PZ,VZ,GZ,HZ,jZ,qZ,KZ,XZ,YZ,ZZ,QZ,eQ,JZ,rQ,sQ,aQ,oQ,iQ,uQ,QQ,lQ,cQ,hQ,dQ,fQ,mQ,pQ,gQ,vQ,yQ,bQ,xQ,wQ,SQ,CQ,NQ,kQ,TQ,_Q,g$,g$,RQ,$Q,MQ,LQ,PQ,BQ,zQ,VQ,UQ,WQ,GQ,HQ,jQ,v$,v$,qQ,KQ,ZQ,JQ,eJ,tJ,nJ,rJ,sJ,aJ,oJ,iJ,uJ,lJ,cJ,hJ,dJ,fJ,pJ,mJ,gJ,y$,y$,b$,b$,vJ,bJ,yJ,xJ,wJ,SJ,CJ,NJ,kJ,TJ,IJ,EJ,RJ];for(const n of AJ)$F(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.abs=function(){return this.throwIfDisposed(),Un(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.acos=function(){return this.throwIfDisposed(),ek(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.acosh=function(){return this.throwIfDisposed(),tk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.add=function(n){return this.throwIfDisposed(),Re(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.all=function(n,e){return this.throwIfDisposed(),kx(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.any=function(n,e){return this.throwIfDisposed(),Xp(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.argMax=function(n){return this.throwIfDisposed(),Yl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.argMin=function(n){return this.throwIfDisposed(),nk(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.asScalar=function(){return this.throwIfDisposed(),B(this.size===1,()=>"The array must have only 1 element."),ae(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.asType=function(n){return this.throwIfDisposed(),Fe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.as1D=function(){return this.throwIfDisposed(),ae(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.as2D=function(n,e){return this.throwIfDisposed(),ae(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),ae(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.as4D=function(n,e,t,r){return this.throwIfDisposed(),ae(this,[n,e,t,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.as5D=function(n,e,t,r,s){return this.throwIfDisposed(),ae(this,[n,e,t,r,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.asin=function(){return this.throwIfDisposed(),rk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.asinh=function(){return this.throwIfDisposed(),sk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.atan=function(){return this.throwIfDisposed(),ak(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.atan2=function(n){return this.throwIfDisposed(),ok(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.atanh=function(){return this.throwIfDisposed(),ik(this)};Se().prototype.avgPool=function(n,e,t,r){return this.throwIfDisposed(),wg(this,n,e,t,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),Sg(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.batchNorm=function(n,e,t,r,s){return this.throwIfDisposed(),tf(this,n,e,t,r,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Ul(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.cast=function(n){return this.throwIfDisposed(),Fe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.ceil=function(){return this.throwIfDisposed(),pk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),vs(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Gt&&(n=[n]),On([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.conv1d=function(n,e,t,r,s,a){return this.throwIfDisposed(),Tx(this,n,e,t,r,s,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.conv2dTranspose=function(n,e,t,r,s){return this.throwIfDisposed(),Ix(this,n,e,t,r,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.conv2d=function(n,e,t,r,s,a){return this.throwIfDisposed(),wi(this,n,e,t,r,s,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.cos=function(){return this.throwIfDisposed(),Cg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.cosh=function(){return this.throwIfDisposed(),Ex(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),Qp(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),_x(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),Sk(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.depthwiseConv2d=function(n,e,t,r,s,a){return this.throwIfDisposed(),nf(this,n,e,t,r,s,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.dilation2d=function(n,e,t,r,s){return this.throwIfDisposed(),Ck(this,n,e,t,r,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.divNoNan=function(n){return this.throwIfDisposed(),Nk(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.div=function(n){return this.throwIfDisposed(),Qe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.dot=function(n){return this.throwIfDisposed(),kk(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.elu=function(){return this.throwIfDisposed(),rf(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.equal=function(n){return this.throwIfDisposed(),Aa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.erf=function(){return this.throwIfDisposed(),Rx(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),Ik(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.exp=function(){return this.throwIfDisposed(),ys(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.expandDims=function(n){return this.throwIfDisposed(),Wr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.expm1=function(){return this.throwIfDisposed(),Ek(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.fft=function(){return this.throwIfDisposed(),Mg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.flatten=function(){return this.throwIfDisposed(),ae(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.floor=function(){return this.throwIfDisposed(),af(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.floorDiv=function(n){return this.throwIfDisposed(),Nx(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.gather=function(n,e,t){return this.throwIfDisposed(),of(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Ei(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.greater=function(n){return this.throwIfDisposed(),Ss(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.ifft=function(){return this.throwIfDisposed(),qh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.irfft=function(){return this.throwIfDisposed(),jx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.isFinite=function(){return this.throwIfDisposed(),_k(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.isInf=function(){return this.throwIfDisposed(),Rk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.isNaN=function(){return this.throwIfDisposed(),Ak(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.leakyRelu=function(n){return this.throwIfDisposed(),kg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.lessEqual=function(n){return this.throwIfDisposed(),Hu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.less=function(n){return this.throwIfDisposed(),Wh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.localResponseNormalization=function(n,e,t,r){return this.throwIfDisposed(),Dk(this,n,e,t,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.logSigmoid=function(){return this.throwIfDisposed(),$k(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.logSoftmax=function(n){return this.throwIfDisposed(),$x(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),Ig(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.log=function(){return this.throwIfDisposed(),Fs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.log1p=function(){return this.throwIfDisposed(),Tg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Za(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.logicalNot=function(){return this.throwIfDisposed(),Eg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.logicalOr=function(n){return this.throwIfDisposed(),Ox(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.logicalXor=function(n){return this.throwIfDisposed(),Ok(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),St(this,n,e,t)};Se().prototype.maxPool=function(n,e,t,r){return this.throwIfDisposed(),_g(this,n,e,t,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.max=function(n,e){return this.throwIfDisposed(),ia(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.maximum=function(n){return this.throwIfDisposed(),zo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.mean=function(n,e){return this.throwIfDisposed(),xn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.min=function(n,e){return this.throwIfDisposed(),Uh(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.minimum=function(n){return this.throwIfDisposed(),$u(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),Mk(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.mod=function(n){return this.throwIfDisposed(),Lk(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.mul=function(n){return this.throwIfDisposed(),re(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.neg=function(){return this.throwIfDisposed(),ln(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.norm=function(n,e,t){return this.throwIfDisposed(),sf(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.notEqual=function(n){return this.throwIfDisposed(),Jl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),Gh(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.onesLike=function(){return this.throwIfDisposed(),Ms(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.pad=function(n,e){return this.throwIfDisposed(),_i(this,n,e)};Se().prototype.pool=function(n,e,t,r,s,a){return this.throwIfDisposed(),Pk(this,n,e,t,r,s,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.pow=function(n){return this.throwIfDisposed(),Fo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.prelu=function(n){return this.throwIfDisposed(),Dg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.prod=function(n,e){return this.throwIfDisposed(),Bk(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.reciprocal=function(){return this.throwIfDisposed(),Wk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.relu=function(){return this.throwIfDisposed(),ro(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.relu6=function(){return this.throwIfDisposed(),Px(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.reshapeAs=function(n){return this.throwIfDisposed(),ae(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.reshape=function(n){return this.throwIfDisposed(),ae(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),o4(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),i4(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.reverse=function(n){return this.throwIfDisposed(),la(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.rfft=function(){return this.throwIfDisposed(),Lg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.round=function(){return this.throwIfDisposed(),Bx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.rsqrt=function(){return this.throwIfDisposed(),zx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.selu=function(){return this.throwIfDisposed(),Vx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.separableConv2d=function(n,e,t,r,s,a){return this.throwIfDisposed(),Ux(this,n,e,t,r,s,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.sigmoid=function(){return this.throwIfDisposed(),Ka(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.sign=function(){return this.throwIfDisposed(),Gk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.sin=function(){return this.throwIfDisposed(),Wx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.sinh=function(){return this.throwIfDisposed(),Gx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.slice=function(n,e){return this.throwIfDisposed(),Ft(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.softmax=function(n){return this.throwIfDisposed(),Fg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.softplus=function(){return this.throwIfDisposed(),mc(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),Ag(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.split=function(n,e){return this.throwIfDisposed(),ps(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.sqrt=function(){return this.throwIfDisposed(),pr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.square=function(){return this.throwIfDisposed(),Qt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.squaredDifference=function(n){return this.throwIfDisposed(),qx(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.squeeze=function(n){return this.throwIfDisposed(),qu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof Gt?[this,n]:[this,...n];return bs(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.step=function(n){return this.throwIfDisposed(),gc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.stridedSlice=function(n,e,t,r,s,a,o,i){return this.throwIfDisposed(),Hk(this,n,e,t,r,s,a,o,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.sub=function(n){return this.throwIfDisposed(),ze(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.sum=function(n,e){return this.throwIfDisposed(),We(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.tan=function(){return this.throwIfDisposed(),jk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.tanh=function(){return this.throwIfDisposed(),Du(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.tile=function(n){return this.throwIfDisposed(),ta(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.toBool=function(){return this.throwIfDisposed(),Fe(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.toFloat=function(){return this.throwIfDisposed(),Fe(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.toInt=function(){return this.throwIfDisposed(),Fe(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.topk=function(n,e){return this.throwIfDisposed(),Xk(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.transpose=function(n){return this.throwIfDisposed(),Dt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.unique=function(n){return this.throwIfDisposed(),Yk(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),Yx(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.unstack=function(n){return this.throwIfDisposed(),ca(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.where=function(n,e){return this.throwIfDisposed(),Er(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.zerosLike=function(){return this.throwIfDisposed(),Lt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class go extends Error{constructor(e){super(e),Object.setPrototypeOf(this,go.prototype)}}class Ia extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ia.prototype)}}class oe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,oe.prototype)}}class bt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,bt.prototype)}}class PT extends Error{constructor(e){super(e),Object.setPrototypeOf(this,PT.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class nL{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nc(n,e){if(Array.isArray(n)){let t=[];for(let r=0;r<e;r++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function vo(n,e){if(!n)throw new PT(e)}function x$(n,e){let t=0;for(const r of n)r===e&&t++;return t}function hs(n){return n.length===1?n[0]:n}function jt(n){return Array.isArray(n)?n:[n]}function hi(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Al(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let wa={};function BT(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function OC(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>OC(e));else{const e=Object.keys(n);for(const t of e){const r=n[t];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?n[t]=r.value:OC(r))}}}function Vg(n,e={},t={},r="object",s=!1){if(typeof n=="string"){const a=n;let o;if(a in t)o=t[a];else if(a in wa)o=wa[a];else if(o=e[a],o==null)throw new oe(`Unknown ${r}: ${n}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const a=n;if(a.className==null||a.config==null)throw new oe(`${r}: Improper config format: ${JSON.stringify(a)}.
'className' and 'config' must set.`);const o=a.className;let i,u;if(o in t?[i,u]=t[o]:o in wa?[i,u]=wa.className:o in e&&([i,u]=e[o]),i==null)throw new oe(`Unknown ${r}: ${o}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(u!=null){const l={};for(const m of Object.keys(wa))l[m]=wa[m];for(const m of Object.keys(t))l[m]=t[m];const c=a.config;c.customObjects=l;const d=Object.assign({},wa);for(const m of Object.keys(t))wa[m]=t[m];OC(a.config);const p=u(i,a.config,t,s);return wa=Object.assign({},d),p}else{const l=Object.assign({},wa);for(const d of Object.keys(t))wa[d]=t[d];const c=new i(a.config);return wa=Object.assign({},l),c}}}function DJ(n,e){return n<e?-1:n>e?1:0}function Iy(n,e){return-1*DJ(n,e)}function Su(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function $J(n){if(n==null)throw new oe(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function yc(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new oe(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function zT(n,e,t=0,r=1/0){return vo(t>=0),vo(r>=t),Array.isArray(n)&&n.length>=t&&n.length<=r&&n.every(s=>typeof s===e)}function cr(n,e){Array.isArray(n)?(B(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,r)=>cr(t,`element ${r+1} of ${e}`))):B(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${rL(n)}.`)}function rL(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>rL(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function OJ(n,e,t){let r=t!=null?t():Zr(),s;return(...o)=>{const i=t!=null?t():Zr();return i-r<e||(r=i,s=n(...o)),s}}function sL(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let FJ=0;function aL(){return FJ++}const Ey={};function d1(n=""){return n in Ey||(Ey[n]=0),Ey[n]+=1,n+Ey[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const MJ=["channelsFirst","channelsLast"],LJ=["nearest","bilinear"],PJ=["valid","same","causal"],BJ=["max","avg"],zJ=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const mh=new Map;function Ln(n){yc(MJ,"DataFormat",n)}function VJ(n){yc(LJ,"InterpolationFormat",n)}function ha(n){yc(PJ,"PaddingMode",n)}function oL(n){yc(BJ,"PoolMode",n)}const Mp=[],w$="/";function Wl(n,e){Mp.push(n);try{const t=e();return Mp.pop(),t}catch(t){throw Mp.pop(),t}}function UJ(){return Mp.length===0?"":Mp.join(w$)+w$}function iL(n){if(!lL(n))throw new Error("Not a valid tensor name: '"+n+"'");return UJ()+n}function uL(n){if(!lL(n))throw new Error("Not a valid tensor name: '"+n+"'");mh.has(n)||mh.set(n,0);const e=mh.get(n);if(mh.set(n,mh.get(n)+1),e>0){const t=`${n}_${e}`;return mh.set(t,1),t}else return n}const WJ=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function lL(n){return!!n.match(WJ)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function GJ(n){return n===parseInt(n.toString(),10)}function Cu(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let r=1;for(let s=e;s<t;++s)r*=n[s];return r}function Kh(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const r=n[t];r<e&&(e=r)}return e}function Ou(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const r=n[t];r>e&&(e=r)}return e}function Qa(n,e){if(e<n)throw new oe(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let r=n;r<e;++r)t.push(r);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let xS;function Jn(){return xS==null&&(xS=XN().epsilon()),xS}function Ja(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Eo(n,e){return Fe(n,e)}function Ug(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),ae(n,t)}function HJ(n,e){return he(()=>{if(n.shape.length!==2)throw new oe(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=Ug(n,1);return FC(t,[1,e,1])})}function jJ(n){const e=[Cu(n.shape)];return ae(n,e)}function qJ(n){if(n.rank<=1)throw new oe(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],Cu(n.shape,1)];return ae(n,e)}function Gl(n,e,t){return he(()=>{switch(n.rank){case 1:return $g(n,e,t);case 2:return Hx(n,[e,0],[t,n.shape[1]]);case 3:return Og(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return jh(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return Ft(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return Ft(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new oe(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function wS(n,e,t){return he(()=>{switch(n.rank){case 1:return $g(n,e,t);case 2:return Hx(n,[0,e],[n.shape[0],t]);case 3:return Og(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return jh(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new oe(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function _y(n,e,t,r){return he(()=>{switch(n.rank){case 1:return $g(n,e,t);case 2:switch(r){case 1:return Gl(n,e,t);case 2:return wS(n,e,t);default:throw new oe(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return Gl(n,e,t);case 2:return Og(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return wS(n,e,t);default:throw new oe(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return Gl(n,e,t);case 2:return jh(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return jh(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return wS(n,e,t);default:throw new oe(`The axis is not within the rank of the tensor ${r}`)}default:throw new oe(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function VT(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),On(n,e)}function S$(n,e){switch(n.rank){case 1:return mk([n,e]);case 2:return gk([n,e],0);case 3:return vk([n,e],0);case 4:return yk([n,e],0);default:throw new oe(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function FC(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new oe(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return ta(n,e)}function f1(n,e=0,t=1,r,s){return Lx(n,e,t,r,s)}function _o(n,e,t,r){if(n.rank<2||e.rank<2)throw new bt(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const s=n.shape.slice(-1)[0],a=e.shape.slice(-2)[0];if(s!==a)throw new bt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return _C({a:n,b:e,transposeA:!1,transposeB:!1,bias:r?MC(n.rank,r,Ja()):null,activation:t});{const s=n.shape.slice(),a=s.pop();n=ae(n,[-1,a]);const o=e.shape.slice(),i=o.pop(),u=o.pop(),l=[...o,i],c=Array.from({length:e.rank},(v,b)=>b===0?e.rank-2:b<=e.rank-2?b-1:b);e=ae(Dt(e,c),[u,-1]);const d=[...s,...l];return ae(_C({a:n,b:e,transposeA:!1,transposeB:!1,bias:r?MC(n.rank,r,Ja()):null,activation:t}),d)}}function cL(n,e,t){return he(()=>(Array.isArray(e)?e=Gr(e,"int32"):e=Fe(e,"int32"),of(n,e,t)))}function Wg(n){return re(n,n)}function MC(n,e,t){const r=e.shape;if(e.rank!==1&&e.rank!==n)throw new oe(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return r.length===1?ae(e,[1,r[0],1,1,1]):ae(e,[1,r[3],r[0],r[1],r[2]]);if(t==="channelsLast")return r.length===1?ae(e,[1,1,1,1,r[0]]):ae(e,[1].concat(r))}else if(n===4){if(t==="channelsFirst")return r.length===1?ae(e,[1,r[0],1,1]):ae(e,[1,r[2],r[0],r[1]]);if(t==="channelsLast")return r.length===1?ae(e,[1,1,1,r[0]]):ae(e,[1].concat(r))}else if(n===3){if(t==="channelsFirst")return r.length===1?ae(e,[1,r[0],1]):ae(e,[1,r[1],r[0]]);if(t==="channelsLast")return r.length===1?ae(e,[1,1,r[0]]):ae(e,[1].concat(r))}else if(n<3)return e;throw new oe(`Unsupported input rank by biasAdd: ${e.rank}`)}function so(n,e,t){return he(()=>(t==null&&(t=Ja()),Ln(t),Re(n,MC(n.rank,e,t))))}function KJ(n,e=1){if(e!==1)throw new bt(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return rf(n)}function XJ(n){return he(()=>Qe(n,Re(Un(n),1)))}function hL(n,e,t,r){return he(()=>Jk(n,e,t,r))}function YJ(n){return he(()=>{const e=Re(.5,re(.2,n));return vs(e,0,1)})}function Gg(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const ZJ=["fanIn","fanOut","fanAvg"],QJ=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function JJ(n){yc(ZJ,"FanMode",n)}function eee(n){yc(QJ,"Distribution",n)}class $a extends vc{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class dL extends $a{apply(e,t){return Wn(e,t)}}dL.className="Zeros";De(dL);class UT extends $a{apply(e,t){return ds(e,t)}}UT.className="Ones";De(UT);class fL extends $a{constructor(e){if(super(),typeof e!="object")throw new oe(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new oe(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return he(()=>re(st(this.value),ds(e,t)))}getConfig(){return{value:this.value}}}fL.className="Constant";De(fL);class pL extends $a{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return ju(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}pL.className="RandomUniform";De(pL);class mL extends $a{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new bt(`randomNormal does not support dType ${t}.`);return f1(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}mL.className="RandomNormal";De(mL);class gL extends $a{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new bt(`truncatedNormal does not support dType ${t}.`);return Xx(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}gL.className="TruncatedNormal";De(gL);class vL extends $a{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return he(()=>{if(e.length!==2||e[0]!==e[1])throw new oe("Identity matrix initializer can only be used for 2D square matrices.");return re(this.gain,Ax(e[0]))})}getConfig(){return{gain:this.gain}}}vL.className="Identity";De(vL);function tee(n,e="channelsLast"){let t,r;if(Ln(e),n.length===2)t=n[0],r=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const s=Cu(n,2);t=n[1]*s,r=n[0]*s}else if(e==="channelsLast"){const s=Cu(n,0,n.length-2);t=n[n.length-2]*s,r=n[n.length-1]*s}}else{const s=Cu(n);t=Math.sqrt(s),r=Math.sqrt(s)}return[t,r]}class Ls extends $a{constructor(e){if(super(),e.scale<0)throw new oe(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,JJ(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,eee(this.distribution),this.seed=e.seed}apply(e,t){const r=tee(e),s=r[0],a=r[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,s):this.mode==="fanOut"?o/=Math.max(1,a):o/=Math.max(1,(s+a)/2),this.distribution==="normal"){const i=Math.sqrt(o);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new bt(`${this.getClassName()} does not support dType ${t}.`);return Xx(e,0,i,t,this.seed)}else{const i=Math.sqrt(3*o);return ju(e,-i,i,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Ls.className="VarianceScaling";De(Ls);class WT extends Ls{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ls.className}}WT.className="GlorotUniform";De(WT);class GT extends Ls{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ls.className}}GT.className="GlorotNormal";De(GT);class HT extends Ls{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ls.className}}HT.className="HeNormal";De(HT);class jT extends Ls{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ls.className}}jT.className="HeUniform";De(jT);class qT extends Ls{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ls.className}}qT.className="LeCunNormal";De(qT);class KT extends Ls{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ls.className}}KT.className="LeCunUniform";De(KT);class yL extends $a{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return he(()=>{if(e.length<2)throw new bt("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const r=xe(e.slice(0,-1)),s=e[e.length-1],a=r*s;a>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${a}) elements: Slowness may result.`);const o=[Math.max(s,r),Math.min(s,r)],i=f1(o,0,1,t,this.seed),u=rT.qr(i,!1);let l=u[0];const d=u[1].flatten().stridedSlice([0],[Math.min(s,r)*Math.min(s,r)],[Math.min(s,r)+1]);return l=re(l,d.sign()),r<s&&(l=l.transpose()),re(st(this.gain),l.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}yL.className="Orthogonal";De(yL);const C$={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function N$(n,e={}){return Vg(n,ea.getMap().classNameMap,e,"initializer")}function wn(n){return BT(n)}function mn(n){if(typeof n=="string"){const e=n in C$?C$[n]:n;if(e==="GlorotNormal")return new GT;if(e==="GlorotUniform")return new WT;if(e==="HeNormal")return new HT;if(e==="HeUniform")return new jT;if(e==="LeCunNormal")return new qT;if(e==="LeCunUniform")return new KT;{const t={};return t.className=e,t.config={},N$(t)}}else return n instanceof $a?n:N$(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function LC(n){return Array.isArray(n)&&Array.isArray(n[0])}function Nb(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function ht(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new oe(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function Vt(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new oe(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kb(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((r,s)=>r*s);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const k$="Variable";class nee{constructor(e,t="float32",r=k$,s=!0,a=null){this.dtype=t??"float32",this.shape=e.shape,this.id=aL(),r=r??k$,this.originalName=iL(r),this.name=uL(this.originalName),this.trainable_=s,this.constraint=a,this.val=Zk(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),ree(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function ree(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function PC(n){return n.map(e=>e.read())}function XT(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class er{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Lo{constructor(e,t,r,s,a,o,i){this.dtype=e,this.shape=t,this.sourceLayer=r,this.inputs=s,this.callArgs=a,this.outputTensorIndex=i,this.id=aL(),o!=null&&(this.originalName=iL(o),this.name=uL(this.originalName)),this.rank=t.length}}let see=0;class p1{constructor(e,t){this.callArgs=t,this.id=see++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const r of e.inboundLayers)r!=null&&r.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let aee=0;class kt extends vc{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=aee++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const r=this.getClassName();t=hi(r)+"_"+d1(r)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let r;if(e.batchInputShape!=null)r=e.batchInputShape;else if(e.inputShape!=null){let a=null;e.batchSize!=null&&(a=e.batchSize),r=[a].concat(e.inputShape)}this.batchInputShape=r;let s=e.dtype;s==null&&(s=e.inputDType),s==null&&(s="float32"),this.dtype=s}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Ia(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new oe(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return hs(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return hs(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new go(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new go(`Layer ${this.name} is not connected, no input to return.`);return hs(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new go(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new go(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return hs(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=jt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const r=jt(this.inputSpec);if(t.length!==r.length)throw new oe(`Layer ${this.name} expects ${r.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let s=0;s<t.length;s++){const a=t[s],o=r[s];if(o==null)continue;const i=a.rank;if(o.ndim!=null&&i!==o.ndim)throw new oe(`Input ${s} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${i}`);if(o.maxNDim!=null&&i>o.maxNDim)throw new oe(`Input ${s} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${i}`);if(o.minNDim!=null&&i<o.minNDim)throw new oe(`Input ${s} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${i}.`);if(o.dtype!=null&&a.dtype!==o.dtype)throw new oe(`Input ${s} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${a.dtype}.`);if(o.axes){const u=a.shape;for(const l in o.axes){const c=Number(l),d=o.axes[l],p=c>=0?u[c]:u[u.length+c];if(d!=null&&[d,null].indexOf(p)===-1)throw new oe(`Input ${s} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${d} but got shape ${u}.`)}}if(o.shape!=null)for(let u=0;u<o.shape.length;++u){const l=o.shape[u],c=a.shape[u];if(l!=null&&c!=null&&l!==c)throw new oe(`Input ${s} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${a.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const r=jt(e),s=uee(e),a=lee(e);if(s===a)throw new oe("Arguments to apply() must be all SymbolicTensors or all Tensors");return Wl(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const i of jt(e))o.push(i.shape);this.build(hs(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&a&&(this._refCount=1)}if(this.assertInputCompatibility(e),a){let o=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,o);const i=jt(o),u=[];for(let l of i)r.indexOf(l)!==-1&&(l=l.clone()),u.push(l);if(o=hs(u),this.activityRegularizer!=null)throw new bt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=oee(e),i=this.computeOutputShape(o);let u;const l=iee(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),i!=null&&i.length>0&&Array.isArray(i[0])?u=i.map((c,d)=>new Lo(l,c,this,jt(e),t,this.name,d)):u=new Lo(l,i,this,jt(e),t,this.name),this.addInboundNode(e,u,null,null,o,i,t),this._refCount++,this.activityRegularizer!=null)throw new bt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return u}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((r,s)=>{r!=null&&e[s]!=null&&e[s]!==r&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new go(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const r=JSON.stringify(t.outputShapes);e.indexOf(r)===-1&&e.push(r)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new go(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Ia(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return kb(this.weights)}build(e){this.built=!0}getWeights(e=!1){return PC(e?this.trainableWeights:this.weights)}setWeights(e){he(()=>{const t=this.weights;if(t.length!==e.length)throw new oe(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const r=[],s=PC(t);for(let a=0;a<s.length;++a){const o=s[a],i=t[a],u=e[a];if(!Et(o.shape,u.shape))throw new oe(`Layer weight shape ${o.shape} not compatible with provided weight shape ${u.shape}`);r.push([i,u])}XT(r)})}addWeight(e,t,r,s,a,o,i,u){if(this._addedWeightNames.indexOf(e)!==-1)throw new oe(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(s=u!=null?u():mn("zeros"));const l=s.apply(t,r),c=new nee(l,r,e,o,i);return l.dispose(),a!=null&&this.addLoss(()=>a.apply(c.read())),o==null&&(o=!0),o?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=jt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,r){if(!this.supportsMasking)return;const s=this.computeMask(e,r),a=jt(t),o=jt(s);if(a.length!==o.length)throw new Error(`${this.name} outputs ${a.length} tensors but ${a.length} masks for those tensors`);for(let i=0;i<a.length;i++)a[i].kerasMask=o[i]}addInboundNode(e,t,r,s,a,o,i=null){const u=jt(e);t=jt(t),r=jt(r),s=jt(s),a=Nb(a),o=Nb(o);const l=[],c=[],d=[];for(const p of u)l.push(p.sourceLayer),c.push(p.nodeIndex),d.push(p.tensorIndex);new p1({outboundLayer:this,inboundLayers:l,nodeIndices:c,tensorIndices:d,inputTensors:u,outputTensors:t,inputMasks:r,outputMasks:s,inputShapes:a,outputShapes:o},i);for(let p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function oee(n){n=jt(n);const e=[];for(const t of n)e.push(t.shape);return hs(e)}function iee(n){return"float32"}function bL(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const r=e.inboundNodes[t];if(r.inboundLayers.length===0)return r.inputTensors;{const s=[];for(let a=0;a<r.inboundLayers.length;a++){const o=r.inputTensors[a],i=r.inboundLayers[a],u=r.nodeIndices[a],l=bL(o,i,u);for(const c of l)s.indexOf(c)===-1&&s.push(c)}return s}}}function uee(n){let e=!0;for(const t of jt(n))if(!(t instanceof Lo)){e=!1;break}return e}function lee(n){let e=!0;for(const t of jt(n))if(t instanceof Lo){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Hg extends kt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:d1("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new oe("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new oe("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new oe("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const r=e.dtype||"float32";this.batchInputShape=t,this.dtype=r,this.inputSpec=[{shape:t}];const s=new Lo(this.dtype,this.batchInputShape,this,[],{},this.name);s.nodeIndex=0,s.tensorIndex=0,new p1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[s],outputTensors:[s],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new oe(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Hg.className="InputLayer";De(Hg);function cee(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new oe("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Hg({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hee(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return Fe(e,n.dtype)}catch{throw new oe(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class vu{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof vu)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,r){if(this.id2Value[e.id]==null)this.id2Value[e.id]=hee(e,t),this.name2Id[e.name]=e.id,r!=null&&(this.id2Mask[e.id]=r);else throw new oe(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Lo){if(this.id2Value[e.id]==null)throw new oe(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new oe(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Lo){if(this.id2Value[e.id]==null)throw new oe(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new oe(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&Ct(this.id2Mask)}}const Tb=new nL,Ib=new nL;function dee(n){Tb!=null&&Tb.setMaxEntries(n),Ib!=null&&Ib.setMaxEntries(n)}function Rp(n,e,t,r){const s=t==null?!1:t.training,a=Array.isArray(n),o=a?n:[n],i=o.map(v=>v.name),u=[],l=e.names();for(const v of i)l.indexOf(v)!==-1?u.push(e.getValue(v)):u.push(null);const c=i.join(",")+"|"+e.names().sort().join(",");let d=Tb.get(c),p;if(d==null){const v=fee(o,e);d=v.sorted,p=v.recipientCounts,Tb.put(c,d),Ib.put(c,p)}p={},s||Object.assign(p,Ib.get(c));const m=new vu(e);for(let v=0;v<d.length;++v){const b=d[v],y=b.sourceLayer;if(y instanceof Hg)continue;const w=[],S=[],N=[];let C=!1;for(const R of b.inputs){const D=m.getValue(R),A=m.getMask(R);w.push(D),S.push(A),A!=null&&(C=!0),s||(p[R.name]--,p[R.name]===0&&!e.hasKey(R)&&i.indexOf(R.name)===-1&&!D.isDisposed&&R.sourceLayer.stateful!==!0&&N.push(D))}C&&(t=t||{},t.mask=S[0]);const T=jt(y.apply(w,t));let E=null;y.supportsMasking&&(E=y.computeMask(w,S));const $=mee(b),_=Array.isArray($)?$:[$];for(let R=0;R<_.length;++R){m.hasKey(_[R])||m.add(_[R],T[R],Array.isArray(E)?E[0]:E);const D=i.indexOf(_[R].name);D!==-1&&(u[D]=T[R])}s||Ct(N)}return m.disposeMasks(),a?u:u[0]}function fee(n,e){B(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],r={};if(n.length===1){const s=T$(n[0],e);t=s.sorted,r=s.recipientMap}else{const s=new Set;for(const a of n){const{sorted:o,recipientMap:i}=T$(a,e);for(const u of o)s.has(u.name)||(t.push(u),s.add(u.name));for(const u in i)r[u]==null&&(r[u]=new Set),i[u].forEach(l=>r[u].add(l))}}return{sorted:t,recipientCounts:pee(r)}}function pee(n){const e={};for(const t in n)e[t]=n[t].size;return e}function T$(n,e){const t=new Set,r=[],s={};for(const i of e.names())t.add(i);const a=[],o=[];for(a.push(n);a.length>0;){const i=a[a.length-1];if(t.has(i.name)){a.pop();continue}const u=o[o.length-1]===a.length-1;if(i.inputs.length===0||u)a.pop(),r.push(i),t.add(i.name),u&&o.pop();else{o.push(a.length-1);for(const l of i.inputs)s[l.name]==null&&(s[l.name]=new Set),s[l.name].add(i.name),!t.has(l.name)&&a.push(l)}}return{sorted:r,recipientMap:s}}function mee(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let r=0;r<n.sourceLayer.inboundNodes.length;++r)for(const s of n.sourceLayer.inboundNodes[r].outputTensors)if(s.id===n.id){t=r;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gee=de();gee.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,dee);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function YT(n,e){return he(()=>pr(We(re(n,n),e,!0)))}class jg extends vc{getConfig(){return{}}}class xL extends jg{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return he(()=>{const t=YT(e,this.axis),r=vs(t,0,this.maxValue);return re(e,Qe(r,Re(Jn(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}xL.className="MaxNorm";De(xL);class wL extends jg{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return he(()=>Qe(e,Re(Jn(),YT(e,this.axis))))}getConfig(){return{axis:this.axis}}}wL.className="UnitNorm";De(wL);class SL extends jg{apply(e){return ro(e)}}SL.className="NonNeg";De(SL);class CL extends jg{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return he(()=>{const t=YT(e,this.axis),r=Re(re(this.rate,vs(t,this.minValue,this.maxValue)),re(1-this.rate,t));return re(e,Qe(r,Re(Jn(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}CL.className="MinMaxNorm";De(CL);const I$={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function tr(n){return BT(n)}function E$(n,e={}){return Vg(n,ea.getMap().classNameMap,e,"constraint")}function nr(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in I$?I$[n]:n,config:{}};return E$(t)}else return n instanceof jg?n:E$(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Sl(n){if(n==null)return;const e=[],t=[],r=[];for(const s in n){const a=n[s];if(typeof a!="number"){const o=a;e.push(o.data()),t.push(s),r.push(o)}}if(e.length>0){const s=await Promise.all(e);for(let a=0;a<s.length;++a)n[t[a]]=s[a][0];Ct(r)}}function NL(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var _$;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(_$||(_$={}));const vee=125;class Jp{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class yee{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class bee extends Jp{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const r=t.size==null?0:t.size;this.seen+=r;for(const s in t){const a=t[s];if(typeof a=="number")this.totals.hasOwnProperty(s)||(this.totals[s]=0),this.totals[s]=this.totals[s]+a*r;else{let o;s in this.totals?o=this.totals[s]:this.totals[s]=0;const i=he(()=>Re(this.totals[s],re(a,r)));this.totals[s]=i,o!=null&&o.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?t[r]=this.totals[r]/this.seen:he(()=>{const s=re(Qe(1,this.seen),this.totals[r]);t[r]=s,this.totals[r].dispose(),Qn(t[r])}))}}class xee extends Jp{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const r in t)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(t[r])}async syncData(){const e=[],t=[],r=[];for(const a in this.history){const o=this.history[a];for(let i=0;i<o.length;++i)if(typeof o[i]!="number"){const u=o[i];e.push(u.data()),t.push(a),r.push(i)}}const s=await Promise.all(e);for(let a=0;a<s.length;++a)this.history[t[a]][r[a]].dispose(),this.history[t[a]][r[a]]=s[a][0]}}class wee extends Jp{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||yT,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=vee),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");mb(this.yieldEvery)&&(this.maybeWait=OJ(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,r){const s=[];this.yield!=null&&(await Sl(r),s.push(this.yield(e,t,r))),s.push(this.nextFrameFunc()),await Promise.all(s)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Sl(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const r=[];this.epochEnd!=null&&(await Sl(t),r.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),await Promise.all(r)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Sl(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const r=[];this.batchEnd!=null&&(await Sl(t),r.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):mb(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(r)}async onTrainBegin(e){this.trainBegin!=null&&(await Sl(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Sl(e),await this.trainEnd(e))}}function kL(n,e){return n==null&&(n={}),n instanceof Jp?[n]:Array.isArray(n)&&n[0]instanceof Jp?n:jt(n).map(r=>new wee(r,e))}class Ca{constructor(){}static registerCallbackConstructor(e,t){B(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Ca.checkForDuplicate(t),Ca.constructors[e]==null&&(Ca.constructors[e]=[]),Ca.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Ca.constructors)Ca.constructors[+t].forEach(s=>{if(s===e)throw new oe("Duplicate callback constructor.")})}static clear(){Ca.constructors={}}static createCallbacks(e){const t=[];for(const r in Ca.constructors){const s=+r;e>=s&&t.push(...Ca.constructors[s])}return t.map(r=>new r)}}Ca.constructors={};function TL(n,e,t,r,s,a,o,i,u){const l=new xee,c=[new bee,...Ca.createCallbacks(e)];n!=null&&c.push(...n),c.push(l);const d=new yee(c);return d.setParams({epochs:t,initialEpoch:r,samples:s,steps:a,batchSize:o,verbose:e,doValidation:i,metrics:u}),{callbackList:d,history:l}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yi(n,e={},t=!1){return Vg(n,ea.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Eb(n,e){return he(()=>{n.dtype!=="float32"&&(n=Fe(n,"float32"));const t=We(Wg(n),e,!0),r=pc(t.shape,Jn()),s=pr(zo(t,r));return Qe(n,s)})}function m1(n,e){return he(()=>xn(Wg(ze(e,n)),-1))}function ZT(n,e){return he(()=>xn(Un(ze(e,n)),-1))}function QT(n,e){return he(()=>{const t=ze(n,e),r=vs(Un(n),Jn(),Number.MAX_VALUE),s=Un(Qe(t,r));return re(100,xn(s,-1))})}function See(n,e){return he(()=>{const t=vs(e,Jn(),Number.MAX_VALUE),r=Fs(Re(1,t)),s=vs(n,Jn(),Number.MAX_VALUE),a=Fs(Re(1,s));return xn(Wg(ze(r,a)),-1)})}function Cee(n,e){return he(()=>{const t=zo(0,ze(1,re(n,e)));return xn(Wg(t),-1)})}function Nee(n,e){return he(()=>{const t=zo(0,ze(1,re(n,e)));return xn(t,-1)})}function kee(n,e){return he(()=>{const t=We(re(n,e),-1),r=ia(re(ze(1,n),e),-1);return zo(0,Re(1,ze(r,t)))})}function Tee(n,e){return he(()=>{const t=Math.log(2),r=ze(e,n),s=ze(Re(r,mc(re(-2,r))),t);return xn(s,-1)})}function em(n,e,t=!1){return he(()=>{if(t)e=Fg(e);else{const r=We(e,e.shape.length-1,!0);e=Qe(e,r)}return e=vs(e,Jn(),1-Jn()),ln(We(re(Fe(n,"float32"),Fs(e)),e.shape.length-1))})}function _b(n,e,t=!1){return he(()=>{const r=Fe(af(jJ(n)),"int32");e=vs(e,Jn(),1-Jn());const s=e.shape,a=ae(Gh(r,s[s.length-1]),s);return em(a,e,t)})}function Iee(n,e){if(!Et(n.shape,e.shape))throw new oe(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return he(()=>{const t=ro(e),r=ln(Un(e));return Re(ze(t,re(e,n)),Tg(ys(r)))})}function g1(n,e){return he(()=>{let t;return t=vs(e,Jn(),1-Jn()),t=Fs(Qe(t,ze(1,t))),xn(Iee(n,t),-1)})}function Eee(n,e){return he(()=>{const t=vs(n,Jn(),1),r=vs(e,Jn(),1);return We(re(n,Fs(Qe(t,r))),-1)})}function _ee(n,e){return he(()=>{const t=Fs(Re(Jn(),e));return xn(ze(e,re(n,t)),-1)})}function IL(n,e){return he(()=>{const t=Eb(n,-1),r=Eb(e,-1),s=re(t,r);return ln(We(s,-1))})}const Rb={meanSquaredError:m1,meanAbsoluteError:ZT,meanAbsolutePercentageError:QT,meanSquaredLogarithmicError:See,squaredHinge:Cee,hinge:Nee,categoricalHinge:kee,logcosh:Tee,categoricalCrossentropy:em,sparseCategoricalCrossentropy:_b,binaryCrossentropy:g1,kullbackLeiblerDivergence:Eee,poisson:_ee,cosineProximity:IL};function SS(n){if(typeof n=="string"){if(n in Rb)return Rb[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new oe(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function EL(n,e){return he(()=>{const t=re(.5,Ms(e)),r=Eo(Ss(e,t),n.dtype);return xn(Aa(n,r),-1)})}function _L(n,e){return he(()=>Eo(Aa(Yl(n,-1),Yl(e,-1)),"float32"))}function Ree(n,e){return he(()=>Fe(We(Za(Aa(n,1),Aa(e,1))),"float32"))}function Aee(n,e){return he(()=>Fe(We(Za(Aa(n,0),Aa(e,1))),"float32"))}function Dee(n,e){return he(()=>{const t=Ree(n,e),r=Aee(n,e),s=Re(t,r);return Fe(Er(Ss(s,0),Qe(t,s),0),"float32")})}function $ee(n,e){return g1(n,e)}function Oee(n,e){return n.rank===e.rank&&(n=qu(n,[n.rank-1])),e=Yl(e,-1),e.dtype!==n.dtype&&(e=Fe(e,n.dtype)),Fe(Aa(n,e),"float32")}const Fee=m1,Mee=m1,Lee=ZT,Pee=ZT,Bee=QT,zee=QT,RL=em,Vee=IL,AL=_b,Ab={binaryAccuracy:EL,categoricalAccuracy:_L,precision:Dee,categoricalCrossentropy:RL,sparseCategoricalCrossentropy:AL,mse:Fee,MSE:Mee,mae:Lee,MAE:Pee,mape:Bee,MAPE:zee,cosine:Vee};function Uee(n){if(typeof n=="string"&&n in Ab)return Ab[n];if(typeof n!="string"&&n!=null)return n;throw new oe(`Unknown metric ${n}`)}function Ry(n){if(vo(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(Rb))if(Rb[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(Ab))if(Ab[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Wee(n){const e={Adagrad:()=>Tl.adagrad(.01),Adadelta:()=>Tl.adadelta(1,.95,Jn()),Adam:()=>Tl.adam(.001,.9,.999,Jn()),Adamax:()=>Tl.adamax(.002,.9,.999,Jn(),0),RMSProp:()=>Tl.rmsprop(.001,.9,0,Jn()),SGD:()=>Tl.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new oe(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const R$=1*1024*1024;function A$(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!BC(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const r=JSON.stringify(n);r.length>R$&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${R$}.`)}}function BC(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!BC(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!BC(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Gee(n,e,t,r=console.log){const s=jee(n),a=["Layer (type)","Input Shape","Output shape","Param #"];s?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(c=>Math.floor(e*c)));let o;if(!s){a.push("Receives inputs"),o=[];for(const c in n.nodesByDepth)o.push(...n.nodesByDepth[c])}r("_".repeat(e)),Db(a,t,r),r("=".repeat(e));const i=n.layers;for(let c=0;c<i.length;++c)s?qee(i[c],t,r):Kee(i[c],t,o,r),r((c===i.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const u=Hee(n),l=kb(n.nonTrainableWeights);r(`Total params: ${u+l}`),r(`Trainable params: ${u}`),r(`Non-trainable params: ${l}`),r("_".repeat(e))}function Hee(n){let e;return n.collectedTrainableWeights!=null?e=kb(n.collectedTrainableWeights):e=kb(n.trainableWeights),e}function jee(n){let e=!0;const t=[],r=[];for(const s in n.nodesByDepth)t.push(n.nodesByDepth[s]);for(const s of t){if(s.length>1||s.length===1&&s[0].inboundLayers.length>1){e=!1;break}r.push(...s)}if(e)for(const s of n.layers){let a=!1;for(const o of s.inboundNodes)if(r.indexOf(o)!==-1)if(a){e=!1;break}else a=!0;if(!e)break}return e}function Db(n,e,t=console.log){let r="";for(let s=0;s<n.length;++s)s>0&&(r=r.slice(0,r.length-1)+" "),r+=n[s],r=r.slice(0,e[s]),r+=" ".repeat(e[s]-r.length);t(r)}function qee(n,e,t){let r,s;try{s=n.inboundNodes.map(u=>JSON.stringify(u.inputShapes)).join(",")}catch{s="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const a=n.name,o=n.getClassName(),i=[`${a} (${o})`,s,r,n.countParams().toString()];Db(i,e,t)}function Kee(n,e,t,r){let s,a;try{a=n.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{a="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const o=[];for(const d of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(d)===-1))for(let p=0;p<d.inboundLayers.length;++p){const m=d.inboundLayers[p].name,v=d.nodeIndices[p],b=d.tensorIndices[p];o.push(`${m}[${v}][${b}]`)}const i=n.name,u=n.getClassName(),l=o.length===0?"":o[0],c=[`${i} (${u})`,a,s,n.countParams().toString(),l];Db(c,e,r);for(let d=1;d<o.length;++d)Db(["","","","",o[d]],e,r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function DL(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function zC(n,e){if(n===null)return null;if(typeof n=="string")return Al(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],r=n.length;for(let s=0;s<r;++s){const a=n[s];DL(e,s,a)?t.push(a):t.push(zC(a,e))}return t}else{const t={};for(const r of Object.keys(n)){const s=n[r];if(r==="name"&&typeof s=="string")t[r]=s;else{const a=Al(r);t[a]=zC(s,a)}}return t}}function VC(n,e){if(n==null)return null;if(typeof n=="string")return hi(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],r=n.length;for(let s=0;s<r;++s){const a=n[s];DL(e,s,a)?t.push(a):t.push(VC(a,e))}return t}else{const t={};for(const r of Object.keys(n)){const s=n[r],a=hi(r);(r==="name"||r==="className")&&typeof s=="string"?t[a]=s:t[a]=VC(s,r)}return t}}/** @license See the LICENSE file. */const $L="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Xee=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class za extends kt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const S=this.getClassName().toLowerCase();this.name=d1(S)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Su(this.inputs).length!==this.inputs.length)throw new oe(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(S=>S.name)}`);Su(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(S=>S.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const S of this.outputs){const N=S.sourceLayer,C=S.nodeIndex,T=S.tensorIndex;this.outputLayers.push(N),this.outputLayersNodeIndices.push(C),this.outputLayersTensorIndices.push(T)}for(const S of this.inputs){const N=S.sourceLayer,C=S.nodeIndex,T=S.tensorIndex;vo(C===0,"input layer has >1 nodes"),vo(T===0,"input layer has >1 tensors"),this.inputLayers.push(N),this.inputLayersNodeIndices.push(C),this.inputLayersTensorIndices.push(T)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let S=0;S<this.inputLayers.length;S++){const N=this.inputLayers[S];if(!(N instanceof Hg))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${S} (0-based) originates from layer type ${N.getClassName()}.`);this.inputNames.push(N.name),this.feedInputShapes.push(N.batchInputShape),this.feedInputNames.push(N.name)}for(const S of this.outputLayers)this.outputNames.push(S.name);this.internalInputShapes=this.inputs.map(S=>S.shape),this.internalOutputShapes=this.outputs.map(S=>S.shape);const t={},r={},s={},a={},o={},i=[],u=(S,N,C,T,E,$)=>{(T==null||E==null||$==null)&&(T=S.sourceLayer,E=S.nodeIndex,$=S.tensorIndex);const _=T.inboundNodes[E];if(C.indexOf(_)!==-1)throw new Ia(`The tensor ${S.name} at layer "${T.name}" is part of a cycle.`);if(N.indexOf(_)!==-1)return;this.containerNodes.add(za.nodeKey(T,E)),T.id in o||(o[T.id]=Object.keys(o).length),C.indexOf(_)===-1&&C.push(_);const R=_.inboundLayers.length;for(let D=0;D<R;D++){const A=_.inputTensors[D],M=_.inboundLayers[D],H=_.nodeIndices[D],j=_.tensorIndices[D];u(A,N,C,M,H,j)}for(N.push(_);C.indexOf(_)>=0;)C.splice(C.indexOf(_),1);i.push(_)},l=[],c=[];for(const S of this.outputs)u(S,l,c);const d=i.slice().reverse();for(const S of d){r[S.id]=S,S.id in t||(t[S.id]=0);let N=t[S.id];const C=s[S.outboundLayer.id]==null?0:s[S.outboundLayer.id];N=Math.max(N,C),s[S.outboundLayer.id]=N,a[S.outboundLayer.id]=S.outboundLayer,t[S.id]=N;for(let T=0;T<S.inboundLayers.length;T++){const E=S.inboundLayers[T],$=S.nodeIndices[T],_=E.inboundNodes[$],R=t[_.id]==null?0:t[_.id];t[_.id]=Math.max(N+1,R),r[_.id]=_}}const p={};for(const S in t){const N=t[S];N in p||(p[N]=[]),p[N].push(r[S])}const m={};for(const S in s){const N=s[S];N in m||(m[N]=[]),m[N].push(a[S])}let v=Object.keys(m).map(S=>parseInt(S,10)).sort(Iy);this.layers=[];for(const S of v){const N=m[S];N.sort((C,T)=>{const E=o[C.id],$=o[T.id];return E<$?-1:E>$?1:0});for(const C of N)C instanceof za&&this.internalContainerRefs.push(C),this.layers.push(C)}this.layersByDepth=m,v=Object.keys(p).map(S=>parseInt(S,10)).sort(Iy);const b=this.inputs.slice(),y=[];for(const S of v)for(const N of p[S]){const C=N.outboundLayer;if(C!=null){for(const T of N.inputTensors)if(b.indexOf(T)===-1)throw new Ia(`Graph disconnected: cannot obtain value for tensor ${T} at layer "${C.name}". The following previous layers were accessed without issue: ${y}`);for(const T of N.outputTensors)b.push(T);y.push(C.name)}}this.nodesByDepth=p;const w=this.layers.map(S=>S.name);for(const S of w){const N=w.filter(C=>C===S).length;if(N!==1)throw new Ia(`The name "${S}" is used ${N} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(w))}this.outboundNodes=[],this.inboundNodes=[],new p1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(S=>null),outputMasks:this.outputs.map(S=>null),inputShapes:this.inputs.map(S=>S.shape),outputShapes:this.outputs.map(S=>S.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(r=>r.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new oe("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.layers)t.push(...r.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const r={};let s=0;const a=Xee(e);a&&this.parseWeights(e);for(const i of this.layers)for(const[u,l]of i.weights.entries()){const c=a?`${l.name.split("/").slice(0,-1).join("/")+"/"}${u}`:l.originalName;if(r[c]!=null)throw new oe(`Duplicate weight name: ${c}`);r[c]=l,s++}const o=[];for(const i in e){let u=i;if(r[i]==null){const l=i.split("/");u=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(r[u]!=null)o.push([r[u],e[i]]);else if(t)throw new oe(`Provided weight data has no target variable: ${i}`);delete r[u]}if(t){const i=[];for(const u in r)i.push(u);if(i.length>0)throw new oe(`${i.length} of ${s} weights are not set: ${i}`)}XT(o)}parseWeights(e){for(const t in Object.keys(e)){const r=t.split("/"),s=["vars","layer_checkpoint_dependencies"],a=r.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!s.includes(o)).join("/");a!==t&&(e[a]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${$L}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const r=VC(this.updatedConfig());return t?JSON.stringify(r):r}call(e,t){return he(()=>{e=jt(e);const r=new vu;for(let s=0;s<this.inputs.length;++s)r.add(this.inputs[s],e[s]);return Rp(this.outputs,r,t)})}computeMask(e,t){return he(()=>{e=jt(e);let r;return t==null?r=nc(null,e.length):r=jt(t),this.runInternalGraph(e,r)[1]})}computeOutputShape(e){const t=Nb(e);if(t.length!==this.inputLayers.length)throw new oe(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const r={};for(let i=0;i<t.length;i++){const u=this.inputLayers[i],l=t[i],c=u.name+"_0_0";r[c]=l}const s=Object.keys(this.nodesByDepth).map(i=>parseInt(i,10)).sort(Iy);if(s.length>1)for(const i of s){const u=this.nodesByDepth[i];for(const l of u){const c=l.outboundLayer;if(this.inputLayers.map(b=>b.id).indexOf(c.id)!==-1)continue;const d=[];for(let b=0;b<l.inboundLayers.length;b++){const y=l.inboundLayers[b],w=l.nodeIndices[b],S=l.tensorIndices[b],N=`${y.name}_${w}_${S}`,C=r[N];d.push(C)}const p=c.computeOutputShape(hs(d)),m=Nb(p),v=c.inboundNodes.indexOf(l);for(let b=0;b<m.length;b++){const y=`${c.name}_${v}_${b}`;r[y]=m[b]}}}const a=[],o=[];for(let i=0;i<this.outputLayers.length;i++){const u=this.outputLayers[i],l=this.outputLayersNodeIndices[i],c=this.outputLayersTensorIndices[i],d=`${u.name}_${l}_${c}`;o.push(d)}for(let i=0;i<o.length;i++){const u=o[i];vo(u in r),a.push(r[u])}return hs(a)}runInternalGraph(e,t){t==null&&(t=nc(null,e.length));const r={};for(let u=0;u<this.inputs.length;++u){const l=this.inputs[u],c=e[u],d=t[u];r[l.id]=[c,d]}const s=Object.keys(this.nodesByDepth).map(u=>parseInt(u,10)).sort(Iy);for(const u of s){const l=this.nodesByDepth[u];for(const c of l){const d=c.outboundLayer,p=c.inputTensors,m=c.outputTensors,v=new Array;for(const b of p)b.id in r&&v.push(r[b.id]);if(v.length===p.length){let b={},y,w,S,N;if(c.callArgs!=null&&(b=c.callArgs),v.length===1){const[C,T]=v[0];b.mask==null&&(b.mask=T),S=jt(d.call(C,b)),N=jt(d.computeMask(C,T)),y=[C],w=[T]}else y=v.map(C=>C[0]),w=v.map(C=>C[1]),b.mask==null&&(b.mask=w),S=jt(d.call(y,b)),N=jt(d.computeMask(y,w));if(d.activityRegularizer)throw new bt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let C=0;C<m.length;++C){const T=m[C],E=S[C],$=N[C];r[T.id]=[E,$]}}}}const a=[],o=[],i=[];for(const u of this.outputs){vo(u.id in r,`Could not compute output ${u.name} : ${u.id}`);const[l,c]=r[u.id];i.push(l.shape),a.push(l),o.push(c)}return[a,o,i]}buildNodeConversionMap(e){const t={};let r;for(const s of this.layers){r=s instanceof za?1:0;for(let a=0;a<s.inboundNodes.length;a++){const o=za.nodeKey(s,a);this.containerNodes.has(o)&&(t[o]=r,r+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new oe("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const r of this.layers)if(r.name===e)return r;throw new oe(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new oe(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return he(()=>{const e=[];for(const t of this.layers)for(let r=0;r<t.inboundNodes.length;++r){const s=za.nodeKey(t,r);this.containerNodes.has(s)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),r=[];for(const o of this.layers){const i=o.getClassName(),u=o.getConfig(),l=[];for(let d=0;d<o.inboundNodes.length;d++){const p=o.inboundNodes[d],m=za.nodeKey(o,d);let v={};if(this.containerNodes.has(m)){if(p.callArgs)try{JSON.stringify(p.callArgs),v=p.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),v={}}if(p.inboundLayers.length>0){const b=[];for(let y=0;y<p.inboundLayers.length;y++){const w=p.inboundLayers[y],S=p.nodeIndices[y],N=p.tensorIndices[y],C=za.nodeKey(w,S);let T=t[C];T==null&&(T=0),b.push([w.name,T,N,v])}l.push(b)}}}const c={};c.name=o.name,c.className=i,c.config=u,c.inboundNodes=l,r.push(c)}e.layers=r;const s=[];for(let o=0;o<this.inputLayers.length;o++){const i=this.inputLayers[o],u=this.inputLayersNodeIndices[o],l=za.nodeKey(i,u);if(!this.containerNodes.has(l))continue;let c=t[l];c==null&&(c=0);const d=this.inputLayersTensorIndices[o];s.push([i.name,c,d])}e.inputLayers=s;const a=[];for(let o=0;o<this.outputLayers.length;o++){const i=this.outputLayers[o],u=this.outputLayersNodeIndices[o],l=za.nodeKey(i,u);if(!this.containerNodes.has(l))continue;let c=t[l];c==null&&(c=0);const d=this.outputLayersTensorIndices[o];a.push([i.name,c,d])}return e.outputLayers=a,e}static fromConfig(e,t,r={},s=!1){const a={},o={};function i(y,w){y.name in o?o[y.name].push(w):o[y.name]=[w]}function u(y,w){const S=[];let N;for(const C of w){const T=C[0],E=C[1],$=C[2];if(N=C[3]==null?{}:C[3],!(T in a)){i(y,w);return}const _=a[T];if(_.inboundNodes.length<=E){i(y,w);return}const R=_.inboundNodes[E];S.push(R.outputTensors[$])}S.length>0&&y.apply(hs(S),N)}function l(y){const w=y.name,S=yi(y,t.customObjects!=null?t.customObjects:{});S.setFastWeightInitDuringBuild(s),a[w]=S,y.inboundNodes.forEach(C=>{if(!(C instanceof Array))throw new oe(`Corrupted configuration, expected array for nodeData: ${C}`);i(S,C)})}const c=t.name,d=t.layers;for(const y of d)l(y);for(;!$J(o);)for(const y of d){const w=a[y.name];if(w.name in o){const S=o[w.name];delete o[w.name];for(const N of S)u(w,N)}}const p=[],m=[],v=t.inputLayers;for(const y of v){const w=y[0],S=y[1],N=y[2];vo(w in a);const T=a[w].inboundNodes[S].outputTensors;p.push(T[N])}const b=t.outputLayers;for(const y of b){const w=y[0],S=y[1],N=y[2];vo(w in a);const T=a[w].inboundNodes[S].outputTensors;m.push(T[N])}return new e({inputs:p,outputs:m,name:c})}get stateful(){if(this._stateful)throw new oe("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){he(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Yee(n,e,t){const r=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>null);if(r===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==r)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const s=[];return e.forEach(a=>{a in n?s.push(n[a]):s.push(null)}),s}else throw new Error(`The model has multiple (${r}) outputs, so ${t} must be either an array with ${r} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function OL(n,e){return Yee(n,e,"classWeight")}async function FL(n,e,t,r){if(t!=null){const s=he(()=>{if(n.shape.length===1)return To(n);if(n.shape.length===2){if(n.shape[1]>1)return Yl(n,1);if(n.shape[1]===1)return ae(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),a=Array.from(await s.data());Ct(s);const o=[];return a.forEach(i=>{if(t[i]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${i} exists in the data but not in classWeight`);o.push(t[i])}),Gr(o,"float32")}else return null}function Zee(n,e){return re(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Qee=32;function ML(n,e){let t,r;const s=e;t=s.xs,r=s.ys,B(t!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const a=D$("input",n.inputNames,t),o=D$("output",n.outputNames,r),i=a[0].shape[0];B(a.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${a.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),B(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let u=0;u<a.length;u++)B(a[u].shape[0]===i,()=>`Batch size mismatch: input ${n.inputNames[u]} has ${a[u].shape[0]}; expected  ${i} based on input ${n.inputNames[0]}.`);for(let u=0;u<o.length;u++)B(o[u].shape[0]===i,()=>`Batch size mismatch: output ${n.outputNames[u]} has ${o[u].shape[0]}; expected  ${i} based on input ${n.inputNames[0]}.`);return{xs:a,ys:o}}function D$(n,e,t){if(t instanceof Gt)return[t];if(Array.isArray(t))return B(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const r=[];for(const s of e){if(t[s]==null)throw new oe(`The feature data generated by the dataset lacks the required ${n} key '${s}'.`);r.push(t[s])}return r}}function Jee(n){if(n.length===3)throw new bt("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function ete(n,e,t){const r=t.batchesPerEpoch!=null;if(B(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),B(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),B(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),B(!r||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),B(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const s=t.validationData!=null;let a,o;if(s)if($$(t.validationData))B(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const y=Jee(t.validationData);a=y.xs,o=y.ys}const i=n.makeTrainFunction(),u=n.getDedupedMetricsNames();let l;s?l=u.slice().concat(u.map(y=>"val_"+y)):l=u.slice();const c=kL(t.callbacks,t.yieldEvery),d=t.verbose==null?1:t.verbose,{callbackList:p,history:m}=TL(c,d,t.epochs,null,null,tte(e,t),null,s,l);p.setModel(n),n.history=m,await p.onTrainBegin(),n.stopTraining_=!1;let v=t.initialEpoch==null?0:t.initialEpoch,b=await e.iterator();for(;v<t.epochs;){const y={};await p.onEpochBegin(v);let w=0,S=0;for(r||(b=await e.iterator());!r||w<t.batchesPerEpoch;){const N=await b.next();if(r&&N.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${w} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(N.value!=null){const{xs:C,ys:T}=ML(n,N.value),E={};E.batch=S,E.size=C[0].shape[0],await p.onBatchBegin(S,E);const $=[];if(t.classWeight!=null){const D=OL(t.classWeight,n.outputNames);for(let A=0;A<D.length;++A)$.push(await FL(T[A],null,D[A]))}const _=C.concat(T).concat($),R=i(_);Ct(_);for(let D=0;D<u.length;++D){const A=u[D],M=R[D];E[A]=M,Qn(M)}await p.onBatchEnd(S,E),NL(E),S++,w++}if(r?w>=t.batchesPerEpoch:N.done){if(s){let C;$$(t.validationData)?C=jt(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):C=jt(n.evaluate(a,o,{batchSize:t.validationBatchSize==null?Qee:t.validationBatchSize,verbose:0}));for(let T=0;T<n.metricsNames.length;++T)y[`val_${n.metricsNames[T]}`]=C[T]}break}if(n.stopTraining_)break}if(await p.onEpochEnd(v,y),v++,n.stopTraining_)break}return await p.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function tte(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function $$(n){return typeof n.iterator=="function"}function nte(n){return typeof n.next=="function"}async function rte(n,e,t){t=t||{};const r=t.batches!=null,s=n.testFunction;let a=[];if(t.verbose>0)throw new bt("Verbose mode is not implemented yet.");B(!r||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const o=nte(e)?e:await e.iterator();let i=0,u=0;for(;!r||u<t.batches;){const l=await o.next();if(a=he(()=>{if(l.value){const{xs:c,ys:d}=ML(n,l.value),p=c.concat(d),m=he(()=>s(p));if(Ct(p),u===0)for(let b=0;b<m.length;++b)a.push(st(0));const v=p[0].shape[0];for(let b=0;b<m.length;++b){const y=m[b],w=a[b];a[b]=he(()=>Re(a[b],re(v,y))),u>0&&Ct(w)}Ct(m),i+=v,++u}return a}),l.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let l=0;l<a.length;++l){const c=a[l];a[l]=Qe(a[l],i),Ct(c)}return hs(a)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function CS(n){B(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function wp(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(r=>Gl(r,e,t-e)):Gl(n,e,t-e)}function UC(n,e){return he(()=>n==null?null:Array.isArray(n)?n.map(t=>UC(t,e)):cL(n,e.dtype==="int32"?e:Fe(e,"int32")))}function NS(n,e){const t=[];let r=0,s=null;for(;r<n;)s=r+e,s>=n&&(s=n),t.push([r,s]),r=s;return t}function LL(n){const e=[];n instanceof Gt&&(n=[n]);for(let t=0;t<n.length;++t){const r=n[t];if(r.rank===1)e.push(Ug(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function Ba(n,e){if(n==null)return;const t=[];if(e instanceof Gt)t.push(e.id);else if(Array.isArray(e))e.forEach(s=>t.push(s.id));else if(e!=null)for(const s in e){const a=e[s];t.push(a.id)}const r=[];if(n instanceof Gt)t.indexOf(n.id)===-1&&r.push(n);else if(Array.isArray(n))n.forEach(s=>{t.indexOf(s.id)===-1&&r.push(s)});else if(n!=null)for(const s in n){const a=n[s];t.indexOf(a.id)===-1&&r.push(a)}r.forEach(s=>{s.isDisposed||s.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ste(n){return n instanceof Gt}function WC(n){return Array.isArray(n)}function O$(n){return!ste(n)&&!WC(n)}function F$(n,e,t,r=!0,s=""){if(e==null||e.length===0){if(n!=null){let o=!1;if(WC(n)&&n.length>0)o=!0;else if(O$(n)){for(const i in n)if(n.hasOwnProperty(i)){o=!0;break}}else o=!0;if(o)throw new oe(`Error when checking model ${s} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(o=>null);let a;if(O$(n)){n=n,a=[];for(const o of e){if(n[o]==null)throw new oe(`No data provided for "${o}". Need data for each key in: ${e}`);a.push(n[o])}}else if(WC(n)){if(n=n,n.length!==e.length)throw new oe(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);a=n}else{if(n=n,e.length>1)throw new oe(`The model ${s} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);a=[n]}if(a=LL(a),t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const i=a[o];if(i.shape.length!==t[o].length)throw new oe(`Error when checking ${s}: expected ${e[o]} to have ${t[o].length} dimension(s). but got array with shape ${i.shape}`);for(let u=0;u<t[o].length;++u){if(u===0&&!r)continue;const l=i.shape[u],c=t[o][u];if(c!=null&&c>=0&&l!==c)throw new oe(`${s} expected a batch of elements where each example has shape [${t[o].slice(1,t[o].length)}] (i.e.,tensor shape [*,${t[o].slice(1,t[o].length)}]) but the ${s} received an input with ${i.shape[0]} examples, each with shape [${i.shape.slice(1,i.shape.length)}] (tensor shape [${i.shape}])`)}}return a}function ate(n,e,t){const r=Su(n.map(a=>a.shape[0]));r.sort();const s=Su(e.map(a=>a.shape[0]));if(s.sort(),r.length>1)throw new oe(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(a=>a.shape))}`);if(s.length>1)throw new oe(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(a=>a.shape))}`);if(r.length>0&&s.length>0&&!Et(r,s))throw new oe(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${s[0]} target sample(s).`)}function ote(n,e,t){const r=[m1,g1,em];for(let s=0;s<n.length;++s){const a=n[s],o=e[s],i=t[s];if(o!=null){if(o===em&&a.shape[a.shape.length-1]===1)throw new oe(`You are passing a target array of shape ${a.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(o)!==-1){const u=a.shape.slice(1),l=i.slice(1);for(let c=0;c<u.length;++c){const d=u[c],p=l[c];if(p!=null&&d!==p)throw new oe(`A target Tensor with shape ${a.shape} was passed for an output of shape ${i}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function M$(n,e,t,r=!0,s=""){let a;if(Array.isArray(n)){if(n.length!==e.length)throw new oe(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);a=n}else{if(e.length>1)throw new oe(`The model expects ${e.length} ${s} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);a=[n]}if(t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const i=a[o];if(i.shape.length!==t[o].length)throw new oe(`Error when checking ${s}: expected ${e[o]} to have ${t[o].length} dimension(s), but got array with shape ${JSON.stringify(i.shape)}`);for(let u=0;u<t[o].length;++u){if(u===0&&!r)continue;const l=i.shape[u],c=t[o][u];if(c!=null&&c!==l)throw new oe(`Error when checking ${s}: expected ${e[o]} to have shape ${JSON.stringify(t[o])} but got array with shape ${JSON.stringify(i.shape)}.`)}}}function ite(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(r=>t);{const r=[];for(const s of e){let a=t.hasOwnProperty(s)?t[s]:[];Array.isArray(a)||(a=[a]),r.push(a)}return r}}const ute="layers-model";class Rh extends za{constructor(e){super(e),this.isTraining=!1}summary(e,t,r=console.log){if(!this.built)throw new oe("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Gee(this,e,t,r)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=Wee(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Ai))throw new oe("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new oe(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),t.push(SS(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new oe(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(i=>SS(i))}else{const o=SS(e.loss);this.outputs.forEach(i=>{t.push(o)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const i=this.internalOutputShapes[o],u=this.outputNames[o];this.feedOutputNames.push(u),this.feedOutputShapes.push(i),this.feedLossFns.push(this.lossFunctions[o])}const r=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Wl("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const i=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([i,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const s=ite(e.metrics,this.outputNames),a=(o,i,u)=>{this.outputNames.length>1&&(i=this.outputNames[o]+"_"+i),this.metricsNames.push(i),this.metricsTensors.push([u,o])};Wl("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const i=s[o];(l=>{const c="";let d,p,m;for(const v of l){if(typeof v=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(v)!==-1){const y=this.internalOutputShapes[o];y[y.length-1]===1||this.lossFunctions[o]===g1?["accuracy","acc"].indexOf(v)!==-1?p=EL:["crossentropy","ce"].indexOf(v)!==-1&&(p=$ee):this.lossFunctions[o]===_b?["accuracy","acc"].indexOf(v)!==-1?p=Oee:["crossentropy","ce"].indexOf(v)!==-1&&(p=AL):["accuracy","acc"].indexOf(v)!==-1?p=_L:["crossentropy","ce"].indexOf(v)!==-1&&(p=RL);let w;["accuracy","acc"].indexOf(v)!==-1?w="acc":["crossentropy","ce"].indexOf(v)!==-1&&(w="ce"),m=p,d=c+w}else m=Uee(v),d=c+Ry(v);let b;Wl(d,()=>{b=m}),a(o,d,b)}})(i)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,r={}){const s=r.batchSize==null?32:r.batchSize;CS(s);const o=this.standardizeUserDataXY(e,t,!0,s);try{const i=o[0].concat(o[1]);this.makeTestFunction();const u=this.testFunction,l=this.testLoop(u,i,s,r.verbose,r.steps);return hs(l)}finally{Ba(o[0],e),Ba(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),rte(this,e,t)}checkNumSamples(e,t,r,s="steps"){let a;if(r!=null){if(a=null,t!=null)throw new oe(`If ${s} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?a=e[0].shape[0]:a=e.shape[0];else throw new oe(`Either the input data should have a defined shape, or ${s} shoud be specified.`);return a}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new oe("`outputs` is an empty Array, which is not allowed.");const r=Array.isArray(t),s=r?t:[t],a=this.retrieveSymbolicTensors(s),o=new vu;if(e instanceof Gt&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new oe(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let u=0;u<this.inputs.length;++u)o.add(this.inputs[u],e[u])}else for(const u of this.inputs){const l=e[u.name];if(l==null)throw new oe(`No value is provided for the model's input ${u.name}`);o.add(u,l)}const i=Rp(a,o);return r?i:i[0]}retrieveSymbolicTensors(e){const t=nc(null,e.length);let r=e.length;for(const s of this.layers){const a=Array.isArray(s.output)?s.output:[s.output],o=a.map(i=>i.name);for(let i=0;i<e.length;++i){const u=o.indexOf(e[i]);if(u!==-1&&(t[i]=a[u],r--),r===0)break}if(r===0)break}if(r>0){const s=[];throw t.forEach((a,o)=>{a==null&&s.push(e[o])}),new oe(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(s)}`)}return t}predictLoop(e,t=32,r=!1){return he(()=>{const s=this.checkNumSamples(e);if(r)throw new bt("Verbose predictLoop() is not implemented yet.");const a=NS(s,t),o=this.outputs.map(i=>[]);for(let i=0;i<a.length;++i)he(()=>{const l=a[i][0],c=a[i][1],d=wp(e,l,c),p=[];if(Array.isArray(d))for(let v=0;v<d.length;++v)p.push({key:this.inputs[v],value:d[v]});else p.push({key:this.inputs[0],value:d});const m=new vu(p);return Rp(this.outputs,m)}).forEach((l,c)=>o[c].push(l));return hs(o.map(i=>On(i,0)))})}predict(e,t={}){const r=LL(e);M$(r,this.inputNames,this.feedInputShapes,!1);try{const s=t.batchSize==null?32:t.batchSize;return CS(s),this.predictLoop(r,s)}finally{Ba(r,e)}}predictOnBatch(e){M$(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,r=!0,s){if(this.optimizer_==null)throw new Ia("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const a=[];for(let o=0;o<this.feedOutputShapes.length;++o){const i=this.feedOutputShapes[o];this.feedLossFns[o]===_b?a.push(i.slice(0,i.length-1).concat([1])):a.push(i)}if(e=F$(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=F$(t,this.feedOutputNames,a,!1,"target"),ate(e,t),ote(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&s!=null&&s>0&&e[0].shape[0]%s!==0)throw new oe(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${s}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,r,s,a=!0,o){const[i,u]=this.standardizeUserDataXY(e,t,a,o);if(r!=null)throw new Error("sample weight is not supported yet.");let l=null;if(s!=null){const c=OL(s,this.outputNames);l=[];for(let d=0;d<c.length;++d)l.push(await FL(u[d],null,c[d]))}return[i,u,l]}testLoop(e,t,r,s=0,a){return he(()=>{const o=this.checkNumSamples(t,r,a,"steps"),i=[];if(s>0)throw new bt("Verbose mode is not implemented yet.");if(a!=null)throw new bt("steps mode in testLoop() is not implemented yet");{const u=NS(o,r),l=Gr(Qa(0,o));for(let c=0;c<u.length;++c){const d=u[c][0],p=u[c][1],m=Gl(l,d,p-d),v=UC(t,m),b=e(v);if(c===0)for(let y=0;y<b.length;++y)i.push(st(0));for(let y=0;y<b.length;++y){const w=b[y];i[y]=Re(i[y],re(p-d,w))}}for(let c=0;c<i.length;++c)i[c]=Qe(i[c],o)}return i})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let r=0;r<e.length;++r){const s=e[r];let a=s;if(x$(e,s)>1){const o=x$(e.slice(0,r),s);a+=`_${o}`}t.push(a)}return t}makeTrainFunction(){return e=>{const t=[],r=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],i=()=>{const d=[];for(let b=0;b<this.inputs.length;++b)d.push({key:this.inputs[b],value:r[b]});const p=new vu(d),m=Rp(this.outputs,p,{training:!0});let v;for(let b=0;b<this.lossFunctions.length;++b){const y=this.lossFunctions[b];let w=y(s[b],m[b]);a[b]!=null&&(w=Zee(w,a[b]));const S=xn(w);t.push(S),b===0?v=w:v=Re(v,w)}for(let b=0;b<this.metricsTensors.length;++b){let y;if(this.outputs.length>1&&b<this.outputs.length)y=t[b];else{const w=this.metricsTensors[b][0],S=this.metricsTensors[b][1];y=xn(w(s[S],m[S]))}Qn(y),o.push(y)}return v=xn(v),this.calculateLosses().forEach(b=>{v=Re(v,b)}),v},u=this.collectedTrainableWeights.map(d=>d.read());return[this.optimizer_.minimize(i,!0,u)].concat(o)}}makeTestFunction(){this.testFunction=e=>he(()=>{const t=[];let r;const s=e.slice(0,this.inputs.length),a=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let l=0;l<this.inputs.length;++l)o.push({key:this.inputs[l],value:s[l]});const i=new vu(o),u=Rp(this.outputs,i);for(let l=0;l<this.lossFunctions.length;++l){const c=this.lossFunctions[l],d=xn(c(a[l],u[l]));l===0?r=d:r=Re(r,d),t.push(r)}for(let l=0;l<this.metricsTensors.length;++l){const c=this.metricsTensors[l][0],d=this.metricsTensors[l][1],p=xn(c(a[d],u[d]));t.push(p)}return t})}async fit(e,t,r={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let s,a,o,i,u,l,c,d,p;try{const m=r.batchSize==null?32:r.batchSize;CS(m);const b=await this.standardizeUserData(e,t,r.sampleWeight,r.classWeight,!1,m);s=b[0],a=b[1],p=b[2];let y=!1,w;if(r.validationData!=null&&r.validationData.length>0){if(y=!0,r.validationData.length===2)u=r.validationData[0],l=r.validationData[1];else throw r.validationData.length===3?new bt("validationData including sample weights is not supported yet."):new oe(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);const D=await this.standardizeUserData(u,l,null,null,!0,m);c=D[0],d=D[1],w=c.concat(d)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){y=!0;const R=Math.floor(s[0].shape[0]*(1-r.validationSplit)),D=s[0].shape[0];c=wp(s,R,D),o=s,s=wp(s,0,R),d=wp(a,R,D),i=a,a=wp(a,0,R),w=c.concat(d)}else r.validationSteps!=null&&(y=!0);const S=s.concat(a).concat(p);this.checkTrainableWeightsConsistency();const N=this.makeTrainFunction(),C=this.getDedupedMetricsNames();let T,E;y?(this.makeTestFunction(),T=this.testFunction,E=C.slice().concat(C.map(R=>"val_"+R))):(T=null,w=[],E=C.slice());const $=kL(r.callbacks,r.yieldEvery);return await this.fitLoop(N,S,C,m,r.epochs,r.verbose,$,T,w,r.shuffle,E,r.initialEpoch,null,null)}finally{this.isTraining=!1,Ba(s,e),Ba(a,t),Ba(o,e),Ba(i,t),Ba(c,u),Ba(d,l),p!=null&&Ct(p)}}async fitLoop(e,t,r,s,a,o,i,u,l,c,d,p,m,v){s==null&&(s=32),a==null&&(a=1),c==null&&(c=!0),p==null&&(p=0);let b=!1;if(u!=null&&l!=null&&(b=!0),v!=null&&(b=!0,m==null))throw new oe("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const y=this.checkNumSamples(t,s,m,"steps_per_epoch");let w;y!=null&&(w=Qa(0,y)),o==null&&(o=1);const{callbackList:S,history:N}=TL(i,o,a,p,y,m,s,b,d);S.setModel(this),this.history=N,await S.onTrainBegin(),this.stopTraining_=!1;for(let C=p;C<a;++C){await S.onEpochBegin(C);const T={};if(m!=null)throw new bt("stepsPerEpoch mode is not implemented yet.");{if(c==="batch")throw new bt("batch shuffling is not implemneted yet");c&&LN(w);const E=Gr(w),$=NS(y,s);for(let _=0;_<$.length;++_){const R={};if(await S.onBatchBegin(_,R),he(()=>{const D=$[_][0],A=$[_][1],M=Gl(E,D,A-D);R.batch=_,R.size=A-D;const H=UC(t,M),j=e(H);for(let G=0;G<r.length;++G){const P=r[G],V=j[G];R[P]=V,Qn(V)}if(_===$.length-1&&b){const G=this.testLoop(u,l,s);for(let P=0;P<r.length;++P){const V=r[P],z=G[P];Qn(z),T["val_"+V]=z}}}),await S.onBatchEnd(_,R),NL(R),this.stopTraining_)break}E.dispose()}if(await S.onEpochEnd(C,T),this.stopTraining_)break}return await S.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return ete(this,e,t)}async trainOnBatch(e,t){const r=await this.standardizeUserData(e,t),s=r[0],a=r[1],i=this.makeTrainFunction()(s.concat(a)),u=[];for(const l of i){const c=await l.data();u.push(c[0])}return Ct(i),Ba(r[0],e),Ba(r[1],t),hs(u)}getNamedWeights(e){const t=[],r=e!=null&&e.trainableOnly,s=r?this.trainableWeights:this.weights,a=this.getWeights(r);for(let o=0;o<s.length;++o)r&&!s[o].trainable||t.push({name:s[o].originalName,tensor:a[o]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=SC().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-SC().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=hi(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>hi(t))}else{const t=Object.keys(this.loss);e={};const r=this.loss;for(const s of t)if(typeof r[s]=="string")e[s]=hi(r[s]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[hi(Ry(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>hi(Ry(e)));{const e={};for(const t in this.metrics)e[t]=hi(Ry(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=zC(e.optimizer_config),r=yi(t);let s;if(typeof e.loss=="string")s=Al(e.loss);else if(Array.isArray(e.loss))s=e.loss.map(o=>Al(o));else if(e.loss!=null){s={};for(const o in e.loss)s[o]=Al(e.loss[o])}let a;if(Array.isArray(e.metrics))a=e.metrics.map(o=>Al(o));else if(e.metrics!=null){a={};for(const o in e.metrics)a[o]=Al(e.metrics[o])}this.compile({loss:s,metrics:a,optimizer:r})}async save(e,t){if(typeof e=="string"){const l=eM(e);if(l.length===0)throw new oe(`Cannot find any save handlers for URL '${e}'`);if(l.length>1)throw new oe(`Found more than one (${l.length}) save handlers for URL '${e}'`);e=l[0]}if(e.save==null)throw new oe("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const r=await CC(this.getNamedWeights(t)),i={modelTopology:this.toJSON(null,!1),format:ute,generatedBy:`TensorFlow.js tfjs-layers v${$L}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){i.trainingConfig=this.getTrainingConfig();const l="optimizer",{data:c,specs:d}=await CC(await this.optimizer.getWeights(),l);r.specs.push(...d),r.data=QF([r.data,c])}return this.userDefinedMetadata!=null&&(A$(this.userDefinedMetadata,this.name,!0),i.userDefinedMetadata=this.userDefinedMetadata),i.weightData=r.data,i.weightSpecs=r.specs,e.save(i)}setUserDefinedMetadata(e){A$(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}Rh.className="Model";De(Rh);class PL extends Rh{}PL.className="Functional";De(PL);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class tm extends Rh{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:d1("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(r=>r<0))throw new oe(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof tm||e instanceof Rh;let r;if(t){if(r=e,r.outputs.length!==1)throw new oe("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new oe("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new oe("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const s=cee({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(s)}if(t)this.outputs=r.outputs,this.inputs=r.inputs;else{if(e.inboundNodes.length!==1)throw new oe(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new oe("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=bL(this.outputs[0])}this.inboundNodes=[],new p1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:nc(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(s=>s.shape),outputShapes:this.outputs[0].shape})}else{const s=e.apply(this.outputs[0]);if(Array.isArray(s))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[s],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Vt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Rh({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,r=console.log){this.built||this.build(),super.summary(e,t,r)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,r={}){if(!this.built)throw new Ia("The model needs to be compiled before being used.");return this.model.evaluate(e,t,r)}async evaluateDataset(e,t){if(!this.built)throw new Ia("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,r={}){if(!this.built)throw new Ia("The model needs to be compiled before being used.");return this.model.fit(e,t,r)}async fitDataset(e,t){if(!this.built)throw new Ia("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,r={},s=!1){let a,o={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new oe("Legacy serialization format not supported yet.");a=t}else B(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),a=t.layers,delete t.layers,o=t;const i=new e(o);if(!(i instanceof tm))throw new bt(`Sequential.fromConfig called on non-Sequential input: ${i}`);for(const u of a){const c=yi(u,void 0,s);s&&c.setFastWeightInitDuringBuild(!0),i.add(c)}return i}set stopTraining(e){if(this.model==null)throw new oe("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new oe("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const r={};r.className=t.getClassName(),r.config=t.getConfig(),e.push(r)}return{name:this.name,layers:e}}}tm.className="Sequential";De(tm);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Hr=class extends vc{getConfig(){return{}}};class BL extends Hr{apply(e,t=1){return KJ(e,t)}}BL.className="elu";De(BL);class zL extends Hr{apply(e){return Vx(e)}}zL.className="selu";De(zL);class VL extends Hr{apply(e){return ro(e)}}VL.className="relu";De(VL);class UL extends Hr{apply(e){return he(()=>$u(6,ro(e)))}}UL.className="relu6";De(UL);class WL extends Hr{apply(e){return e}}WL.className="linear";De(WL);class GL extends Hr{apply(e){return Ka(e)}}GL.className="sigmoid";De(GL);class HL extends Hr{apply(e){return YJ(e)}}HL.className="hardSigmoid";De(HL);class jL extends Hr{apply(e){return mc(e)}}jL.className="softplus";De(jL);class qL extends Hr{apply(e){return XJ(e)}}qL.className="softsign";De(qL);class KL extends Hr{apply(e){return Du(e)}}KL.className="tanh";De(KL);let JT=class extends Hr{apply(e,t=-1){return Fg(e,t)}};JT.className="softmax";De(JT);class XL extends Hr{apply(e,t=-1){return $x(e,t)}}XL.className="logSoftmax";De(XL);class YL extends Hr{apply(e){return he(()=>he(()=>{const t=Math.sqrt(2),r=re(.5,Re(1,Rx(Qe(e,t))));return re(e,r)}))}}YL.className="gelu";De(YL);class ZL extends Hr{apply(e){return he(()=>re(.5,re(e,Re(1,Du(re(pr(Qe(2,Math.PI)),Re(e,re(.044715,Fo(e,3)))))))))}}ZL.className="gelu_new";De(ZL);class QL extends Hr{apply(e){return he(()=>re(e,Du(mc(e))))}}QL.className="mish";De(QL);class JL extends Hr{apply(e,t=1){return he(()=>re(Ka(re(e,t)),e))}}JL.className="swish";De(JL);function Fu(n){return n.getClassName()}function kS(n,e={}){return Vg(n,ea.getMap().classNameMap,e,"activation")}function Mu(n){if(n==null){const e={};return e.className="linear",e.config={},kS(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},kS(e)}else return n instanceof Hr?n:kS(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function lte(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class eP extends vc{}class tP extends eP{constructor(e){super(),lte(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return he(()=>{let t=Wn([1]);return this.hasL1&&(t=Re(t,We(re(this.l1,Un(e))))),this.hasL2&&(t=Re(t,We(re(this.l2,Wg(e))))),ae(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}tP.className="L1L2";De(tP);const L$={l1l2:"L1L2"};function an(n){return BT(n)}function P$(n,e={}){return Vg(n,ea.getMap().classNameMap,e,"regularizer")}function gn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in L$?L$[n]:n,config:{}};return P$(t)}else return n instanceof eP?n:P$(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class nP extends kt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=ht(e);let r=ro(e);return this.maxValue!=null&&(r=vs(r,0,this.maxValue)),r}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}nP.className="ReLU";De(nP);class rP extends kt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const r=ht(e);return kg(r,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}rP.className="LeakyReLU";De(rP);class sP extends kt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=mn(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=gn(e.alphaRegularizer),this.alphaConstraint=nr(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new oe(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Vt(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const s of this.sharedAxes)t[s-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const r={};if(this.sharedAxes!=null)for(let s=1;s<e.length;++s)r[s]=e[s];this.inputSpec=[new er({ndim:e.length,axes:r})],this.built=!0}call(e,t){return e=ht(e),Dg(e,this.alpha.read())}getConfig(){const e={alphaInitializer:wn(this.alphaInitializer),alphaRegularizer:an(this.alphaRegularizer),alphaConstraint:tr(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}sP.className="PReLU";De(sP);let aP=class extends kt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new bt(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const r=ht(e);return rf(r)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};aP.className="ELU";De(aP);class oP extends kt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const r=ht(e);return re(r,Fe(Ss(r,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}oP.className="ThresholdedReLU";De(oP);class iP extends kt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new JT().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return he(()=>{let r=ht(e);const s=t.mask;if(s!=null){const a=re(ze(ds(r.shape),Fe(s,r.dtype)),st(-1e9));r=Re(r,a)}return this.axis instanceof Array?this.axis.length>1?ys(ze(r,Ig(r,this.axis,!0))):this.softmax(r,this.axis[0]):this.softmax(r,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}iP.className="Softmax";De(iP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ah(n,e,t){if(typeof n=="number")return nc(n,e);if(n.length!==e)throw new oe(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let r=0;r<e;++r){const s=n[r];if(!GJ(s))throw new oe(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${s}`)}return n}function Xa(n,e,t,r,s=1){if(n==null)return n;const a=e+(e-1)*(s-1);let o;return t==="same"?o=n:o=n-a+1,Math.floor((o+r-1)/r)}function yo(n,e,t,r){if(n==null)return null;if(r==="valid")n=n*e+Ou([t-e,0]);else if(r==="same")n=n*e;else throw new oe(`Unsupport padding mode: ${r}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eI(n,e){return he(()=>(Ln(e),e==="channelsFirst"?Dt(n,[0,2,3,1]):n))}function uP(n,e){return he(()=>(Ln(e),e==="channelsFirst"?Dt(n,[0,2,3,4,1]):n))}function cte(n,e,t,r=1,s="valid",a,o=1){return he(()=>{if(a==null&&(a=Ja()),Ln(a),n.shape.length!==3)throw new oe(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new oe(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new oe(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(a==="channelsFirst"&&(n=Dt(n,[0,2,1])),s==="causal")throw new bt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let i=Tx(n,e,r,s==="same"?"same":"valid","NWC",o);return t!=null&&(i=so(i,t)),i})}function B$(n,e,t,r=[1,1],s="valid",a,o,i=null){return he(()=>{if(a==null&&(a=Ja()),Ln(a),n.rank!==3&&n.rank!==4)throw new oe(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new oe(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let u=eI(n,a);if(s==="causal")throw new bt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=e4({x:u,filter:e,strides:r,pad:s==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:i}),a==="channelsFirst"&&(u=Dt(u,[0,3,1,2])),u})}function hte(n,e,t,r=[1,1,1],s="valid",a,o){return he(()=>{if(a==null&&(a=Ja()),Ln(a),n.rank!==4&&n.rank!==5)throw new oe(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new oe(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let i=uP(n,a);if(s==="causal")throw new bt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return i=xk(i,e,r,s==="same"?"same":"valid","NDHWC",o),t!=null&&(i=so(i,t)),a==="channelsFirst"&&(i=Dt(i,[0,4,1,2,3])),i})}class v1 extends kt{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",v1.verifyArgs(t),this.rank=e,cr(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new bt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Ah(t.kernelSize,e,"kernelSize"),this.strides=Ah(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,ha(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Ln(this.dataFormat),this.activation=Mu(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=mn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=nr(t.biasConstraint),this.biasRegularizer=gn(t.biasRegularizer),this.activityRegularizer=gn(t.activityRegularizer),this.dilationRate=Ah(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new oe(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new oe(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new oe(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(vo("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!zT(e.kernelSize,"number",1,3))throw new oe(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Fu(this.activation),useBias:this.useBias,biasInitializer:wn(this.biasInitializer),biasRegularizer:an(this.biasRegularizer),activityRegularizer:an(this.activityRegularizer),biasConstraint:tr(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class lf extends v1{constructor(e,t){super(e,t),this.kernel=null,lf.verifyArgs(t),this.filters=t.filters,cr(this.filters,"filters"),this.kernelInitializer=mn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=nr(t.kernelConstraint),this.kernelRegularizer=gn(t.kernelRegularizer)}build(e){e=Vt(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new oe(`The channel dimension of the input should be defined. Found ${e[t]}`);const r=e[t],s=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:r}}],this.built=!0}call(e,t){return he(()=>{e=ht(e);let r;const s=this.bias==null?null:this.bias.read(),a=sL(this.activation.getClassName());if(a!=null&&this.rank===2)r=B$(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate,a);else{if(this.rank===1)r=cte(e,this.kernel.read(),s,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=B$(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=hte(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new bt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(e){e=Vt(e);const t=[],r=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let a=0;a<r.length;++a){const o=Xa(r[a],this.kernelSize[a],this.padding,this.strides[a],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[a]);t.push(o)}let s=[e[0]];return this.dataFormat==="channelsLast"?(s=s.concat(t),s.push(this.filters)):(s.push(this.filters),s=s.concat(t)),s}getConfig(){const e={filters:this.filters,kernelInitializer:wn(this.kernelInitializer),kernelRegularizer:an(this.kernelRegularizer),kernelConstraint:tr(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new oe(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class qg extends lf{constructor(e){super(2,e),qg.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!zT(e.kernelSize,"number",1,2))throw new oe(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}qg.className="Conv2D";De(qg);class Kg extends lf{constructor(e){super(3,e),Kg.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new oe(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Kg.className="Conv3D";De(Kg);class lP extends qg{constructor(e){if(super(e),this.inputSpec=[new er({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new oe(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Vt(e),e.length!==4)throw new oe("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new oe("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new er({ndim:4,axes:{[t]:r}})],this.built=!0}call(e,t){return he(()=>{let r=ht(e);if(r.shape.length!==4)throw new oe(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,a=s[0];let o,i;this.dataFormat==="channelsFirst"?(o=2,i=3):(o=1,i=2);const u=s[o],l=s[i],c=this.kernelSize[0],d=this.kernelSize[1],p=this.strides[0],m=this.strides[1],v=yo(u,p,c,this.padding),b=yo(l,m,d,this.padding),y=[a,v,b,this.filters];this.dataFormat!=="channelsLast"&&(r=Dt(r,[0,2,3,1]));let w=Ix(r,this.kernel.read(),y,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(w=Dt(w,[0,3,1,2])),this.bias!=null&&(w=so(w,this.bias.read(),this.dataFormat)),this.activation!=null&&(w=this.activation.apply(w)),w})}computeOutputShape(e){e=Vt(e);const t=e.slice();let r,s,a;this.dataFormat==="channelsFirst"?(r=1,s=2,a=3):(r=3,s=1,a=2);const o=this.kernelSize[0],i=this.kernelSize[1],u=this.strides[0],l=this.strides[1];return t[r]=this.filters,t[s]=yo(t[s],u,o,this.padding),t[a]=yo(t[a],l,i,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}lP.className="Conv2DTranspose";De(lP);class cP extends Kg{constructor(e){if(super(e),this.inputSpec=[new er({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new oe(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Vt(e),e.length!==5)throw new oe("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new oe("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new er({ndim:5,axes:{[t]:r}})],this.built=!0}call(e,t){return he(()=>{let r=ht(e);if(r.shape.length!==5)throw new oe(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,a=s[0];let o,i,u;this.dataFormat==="channelsFirst"?(u=2,o=3,i=4):(u=1,o=2,i=3);const l=s[u],c=s[o],d=s[i],p=this.kernelSize[0],m=this.kernelSize[1],v=this.kernelSize[2],b=this.strides[0],y=this.strides[1],w=this.strides[2],S=yo(l,b,p,this.padding),N=yo(c,y,m,this.padding),C=yo(d,w,v,this.padding),T=[a,S,N,C,this.filters];this.dataFormat!=="channelsLast"&&(r=Dt(r,[0,2,3,4,1]));let E=wk(r,this.kernel.read(),T,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(E=Dt(E,[0,4,1,2,3])),this.bias!==null&&(E=so(E,this.bias.read(),this.dataFormat)),this.activation!==null&&(E=this.activation.apply(E)),E})}computeOutputShape(e){e=Vt(e);const t=e.slice();let r,s,a,o;this.dataFormat==="channelsFirst"?(r=1,s=2,a=3,o=4):(r=4,s=1,a=2,o=3);const i=this.kernelSize[0],u=this.kernelSize[1],l=this.kernelSize[2],c=this.strides[0],d=this.strides[1],p=this.strides[2];return t[r]=this.filters,t[s]=yo(t[s],c,i,this.padding),t[a]=yo(t[a],d,u,this.padding),t[o]=yo(t[o],p,l,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}cP.className="Conv3DTranspose";De(cP);class hP extends lf{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new oe("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new oe("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new oe(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=mn(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=gn(t.depthwiseRegularizer),this.depthwiseConstraint=nr(t.depthwiseConstraint),this.pointwiseInitializer=mn(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=gn(t.pointwiseRegularizer),this.pointwiseConstraint=nr(t.pointwiseConstraint)}build(e){if(e=Vt(e),e.length<this.rank+2)throw new oe(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new oe(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const r=e[t],s=this.kernelSize.concat([r,this.depthMultiplier]),a=[];for(let i=0;i<this.rank;++i)a.push(1);a.push(r*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",s,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new er({ndim:this.rank+2,axes:{[t]:r}})],this.built=!0}call(e,t){return he(()=>{e=ht(e);let r;if(this.rank===1)throw new bt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Dt(e,[0,2,3,1])),r=Ux(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(r=so(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),this.dataFormat==="channelsFirst"&&(r=Dt(r,[0,3,1,2])),r})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=wn(this.depthwiseInitializer),e.pointwiseInitializer=wn(this.pointwiseInitializer),e.depthwiseRegularizer=an(this.depthwiseRegularizer),e.pointwiseRegularizer=an(this.pointwiseRegularizer),e.depthwiseConstraint=tr(this.depthwiseConstraint),e.pointwiseConstraint=tr(this.pointwiseConstraint),e}}hP.className="SeparableConv";class dP extends hP{constructor(e){super(2,e)}}dP.className="SeparableConv2D";De(dP);class y1 extends lf{constructor(e){super(1,e),y1.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!zT(e.kernelSize,"number",1,1))throw new oe(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}y1.className="Conv1D";De(y1);class fP extends kt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return he(()=>{if(e=ht(e),this.dataFormat==="channelsLast"){const r=_y(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return _y(r,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const r=_y(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return _y(r,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}fP.className="Cropping2D";De(fP);class pP extends kt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Ln(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,VJ(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],r=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,r]}else{const t=e[1]==null?null:this.size[0]*e[1],r=e[2]==null?null:this.size[1]*e[2];return[e[0],t,r,e[3]]}}call(e,t){return he(()=>{let r=ht(e);const s=r.shape;if(this.dataFormat==="channelsFirst"){r=Dt(r,[0,2,3,1]);const a=this.size[0]*s[2],o=this.size[1]*s[3],i=this.interpolation==="nearest"?Ha.resizeNearestNeighbor(r,[a,o]):Ha.resizeBilinear(r,[a,o]);return Dt(i,[0,3,1,2])}else{const a=this.size[0]*s[1],o=this.size[1]*s[2];return this.interpolation==="nearest"?Ha.resizeNearestNeighbor(r,[a,o]):Ha.resizeBilinear(r,[a,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}pP.className="UpSampling2D";De(pP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function dte(n,e,t=[1,1],r="valid",s,a){return he(()=>{s==null&&(s=Ja()),Ln(s);let o=eI(n,s);if(n.rank!==4)throw new oe(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new oe(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=nf(o,e,t,r==="same"?"same":"valid","NHWC",a),s==="channelsFirst"&&(o=Dt(o,[0,3,1,2])),o})}class mP extends v1{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=mn(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=nr(e.depthwiseConstraint),this.depthwiseRegularizer=gn(e.depthwiseRegularizer)}build(e){if(e=Vt(e),e.length<4)throw new oe(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new oe(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const r=e[t],s=[this.kernelSize[0],this.kernelSize[1],r,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",s,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[r*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return he(()=>{e=ht(e);let r=dte(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(r=so(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),r})}computeOutputShape(e){e=Vt(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=Xa(t,this.kernelSize[0],this.padding,this.strides[0]),o=Xa(r,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],s,a,o]:[e[0],a,o,s]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=wn(this.depthwiseInitializer),e.depthwiseRegularizer=an(this.depthwiseRegularizer),e.depthwiseConstraint=tr(this.depthwiseRegularizer),e}}mP.className="DepthwiseConv2D";De(mP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gP(n,e,t,r){if(Array.isArray(n)){if(e!=null||t!=null)throw new oe("When inputs is an array, neither initialState or constants should be provided");r!=null&&(t=n.slice(n.length-r,n.length),n=n.slice(0,n.length-r)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function s(a){return a==null||Array.isArray(a)?a:[a]}return e=s(e),t=s(t),{inputs:n,initialState:e,constants:t}}function vP(n,e,t,r=!1,s,a,o=!1,i=!1){return he(()=>{const u=e.shape.length;if(u<3)throw new oe(`Input should be at least 3D, but is ${u}D.`);const l=[1,0].concat(Qa(2,u));e=Dt(e,l),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),s!=null&&(s=Fe(Fe(s,"bool"),"float32"),s.rank===u-1&&(s=Wr(s,-1)),s=Dt(s,l)),r&&(e=la(e,0),s!=null&&(s=la(s,0)));const c=[];let d,p=t;const m=e.shape[0],v=ca(e);let b;s!=null&&(b=ca(s));for(let w=0;w<m;++w){const S=v[w],N=he(()=>n(S,p));if(s==null)d=N[0],p=N[1];else{const C=he(()=>{const T=b[w],E=ze(Ms(T),T),$=Re(re(N[0],T),re(p[0],E)),_=p.map((R,D)=>Re(re(N[1][D],T),re(R,E)));return{output:$,newStates:_}});d=C.output,p=C.newStates}i&&c.push(d)}let y;return i&&(y=bs(c,1)),[d,y,p]})}class Xu extends kt{constructor(e){super(e);let t;if(e.cell==null)throw new oe("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new rI({cells:e.cell}):t=e.cell,t.stateSize==null)throw new oe("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new er({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Qa(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){LC(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const r=t[0];let s;if(this.returnSequences?s=[e[0],e[1],r]:s=[e[0],r],this.returnState){const a=[];for(const o of t)a.push([e[0],o]);return[s].concat(a)}else return s}computeMask(e,t){return he(()=>{Array.isArray(t)&&(t=t[0]);const r=this.returnSequences?t:null;if(this.returnState){const s=this.states.map(a=>null);return[r].concat(s)}else return r})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let r=0;r<e;++r)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new bt("Constants support is not implemented in RNN yet.");LC(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,r=e.slice(2);this.inputSpec[0]=new er({shape:[t,null,...r]});const s=[e[0]].concat(e.slice(2));this.cell.build(s);let a;if(Array.isArray(this.cell.stateSize)?a=this.cell.stateSize:a=[this.cell.stateSize],this.stateSpec!=null){if(!Et(this.stateSpec.map(o=>o.shape[o.shape.length-1]),a))throw new oe(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=a.map(o=>new er({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){he(()=>{if(!this.stateful)throw new go("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape[0];if(r==null)throw new oe("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>Wn([r,s])):this.states_=[Wn([r,this.cell.stateSize])];else if(e==null)Ct(this.states_),this.keptStates!=null&&(Ct(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>Wn([r,s])):this.states_[0]=Wn([r,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new oe(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):Ct(this.states_);for(let s=0;s<this.states_.length;++s){const a=e[s],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[s]:this.cell.stateSize,i=[r,o];if(!Et(a.shape,i))throw new oe(`State ${s} is incompatible with layer ${this.name}: expected shape=${i}, received shape=${a.shape}`);this.states_[s]=a}}this.states_=this.states_.map(s=>Qn(s.clone()))})}apply(e,t){let r=t==null?null:t.initialState,s=t==null?null:t.constants;t==null&&(t={});const a=gP(e,r,s,this.numConstants);e=a.inputs,r=a.initialState,s=a.constants;let o=[],i=[];if(r!=null){t.initialState=r,o=o.concat(r),this.stateSpec=[];for(const l of r)this.stateSpec.push(new er({shape:l.shape}));i=i.concat(this.stateSpec)}if(s!=null&&(t.constants=s,o=o.concat(s),this.numConstants=s.length),o[0]instanceof Lo){const l=[e].concat(o),c=this.inputSpec.concat(i),d=this.inputSpec;this.inputSpec=c;const p=super.apply(l,t);return this.inputSpec=d,p}else return super.apply(e,t)}call(e,t){return he(()=>{const r=t==null?null:t.mask,s=t==null?null:t.training;let a=t==null?null:t.initialState;e=ht(e),a==null&&(this.stateful?a=this.states_:a=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(a.length!==o)throw new oe(`RNN Layer has ${o} state(s) but was passed ${a.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const i={training:s},l=vP((v,b)=>{const y=this.cell.call([v].concat(b),i);return[y[0],y.slice(1)]},e,a,this.goBackwards,r,null,this.unroll,this.returnSequences),c=l[0],d=l[1],p=l[2];this.stateful&&this.resetStates(p,s);const m=this.returnSequences?d:c;return this.returnState?[m].concat(p):m})}getInitialState(e){return he(()=>{let t=Wn(e.shape);return t=We(t,[1,2]),t=Ug(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?FC(t,[1,r]):t):this.cell.stateSize>1?[FC(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const r=this.cell.getConfig();return this.getClassName()===Xu.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),e),t)}static fromConfig(e,t,r={}){const s=t.cell,a=yi(s,r);return new e(Object.assign(t,{cell:a}))}}Xu.className="RNN";De(Xu);class b1 extends kt{}class tI extends b1{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,cr(this.units,"units"),this.activation=Mu(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=mn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=mn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=mn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=gn(e.kernelRegularizer),this.recurrentRegularizer=gn(e.recurrentRegularizer),this.biasRegularizer=gn(e.biasRegularizer),this.kernelConstraint=nr(e.kernelConstraint),this.recurrentConstraint=nr(e.recurrentConstraint),this.biasConstraint=nr(e.biasConstraint),this.dropout=Kh([1,Ou([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Kh([1,Ou([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Vt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return he(()=>{if(e=e,e.length!==2)throw new oe(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let r=e[1];e=e[0];const s=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Lu({ones:()=>Ms(e),rate:this.dropout,training:s,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Lu({ones:()=>Ms(r),rate:this.recurrentDropout,training:s,dropoutFunc:this.dropoutFunc}));let a;const o=this.dropoutMask,i=this.recurrentDropoutMask;o!=null?a=_o(re(e,o),this.kernel.read()):a=_o(e,this.kernel.read()),this.bias!=null&&(a=so(a,this.bias.read())),i!=null&&(r=re(r,i));let u=Re(a,_o(r,this.recurrentKernel.read()));return this.activation!=null&&(u=this.activation.apply(u)),[u,u]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Fu(this.activation),useBias:this.useBias,kernelInitializer:wn(this.kernelInitializer),recurrentInitializer:wn(this.recurrentInitializer),biasInitializer:wn(this.biasInitializer),kernelRegularizer:an(this.kernelRegularizer),recurrentRegularizer:an(this.recurrentRegularizer),biasRegularizer:an(this.biasRegularizer),activityRegularizer:an(this.activityRegularizer),kernelConstraint:tr(this.kernelConstraint),recurrentConstraint:tr(this.recurrentConstraint),biasConstraint:tr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}tI.className="SimpleRNNCell";De(tI);class yP extends Xu{constructor(e){e.cell=new tI(e),super(e)}call(e,t){return he(()=>{this.cell.dropoutMask!=null&&(Ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:a})})}static fromConfig(e,t){return new e(t)}}yP.className="SimpleRNN";De(yP);class nI extends b1{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new oe("GRUCell does not support reset_after parameter set to true.");this.units=e.units,cr(this.units,"units"),this.activation=Mu(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Mu(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=mn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=mn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=mn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=gn(e.kernelRegularizer),this.recurrentRegularizer=gn(e.recurrentRegularizer),this.biasRegularizer=gn(e.biasRegularizer),this.kernelConstraint=nr(e.kernelConstraint),this.recurrentConstraint=nr(e.recurrentConstraint),this.biasConstraint=nr(e.biasConstraint),this.dropout=Kh([1,Ou([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Kh([1,Ou([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Vt(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return he(()=>{if(e=e,e.length!==2)throw new oe(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training==null?!1:t.training;let s=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Lu({ones:()=>Ms(e),rate:this.dropout,training:r,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Lu({ones:()=>Ms(s),rate:this.recurrentDropout,training:r,count:3,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,o=this.recurrentDropoutMask;let i,u,l;0<this.dropout&&this.dropout<1&&(e=re(e,a[0]));let c=_o(e,this.kernel.read());this.useBias&&(c=so(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(s=re(s,o[0]));const d=this.recurrentKernel.read(),[p,m]=ps(d,[2*this.units,this.units],d.rank-1),v=_o(s,p),[b,y,w]=ps(c,3,c.rank-1),[S,N]=ps(v,2,v.rank-1);i=this.recurrentActivation.apply(Re(b,S)),u=this.recurrentActivation.apply(Re(y,N));const C=_o(re(u,s),m);l=this.activation.apply(Re(w,C));const T=Re(re(i,s),re(Re(1,ln(i)),l));return[T,T]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Fu(this.activation),recurrentActivation:Fu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:wn(this.kernelInitializer),recurrentInitializer:wn(this.recurrentInitializer),biasInitializer:wn(this.biasInitializer),kernelRegularizer:an(this.kernelRegularizer),recurrentRegularizer:an(this.recurrentRegularizer),biasRegularizer:an(this.biasRegularizer),activityRegularizer:an(this.activityRegularizer),kernelConstraint:tr(this.kernelConstraint),recurrentConstraint:tr(this.recurrentConstraint),biasConstraint:tr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}nI.className="GRUCell";De(nI);class bP extends Xu{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new nI(e),super(e)}call(e,t){return he(()=>{this.cell.dropoutMask!=null&&(Ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:a})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}bP.className="GRU";De(bP);class x1 extends b1{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,cr(this.units,"units"),this.activation=Mu(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Mu(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=mn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=mn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=mn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=gn(e.kernelRegularizer),this.recurrentRegularizer=gn(e.recurrentRegularizer),this.biasRegularizer=gn(e.biasRegularizer),this.kernelConstraint=nr(e.kernelConstraint),this.recurrentConstraint=nr(e.recurrentConstraint),this.biasConstraint=nr(e.biasConstraint),this.dropout=Kh([1,Ou([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Kh([1,Ou([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Vt(e);const r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let s;if(this.useBias){if(this.unitForgetBias){const a=this.biasInitializer,o=this.units;s=new(t=class extends $a{apply(u,l){const c=a.apply([o]),d=new UT().apply([o]),p=a.apply([o*2]);return S$(S$(c,d),p)}},t.className="CustomInit",t)}else s=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,s,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return he(()=>{const r=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new oe(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let s=e[1];const a=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Lu({ones:()=>Ms(e),rate:this.dropout,training:r,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Lu({ones:()=>Ms(s),rate:this.recurrentDropout,training:r,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,i=this.recurrentDropoutMask;let u,l,c,d;0<this.dropout&&this.dropout<1&&(e=re(e,o[0]));let p=_o(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(s=re(s,i[0])),p=Re(p,_o(s,this.recurrentKernel.read())),this.useBias&&(p=so(p,this.bias.read()));const[m,v,b,y]=ps(p,4,p.rank-1);u=this.recurrentActivation.apply(m),l=this.recurrentActivation.apply(v),c=Re(re(l,a),re(u,this.activation.apply(b))),d=this.recurrentActivation.apply(y);const w=re(d,this.activation.apply(c));return[w,w,c]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Fu(this.activation),recurrentActivation:Fu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:wn(this.kernelInitializer),recurrentInitializer:wn(this.recurrentInitializer),biasInitializer:wn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:an(this.kernelRegularizer),recurrentRegularizer:an(this.recurrentRegularizer),biasRegularizer:an(this.biasRegularizer),activityRegularizer:an(this.activityRegularizer),kernelConstraint:tr(this.kernelConstraint),recurrentConstraint:tr(this.recurrentConstraint),biasConstraint:tr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}x1.className="LSTMCell";De(x1);class xP extends Xu{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new x1(e),super(e)}call(e,t){return he(()=>{this.cell.dropoutMask!=null&&(Ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:a})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}xP.className="LSTM";De(xP);class rI extends b1{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return he(()=>{e=e;let r=e.slice(1);const s=[];for(const i of this.cells.slice().reverse())Array.isArray(i.stateSize)?s.push(r.splice(0,i.stateSize.length)):s.push(r.splice(0,1));s.reverse();const a=[];let o;for(let i=0;i<this.cells.length;++i){const u=this.cells[i];r=s[i],i===0?o=[e[0]].concat(r):o=[o[0]].concat(r),o=u.call(o,t),a.push(o.slice(1))}r=[];for(const i of a.slice().reverse())r.push(...i);return[o[0]].concat(r)})}build(e){LC(e)&&(e=e[0]),e=e;let t;this.cells.forEach((r,s)=>{Wl(`RNNCell_${s}`,()=>{r.build(e),Array.isArray(r.stateSize)?t=r.stateSize[0]:t=r.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=a=>({className:a.getClassName(),config:a.getConfig()}),s={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),s)}static fromConfig(e,t,r={}){const s=[];for(const a of t.cells)s.push(yi(a,r));return new e({cells:s})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.cells)t.push(...r.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return PC(e)}setWeights(e){const t=[];for(const r of this.cells){const s=r.weights.length,a=e.splice(s);for(let o=0;o<r.weights.length;++o)t.push([r.weights[o],a[o]])}XT(t)}}rI.className="StackedRNNCells";De(rI);function Lu(n){const{ones:e,rate:t,training:r=!1,count:s=1,dropoutFunc:a}=n,o=()=>a!=null?a(e(),t):hL(e(),t),i=()=>Gg(o,e,r);return!s||s<=1?Qn(i().clone()):Array(s).fill(void 0).map(i).map(l=>Qn(l.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var fte=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class wP extends Xu{constructor(e){if(e.unroll)throw new bt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new bt("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new er({ndim:5})]}call(e,t){return he(()=>{if(this.cell.dropoutMask!=null&&(Ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new oe("ConvRNN2D cell does not support constants");const r=t==null?null:t.mask,s=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:a})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return he(()=>{const{stateSize:t}=this.cell,r=e.shape,s=this.computeSingleOutputShape(r),a=[s[0],...s.slice(2)],o=Wn(a);return Array.isArray(t)?Array(t.length).fill(o):[o]})}resetStates(e,t=!1){he(()=>{if(!this.stateful)throw new go("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape,s=this.computeSingleOutputShape(r),a=[s[0],...s.slice(2)];if(r[0]==null)throw new oe("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Wn(a)):this.states_=[Wn(a)];else if(e==null)Ct(this.states_),this.keptStates!=null&&(Ct(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Wn(a)):this.states_[0]=Wn(a);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new oe(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):Ct(this.states_);for(let i=0;i<this.states_.length;++i){const u=e[i],l=a;if(!Et(u.shape,l))throw new oe(`State ${i} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${u.shape}`);this.states_[i]=u}}this.states_=this.states_.map(i=>Qn(i.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:r,kernelSize:s,padding:a,strides:o,dilationRate:i}=this.cell,u=t==="channelsFirst",l=e[u?3:2],c=e[u?4:3],d=Xa(l,s[0],a,o[0],i[0]),p=Xa(c,s[1],a,o[1],i[1]);return[...e.slice(0,2),...u?[r,d,p]:[d,p,r]]}}wP.className="ConvRNN2D";class sI extends x1{constructor(e){const{filters:t,kernelSize:r,strides:s,padding:a,dataFormat:o,dilationRate:i}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,cr(this.filters,"filters"),this.kernelSize=Ah(r,2,"kernelSize"),this.kernelSize.forEach(u=>cr(u,"kernelSize")),this.strides=Ah(s||1,2,"strides"),this.strides.forEach(u=>cr(u,"strides")),this.padding=a||"valid",ha(this.padding),this.dataFormat=o||"channelsLast",Ln(this.dataFormat),this.dilationRate=Ah(i||1,2,"dilationRate"),this.dilationRate.forEach(u=>cr(u,"dilationRate"))}build(e){var t;e=Vt(e);const r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new oe(`The channel dimension of the input should be defined. Found ${e[r]}`);const s=e[r],a=4,o=this.kernelSize.concat([s,this.filters*a]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const i=this.kernelSize.concat([this.filters,this.filters*a]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let u;if(this.unitForgetBias){const l=this.biasInitializer,c=this.filters;u=new(t=class extends $a{apply(p,m){const v=l.apply([c]),b=ds([c]),y=l.apply([c*2]);return VT([v,b,y])}},t.className="CustomInit",t)}else u=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*a],null,u,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return he(()=>{if(e.length!==3)throw new oe(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training||!1,s=e[0],a=e[1],o=e[2],i=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Lu({ones:()=>Ms(s),rate:this.dropout,training:r,count:i,dropoutFunc:this.dropoutFunc}));const u=this.dropoutMask,l=(L,K,J)=>!K||!K[J]?L:re(K[J],L);let c=l(s,u,0),d=l(s,u,1),p=l(s,u,2),m=l(s,u,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Lu({ones:()=>Ms(a),rate:this.recurrentDropout,training:r,count:i,dropoutFunc:this.dropoutFunc}));const v=this.recurrentDropoutMask;let b=l(a,v,0),y=l(a,v,1),w=l(a,v,2),S=l(a,v,3);const N=3,[C,T,E,$]=ps(this.kernel.read(),i,N),[_,R,D,A]=this.useBias?ps(this.bias.read(),i):[null,null,null,null];c=this.inputConv(c,C,_,this.padding),d=this.inputConv(d,T,R,this.padding),p=this.inputConv(p,E,D,this.padding),m=this.inputConv(m,$,A,this.padding);const[M,H,j,G]=ps(this.recurrentKernel.read(),i,N);b=this.recurrentConv(b,M),y=this.recurrentConv(y,H),w=this.recurrentConv(w,j),S=this.recurrentConv(S,G);const P=this.recurrentActivation.apply(Re(c,b)),V=this.recurrentActivation.apply(Re(d,y)),z=Re(re(V,o),re(P,this.activation.apply(Re(p,w)))),Y=re(this.recurrentActivation.apply(Re(m,S)),this.activation.apply(z));return[Y,Y,z]})}getConfig(){const e=super.getConfig(),{units:t}=e,r=fte(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},r),s)}inputConv(e,t,r,s){const a=wi(e,t,this.strides,s||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return r?so(a,r,this.dataFormat):a}recurrentConv(e,t){return wi(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}sI.className="ConvLSTM2DCell";De(sI);class SP extends wP{constructor(e){const t=new sI(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}SP.className="ConvLSTM2D";De(SP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class aI extends kt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,r=[];for(let s=0;s<this.noiseShape.length;++s)r.push(this.noiseShape[s]==null?t[s]:this.noiseShape[s]);return r}call(e,t){return he(()=>{this.invokeCallHook(e,t);const r=ht(e);if(0<this.rate&&this.rate<1){const s=t.training==null?!1:t.training,a=this.getNoiseShape(r);return Gg(()=>hL(r,this.rate,a,this.seed),()=>r,s)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}aI.className="Dropout";De(aI);class CP extends aI{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}CP.className="SpatialDropout1D";De(CP);class NP extends kt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,cr(this.units,"units"),this.activation=Mu(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=mn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=mn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=nr(e.kernelConstraint),this.biasConstraint=nr(e.biasConstraint),this.kernelRegularizer=gn(e.kernelRegularizer),this.biasRegularizer=gn(e.biasRegularizer),this.activityRegularizer=gn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Vt(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Vt(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return he(()=>{this.invokeCallHook(e,t);const r=ht(e),s=sL(this.activation.getClassName());let a;return s!=null?a=_o(r,this.kernel.read(),s,this.bias?this.bias.read():null):(a=_o(r,this.kernel.read()),this.bias!=null&&(a=so(a,this.bias.read())),this.activation!=null&&(a=this.activation.apply(a))),a})}getConfig(){const e={units:this.units,activation:Fu(this.activation),useBias:this.useBias,kernelInitializer:wn(this.kernelInitializer),biasInitializer:wn(this.biasInitializer),kernelRegularizer:an(this.kernelRegularizer),biasRegularizer:an(this.biasRegularizer),activityRegularizer:an(this.activityRegularizer),kernelConstraint:tr(this.kernelConstraint),biasConstraint:tr(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}NP.className="Dense";De(NP);class kP extends kt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Vt(e);for(const t of e.slice(1))if(t==null)throw new oe(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Cu(e,1)]}call(e,t){return he(()=>{this.invokeCallHook(e,t);let r=ht(e);if(this.dataFormat==="channelsFirst"&&r.rank>1){const s=[0];for(let a=2;a<r.rank;++a)s.push(a);s.push(1),r=Dt(r,s)}return qJ(r)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}kP.className="Flatten";De(kP);class TP extends kt{constructor(e){super(e),this.supportsMasking=!0,this.activation=Mu(e.activation)}call(e,t){return he(()=>{this.invokeCallHook(e,t);const r=ht(e);return this.activation.apply(r)})}getConfig(){const e={activation:Fu(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}TP.className="Activation";De(TP);class IP extends kt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return he(()=>(e=ht(e),HJ(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}IP.className="RepeatVector";De(IP);class EP extends kt{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const r="Total size of new array must be unchanged.",s=t.slice();let a=1,o=null;for(let u=0;u<s.length;++u){const l=s[u];if(this.isUnknown(l))if(o===null)o=u;else throw new oe("Can only specifiy one unknown dimension.");else a*=l}const i=Cu(e);if(o!==null){if(a===0||i%a!==0)throw new oe(r);s[o]=i/a}else if(i!==a)throw new oe(r);return s}computeOutputShape(e){let t=!1;for(let r=0;r<e.length;++r)if(this.isUnknown(e[r])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return he(()=>{this.invokeCallHook(e,t);const r=ht(e),s=r.shape,a=s.slice(0,1).concat(this.fixUnknownDimension(s.slice(1),this.targetShape));return ae(r,a)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}EP.className="Reshape";De(EP);class _P extends kt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=Qa(1,e.dims.length+1);if(!Et(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new er({ndim:this.dims.length+1})]}computeOutputShape(e){e=Vt(e);const t=e.slice();return this.dims.forEach((r,s)=>{t[s+1]=e[r]}),t}call(e,t){return Dt(ht(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}_P.className="Permute";De(_P);class RP extends kt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const r=ht(e);return Xp(Jl(r,this.maskValue),-1)}call(e,t){return he(()=>{this.invokeCallHook(e,t);const r=ht(e),o=Xp(Jl(r,this.maskValue),-1,!0);return re(r,Fe(o,r.dtype))})}}RP.className="Masking";De(RP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class AP extends kt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(jt(e.inputLength))}this.inputDim=e.inputDim,cr(this.inputDim,"inputDim"),this.outputDim=e.outputDim,cr(this.outputDim,"outputDim"),this.embeddingsInitializer=mn(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=gn(e.embeddingsRegularizer),this.activityRegularizer=gn(e.activityRegularizer),this.embeddingsConstraint=nr(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return he(()=>this.maskZero?(e=ht(e),Jl(e,Lt(e))):null)}computeOutputShape(e){if(e=Vt(e),this.inputLength==null)return[...e,this.outputDim];const t=jt(this.inputLength);if(t.length!==e.length-1)throw new oe(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let r=0;for(let s=0;s<t.length;++s){const a=t[s],o=e[s+1];if(a!=null&&o!=null&&a!==o)throw new oe(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);a==null&&(t[r]=o),r++}}return[e[0],...t,this.outputDim]}call(e,t){return he(()=>{this.invokeCallHook(e,t);let r=ht(e);r.dtype!=="int32"&&(r=Eo(r,"int32"));const s=cL(this.embeddings.read(),ae(r,[r.size]));return ae(s,Vt(this.computeOutputShape(r.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:wn(this.embeddingsInitializer),embeddingsRegularizer:an(this.embeddingsRegularizer),activityRegularizer:an(this.activityRegularizer),embeddingsConstraint:tr(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}AP.className="Embedding";De(AP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class bc extends kt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new bt}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const r=e.slice(0,e.length-t.length);for(let s=0;s<t.length;++s){const a=e[e.length-t.length+s],o=t[s];if(a==null||o==null||a<0||o<0)r.push(null);else if(a===1)r.push(o);else if(o===1)r.push(a);else{if(a!==o)throw new oe("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));r.push(a)}}return r}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Vt(e)]),e=e,e.length<2)throw new oe(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const a of e)a!=null&&a[0]!==null&&t.push(a[0]);if(t=Su(t),t.length>1)throw new oe(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let r=e[0]==null?null:e[0].slice(1);for(let a=1;a<e.length;++a){const o=e[a]==null?null:e[a].slice(1);r=this.computeElementwiseOpOutputShape(r,o)}const s=e.map(a=>a.length);e.indexOf(null)===-1&&Su(s).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return he(()=>{if(e=e,this.reshapeRequired){const r=[],s=e.map(a=>a.rank);if(s.indexOf(null)===-1){const a=Ou(s);for(let o of e){const i=o.rank;for(let u=0;u<a-i;++u)o=Ug(o,1);r.push(o)}return this.mergeFunction(r)}else{let a=!1;for(const u of e){const l=u.rank;if(l==null){const c=u.shape,d=c[0],p=c.slice(1).concat([d]);let m=ae(u,[d].concat(Cu(c.slice(1))));m=Dt(m,[1,0]),m=ae(m,p),r.push(m),a=!0}else if(l>1){const c=Qa(1,l).concat([0]);r.push(Dt(u,c)),a=!0}else r.push(u)}let o=this.mergeFunction(r);const i=o.rank;if(a){if(i==null){const u=o.shape,l=u.length,c=u[l-1],d=[c].concat(u.slice(0,u.length-1));o=ae(Dt(ae(o,[-1,c]),[1,0]),d)}else if(i>1){const u=[i-1].concat(Qa(0,i-1));o=Dt(o,u)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let s=1;s<e.length;++s){const a=e[s]==null?null:e[s].slice(1);t=this.computeElementwiseOpOutputShape(t,a)}let r=[];for(const s of e)s!=null&&s[0]!==null&&r.push(s[0]);return r=Su(r),r.length===1?t=r.concat(t):t=[null].concat(t),t}computeMask(e,t){return he(()=>{if(t==null)return null;if(!Array.isArray(t))throw new oe("`mask` should be an Array");if(!Array.isArray(e))throw new oe("`inputs` should be an Array");if(t.length!==e.length)throw new oe(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(s=>s==null))return null;t=t.map(s=>s==null?s:Wr(s,0));let r=t[0];for(let s=1;s<t.length-1;++s)r=Za(r,t[s]);return r})}}class DP extends bc{constructor(e){super(e)}mergeFunction(e){return he(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=Re(t,e[r]);return t})}}DP.className="Add";De(DP);class $P extends bc{constructor(e){super(e)}mergeFunction(e){return he(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=re(t,e[r]);return t})}}$P.className="Multiply";De($P);class OP extends bc{constructor(e){super(e)}mergeFunction(e){return he(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=Re(t,e[r]);return re(1/e.length,t)})}}OP.className="Average";De(OP);class FP extends bc{constructor(e){super(e)}mergeFunction(e){return he(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=zo(t,e[r]);return t})}}FP.className="Maximum";De(FP);class MP extends bc{constructor(e){super(e)}mergeFunction(e){return he(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=$u(t,e[r]);return t})}}MP.className="Minimum";De(MP);class LP extends bc{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new oe("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const s of e)if(s!=null){t=!1;break}if(t)return;const r=[];for(let s=0;s<e.length;++s){const a=e[s].slice();a.splice(this.axis,1);let o=!1;for(const i of r)if(Et(i,a)){o=!0;break}o||r.push(a)}if(r.length>1)throw new oe("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return he(()=>VT(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new oe("A `Concatenate` layer should be called on a list of inputs.");const t=e,r=t[0].slice(),s=this.axis<0?r.length+this.axis:this.axis;for(const a of t.slice(1)){if(r[s]==null||a[s]==null){r[s]=null;break}r[s]+=a[s]}return r}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new oe("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new oe("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new oe(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return he(()=>{let r=!0;if(t.forEach(o=>{if(o!=null){r=!1;return}}),r)return null;const s=[];for(let o=0;o<e.length;++o)t[o]==null?s.push(Fe(Ms(e[o]),"bool")):t[o].rank<e[o].rank?s.push(Wr(t[o],-1)):s.push(t[o]);const a=On(s,this.axis);return kx(a,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}LP.className="Concatenate";De(LP);function Sp(n,e){for(;n<0;)n+=e;return n}function pte(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new bt("batchDot is not implemented for tensors of 4D or higher rank yet");if(B(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),B(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new bt("batchDot is not implemented for complex64-type Tensors yet.");const r=n.shape.length,s=e.shape.length;t==null&&(t=[r-1,s-2]);const a=t;return he(()=>{let o;if(r>s){o=r-s;const u=[];for(let l=0;l<o;++l)u.push(1);e=ae(e,e.shape.concat(u))}else if(s>r){o=s-r;const u=[];for(let l=0;l<o;++l)u.push(1);n=ae(n,n.shape.concat(u))}else o=0;let i;if(n.shape.length===2&&e.shape.length===2)a[0]===a[1]?i=We(re(n,e),a[0]):i=We(re(Dt(n,[1,0]),e),a[1]);else{const u=a[0]!==n.shape.length-1,l=a[1]===e.shape.length-1;i=St(n,e,u,l)}if(o>0){let u;r>s?u=r+s-3:u=r-1;const l=[];for(let c=u;c<u+o;++c)l.push(c);i=qu(i,l)}return i.shape.length===1&&(i=Wr(i,1)),i})}class PP extends bc{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){B(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],r=e[1];if(t.length>3||r.length>3)throw new bt("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(t,r);if(t[s[0]]!==r[s[1]])throw new oe(`Dimension incompatibility: ${t[s[0]]} !== ${r[s[1]]}`)}mergeFunction(e){if(e.length!==2)throw new oe(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],r=e[1],s;return Array.isArray(this.axes)?s=this.axes.map((a,o)=>Sp(a,e[o].shape.length)):s=[Sp(this.axes,t.shape.length),Sp(this.axes,r.shape.length)],this.normalize&&(t=Eb(t,s[0]),r=Eb(r,s[1])),pte(t,r,s)}interpretAxes(e,t){let r;return Array.isArray(this.axes)?r=this.axes:r=[Sp(this.axes,e.length),Sp(this.axes,t.length)],r}computeOutputShape(e){B(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),r=e[1].slice();if(t.length>3||r.length>3)throw new bt("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(t,r);t.splice(s[0],1),r.splice(s[1],1),r.splice(0,1);const a=t.concat(r);return a.length===1&&a.push(1),a}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}PP.className="Dot";De(PP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class BP extends kt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return he(()=>{this.invokeCallHook(e,t);const r=ht(e);return Gg(()=>Re(f1(r.shape,0,this.stddev),r),()=>r,t.training||!1)})}}BP.className="GaussianNoise";De(BP);class zP extends kt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return he(()=>{this.invokeCallHook(e,t);const r=ht(e);return this.rate>0&&this.rate<1?Gg(()=>{const a=Math.sqrt(this.rate/(1-this.rate));return re(r,f1(r.shape,1,a))},()=>r,t.training||!1):r})}}zP.className="GaussianDropout";De(zP);class VP extends kt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||ht(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return he(()=>{if(this.rate<1&&this.rate>0){const r=this._getNoiseShape(e);return Gg(()=>{const a=ht(e),i=-1.6732632423543772*1.0507009873554805;let u=Ei(ju(r),this.rate);u=Eo(u,"float32");const l=((1-this.rate)*(1+this.rate*i**2))**-.5,c=-l*i*this.rate,d=Re(re(a,u),re(Re(u,-1),i));return Re(re(d,l),c)},()=>ht(e),t.training||!1)}return e})}}VP.className="AlphaDropout";De(VP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nm(n,e,t,r,s,a=.001){let o;if(n.rank===2)o=ck(n,e,t,r,s,a);else if(n.rank===3)o=hk(n,e,t,r,s,a);else if(n.rank===4)o=dk(n,e,t,r,s,a);else throw new bt(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function mte(n,e,t,r,s=.001){return he(()=>{const a=Rg(n,r),o=a.mean,i=a.variance;return[nm(n,o,i,t,e,s),o,i]})}function gte(n,e,t,r,s=.001){return he(()=>{const a=Rg(n,r),o=a.mean,i=a.variance,u=[];for(const v of Qa(0,n.rank))r.indexOf(v)!==-1?u.push(1):u.push(n.shape[v]);const l=ae(o,u),c=ae(i,u),d=e==null?null:ae(e,u),p=t==null?null:ae(t,u);return[nm(n,l,c,p,d,s),o,i]})}function vte(n,e,t,r,s=.001){return Et(r.slice().sort(),Qa(0,n.rank-1))?mte(n,e,t,r,s):gte(n,e,t,r,s)}class UP extends kt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=mn(e.betaInitializer||"zeros"),this.gammaInitializer=mn(e.gammaInitializer||"ones"),this.movingMeanInitializer=mn(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=mn(e.movingVarianceInitializer||"ones"),this.betaConstraint=nr(e.betaConstraint),this.gammaConstraint=nr(e.gammaConstraint),this.betaRegularizer=gn(e.betaRegularizer),this.gammaRegularizer=gn(e.gammaRegularizer)}build(e){e=Vt(e);const t=this.axis>=0?this.axis:this.axis+e.length,r=e[t];if(r==null)throw new oe(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new er({ndim:e.length,axes:{[t]:r}})];const s=[r];this.scale&&(this.gamma=this.addWeight("gamma",s,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",s,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",s,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",s,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return he(()=>{const r=t.training==null?!1:t.training,s=ht(e),a=s.shape,o=a.length,i=Qa(0,o),u=this.axis>=0?this.axis:this.axis+o;i.splice(u,1);const l=nc(1,o);l[u]=a[u];const c=i.slice();c.sort();const d=!Et(c,Qa(0,o).slice(0,o-1)),p=()=>{if(d){const S=ae(this.movingMean.read(),l),N=ae(this.movingVariance.read(),l),C=this.center?ae(this.beta.read(),l):null,T=this.scale?ae(this.gamma.read(),l):null;return nm(s,S,N,C,T,this.epsilon)}else return nm(s,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!r)return p();const[m,v,b]=vte(s,this.gamma.read(),this.beta.read(),i,this.epsilon),y=(S,N,C)=>{he(()=>{const T=1-C,E=S.read(),$=re(ze(E,N),T);S.write(ze(E,$))})};return(()=>{y(this.movingMean,v,this.momentum),y(this.movingVariance,b,this.momentum)})(),m})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:wn(this.betaInitializer),gammaInitializer:wn(this.gammaInitializer),movingMeanInitializer:wn(this.movingMeanInitializer),movingVarianceInitializer:wn(this.movingVarianceInitializer),betaRegularizer:an(this.betaRegularizer),gammaRegularizer:an(this.gammaRegularizer),betaConstraint:tr(this.betaConstraint),gammaConstraint:tr(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}UP.className="BatchNormalization";De(UP);class WP extends kt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=mn(e.betaInitializer||"zeros"),this.gammaInitializer=mn(e.gammaInitializer||"ones"),this.betaRegularizer=gn(e.betaRegularizer),this.gammaRegularizer=gn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Vt(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let a=0;a<this.axis.length;++a)this.axis[a]<0&&(this.axis[a]+=t);for(const a of this.axis)if(a<0||a>=t)throw new Error(`Invalid axis: ${a}`);if(this.axis.length!==Su(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const r=this.axis.map(a=>e[a]),s=!0;this.scale?this.gamma=this.addWeight("gamma",r,"float32",this.gammaInitializer,this.gammaRegularizer,s):this.gamma=null,this.center?this.beta=this.addWeight("beta",r,"float32",this.betaInitializer,this.betaRegularizer,s):this.beta=null,this.built=!0}call(e,t){const r=ht(e),s=r.shape,a=s.length;return he(()=>{let{mean:i,variance:u}=Rg(r,this.axis,!0);const l=nc(1,a);for(const b of this.axis)l[b]=s[b];const c=b=>b!=null&&b.shape.length!==a?ae(b,l):b;let d=this.scale?c(this.gamma.read()):null,p=this.center?c(this.beta.read()):null;const m=[],v=[];for(let b=0;b<a;++b)this.axis.indexOf(b)!==-1?(m.push(s[b]),v.push(1)):(m.push(1),v.push(s[b]));return i=ta(i,m),u=ta(u,m),d!=null&&(d=ta(d,v)),p!=null&&(p=ta(p,v)),nm(r,i,u,p,d,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:wn(this.betaInitializer),gammaInitializer:wn(this.gammaInitializer),betaRegularizer:an(this.betaRegularizer),gammaRegularizer:an(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}WP.className="LayerNormalization";De(WP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yte(n,e,t){return he(()=>{if(n.rank!==4)throw new oe(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new oe("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=Ja()),t!=="channelsLast"&&t!=="channelsFirst")throw new oe(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return t==="channelsFirst"?r=[[0,0],[0,0],e[0],e[1]]:r=[[0,0],e[0],e[1],[0,0]],_i(n,r)})}class GP extends kt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Ja():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new oe(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,r;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],r=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new oe(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new oe(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);r=e.padding[1]}this.padding=[t,r]}this.inputSpec=[new er({ndim:4})]}computeOutputShape(e){e=Vt(e);let t,r;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?r=e[3]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],e[1],t,r]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?r=e[2]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],t,r,e[3]])}call(e,t){return he(()=>yte(ht(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}GP.className="ZeroPadding2D";De(GP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function w1(n,e,t,r,s,a){return he(()=>{Ln(s),oL(a),ha(r),t==null&&(t=[1,1]),r==null&&(r="valid"),s==null&&(s=Ja()),a==null&&(a="max"),n=eI(n,s);let o;const i=r==="same"?"same":"valid";return a==="max"?o=_g(n,e,t,i):o=wg(n,e,t,i),s==="channelsFirst"&&(o=Dt(o,[0,3,1,2])),o})}function HP(n,e,t,r,s,a){return he(()=>{Ln(s),oL(a),ha(r),t==null&&(t=[1,1,1]),r==null&&(r="valid"),s==null&&(s=Ja()),a==null&&(a="max"),n=uP(n,s);let o;const i=r==="same"?"same":"valid";return a==="max"?o=Fk(n,e,t,i):o=lk(n,e,t,i),s==="channelsFirst"&&(o=Dt(o,[0,4,1,2,3])),o})}class jP extends kt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new oe(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(cr(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new oe(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);cr(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,ha(this.padding),this.inputSpec=[new er({ndim:3})]}computeOutputShape(e){e=Vt(e);const t=Xa(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return he(()=>{this.invokeCallHook(e,t),e=Ug(ht(e),2);const r=this.poolingFunction(ht(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return qu(r,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class qP extends jP{constructor(e){super(e)}poolingFunction(e,t,r,s,a){return Ln(a),ha(s),w1(e,t,r,s,a,"max")}}qP.className="MaxPooling1D";De(qP);class KP extends jP{constructor(e){super(e)}poolingFunction(e,t,r,s,a){return Ln(a),ha(s),w1(e,t,r,s,a,"avg")}}KP.className="AveragePooling1D";De(KP);class XP extends kt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new oe(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];cr(this.poolSize,"poolSize"),cr(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Ln(this.dataFormat),ha(this.padding),this.inputSpec=[new er({ndim:4})]}computeOutputShape(e){e=Vt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=Xa(t,this.poolSize[0],this.padding,this.strides[0]),r=Xa(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r]:[e[0],t,r,e[3]]}call(e,t){return he(()=>(this.invokeCallHook(e,t),this.poolingFunction(ht(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class YP extends XP{constructor(e){super(e)}poolingFunction(e,t,r,s,a){return Ln(a),ha(s),w1(e,t,r,s,a,"max")}}YP.className="MaxPooling2D";De(YP);class ZP extends XP{constructor(e){super(e)}poolingFunction(e,t,r,s,a){return Ln(a),ha(s),w1(e,t,r,s,a,"avg")}}ZP.className="AveragePooling2D";De(ZP);class QP extends kt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new oe(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];cr(this.poolSize,"poolSize"),cr(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Ln(this.dataFormat),ha(this.padding),this.inputSpec=[new er({ndim:5})]}computeOutputShape(e){e=Vt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=Xa(t,this.poolSize[0],this.padding,this.strides[0]),r=Xa(r,this.poolSize[1],this.padding,this.strides[1]),s=Xa(s,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r,s]:[e[0],t,r,s,e[4]]}call(e,t){return he(()=>(this.invokeCallHook(e,t),this.poolingFunction(ht(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class JP extends QP{constructor(e){super(e)}poolingFunction(e,t,r,s,a){return Ln(a),ha(s),HP(e,t,r,s,a,"max")}}JP.className="MaxPooling3D";De(JP);class eB extends QP{constructor(e){super(e)}poolingFunction(e,t,r,s,a){return Ln(a),ha(s),HP(e,t,r,s,a,"avg")}}eB.className="AveragePooling3D";De(eB);class tB extends kt{constructor(e){super(e),this.inputSpec=[new er({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new bt}}class nB extends tB{constructor(e){super(e||{})}call(e,t){return he(()=>{const r=ht(e);return xn(r,1)})}}nB.className="GlobalAveragePooling1D";De(nB);class rB extends tB{constructor(e){super(e||{})}call(e,t){return he(()=>{const r=ht(e);return ia(r,1)})}}rB.className="GlobalMaxPooling1D";De(rB);class sB extends kt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Ln(this.dataFormat),this.inputSpec=[new er({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new bt}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class aB extends sB{call(e,t){return he(()=>{const r=ht(e);return this.dataFormat==="channelsLast"?xn(r,[1,2]):xn(r,[2,3])})}}aB.className="GlobalAveragePooling2D";De(aB);class oB extends sB{call(e,t){return he(()=>{const r=ht(e);return this.dataFormat==="channelsLast"?ia(r,[1,2]):ia(r,[2,3])})}}oB.className="GlobalMaxPooling2D";De(oB);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class iB extends kt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,r={}){const s=t.layer,a=yi(s,r);delete t.layer;const o={layer:a};return Object.assign(o,t),new e(o)}}class uB extends iB{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Vt(e),e.length<3)throw new oe(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Vt(e);const t=[e[0]].concat(e.slice(2)),r=this.layer.computeOutputShape(t),s=e[1];return[r[0],s].concat(r.slice(1))}call(e,t){return he(()=>(e=ht(e),vP((o,i)=>[ht(this.layer.call(o,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}uB.className="TimeDistributed";De(uB);function bte(n){yc(zJ,"BidirectionalMergeMode",n)}const xte="concat";class lB extends iB{constructor(e){super(e);const t=e.layer.getConfig(),r={};r.className=e.layer.getClassName(),r.config=t,this.forwardLayer=yi(r),t.goBackwards=t.goBackwards!==!0;const s={};if(s.className=e.layer.getClassName(),s.config=t,this.backwardLayer=yi(s),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?xte:e.mergeMode,bte(this.mergeMode),e.weights)throw new bt("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,r=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,r)),this.backwardLayer.setWeights(e.slice(r))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let r,s,a;return this.returnState&&(a=t.slice(1)),r=t[0],r=r,this.mergeMode==="concat"?(r[r.length-1]*=2,s=[r]):this.mergeMode==null?s=[r,r.slice()]:s=[r],this.returnState?this.mergeMode==null?s.concat(a).concat(a.slice()):[r].concat(a).concat(a.slice()):hs(s)}apply(e,t){let r=t==null?null:t.initialState,s=t==null?null:t.constants;t==null&&(t={});const a=gP(e,r,s,this.numConstants);if(e=a.inputs,r=a.initialState,s=a.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(r==null||r.length===0)&&s==null)return super.apply(e,t);const o=[],i=[];if(r!=null){const l=r.length;if(l%2>0)throw new oe("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push(...r);const c=r.map(d=>new er({shape:d.shape}));this.forwardLayer.stateSpec=c.slice(0,l/2),this.backwardLayer.stateSpec=c.slice(l/2),i.push(...c)}if(s!=null)throw new bt("Support for constants in Bidirectional layers is not implemented yet.");const u=o[0]instanceof Lo;for(const l of o)if(l instanceof Lo!==u)throw new oe("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(u){const l=[e].concat(o),c=this.inputSpec.concat(i),d=this.inputSpec;this.inputSpec=c;const p=super.apply(l,t);return this.inputSpec=d,p}else return super.apply(e,t)}call(e,t){return he(()=>{const r=t.initialState;let s,a;if(r==null)s=this.forwardLayer.call(e,t),a=this.backwardLayer.call(e,t);else{const u=r.slice(0,r.length/2),l=r.slice(r.length/2);s=this.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=this.backwardLayer.call(e,Object.assign(t,{initialState:l}))}let o;this.returnState&&(Array.isArray(s)&&(o=s.slice(1).concat(a.slice(1))),s=s[0],a=a[0]),this.returnSequences&&(a=la(a,1));let i;return this.mergeMode==="concat"?i=VT([s,a]):this.mergeMode==="sum"?i=Re(s,a):this.mergeMode==="ave"?i=re(.5,Re(s,a)):this.mergeMode==="mul"?i=re(s,a):this.mergeMode==null&&(i=[s,a]),this.returnState?this.mergeMode==null?i.concat(o):[i].concat(o):i})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Wl(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Wl(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let r;if(this.returnSequences?this.mergeMode==null?r=[t,t]:r=t:this.mergeMode==null?r=[null,null]:r=null,this.returnState){const a=this.forwardLayer.states.map(o=>null);return Array.isArray(r)?r.concat(a).concat(a):[r].concat(a).concat(a)}else return r}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const r=yi(t.layer);if(delete t.layer,t.numConstants!=null)throw new bt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const s=t;return s.layer=r,new e(s)}}lB.className="Bidirectional";De(lB);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class cB extends kt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return he(()=>(e=ht(e),e.dtype!=="float32"&&(e=Eo(e,"float32")),Re(re(e,this.scale),this.offset)))}}cB.className="Rescaling";De(cB);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:wte,cropAndResize:Ste}=Ha;class hB extends kt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,r,s,a,o,i,u){return he(()=>{let l,c=!1;const d=t/o,p=r/i,m=(s+t)/o,v=(a+r)/i,b=[d,p,m,v],y=[];e.rank===3?(c=!0,l=bs([e])):l=e;for(let T=0;T<l.shape[0];T++)y.push(b);const w=Ra(y,[y.length,4]),S=ec(0,y.length,1,"int32"),C=Ste(l,w,S,[s,a],"nearest");return Eo(c?ht(ca(C)):C,u)})}upsize(e,t,r,s){return he(()=>{const a=wte(e,[t,r]);return Eo(a,s)})}call(e,t){return he(()=>{const r=ht(e),s=r.dtype,a=r.shape,o=a[a.length-3],i=a[a.length-2];let u=0;o!==this.height&&(u=Math.floor((o-this.height)/2));let l=0;return i!==this.width&&(l=Math.floor((i-this.width)/2),l===0&&(l=1)),u>=0&&l>=0?this.centerCrop(r,u,l,this.height,this.width,o,i,s):this.upsize(e,this.height,this.width,s)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Vt(e);const t=e.length-3,r=e.length-2;return e[t]=this.height,e[r]=this.width,e}}hB.className="CenterCrop";De(hB);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Cte(n,e,t,r){let s=ht(n);if(s.dtype!=="int32"&&(s=Eo(s,"int32")),e==="int")return s;const a=s.shape;if(s.rank===0&&(s=Wr(s,-1)),e==="oneHot"&&s.shape[s.shape.length-1]!==1&&(s=Wr(s,-1)),s.rank>2)throw new oe(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${a} which would result in output rank ${s.rank}.`);const o=["multiHot","oneHot"].includes(e),i=s;let u;if(typeof r<"u"&&e==="count"?u=Sb(i,r,t,o):u=Sb(i,[],t,o),e!=="tfIdf")return u;if(r)return re(u,r);throw new oe("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class dB extends kt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Vt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return he(()=>{e=ht(e),e.dtype!=="int32"&&(e=Eo(e,"int32"));let r;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new oe(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);r=ht(t.countWeights)}const s=ia(e),a=Uh(e),o=Ss(this.numTokens,s).bufferSync().get(0),i=Ei(a,0).bufferSync().get(0);if(!(o&&i))throw new oe(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return Cte(e,this.outputMode,this.numTokens,r)})}}dB.className="CategoryEncoding";De(dB);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Nte=["bilinear","nearest"],z$=new Set(Nte);class fB extends kt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(z$.has(e.interpolation))this.interpolation=e.interpolation;else throw new oe(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Vt(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return he(()=>{const r=[this.height,this.width];if(this.interpolation==="bilinear")return Ha.resizeBilinear(e,r,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Ha.resizeNearestNeighbor(e,r,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...z$]} are supported`)})}}fB.className="Resizing";De(fB);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class pB{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}pB.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class mB extends kt{constructor(e){super(e),this.randomGenerator=new pB(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}mB.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const kte=["bilinear","nearest"],V$=new Set(kte);class gB extends mB{constructor(e){super(e);const{factor:t,interpolation:r="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new oe(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new oe(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new oe(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(r)if(V$.has(r))this.interpolation=r;else throw new oe(`Invalid interpolation parameter: ${r} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Vt(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return he(()=>{const r=ht(e);this.imgHeight=r.shape[r.shape.length-3];const s=r.shape[r.shape.length-2];this.widthFactor=ju([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let a=this.widthFactor.dataSync()[0]*s;a=Math.round(a);const o=[this.imgHeight,a];switch(this.interpolation){case"bilinear":return Ha.resizeBilinear(e,o);case"nearest":return Ha.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...V$]} are supported`)}})}}gB.className="RandomWidth";De(gB);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tte=de();Tte.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var _s;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(_s||(_s={}));var U$;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(U$||(U$={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oI={};function Ite(n,e){const t={tfOpName:n,category:"custom",inputs:[],attrs:[],customExecutor:e};oI[n]=t}function vB(n){return oI[n]}function Ete(n){delete oI[n]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O(n,e,t,r,s){const a=e.inputParams[n];if(a&&a.inputIndexStart!==void 0){const i=a.inputIndexStart,u=a.inputIndexEnd===0?void 0:a.inputIndexEnd===void 0?i+1:a.inputIndexEnd,l=i<0?e.inputNames.length+i:i;if(a.type==="tensor")return Tr(e.inputNames[l],t,r,s);if(a.type==="tensors"){const p=e.inputs.slice(i,u);return e.inputNames.slice(i,u).filter((v,b)=>{var y;return((y=p[b])===null||y===void 0?void 0:y.op)!=="NoOp"}).map(v=>Tr(v,t,r,s))}const c=Tr(e.inputNames[l],t,r,s),d=c.dataSync();return a.type==="number"?d[0]:oa(c.shape,d)}const o=e.attrParams[n];return o&&o.value}function Tr(n,e,t,r){const[s,a]=Rs(n,t);if(r!=null){const i=r.getHashTableHandleByName(s);if(i!=null)return i}const o=t.currentContextIds.find(i=>!!e[$b(s,i)]);return o!==void 0?e[$b(s,o)][a]:void 0}function W$(n,e,t){return e[$b(n,t.currentContextId)]}function di(n,e){const[t,r,s]=Rs(n,e);return[$b(t,e&&e.currentContextId),r,s]}function $b(n,e){return e?`${n}-${e}`:n}function Rs(n,e){if(n==="")return["",0,void 0];const t=e!=null&&e.parseNodeNameCache!=null;if(t){const a=e.parseNodeNameCache.get(n);if(a!=null)return a}const r=n.split(":");let s;if(r.length===1)s=[n,0,void 0];else{const a=r[0],o=r.length===3?r[1]:void 0,i=Number(r[r.length-1]);s=[a,i,o]}return t&&e.parseNodeNameCache.set(n,s),s}function lb(n,e,t){let r=O("pad",n,e,t);if(r==="explicit"){r=O("explicitPaddings",n,e,t);const s=[[0,0],[0,0],[0,0],[0,0]];for(let a=0;a<4;a++)s[a][0]=r[a*2],s[a][1]=r[a*2+1];return s}return r}function fi(n){return n.kept?n:To(n)}/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _te=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Rte=Object.freeze(Object.defineProperty({__proto__:null,json:_te},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ate=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Dte=Object.freeze(Object.defineProperty({__proto__:null,json:Ate},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $te=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],Ote=Object.freeze(Object.defineProperty({__proto__:null,json:$te},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fte=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],Mte=Object.freeze(Object.defineProperty({__proto__:null,json:Fte},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lte=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],Pte=Object.freeze(Object.defineProperty({__proto__:null,json:Lte},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bte=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],zte=Object.freeze(Object.defineProperty({__proto__:null,json:Bte},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vte=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],Ute=Object.freeze(Object.defineProperty({__proto__:null,json:Vte},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wte=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],Gte=Object.freeze(Object.defineProperty({__proto__:null,json:Wte},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hte=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],jte=Object.freeze(Object.defineProperty({__proto__:null,json:Hte},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qte=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],Kte=Object.freeze(Object.defineProperty({__proto__:null,json:qte},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xte=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],Yte=Object.freeze(Object.defineProperty({__proto__:null,json:Xte},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zte=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],Qte=Object.freeze(Object.defineProperty({__proto__:null,json:Zte},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jte=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],ene=Object.freeze(Object.defineProperty({__proto__:null,json:Jte},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tne=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],nne=Object.freeze(Object.defineProperty({__proto__:null,json:tne},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rne=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],sne=Object.freeze(Object.defineProperty({__proto__:null,json:rne},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ane=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],one=Object.freeze(Object.defineProperty({__proto__:null,json:ane},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ine=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],une=Object.freeze(Object.defineProperty({__proto__:null,json:ine},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lne=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],cne=Object.freeze(Object.defineProperty({__proto__:null,json:lne},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hne=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],dne=Object.freeze(Object.defineProperty({__proto__:null,json:hne},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G${static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[Rte,Dte,Ote,Mte,Pte,zte,Ute,Gte,jte,Kte,Yte,Qte,ene,nne,sne,one,une,cne,dne],t=[].concat(...e.map(r=>r.json));this.opMappers=t.reduce((r,s)=>(r[s.tfOpName]=s,r),{})}transformGraph(e,t={}){const r=e.node,s=[],a=[],o=[],i=r.reduce((b,y)=>(b[y.name]=this.mapNode(y),y.op.startsWith("Placeholder")?s.push(b[y.name]):y.op==="Const"?a.push(b[y.name]):(y.input==null||y.input.length===0)&&o.push(b[y.name]),b),{});let u=[];const l=[];let c={},d={};t!=null&&(c=this.mapSignatureEntries(t.inputs),d=this.mapSignatureEntries(t.outputs));const p=Object.keys(i);p.forEach(b=>{const y=i[b];y.inputNames.forEach((w,S)=>{const[N,,C]=di(w),T=i[N];if(T.outputs!=null){const E=T.outputs.indexOf(C);if(E!==-1){const $=`${N}:${E}`;y.inputNames[S]=$}}y.inputs.push(T),T.children.push(y)})}),Object.keys(d).length===0?p.forEach(b=>{const y=i[b];y.children.length===0&&l.push(y)}):Object.keys(d).forEach(b=>{const[y]=di(b),w=i[y];w!=null&&(w.signatureKey=d[b],l.push(w))}),Object.keys(c).length>0?Object.keys(c).forEach(b=>{const[y]=di(b),w=i[y];w&&(w.signatureKey=c[b],u.push(w))}):u=s;let m={};e.library!=null&&e.library.function!=null&&(m=e.library.function.reduce((b,y)=>(b[y.signature.name]=this.mapFunction(y),b),{}));const v={nodes:i,inputs:u,outputs:l,weights:a,placeholders:s,signature:t,functions:m};return o.length>0&&(v.initNodes=o),v}mapSignatureEntries(e){return Object.keys(e||{}).reduce((t,r)=>(t[e[r].name]=r,t),{})}mapNode(e){const t=vB(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const r={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(s=>s.startsWith("^")?s.slice(1):s),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(r.inputParams=t.inputs.reduce((s,a)=>(s[a.name]={type:a.type,inputIndexStart:a.start,inputIndexEnd:a.end},s),{})),t.attrs!=null&&(r.attrParams=t.attrs.reduce((s,a)=>{const o=a.type;let i;switch(a.type){case"string":i=GC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=GC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"string[]":i=ZC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=ZC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"number":i=jC(e.attr,a.tfName,a.defaultValue||0),i===void 0&&a.tfDeprecatedName&&(i=jC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"number[]":i=YC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=YC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool":i=HC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=HC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool[]":i=JC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=JC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape":i=XC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=XC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape[]":i=QC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=QC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype":i=qC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=qC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype[]":i=KC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=KC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"func":i=H$(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=H$(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${a.type} for op: ${e.op}`)}return s[a.name]={value:i,type:o},s},{})),r}mapFunction(e){const t=e.nodeDef,r=[],s=[];let a={};t!=null&&(a=t.reduce((d,p)=>(d[p.name]=this.mapNode(p),p.op==="Const"&&s.push(d[p.name]),d),{}));const o=[],i=[];e.signature.inputArg.forEach(d=>{const[p]=di(d.name),m={name:p,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:iI(d.type),type:"dtype"}},children:[]};m.signatureKey=d.name,o.push(m),a[p]=m}),Object.keys(a).forEach(d=>{const p=a[d];p.inputNames.forEach((m,v)=>{const[b,,y]=di(m),w=a[b];if(w.outputs!=null){const S=w.outputs.indexOf(y);if(S!==-1){const N=`${b}:${S}`;p.inputNames[v]=N}}p.inputs.push(w),w.children.push(p)})});const l=e.ret;e.signature.outputArg.forEach(d=>{const[p,m]=di(l[d.name]),v=a[p];v!=null&&(v.defaultOutput=m,i.push(v))});const c=this.mapArgsToSignature(e);return{nodes:a,inputs:o,outputs:i,weights:s,placeholders:r,signature:c}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((t,r)=>(t[r.name]=this.mapArgToTensorInfo(r),t),{}),outputs:e.signature.outputArg.reduce((t,r)=>(t[r.name]=this.mapArgToTensorInfo(r,e.ret),t),{})}}mapArgToTensorInfo(e,t){let r=e.name;return t!=null&&(r=t[r]),{name:r,dtype:e.type}}}function fne(n){const e=de().global;if(typeof e.atob<"u")return e.atob(n);if(typeof Buffer<"u")return new Buffer(n,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function yB(n,e){const t=Array.isArray(n)?String.fromCharCode.apply(null,n):fne(n);return e?t:t.toLowerCase()}function GC(n,e,t,r=!1){const s=n[e];return s!=null?yB(s.s,r):t}function HC(n,e,t){const r=n[e];return r?r.b:t}function jC(n,e,t){const r=n[e]||{},s=r.i!=null?r.i:r.f!=null?r.f:t;return typeof s=="number"?s:parseInt(s,10)}function iI(n){switch(typeof n=="string"&&(n=_s[n]),n){case _s.DT_FLOAT:case _s.DT_HALF:return"float32";case _s.DT_INT32:case _s.DT_INT64:case _s.DT_INT8:case _s.DT_UINT8:return"int32";case _s.DT_BOOL:return"bool";case _s.DT_DOUBLE:return"float32";case _s.DT_STRING:return"string";case _s.DT_COMPLEX64:case _s.DT_COMPLEX128:return"complex64";default:return null}}function H$(n,e,t){const r=n[e];return r&&r.func?r.func.name:t}function qC(n,e,t){const r=n[e];return r&&r.type?iI(r.type):t}function KC(n,e,t){const r=n[e];return r&&r.list&&r.list.type?r.list.type.map(s=>iI(s)):t}function bB(n){if(!n.unknownRank)return n.dim!=null?n.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function XC(n,e,t){const r=n[e];return r&&r.shape?bB(r.shape):t}function YC(n,e,t){const r=n[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(s=>typeof s=="number"?s:parseInt(s,10)):t}function ZC(n,e,t,r=!1){const s=n[e];return s&&s.list&&s.list.s?s.list.s.map(a=>yB(a,r)):t}function QC(n,e,t){const r=n[e];return r&&r.list&&r.list.shape?r.list.shape.map(s=>bB(s)):t}function JC(n,e,t){const r=n[e];return r&&r.list&&r.list.b?r.list.b:t}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pne{constructor(e,t,r){this.node=e,this.tensorMap=t,this.context=r,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(s=>this.getInput(s)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((s,a)=>(s[a]=this.getAttr(a),s),{}))}getInput(e){return Tr(e,this.tensorMap,this.context)}getAttr(e,t){const r=this.node.rawAttrs[e];if(r.tensor!=null)return Tr(e,this.tensorMap,this.context);if(r.i!=null||r.f!=null)return jC(this.node.rawAttrs,e,t);if(r.s!=null)return GC(this.node.rawAttrs,e,t);if(r.b!=null)return HC(this.node.rawAttrs,e,t);if(r.shape!=null)return XC(this.node.rawAttrs,e,t);if(r.type!=null)return qC(this.node.rawAttrs,e,t);if(r.list!=null){if(r.list.i!=null||r.list.f!=null)return YC(this.node.rawAttrs,e,t);if(r.list.s!=null)return ZC(this.node.rawAttrs,e,t);if(r.list.shape!=null)return QC(this.node.rawAttrs,e,t);if(r.list.b!=null)return JC(this.node.rawAttrs,e,t);if(r.list.type!=null)return KC(this.node.rawAttrs,e,t)}return t}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fr=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:qN,abs:Un,acos:ek,acosh:tk,add:Re,addN:uM,all:kx,any:Xp,argMax:Yl,argMin:nk,asin:rk,asinh:sk,atan:ak,atan2:ok,atanh:ik,avgPool:wg,avgPool3d:lk,basicLSTMCell:lM,batchNorm:tf,batchNorm2d:ck,batchNorm3d:hk,batchNorm4d:dk,batchToSpaceND:Sg,bincount:fk,bitwiseAnd:cM,booleanMaskAsync:KM,broadcastArgs:hM,broadcastTo:Ul,buffer:yt,cast:Fe,ceil:pk,clipByValue:vs,clone:To,complex:xi,concat:On,concat1d:mk,concat2d:gk,concat3d:vk,concat4d:yk,conv1d:Tx,conv2d:wi,conv2dTranspose:Ix,conv3d:xk,conv3dTranspose:wk,cos:Cg,cosh:Ex,cosineWindow:Qx,cumprod:Qp,cumsum:_x,denseBincount:Sb,depthToSpace:Sk,depthwiseConv2d:nf,diag:fM,dilation2d:Ck,div:Qe,divNoNan:Nk,dot:kk,dropout:Jk,einsum:Rl,elu:rf,enclosingPowerOfTwo:eT,ensureShape:pM,equal:Aa,erf:Rx,euclideanNorm:Ik,exp:ys,expandDims:Wr,expm1:Ek,eye:Ax,fft:Mg,fill:pc,floor:af,floorDiv:Nx,fused:r4,gather:of,gatherND:QM,greater:Ss,greaterEqual:Ei,ifft:qh,imag:Ng,image:Ha,inTopKAsync:JM,irfft:jx,isFinite:_k,isInf:Rk,isNaN:Ak,leakyRelu:kg,less:Wh,lessEqual:Hu,linalg:rT,linspace:vM,localResponseNormalization:Dk,log:Fs,log1p:Tg,logSigmoid:$k,logSoftmax:$x,logSumExp:Ig,logicalAnd:Za,logicalNot:Eg,logicalOr:Ox,logicalXor:Ok,losses:c4,lowerBound:bM,matMul:St,max:ia,maxPool:_g,maxPool3d:Fk,maxPoolWithArgmax:xM,maximum:zo,mean:xn,meshgrid:wM,min:Uh,minimum:$u,mirrorPad:Mk,mod:Lk,moments:Rg,movingAverage:XM,mul:re,multiRNNCell:SM,multinomial:CM,neg:ln,norm:sf,notEqual:Jl,oneHot:Gh,ones:ds,onesLike:Ms,op:ee,outerProduct:NM,pad:_i,pad1d:kM,pad2d:TM,pad3d:IM,pad4d:EM,pool:Pk,pow:Fo,prelu:Dg,print:JN,prod:Bk,raggedGather:_M,raggedRange:RM,raggedTensorToTensor:AM,rand:DM,randomGamma:FM,randomNormal:Lx,randomStandardNormal:MM,randomUniform:ju,randomUniformInt:LM,range:ec,real:Hh,reciprocal:Wk,relu:ro,relu6:Px,reshape:ae,reverse:la,reverse1d:PM,reverse2d:BM,reverse3d:zM,reverse4d:VM,rfft:Lg,round:Bx,rsqrt:zx,scalar:st,scatterND:YM,searchSorted:Fx,selu:Vx,separableConv2d:Ux,setdiff1dAsync:UM,sigmoid:Ka,sign:Gk,signal:l4,sin:Wx,sinh:Gx,slice:Ft,slice1d:$g,slice2d:Hx,slice3d:Og,slice4d:jh,softmax:Fg,softplus:mc,spaceToBatchND:Ag,sparse:h4,sparseToDense:ZM,spectral:u4,split:ps,sqrt:pr,square:Qt,squaredDifference:qx,squeeze:qu,stack:bs,step:gc,stridedSlice:Hk,string:d4,sub:ze,sum:We,tan:jk,tanh:Du,tensor:Ra,tensor1d:Gr,tensor2d:_h,tensor3d:qk,tensor4d:WM,tensor5d:GM,tensor6d:HM,tensorScatterUpdate:jM,tile:ta,topk:Xk,transpose:Dt,truncatedNormal:Xx,unique:Yk,unsortedSegmentSum:Yx,unstack:ca,upperBound:qM,variable:Zk,where:Er,whereAsync:Qk,zeros:Wn,zerosLike:Lt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mne=(n,e,t,r=Fr)=>{switch(n.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(O("a",n,e,t),O("b",n,e,t))];case"AddN":return[r.addN(O("tensors",n,e,t))];case"FloorMod":case"Mod":return[r.mod(O("a",n,e,t),O("b",n,e,t))];case"Mul":return[r.mul(O("a",n,e,t),O("b",n,e,t))];case"RealDiv":case"Div":return[r.div(O("a",n,e,t),O("b",n,e,t))];case"DivNoNan":return[r.divNoNan(O("a",n,e,t),O("b",n,e,t))];case"FloorDiv":return[r.floorDiv(O("a",n,e,t),O("b",n,e,t))];case"Sub":return[r.sub(O("a",n,e,t),O("b",n,e,t))];case"Minimum":return[r.minimum(O("a",n,e,t),O("b",n,e,t))];case"Maximum":return[r.maximum(O("a",n,e,t),O("b",n,e,t))];case"Pow":return[r.pow(O("a",n,e,t),O("b",n,e,t))];case"SquaredDifference":return[r.squaredDifference(O("a",n,e,t),O("b",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gne=(n,e,t,r=Fr)=>{switch(n.op){case"Abs":case"ComplexAbs":return[r.abs(O("x",n,e,t))];case"Acos":return[r.acos(O("x",n,e,t))];case"Acosh":return[r.acosh(O("x",n,e,t))];case"Asin":return[r.asin(O("x",n,e,t))];case"Asinh":return[r.asinh(O("x",n,e,t))];case"Atan":return[r.atan(O("x",n,e,t))];case"Atan2":return[r.atan2(O("x",n,e,t),O("y",n,e,t))];case"Atanh":return[r.atanh(O("x",n,e,t))];case"Ceil":return[r.ceil(O("x",n,e,t))];case"Complex":return[r.complex(O("real",n,e,t),O("imag",n,e,t))];case"Cos":return[r.cos(O("x",n,e,t))];case"Cosh":return[r.cosh(O("x",n,e,t))];case"Elu":return[r.elu(O("x",n,e,t))];case"Erf":return[r.erf(O("x",n,e,t))];case"Exp":return[r.exp(O("x",n,e,t))];case"Expm1":return[r.expm1(O("x",n,e,t))];case"Floor":return[r.floor(O("x",n,e,t))];case"Log":return[r.log(O("x",n,e,t))];case"Log1p":return[r.log1p(O("x",n,e,t))];case"Imag":return[r.imag(O("x",n,e,t))];case"Neg":return[r.neg(O("x",n,e,t))];case"Reciprocal":return[r.reciprocal(O("x",n,e,t))];case"Real":return[r.real(O("x",n,e,t))];case"Relu":return[r.relu(O("x",n,e,t))];case"Round":return[r.round(O("x",n,e,t))];case"Selu":return[r.selu(O("x",n,e,t))];case"Sigmoid":return[r.sigmoid(O("x",n,e,t))];case"Sin":return[r.sin(O("x",n,e,t))];case"Sign":return[r.sign(O("x",n,e,t))];case"Sinh":return[r.sinh(O("x",n,e,t))];case"Softplus":return[r.softplus(O("x",n,e,t))];case"Sqrt":return[r.sqrt(O("x",n,e,t))];case"Square":return[r.square(O("x",n,e,t))];case"Tanh":return[r.tanh(O("x",n,e,t))];case"Tan":return[r.tan(O("x",n,e,t))];case"ClipByValue":return[r.clipByValue(O("x",n,e,t),O("clipValueMin",n,e,t),O("clipValueMax",n,e,t))];case"Relu6":return[r.relu6(O("x",n,e,t))];case"Rsqrt":return[r.rsqrt(Tr(n.inputNames[0],e,t))];case"LeakyRelu":return[r.leakyRelu(O("x",n,e,t),O("alpha",n,e,t))];case"Prelu":return[r.prelu(O("x",n,e,t),O("alpha",n,e,t))];case"IsNan":return[r.isNaN(Tr(n.inputNames[0],e,t))];case"IsInf":return[r.isInf(Tr(n.inputNames[0],e,t))];case"IsFinite":return[r.isFinite(Tr(n.inputNames[0],e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Na(n,e,t=""){if(!(typeof n=="number"||typeof e=="number")){B(n.length===e.length,()=>t+` Shapes ${n} and ${e} must match`);for(let r=0;r<n.length;r++){const s=n[r],a=e[r];B(s<0||a<0||s===a,()=>t+` Shapes ${n} and ${e} must match`)}}}function j$(n){return!(typeof n=="number"||n.some(e=>e<0))}function Cp(n,e,t){let r=eN(n,t);const s=!j$(r);if(s&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(s&&e.forEach(a=>{r=eN(a.shape,r)}),!j$(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function eN(n,e){if(typeof n=="number")return e;if(typeof e=="number")return n;if(n.length!==e.length)throw new Error(`Incompatible ranks during merge: ${n} vs. ${e}`);const t=[];for(let r=0;r<n.length;++r){const s=n[r],a=e[r];if(s>=0&&a>=0&&s!==a)throw new Error(`Incompatible shape during merge: ${n} vs. ${e}`);t[r]=s>=0?s:a}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vne{constructor(e,t,r,s,a,o,i){this.name=e,this.dtype=t,this.maxSize=r,this.elementShape=s,this.identicalElementShapes=a,this.dynamicSize=o,this.clearAfterRead=i,this.tensors=[],this.closed_=!1,this.idTensor=st(0),Qn(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map(t=>this.read(t))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const r=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),Na(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),r.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(r.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);r.tensor=t,Qn(t),r.written=!0,this.tensors[e]=r}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach((r,s)=>this.write(r,t[s]))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let s=0;s<this.size();s++)e.push(s)}if(e.length===0)return Ra([],[0].concat(this.elementShape));const r=this.readMany(e);return Na(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),bs(r,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return Ra([],[0].concat(this.elementShape));const t=[];for(let s=0;s<this.size();s++)t.push(s);const r=this.readMany(t);return Na(this.elementShape,r[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${r[0].shape})`),On(r,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const r=Math.max(...e);if(!this.dynamicSize&&r>=this.maxSize)throw new Error(`Max index must be < array size (${r}  vs. ${this.maxSize})`);this.writeMany(e,ca(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let r=0;const s=e.map(u=>(r+=u,r));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${r}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const a=r===0?0:t.size/r,o=[];he(()=>{t=ae(t,[1,r,a]);for(let u=0;u<e.length;++u){const c=[0,u===0?0:s[u-1],0],d=[1,e[u],a];o[u]=ae(Ft(t,c,d),this.elementShape)}return o});const i=[];for(let u=0;u<e.length;u++)i[u]=u;this.writeMany(i,o)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rc{get id(){return this.idTensor.id}constructor(e,t,r,s=-1){this.tensors=e,this.elementShape=t,this.elementDtype=r,e!=null&&e.forEach(a=>{if(r!==a.dtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${a.dtype}`);Na(t,a.shape,"TensorList shape mismatch: "),Qn(a)}),this.idTensor=st(0),this.maxNumElements=s,Qn(this.idTensor)}copy(){return new rc([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t,r=-1){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(r!==-1&&this.tensors.length!==r)throw new Error(`Operation expected a list with ${r} elements but got a list with ${this.tensors.length} elements.`);Na(e,this.elementShape,"TensorList shape mismatch: ");const s=Cp(this.elementShape,this.tensors,e);return he(()=>{const a=this.tensors.map(o=>ae(o,s));return bs(a,0)})}popBack(e,t){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const r=Cp(this.elementShape,this.tensors,e),s=this.tensors.pop();return s.kept=!1,Na(s.shape,e,"TensorList shape mismatch: "),ae(s,r)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(Na(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Qn(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const t=new rc([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let r=0;r<Math.min(this.tensors.length,e);++r)t.tensors[r]=this.tensors[r];return t}getItem(e,t,r){if(r!==this.elementDtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);Na(this.tensors[e].shape,t,"TensorList shape mismatch: ");const s=Cp(this.elementShape,this.tensors,t);return ae(this.tensors[e],s)}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);Na(this.elementShape,t.shape,"TensorList shape mismatch: "),Qn(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t}gather(e,t,r){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);Na(this.elementShape,r,"TensorList shape mismatch: "),e=e.slice(0,this.size());const s=Cp(this.elementShape,this.tensors,r);return e.length===0?Ra([],[0].concat(s)):he(()=>{const a=e.map(o=>ae(this.tensors[o],s));return bs(a,0)})}concat(e,t){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);Na(this.elementShape,t,"TensorList shape mismatch: ");const r=Cp(this.elementShape,this.tensors,t);return this.size()===0?Ra([],[0].concat(r)):he(()=>{const s=this.tensors.map(a=>ae(a,r));return On(s,0)})}}function yne(n,e,t){const r=n.dtype;if(n.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${n.shape}`);if(n.dtype!==t)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${t}`);const s=n.shape.slice(1);Na(s,e,"TensorList shape mismatch: ");const a=ca(n);return new rc(a,e,r)}function bne(n,e,t,r){return new rc([],n,e,r)}function xne(n,e,t,r){if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const s=Math.max(...e);if(r!=null&&r!==-1&&s>=r)throw new Error(`Max index must be < array size (${s}  vs. ${r})`);const a=new rc([],t,n.dtype,r),o=ca(n,0);return e.forEach((i,u)=>{a.setItem(i,o[u])}),a}function wne(n,e,t){let r=0;const s=e.map(c=>(r+=c,r));if(r!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${r}, and tensor's shape is: ${n.shape}`);const a=n.shape.slice(1),o=eN(a,t),i=r===0?0:n.size/r,u=he(()=>{const c=[];n=ae(n,[1,r,i]);for(let d=0;d<e.length;++d){const m=[0,d===0?0:s[d-1],0],v=[1,e[d],i];c[d]=ae(Ft(n,m,v),o)}return n.dispose(),c}),l=new rc([],t,n.dtype,e.length);for(let c=0;c<u.length;c++)l.setItem(c,u[c]);return l}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sne=async(n,e,t)=>{switch(n.op){case"If":case"StatelessIf":{const r=O("thenBranch",n,e,t),s=O("elseBranch",n,e,t),a=O("cond",n,e,t),o=O("args",n,e,t);return(await a.data())[0]?t.functionMap[r].executeFunctionAsync(o,t.tensorArrayMap,t.tensorListMap):t.functionMap[s].executeFunctionAsync(o,t.tensorArrayMap,t.tensorListMap)}case"While":case"StatelessWhile":{const r=O("body",n,e,t),s=O("cond",n,e,t),a=O("args",n,e,t),o=await t.functionMap[s].executeFunctionAsync(a,t.tensorArrayMap,t.tensorListMap),i=a.map(c=>c.id);let u=await o[0].data();o.forEach(c=>{!c.kept&&i.indexOf(c.id)===-1&&c.dispose()});let l=a;for(;u[0];){const c=l;l=await t.functionMap[r].executeFunctionAsync(l,t.tensorArrayMap,t.tensorListMap);const d=l.map(m=>m.id);c.forEach(m=>{!m.kept&&i.indexOf(m.id)===-1&&d.indexOf(m.id)===-1&&m.dispose()});const p=await t.functionMap[s].executeFunctionAsync(l,t.tensorArrayMap,t.tensorListMap);u=await p[0].data(),p.forEach(m=>{!m.kept&&i.indexOf(m.id)===-1&&d.indexOf(m.id)===-1&&m.dispose()})}return l}case"LoopCond":{const r=O("pred",n,e,t);return[fi(r)]}case"Switch":{const r=O("pred",n,e,t);let s=O("data",n,e,t);return s.kept||(s=fi(s)),(await r.data())[0]?[void 0,s]:[s,void 0]}case"Merge":{const r=n.inputNames.find(s=>Tr(s,e,t)!==void 0);if(r){const s=Tr(r,e,t);return[fi(s)]}return}case"Enter":{const r=O("frameName",n,e,t),s=O("tensor",n,e,t);return t.enterFrame(r),[fi(s)]}case"Exit":{const r=O("tensor",n,e,t);return t.exitFrame(),[fi(r)]}case"NextIteration":{const r=O("tensor",n,e,t);return t.nextIteration(),[fi(r)]}case"TensorArrayV3":{const r=O("size",n,e,t),s=O("dtype",n,e,t),a=O("elementShape",n,e,t),o=O("dynamicSize",n,e,t),i=O("clearAfterRead",n,e,t),u=O("identicalElementShapes",n,e,t),l=O("name",n,e,t),c=new vne(l,s,r,a,u,o,i);return t.addTensorArray(c),[c.idTensor,st(1)]}case"TensorArrayWriteV3":{const r=O("tensorArrayId",n,e,t),s=O("index",n,e,t),a=O("tensor",n,e,t),o=t.getTensorArray(r.id);return o.write(s,a),[o.idTensor]}case"TensorArrayReadV3":{const r=O("tensorArrayId",n,e,t),s=O("index",n,e,t);return[t.getTensorArray(r.id).read(s)]}case"TensorArrayGatherV3":{const r=O("tensorArrayId",n,e,t),s=O("indices",n,e,t),a=O("dtype",n,e,t);return[t.getTensorArray(r.id).gather(s,a)]}case"TensorArrayScatterV3":{const r=O("tensorArrayId",n,e,t),s=O("indices",n,e,t),a=O("tensor",n,e,t),o=t.getTensorArray(r.id);return o.scatter(s,a),[o.idTensor]}case"TensorArrayConcatV3":{const r=O("tensorArrayId",n,e,t),s=t.getTensorArray(r.id),a=O("dtype",n,e,t);return[s.concat(a)]}case"TensorArraySplitV3":{const r=O("tensorArrayId",n,e,t),s=O("tensor",n,e,t),a=O("lengths",n,e,t),o=t.getTensorArray(r.id);return o.split(a,s),[o.idTensor]}case"TensorArraySizeV3":{const r=O("tensorArrayId",n,e,t),s=t.getTensorArray(r.id);return[st(s.size(),"int32")]}case"TensorArrayCloseV3":{const r=O("tensorArrayId",n,e,t),s=t.getTensorArray(r.id);return s.clearAndClose(),[s.idTensor]}case"TensorListSetItem":{const r=O("tensorListId",n,e,t),s=O("index",n,e,t),a=O("tensor",n,e,t),o=t.getTensorList(r.id);return o.setItem(s,a),[o.idTensor]}case"TensorListGetItem":{const r=O("tensorListId",n,e,t),s=O("index",n,e,t),a=O("elementShape",n,e,t),o=O("elementDType",n,e,t);return[t.getTensorList(r.id).getItem(s,a,o)]}case"TensorListScatterV2":case"TensorListScatter":{const r=O("indices",n,e,t),s=O("tensor",n,e,t),a=O("elementShape",n,e,t),o=O("numElements",n,e,t),i=xne(s,r,a,o);return t.addTensorList(i),[i.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=O("elementShape",n,e,t),s=O("elementDType",n,e,t);let a;n.op==="TensorListReserve"?a="numElements":a="maxNumElements";const o=O(a,n,e,t),i=n.op==="TensorListReserve"?-1:o,u=bne(r,s,o,i);return t.addTensorList(u),[u.idTensor]}case"TensorListGather":{const r=O("tensorListId",n,e,t),s=O("indices",n,e,t),a=O("elementShape",n,e,t),o=O("elementDType",n,e,t);return[t.getTensorList(r.id).gather(s,o,a)]}case"TensorListStack":{const r=O("tensorListId",n,e,t),s=O("elementShape",n,e,t),a=O("elementDType",n,e,t),o=O("numElements",n,e,t);return[t.getTensorList(r.id).stack(s,a,o)]}case"TensorListFromTensor":{const r=O("tensor",n,e,t),s=O("elementShape",n,e,t),a=O("elementDType",n,e,t),o=yne(r,s,a);return t.addTensorList(o),[o.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=O("tensorListId",n,e,t),s=t.getTensorList(r.id),a=O("dtype",n,e,t),o=O("elementShape",n,e,t);return[s.concat(a,o)]}case"TensorListPushBack":{const r=O("tensorListId",n,e,t),s=O("tensor",n,e,t),a=t.getTensorList(r.id);return a.pushBack(s),[a.idTensor]}case"TensorListPopBack":{const r=O("tensorListId",n,e,t),s=O("elementShape",n,e,t),a=O("elementDType",n,e,t);return[t.getTensorList(r.id).popBack(s,a)]}case"TensorListSplit":{const r=O("tensor",n,e,t),s=O("elementShape",n,e,t),a=O("lengths",n,e,t),o=wne(r,a,s);return t.addTensorList(o),[o.idTensor]}case"TensorListLength":{const r=O("tensorListId",n,e,t),s=t.getTensorList(r.id);return[st(s.size(),"int32")]}case"TensorListResize":{const r=O("tensorListId",n,e,t),s=O("size",n,e,t),o=t.getTensorList(r.id).resize(s);return t.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q$(n,e,t){const[r,s]=O("fusedOps",n,e,t),a=r==="biasadd",o=!a,i=s==="prelu",u=r==="fusedbatchnorm",l=O("numArgs",n,e,t);if(a){if(i&&l!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&a&&l!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const c=O("strides",n,e,t),d=lb(n,e,t),p=O("dataFormat",n,e,t).toUpperCase(),m=O("dilations",n,e,t);let[v,b]=O("args",n,e,t);o&&(b=v,v=void 0);const y=O("leakyreluAlpha",n,e,t);return{stride:c,pad:d,dataFormat:p,dilations:m,biasArg:v,preluArg:b,activationFunc:s,leakyreluAlpha:y}}const Cne=(n,e,t,r=Fr)=>{switch(n.op){case"Conv1D":{const s=O("stride",n,e,t),a=O("pad",n,e,t),o=O("dataFormat",n,e,t).toUpperCase(),i=O("dilation",n,e,t);return[r.conv1d(O("x",n,e,t),O("filter",n,e,t),s,a,o,i)]}case"Conv2D":{const s=O("strides",n,e,t),a=lb(n,e,t),o=O("dataFormat",n,e,t).toUpperCase(),i=O("dilations",n,e,t);return[r.conv2d(O("x",n,e,t),O("filter",n,e,t),[s[1],s[2]],a,o,[i[1],i[2]])]}case"_FusedConv2D":{const{stride:s,pad:a,dataFormat:o,dilations:i,biasArg:u,preluArg:l,activationFunc:c,leakyreluAlpha:d}=q$(n,e,t);return[r.fused.conv2d({x:O("x",n,e,t),filter:O("filter",n,e,t),strides:[s[1],s[2]],pad:a,dataFormat:o,dilations:[i[1],i[2]],bias:u,activation:c,preluActivationWeights:l,leakyreluAlpha:d})]}case"FusedDepthwiseConv2dNative":{const{stride:s,pad:a,dataFormat:o,dilations:i,biasArg:u,preluArg:l,activationFunc:c,leakyreluAlpha:d}=q$(n,e,t);return[r.fused.depthwiseConv2d({x:O("x",n,e,t),filter:O("filter",n,e,t),strides:[s[1],s[2]],pad:a,dataFormat:o,dilations:[i[1],i[2]],bias:u,activation:c,preluActivationWeights:l,leakyreluAlpha:d})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const s=O("outputShape",n,e,t),a=O("strides",n,e,t),o=lb(n,e,t);return[r.conv2dTranspose(O("x",n,e,t),O("filter",n,e,t),s,[a[1],a[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const s=O("strides",n,e,t),a=lb(n,e,t),o=O("dilations",n,e,t),i=O("dataFormat",n,e,t).toUpperCase();return[r.depthwiseConv2d(O("input",n,e,t),O("filter",n,e,t),[s[1],s[2]],a,i,[o[1],o[2]])]}case"Conv3D":{const s=O("strides",n,e,t),a=O("pad",n,e,t),o=O("dataFormat",n,e,t).toUpperCase(),i=O("dilations",n,e,t);return[r.conv3d(O("x",n,e,t),O("filter",n,e,t),[s[1],s[2],s[3]],a,o,[i[1],i[2],i[3]])]}case"AvgPool":{const s=O("strides",n,e,t),a=O("pad",n,e,t),o=O("kernelSize",n,e,t);return[r.avgPool(O("x",n,e,t),[o[1],o[2]],[s[1],s[2]],a)]}case"MaxPool":{const s=O("strides",n,e,t),a=O("pad",n,e,t),o=O("kernelSize",n,e,t);return[r.maxPool(O("x",n,e,t),[o[1],o[2]],[s[1],s[2]],a)]}case"MaxPoolWithArgmax":{const s=O("strides",n,e,t),a=O("pad",n,e,t),o=O("kernelSize",n,e,t),i=O("includeBatchInIndex",n,e,t),{result:u,indexes:l}=r.maxPoolWithArgmax(O("x",n,e,t),[o[1],o[2]],[s[1],s[2]],a,i);return[u,l]}case"AvgPool3D":{const s=O("strides",n,e,t),a=O("pad",n,e,t),o=O("kernelSize",n,e,t);return[r.avgPool3d(O("x",n,e,t),[o[1],o[2],o[3]],[s[1],s[2],s[3]],a)]}case"MaxPool3D":{const s=O("strides",n,e,t),a=O("pad",n,e,t),o=O("kernelSize",n,e,t);return[r.maxPool3d(O("x",n,e,t),[o[1],o[2],o[3]],[s[1],s[2],s[3]],a)]}case"Dilation2D":{const s=O("strides",n,e,t),a=O("pad",n,e,t),o=O("dilations",n,e,t),i=s[1],u=s[2],l=o[1],c=o[2];return[r.dilation2d(O("x",n,e,t),O("filter",n,e,t),[i,u],a,[l,c],"NHWC")]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nne=(n,e,t,r=Fr)=>{switch(n.op){case"Fill":{const s=O("shape",n,e,t),a=O("dtype",n,e,t),o=O("value",n,e,t);return[r.fill(s,o,a)]}case"LinSpace":{const s=O("start",n,e,t),a=O("stop",n,e,t),o=O("num",n,e,t);return[r.linspace(s,a,o)]}case"Multinomial":{const s=O("logits",n,e,t),a=O("numSamples",n,e,t),o=O("seed",n,e,t);return[r.multinomial(s,a,o)]}case"OneHot":{const s=O("indices",n,e,t),a=O("depth",n,e,t),o=O("onValue",n,e,t),i=O("offValue",n,e,t),u=O("dtype",n,e,t);return[r.oneHot(s,a,o,i,u)]}case"Ones":return[r.ones(O("shape",n,e,t),O("dtype",n,e,t))];case"OnesLike":return[r.onesLike(O("x",n,e,t))];case"RandomStandardNormal":return[r.randomStandardNormal(O("shape",n,e,t),O("dtype",n,e,t),O("seed",n,e,t))];case"RandomUniform":return[r.randomUniform(O("shape",n,e,t),O("minval",n,e,t),O("maxval",n,e,t),O("dtype",n,e,t))];case"RandomUniformInt":return[r.randomUniformInt(O("shape",n,e,t),O("minval",n,e,t),O("maxval",n,e,t),O("seed",n,e,t))];case"Range":{const s=O("start",n,e,t),a=O("stop",n,e,t),o=O("step",n,e,t);return[r.range(s,a,o,O("dtype",n,e,t))]}case"TruncatedNormal":{const s=O("shape",n,e,t),a=O("mean",n,e,t),o=O("stdDev",n,e,t),i=O("seed",n,e,t);return[r.truncatedNormal(s,a,o,O("dtype",n,e,t),i)]}case"Zeros":return[r.zeros(O("shape",n,e,t),O("dtype",n,e,t))];case"ZerosLike":return[r.zerosLike(O("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TS(n,e,t){const r=O("boxes",n,e,t),s=O("scores",n,e,t),a=O("maxOutputSize",n,e,t),o=O("iouThreshold",n,e,t),i=O("scoreThreshold",n,e,t),u=O("softNmsSigma",n,e,t);return{boxes:r,scores:s,maxOutputSize:a,iouThreshold:o,scoreThreshold:i,softNmsSigma:u}}const kne=async(n,e,t,r,s=Fr)=>{switch(n.op){case"NonMaxSuppressionV5":{const{boxes:a,scores:o,maxOutputSize:i,iouThreshold:u,scoreThreshold:l,softNmsSigma:c}=TS(n,e,t),d=await s.image.nonMaxSuppressionWithScoreAsync(a,o,i,u,l,c);return[d.selectedIndices,d.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:a,scores:o,maxOutputSize:i,iouThreshold:u,scoreThreshold:l}=TS(n,e,t),c=O("padToMaxOutputSize",n,e,t),d=await s.image.nonMaxSuppressionPaddedAsync(a,o,i,u,l,c);return[d.selectedIndices,d.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:a,scores:o,maxOutputSize:i,iouThreshold:u,scoreThreshold:l}=TS(n,e,t);return[await s.image.nonMaxSuppressionAsync(a,o,i,u,l)]}case"Where":{const a=s.cast(O("condition",n,e,t),"bool"),o=[await s.whereAsync(a)];return a.dispose(),o}case"ListDiff":return s.setdiff1dAsync(O("x",n,e,t),O("y",n,e,t));default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tne=(n,e,t,r=Fr)=>{switch(n.op){case"LowerBound":{const s=O("sortedSequence",n,e,t),a=O("values",n,e,t);return[r.lowerBound(s,a)]}case"TopKV2":{const s=O("x",n,e,t),a=O("k",n,e,t),o=O("sorted",n,e,t),i=r.topk(s,a,o);return[i.values,i.indices]}case"UpperBound":{const s=O("sortedSequence",n,e,t),a=O("values",n,e,t);return[r.upperBound(s,a)]}case"Unique":{const s=O("x",n,e,t),a=r.unique(s);return[a.values,a.indices]}case"UniqueV2":{const s=O("x",n,e,t),a=O("axis",n,e,t),o=r.unique(s,a);return[o.values,o.indices]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ine=(n,e,t,r=Fr)=>{switch(n.op){case"Const":return e[n.name];case"PlaceholderWithDefault":const s=O("default",n,e,t);return[Tr(n.name,e,t)||s];case"Placeholder":return[Tr(n.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const c=O("x",n,e,t);return[fi(c)]}case"IdentityN":return O("x",n,e,t).map(c=>fi(c));case"Snapshot":const a=O("x",n,e,t);return[fi(a)];case"Shape":return[r.tensor1d(O("x",n,e,t).shape,"int32")];case"ShapeN":return O("x",n,e,t).map(c=>r.tensor1d(c.shape));case"Size":return[r.scalar(O("x",n,e,t).size,"int32")];case"Rank":return[r.scalar(O("x",n,e,t).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":const o=O("x",n,e,t),i=O("data",n,e,t),u=O("message",n,e,t),l=O("summarize",n,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(u);for(let c=0;c<i.length;c++)console.log(Array.prototype.slice.call(i[c].dataSync()).slice(0,l));return[o];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ene{get id(){return this.handle.id}constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=st(0),this.tensorMap=new Map,Qn(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return st(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);const r=await e.data();return this.tensorMap.forEach(s=>s.dispose()),this.tensorMap.clear(),he(()=>{const s=ca(t),a=r.length,o=s.length;B(a===o,()=>`The number of elements doesn't match, keys has ${a} elements, the values has ${o} elements.`);for(let i=0;i<a;i++){const u=r[i],l=s[i];Qn(l),this.tensorMap.set(u,l)}return this.handle})}async find(e,t){this.checkKeyAndValueTensor(e,t);const r=await e.data();return he(()=>{const s=[];for(let a=0;a<r.length;a++){const o=r[a],i=this.findWithDefault(o,t);s.push(i)}return bs(s)})}findWithDefault(e,t){const r=this.tensorMap.get(e);return r??t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${t.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ne=async(n,e,t,r)=>{switch(n.op){case"HashTable":case"HashTableV2":{const s=r.getHashTableHandleByName(n.name);if(s!=null)return[s];{const a=O("keyDType",n,e,t),o=O("valueDType",n,e,t),i=new Ene(a,o);return r.addHashTable(n.name,i),[i.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const s=O("tableHandle",n,e,t,r),a=O("keys",n,e,t),o=O("values",n,e,t);return[await r.getHashTableById(s.id).import(a,o)]}case"LookupTableFind":case"LookupTableFindV2":{const s=O("tableHandle",n,e,t,r),a=O("keys",n,e,t),o=O("defaultValue",n,e,t);return[await r.getHashTableById(s.id).find(a,o)]}case"LookupTableSize":case"LookupTableSizeV2":{const s=O("tableHandle",n,e,t,r);return[r.getHashTableById(s.id).tensorSize()]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rne=(n,e,t,r=Fr)=>{switch(n.op){case"ResizeBilinear":{const s=O("images",n,e,t),a=O("size",n,e,t),o=O("alignCorners",n,e,t),i=O("halfPixelCenters",n,e,t);return[r.image.resizeBilinear(s,[a[0],a[1]],o,i)]}case"ResizeNearestNeighbor":{const s=O("images",n,e,t),a=O("size",n,e,t),o=O("alignCorners",n,e,t),i=O("halfPixelCenters",n,e,t);return[r.image.resizeNearestNeighbor(s,[a[0],a[1]],o,i)]}case"CropAndResize":{const s=O("image",n,e,t),a=O("boxes",n,e,t),o=O("boxInd",n,e,t),i=O("cropSize",n,e,t),u=O("method",n,e,t),l=O("extrapolationValue",n,e,t);return[r.image.cropAndResize(s,a,o,i,u,l)]}case"ImageProjectiveTransformV3":{const s=O("images",n,e,t),a=O("transforms",n,e,t),o=O("outputShape",n,e,t),i=O("fillValue",n,e,t),u=O("interpolation",n,e,t),l=O("fillMode",n,e,t);return[r.image.transform(s,a,u.toLowerCase(),l.toLowerCase(),i,o)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ane=(n,e,t,r=Fr)=>{switch(n.op){case"Equal":return[r.equal(O("a",n,e,t),O("b",n,e,t))];case"NotEqual":return[r.notEqual(O("a",n,e,t),O("b",n,e,t))];case"Greater":return[r.greater(O("a",n,e,t),O("b",n,e,t))];case"GreaterEqual":return[r.greaterEqual(O("a",n,e,t),O("b",n,e,t))];case"Less":return[r.less(O("a",n,e,t),O("b",n,e,t))];case"LessEqual":return[r.lessEqual(O("a",n,e,t),O("b",n,e,t))];case"LogicalAnd":return[r.logicalAnd(O("a",n,e,t),O("b",n,e,t))];case"LogicalNot":return[r.logicalNot(O("a",n,e,t))];case"LogicalOr":return[r.logicalOr(O("a",n,e,t),O("b",n,e,t))];case"Select":case"SelectV2":return[r.where(O("condition",n,e,t),O("a",n,e,t),O("b",n,e,t))];case"BitwiseAnd":return[r.bitwiseAnd(O("a",n,e,t),O("b",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dne=(n,e,t,r=Fr)=>{switch(n.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(O("a",n,e,t),O("b",n,e,t),O("transposeA",n,e,t),O("transposeB",n,e,t))];case"Einsum":return[r.einsum(O("equation",n,e,t),...O("tensors",n,e,t))];case"Transpose":return[r.transpose(O("x",n,e,t),O("perm",n,e,t))];case"_FusedMatMul":const[s,a]=O("fusedOps",n,e,t),o=s==="biasadd",i=a==="prelu",u=O("numArgs",n,e,t),l=O("leakyreluAlpha",n,e,t);if(o){if(i&&u!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&u!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,d]=O("args",n,e,t);return[r.fused.matMul({a:O("a",n,e,t),b:O("b",n,e,t),transposeA:O("transposeA",n,e,t),transposeB:O("transposeB",n,e,t),bias:c,activation:a,preluActivationWeights:d,leakyreluAlpha:l})];case"MatrixBandPart":return[r.linalg.bandPart(O("a",n,e,t),O("numLower",n,e,t),O("numUpper",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ne=(n,e,t,r=Fr)=>{switch(n.op){case"EuclideanNorm":return[r.euclideanNorm(O("x",n,e,t),O("axis",n,e,t),O("keepDims",n,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[r.batchNorm(O("x",n,e,t),O("mean",n,e,t),O("variance",n,e,t),O("offset",n,e,t),O("scale",n,e,t),O("epsilon",n,e,t))];case"FusedBatchNormV3":return[r.batchNorm(O("x",n,e,t),O("mean",n,e,t),O("variance",n,e,t),O("offset",n,e,t),O("scale",n,e,t),O("epsilon",n,e,t))];case"LRN":return[r.localResponseNormalization(O("x",n,e,t),O("radius",n,e,t),O("bias",n,e,t),O("alpha",n,e,t),O("beta",n,e,t))];case"Softmax":return[r.softmax(O("x",n,e,t))];case"LogSoftmax":return[r.logSoftmax(O("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const One=(n,e,t,r=Fr)=>{switch(n.op){case"RaggedGather":{const{outputNestedSplits:s,outputDenseValues:a}=r.raggedGather(O("paramsNestedSplits",n,e,t),O("paramsDenseValues",n,e,t),O("indices",n,e,t),O("outputRaggedRank",n,e,t));return s.concat(a)}case"RaggedRange":{const{rtNestedSplits:s,rtDenseValues:a}=r.raggedRange(O("starts",n,e,t),O("limits",n,e,t),O("splits",n,e,t));return[s,a]}case"RaggedTensorToTensor":return[r.raggedTensorToTensor(O("shape",n,e,t),O("values",n,e,t),O("defaultValue",n,e,t),O("rowPartitionTensors",n,e,t),O("rowPartitionTypes",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fne=(n,e,t,r=Fr)=>{switch(n.op){case"Max":{const i=O("axis",n,e,t),u=O("keepDims",n,e,t);return[r.max(O("x",n,e,t),i,u)]}case"Mean":{const i=O("axis",n,e,t),u=O("keepDims",n,e,t);return[r.mean(O("x",n,e,t),i,u)]}case"Min":{const i=O("axis",n,e,t),u=O("keepDims",n,e,t);return[r.min(O("x",n,e,t),i,u)]}case"Sum":{const i=O("axis",n,e,t),u=O("keepDims",n,e,t);return[r.sum(O("x",n,e,t),i,u)]}case"All":{const i=O("axis",n,e,t),u=O("keepDims",n,e,t);return[r.all(O("x",n,e,t),i,u)]}case"Any":{const i=O("axis",n,e,t),u=O("keepDims",n,e,t);return[r.any(O("x",n,e,t),i,u)]}case"ArgMax":{const i=O("axis",n,e,t);return[r.argMax(O("x",n,e,t),i)]}case"ArgMin":{const i=O("axis",n,e,t);return[r.argMin(O("x",n,e,t),i)]}case"Prod":{const i=O("axis",n,e,t),u=O("keepDims",n,e,t);return[r.prod(O("x",n,e,t),i,u)]}case"Cumprod":{const i=O("axis",n,e,t),u=O("exclusive",n,e,t),l=O("reverse",n,e,t);return[r.cumprod(O("x",n,e,t),i,u,l)]}case"Cumsum":{const i=O("axis",n,e,t),u=O("exclusive",n,e,t),l=O("reverse",n,e,t);return[r.cumsum(O("x",n,e,t),i,u,l)]}case"Bincount":const s=O("x",n,e,t),a=O("weights",n,e,t),o=O("size",n,e,t);return[r.bincount(s,a,o)];case"DenseBincount":{const i=O("x",n,e,t),u=O("weights",n,e,t),l=O("size",n,e,t),c=O("binaryOutput",n,e,t);return[r.denseBincount(i,u,l,c)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mne=(n,e,t,r=Fr)=>{switch(n.op){case"ConcatV2":case"Concat":{const s=O("n",n,e,t),a=O("axis",n,e,t);let o=O("tensors",n,e,t);return o=o.slice(0,s),[r.concat(o,a)]}case"Gather":{const s=O("x",n,e,t),a=O("indices",n,e,t);return[r.gather(s,r.cast(a,"int32"),0)]}case"GatherV2":{const s=O("axis",n,e,t),a=O("batchDims",n,e,t),o=O("x",n,e,t),i=O("indices",n,e,t);return[r.gather(o,r.cast(i,"int32"),s,a)]}case"Reverse":{const s=O("dims",n,e,t),a=[];for(let i=0;i<s.length;i++)s[i]&&a.push(i);const o=O("x",n,e,t);return[r.reverse(o,a)]}case"ReverseV2":{const s=O("axis",n,e,t),a=O("x",n,e,t);return[r.reverse(a,s)]}case"Slice":{const s=O("begin",n,e,t),a=O("size",n,e,t);return[r.slice(O("x",n,e,t),s,a)]}case"StridedSlice":{const s=O("begin",n,e,t),a=O("end",n,e,t),o=O("strides",n,e,t),i=O("beginMask",n,e,t),u=O("endMask",n,e,t),l=O("ellipsisMask",n,e,t),c=O("newAxisMask",n,e,t),d=O("shrinkAxisMask",n,e,t),p=O("x",n,e,t);return[r.stridedSlice(p,s,a,o,i,u,l,c,d)]}case"Pack":return he(()=>{const s=O("axis",n,e,t),a=O("tensors",n,e,t),o=a[0].shape,i=r.squeeze(a[0]).shape,u=a.map(l=>{const c=Et(l.shape,o);if(!c&&!Et(r.squeeze(l).shape,i))throw new Error("the input tensors shape does not match");return c?l:r.reshape(l,o)});return[r.stack(u,s)]});case"Unpack":{const s=O("axis",n,e,t),a=O("tensor",n,e,t);return r.unstack(a,s)}case"Tile":{const s=O("reps",n,e,t);return[r.tile(O("x",n,e,t),s)]}case"Split":case"SplitV":{const s=O("axis",n,e,t),a=O("numOrSizeSplits",n,e,t),o=O("x",n,e,t);return r.split(o,a,s)}case"ScatterNd":{const s=O("indices",n,e,t),a=O("values",n,e,t),o=O("shape",n,e,t);return[r.scatterND(s,a,o)]}case"GatherNd":{const s=O("x",n,e,t),a=O("indices",n,e,t);return[r.gatherND(s,a)]}case"SparseToDense":{const s=O("sparseIndices",n,e,t),a=O("outputShape",n,e,t),o=O("sparseValues",n,e,t),i=O("defaultValue",n,e,t);return[r.sparseToDense(s,o,a,o.dtype===i.dtype?i:r.cast(i,o.dtype))]}case"TensorScatterUpdate":{const s=O("indices",n,e,t),a=O("values",n,e,t),o=O("tensor",n,e,t);return[r.tensorScatterUpdate(o,s,a)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lne=(n,e,t,r=Fr)=>{switch(n.op){case"SparseFillEmptyRows":{const{outputIndices:s,outputValues:a,emptyRowIndicator:o,reverseIndexMap:i}=r.sparse.sparseFillEmptyRows(O("indices",n,e,t),O("values",n,e,t),O("denseShape",n,e,t),O("defaultValue",n,e,t));return[s,a,o,i]}case"SparseReshape":{const{outputIndices:s,outputShape:a}=r.sparse.sparseReshape(O("inputIndices",n,e,t),O("inputShape",n,e,t),O("newShape",n,e,t));return[s,a]}case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(O("data",n,e,t),O("indices",n,e,t),O("segmentIds",n,e,t))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(O("data",n,e,t),O("indices",n,e,t),O("segmentIds",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pne=(n,e,t,r=Fr)=>{switch(n.op){case"FFT":return[r.fft(O("x",n,e,t))];case"IFFT":return[r.ifft(O("x",n,e,t))];case"RFFT":return[r.rfft(O("x",n,e,t))];case"IRFFT":return[r.irfft(O("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bne=(n,e,t,r=Fr)=>{switch(n.op){case"StaticRegexReplace":return[r.string.staticRegexReplace(O("input",n,e,t),O("pattern",n,e,t),O("rewrite",n,e,t),O("replaceGlobal",n,e,t))];case"StringNGrams":{const{nGrams:s,nGramsSplits:a}=r.string.stringNGrams(O("data",n,e,t),O("dataSplits",n,e,t),O("separator",n,e,t),O("nGramWidths",n,e,t),O("leftPad",n,e,t),O("rightPad",n,e,t),O("padWidth",n,e,t),O("preserveShortSequences",n,e,t));return[s,a]}case"StringSplit":{const{indices:s,values:a,shape:o}=r.string.stringSplit(O("input",n,e,t),O("delimiter",n,e,t),O("skipEmpty",n,e,t));return[s,a,o]}case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(O("input",n,e,t),O("numBuckets",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zne=(n,e,t,r=Fr)=>{switch(n.op){case"Cast":return[r.cast(O("x",n,e,t),O("dtype",n,e,t))];case"ExpandDims":{const s=O("axis",n,e,t);return[r.expandDims(O("x",n,e,t),s)]}case"Squeeze":{const s=O("axis",n,e,t);return[r.squeeze(O("x",n,e,t),s)]}case"Reshape":return[r.reshape(O("x",n,e,t),O("shape",n,e,t))];case"EnsureShape":return[r.ensureShape(O("x",n,e,t),O("shape",n,e,t))];case"MirrorPad":return[r.mirrorPad(O("x",n,e,t),O("padding",n,e,t),O("mode",n,e,t))];case"PadV2":case"Pad":return[r.pad(O("x",n,e,t),O("padding",n,e,t),O("constantValue",n,e,t))];case"SpaceToBatchND":{const s=O("blockShape",n,e,t),a=O("paddings",n,e,t);return[r.spaceToBatchND(O("x",n,e,t),s,a)]}case"BatchToSpaceND":{const s=O("blockShape",n,e,t),a=O("crops",n,e,t);return[r.batchToSpaceND(O("x",n,e,t),s,a)]}case"DepthToSpace":{const s=O("blockSize",n,e,t),a=O("dataFormat",n,e,t).toUpperCase();return[r.depthToSpace(O("x",n,e,t),s,a)]}case"BroadcastTo":return[r.broadcastTo(O("x",n,e,t),O("shape",n,e,t))];case"BroadcastArgs":return[r.broadcastArgs(O("s0",n,e,t),O("s1",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K$(n,e,t,r,s=he){const a=((o,i,u)=>{switch(o.category){case"arithmetic":return s(()=>mne(o,i,u));case"basic_math":return s(()=>gne(o,i,u));case"control":return Sne(o,i,u);case"convolution":return s(()=>Cne(o,i,u));case"creation":return s(()=>Nne(o,i,u));case"dynamic":return kne(o,i,u);case"evaluation":return s(()=>Tne(o,i,u));case"image":return s(()=>Rne(o,i,u));case"graph":return s(()=>Ine(o,i,u));case"logical":return s(()=>Ane(o,i,u));case"matrices":return s(()=>Dne(o,i,u));case"normalization":return s(()=>$ne(o,i,u));case"ragged":return s(()=>One(o,i,u));case"reduction":return s(()=>Fne(o,i,u));case"slice_join":return s(()=>Mne(o,i,u));case"sparse":return s(()=>Lne(o,i,u));case"spectral":return s(()=>Pne(o,i,u));case"string":return s(()=>Bne(o,i,u));case"transformation":return s(()=>zne(o,i,u));case"hash_table":return _ne(o,i,u,r);case"custom":const l=vB(o.op);if(l&&l.customExecutor)return l.customExecutor(new pne(o,i,u));throw TypeError(`Custom op ${o.op} is not registered.`);default:throw TypeError(`Unknown op '${o.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(n,e,t);return _u(a)?a.then(o=>[].concat(o)):[].concat(a)}class X${constructor(e={},t={},r={},s={},a){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=r,this.functionMap=s,this.parseNodeNameCache=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let t=0;t<this.contexts.length-1;t++){const r=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(r))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(t=>t.id===0&&t.iterationId===0?"":`${t.frameName}-${t.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y$(n,e,t,r){const s=new Set,a=[];let o=null,i=null;const u=new Set,l=new Set(Object.keys(n).map(p=>Rs(p)[0]));r=r||[];const c=new Set(r.map(p=>Rs(p.name)[0])),d=[...e];for(;d.length>0;){const p=d.pop();if((Dl(p)||Kne(p)||Xne(p))&&o==null&&(o=p,i=o.children.map(m=>m.name).filter(m=>s.has(m))),s.add(p.name),t[p.name]==null&&!l.has(p.name)&&!c.has(p.name)){if(p.inputs.length===0){a.push(p.name);continue}p.inputs.forEach(m=>{u.has(m.name)||(u.add(m.name),d.push(m))})}}return{inputs:n,outputs:e,usedNodes:s,missingInputs:a,dynamicNode:o,syncInputs:i}}function Vne(n,e){const{usedNodes:t,inputs:r}=e,s=Object.keys(r).map(y=>Rs(y)[0]).map(y=>n.nodes[y]),a=n.initNodes||[],o=y=>t.has(typeof y=="string"?y:y.name);function i(y){return[...new Map(y.map(w=>[w.name,w])).values()]}const u=i([...s,...n.weights,...a]).filter(o),l=i([...u,...Object.values(n.nodes)]).filter(o),c=new Map(l.map(y=>[y.name,y])),d={};for(const y of l){d[y.name]=d[y.name]||0;for(const w of y.children)o(w)||(d[w.name]=Number.POSITIVE_INFINITY),d[w.name]=(d[w.name]||0)+1}const p=Object.entries(d).filter(([,y])=>y===0).map(([y])=>y),m=[...p];for(;p.length>0;){const y=p.pop(),w=c.get(y);for(const S of w.children.filter(o))--d[S.name]===0&&(m.push(S.name),p.push(S.name))}const v=m.map(y=>c.get(y)),b=Une(v,u);return Wne(b,u),b}function Une(n,e){const t=new Map(n.map(o=>[o.name,o])),r=e.map(o=>o.name),s=new Set(r);for(;r.length>0;){const o=r.pop(),i=t.get(o);for(const u of i.children)!t.has(u.name)||s.has(u.name)||(s.add(u.name),r.push(u.name))}return n.filter(o=>s.has(o.name))}class Ay extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}}function Wne(n,e){const t=new Map(n.map((i,u)=>[i.name,u])),r=new Set(e.map(i=>i.name)),s=i=>r.has(typeof i=="string"?i:i.name),a=new Set(n.map(i=>i.name)),o=i=>a.has(typeof i=="string"?i:i.name);for(const i of n){for(const u of i.children.filter(o)){if(!t.has(u.name))throw new Ay(`Child ${u.name} of node ${i.name} is unreachable.`);if(t.get(i.name)>t.get(u.name))throw new Ay(`Node ${i.name} is scheduled to run after its child ${u.name}.`)}if(!s(i))for(const u of i.inputs){if(!t.has(u.name))throw new Ay(`Input ${u.name} of node ${i.name} is unreachable.`);if(t.get(u.name)>t.get(i.name))throw new Ay(`Node ${i.name} is scheduled to run before its input ${u.name}.`)}}}function Gne(n){const e=new Map(n.map((i,u)=>[i.name,u])),t=Number.MAX_SAFE_INTEGER,r=n.map((i,u)=>Dl(i)?t:u),s=i=>{const u=r[e.get(i.name)];return u??-1},a=n.map((i,u)=>i.children.map(s).reduce((l,c)=>Math.max(l,c),r[u])),o=new Map;for(let i=0;i<n.length;++i){const u=a[i];if(u===t)continue;const l=n[i],c=n[u];o.has(c.name)||o.set(c.name,[]),o.get(c.name).push(l)}return o}const Hne=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),jne=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),qne=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function Dl(n){return Hne.has(n.op)}function Kne(n){return jne.has(n.op)}function Xne(n){return qne.has(n.op)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ob{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const t=Object.keys(e).map(r=>e[r].map(s=>s.id));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const t=e.signatureKey||e.name;return e.defaultOutput?`${t}:${e.defaultOutput}`:t})}get functions(){return Object.keys(this._functions).reduce((e,t)=>(e[t]=this._functions[t].signature,e),{})}constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(r=>{this._functionExecutorMap[r]=new Ob(e.functions[r],this)})}getCompilationKey(e,t){const r=e.map(a=>a.name).sort(),s=t.map(a=>a.name).sort();return r.join(this.SEPARATOR)+"--"+s.join(this.SEPARATOR)}compile(e,t){const r=Y$(e,t,this.weightMap,this._initNodes),{missingInputs:s,dynamicNode:a,syncInputs:o}=r;if(a!=null)throw new Error(`This execution contains the node '${a.name}', which has the dynamic op '${a.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(s.length>0){const l=t.map(d=>d.name),c=Object.keys(e);throw new Error(`Cannot compute the outputs [${l}] from the provided inputs [${c}]. Missing the following inputs: [${s}]`)}const i=Vne(this.graph,r),u=Gne(i);return{orderedNodes:i,nodeLiveUntilMap:u}}cloneAndKeepTensor(e){if(e==null)return null;const t=e.clone();return Qn(t),t}cloneTensorList(e){return e?e.map(r=>this.cloneAndKeepTensor(r)):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(([t,r])=>[t,this.cloneTensorList(r)]))}execute(e,t){this.disposeIntermediateTensors(),e=this.mapInputs(e);const r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);const s=r.map(p=>this.graph.nodes[Rs(p)[0]]),a=t.map(p=>Rs(p)[0]),o=new Set(a);let i=a.map(p=>this.graph.nodes[p]);i.length===0&&(i=this._outputs);const u=this.getCompilationKey(s,i);let l=this.compiledMap.get(u);l==null&&(l=this.compile(e,i),this.compiledMap.set(u,l));try{this.keepIntermediateTensors=de().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}const c={},d={};return he(()=>{const p=new X$(this.weightMap,c,d,this.functionExecutorMap,this.parseNodeNameCache),m=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(w=>{const[S,N]=Rs(w,p),C=[];C[N]=e[w],m[S]=C,this.keepIntermediateTensors&&(this.clonedTensorsMap[S]=this.cloneTensorList(C))});const v=this.getFrozenTensorIds(m),{orderedNodes:b,nodeLiveUntilMap:y}=l;for(const w of b){if(m[w.name])continue;const S=K$(w,m,p,this._resourceManager);if(_u(S))throw new Error(`The execution of the op '${w.op}' returned a promise. Please use model.executeAsync() instead.`);m[w.name]=S,this.keepIntermediateTensors&&(this.clonedTensorsMap[w.name]=this.cloneTensorList(S)),this.checkTensorForDisposalWithNodeLiveUntilInfo(w,m,p,v,o,y.get(w.name))}return this.parent==null&&p.dispose(v),t.map(w=>Tr(w,m,p))})}getFrozenTensorIds(e){const t=[].concat.apply([],Object.keys(e).map(r=>e[r]).map(r=>r.map(s=>s.id)));return new Set(t)}checkTensorForDisposal(e,t,r,s,a,o,i){if(!(Dl(t)||o.has(e))){for(const u of r[e])u!=null&&(i[u.id]=(i[u.id]||0)+t.children.length);for(const u of t.inputs){if(Dl(u))continue;const l=W$(u.name,r,s);if(l!=null)for(const c of l){if(!c||c.kept||a.has(c.id))continue;const d=i[c.id];d===1?(c.dispose(),delete i[c.id]):d!=null&&i[c.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,t,r,s,a,o){function i(u){return Dl(u)||a.has(u.name)}if(!(Dl(e)||o==null))for(const u of o){if(i(u))continue;const l=W$(u.name,t,r);for(const c of l)!c||c.kept||s.has(c.id)||c.dispose()}}async executeAsync(e,t){return this._executeAsync(e,t)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(const t of e)t&&!t.isDisposed&&t.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,t,r=!1,s={},a={}){this.disposeIntermediateTensors(),r||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=de().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}const o=new X$(this.weightMap,s,a,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const i=await this.executeWithControlFlow(e,o,t,r),u=t.map(p=>Tr(p,i,o)),l=u.map(p=>p.id),c=Object.keys(e).map(p=>e[p].id),d=new Set([...l,...c,...this.weightIds]);return Object.values(i).forEach(p=>{p.forEach(m=>{m&&!m.isDisposed&&!d.has(m.id)&&m.dispose()})}),this.parent==null&&o.dispose(d),u}async executeFunctionAsync(e,t,r){const s=e.reduce((a,o,i)=>(a[this.inputs[i].name]=o,a),{});return this._executeAsync(s,this.outputNodes,!0,t,r)}async executeWithControlFlow(e,t,r,s){const a=Object.keys(e),o=a.map(C=>this.graph.nodes[Rs(C)[0]]),i=r.map(C=>Rs(C)[0]),u=new Set(i);let l=i.map(C=>this.graph.nodes[C]);l.length===0&&(l=this._outputs);const{usedNodes:c,missingInputs:d,dynamicNode:p,syncInputs:m}=Y$(e,l,this.weightMap,this._initNodes),v=[...o,...this.graph.weights,...this._initNodes||[]].map(C=>({node:C,contexts:t.currentContext})),b=Object.assign({},this.weightMap);Object.keys(e).forEach(C=>{const[T,E]=Rs(C),$=[];$[E]=e[C],b[T]=$});const y={},w=this.getFrozenTensorIds(b),S={};for(;v.length>0;){const C=this.processStack(o,v,t,b,S,w,u,y,c);await Promise.all(C)}p==null&&!s&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const N=l.filter(C=>!Dl(C)&&!Tr(C.name,b,t)).map(C=>C.name);if(N.length>0){let C="";throw p!=null&&(C=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${m}]`),new Error(`Cannot compute the outputs [${N}] from the provided inputs [${a}]. Consider providing the following inputs: [${d}]. ${C}`)}return b}processStack(e,t,r,s,a,o,i,u,l){const c=[];for(;t.length>0;){const d=t.pop();r.currentContext=d.contexts;let p="";if(d.node.op==="Enter"&&O("isConstant",d.node,s,r)&&([p]=di(d.node.name,r)),s[d.node.name]==null){const m=K$(d.node,s,r,this._resourceManager);p||([p]=di(d.node.name,r));const v=r.currentContext;_u(m)?c.push(m.then(b=>(s[p]=b,this.keepIntermediateTensors&&(this.clonedTensorsMap[p]=this.cloneTensorList(b)),r.currentContext=v,this.checkTensorForDisposal(p,d.node,s,r,o,i,u),this.processChildNodes(d.node,t,r,s,a,l),b))):(s[p]=m,this.keepIntermediateTensors&&(this.clonedTensorsMap[p]=this.cloneTensorList(m)),this.checkTensorForDisposal(p,d.node,s,r,o,i,u),this.processChildNodes(d.node,t,r,s,a,l))}else this.processChildNodes(d.node,t,r,s,a,l)}return c}processChildNodes(e,t,r,s,a,o){e.children.forEach(i=>{const[u]=di(i.name,r);a[u]||!o.has(i.name)||(i.op==="Merge"?i.inputNames.some(l=>!!Tr(l,s,r))&&(a[u]=!0,t.push({contexts:r.currentContext,node:i})):i.inputNames.every(l=>!!Tr(l,s,r))&&(a[u]=!0,t.push({contexts:r.currentContext,node:i})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(t=>t.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(t=>{const r=e[t],[s]=Rs(t),a=this.graph.nodes[s];if(a.attrParams.shape&&a.attrParams.shape.value){const o=a.attrParams.shape.value,i=o.length===r.shape.length&&r.shape.every((u,l)=>o[l]===-1||o[l]===u);B(i,()=>`The shape of dict['${a.name}'] provided in model.execute(dict) must be [${o}], but was [${r.shape}]`)}a.attrParams.dtype&&a.attrParams.dtype.value&&B(r.dtype===a.attrParams.dtype.value,()=>`The dtype of dict['${a.name}'] provided in model.execute(dict) must be ${a.attrParams.dtype.value}, but was ${r.dtype}`)})}mapInputs(e){var t,r;const s={};for(const a in e){const o=(r=(t=this._signature)===null||t===void 0?void 0:t.inputs)===null||r===void 0?void 0:r[a];o!=null?s[o.name]=e[a]:s[a]=e[a]}return s}checkInputs(e){const t=Object.keys(e).filter(r=>{const[s]=Rs(r);return this.graph.nodes[s]==null});if(t.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${t}] that are not part of graph`)}mapOutputs(e){return e.map(t=>{var r,s;const a=(s=(r=this._signature)===null||r===void 0?void 0:r.outputs)===null||s===void 0?void 0:s[t];return a!=null?a.name:t},{})}checkOutputs(e){e.forEach(t=>{const[r]=Rs(t);if(!this.graph.nodes[r])throw new Error(`The output '${t}' is not found in the graph`)})}}class Yne{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zne="?tfjs-format=file",Qne="model.json";class uI{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,t={},r=dT){this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=r,t==null&&(this.loadOptions={}),this.resourceManager=new Yne}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error(`Found more than one (${t.length}) load handlers for URL '${[e]}'`);this.handler=t[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return _u(e)?e.then(t=>t.getWeightStream==null?this.loadSync(t):this.loadStreaming(t)):this.loadSync(e)}loadSync(e){const t=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,t)}async loadStreaming(e){if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");const t=await ZF(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,t)}loadWithWeightMap(e,t){this.artifacts=e;const r=this.artifacts.modelTopology;let s=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const a=this.artifacts.userDefinedMetadata;a.signature!=null&&(s=a.signature),a.structuredOutputKeys!=null&&(this.structuredOutputKeys=a.structuredOutputKeys)}if(this.signature=s,this.version=`${r.versions.producer}.${r.versions.minConsumer}`,this.executor=new Ob(G$.Instance.transformGraph(r,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(t),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const a=G$.Instance.transformGraph(e.modelInitializer);this.initializer=new Ob(a),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,t){if(typeof e=="string"){const r=this.io.getSaveHandlers(e);if(r.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(r.length>1)throw new Error(`Found more than one (${r.length}) save handlers for URL '${e}'`);e=r[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const t=e instanceof Gt?[e]:e,r={};return t.forEach((s,a)=>r[this.structuredOutputKeys[a]]=s),r}return e}predict(e,t){const r=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(r)}async predictAsync(e,t){const r=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(r)}normalizeInputs(e){var t;if(!(e instanceof Gt)&&!Array.isArray(e)){const a=(t=this.signature)===null||t===void 0?void 0:t.inputs;if(a!=null)for(const o in a){const i=a[o];i.resourceId!=null&&(e[o]=this.resourceIdToCapturedInput[i.resourceId])}return e}e=Array.isArray(e)?e:[e];const r=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+r!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-r} non-resource placeholders, while there are ${e.length} input tensors provided.`);let s=0;return this.inputNodes.reduce((a,o)=>{var i,u,l;const c=(l=(u=(i=this.signature)===null||i===void 0?void 0:i.inputs)===null||u===void 0?void 0:u[o])===null||l===void 0?void 0:l.resourceId;return c!=null?a[o]=this.resourceIdToCapturedInput[c]:a[o]=e[s++],a},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const t=this.initializerSignature.outputs,r=Object.keys(t);for(let s=0;s<r.length;s++){const a=r[s],o=t[a];this.resourceIdToCapturedInput[o.resourceId]=e[s]}}}execute(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const r=this.executor.execute(e,t);return r.length>1?r:r[0]}async executeAsync(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const r=await this.executor.executeAsync(e,t);return r.length>1?r:r[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((t,r)=>(t[r]=[e[r]],t),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Ct(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function Jne(n,e={},t=dT){if(n==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof n=="string"&&(n=tre(n));const r=new uI(n,e,t);return await r.load(),r}function ere(n){if(n==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");let e;if(n instanceof Array){const[r,s]=n;if(!r)throw new Error("modelJSON must be the first element of the array");if(!s||!(s instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in r))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in r))throw new Error("Model JSON is missing 'weightsManifest'");const a=wb(r.weightsManifest),o=ZN(r,a,s);e=Cb(o)}else if("load"in n)e=n;else if("modelTopology"in n&&"weightSpecs"in n&&"weightData"in n)e=Cb(n);else throw new Error("Unknown model format");const t=new uI(e);return t.load(),t}function tre(n){return n.endsWith("/")||(n=n+"/"),`${n}${Qne}${Zne}`}/** @license See the LICENSE file. */const nre="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rre=Object.freeze(Object.defineProperty({__proto__:null,GraphModel:uI,deregisterOp:Ete,loadGraphModel:Jne,loadGraphModelSync:ere,registerOp:Ite,version_converter:nre},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Z$;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(Z$||(Z$={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ge(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&B(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sre=Zx;class S1 extends p0{nextDataId(){return S1.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new MN(this,Va())}write(e,t,r){this.firstUse&&(this.firstUse=!1,de().get("IS_NODE")&&Js(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const s={id:this.nextDataId()};return this.data.set(s,{values:e,dtype:r,refCount:1}),s}makeTensorInfo(e,t,r){let s;if(t==="string"&&r!=null&&r.length>0&&So(r[0])){const a=r.map(o=>ko(o));s=this.write(a,e,t)}else s=this.write(r,e,t);return{dataId:s,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,r,s,a){this.data.set(e,{values:t,dtype:s,refCount:a})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:r}=this.data.get(e);if(t==="complex64"){const s=this.readSync(r.real.dataId),a=this.readSync(r.imag.dataId);return Si(s,a)}return EF(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(s=>bi(s));return yt(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return yt(e.shape,e.dtype,t)}makeOutput(e,t,r){return Va().makeTensorFromTensorInfo(this.makeTensorInfo(t,r,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:r}=this.data.get(e);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Zr();return e(),{kernelMs:Zr()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ge([e],"where");const t=this.readSync(e.dataId);return sre(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}S1.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xB(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const are=n=>{const{x:e}=n.inputs,t=n.backend;Ge(e,"abs");let r=new Float32Array(xe(e.shape));const s=t.data.get(e.dataId).values;return r=xB(s),t.makeOutput(r,e.shape,e.dtype)},ore={kernelName:mm,backendName:"cpu",kernelFunc:are};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pn(n){return(e,t,r,s,a)=>{const o=mt(e,t),i=o.length,u=rt(o),l=xe(o),c=fr(a,l),d=e.length,p=t.length,m=rt(e),v=rt(t),b=Ql(e,o),y=Ql(t,o);if(b.length+y.length===0)for(let w=0;w<c.length;++w)c[w]=n(r[w%r.length],s[w%s.length]);else for(let w=0;w<c.length;++w){const S=dc(w,i,u),N=S.slice(-d);b.forEach($=>N[$]=0);const C=qa(N,d,m),T=S.slice(-p);y.forEach($=>T[$]=0);const E=qa(T,p,v);c[w]=n(r[C],s[E])}return[c,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ds(n){const{inputs:e,backend:t}=n,{real:r,imag:s}=e,a=t.data.get(r.dataId).values,o=t.data.get(s.dataId).values,i=t.makeTensorInfo(r.shape,"complex64"),u=t.data.get(i.dataId);return u.complexTensorInfos={real:t.makeTensorInfo(r.shape,"float32",a),imag:t.makeTensorInfo(s.shape,"float32",o)},i}const ire={kernelName:C0,backendName:"cpu",kernelFunc:Ds};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fb(n,e,t="float32"){if(t==="complex64"){const s=Fb(n,e,"float32"),a=Fb(n,e,"float32");return Ds({inputs:{real:s,imag:a},backend:n})}const r=Rr(xe(e),t);return n.makeTensorInfo(e,t,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Po(n){const{inputs:e,backend:t}=n,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const ure={kernelName:Td,backendName:"cpu",kernelFunc:Po};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sc(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.data.get(r.dataId).complexTensorInfos.real,a=t.data.get(s.dataId).values;return t.makeTensorInfo(s.shape,s.dtype,a)}const lre={kernelName:nx,backendName:"cpu",kernelFunc:sc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wB(n,e,t,r){if(r==="int32"){const s=Int32Array.from(n);return[e,"int32",s]}if(r==="bool"){const s=Vu([0],t),[a,o]=Pn((i,u)=>i!==u?1:0)(e,[],n,s,"bool");return[o,"bool",a]}throw new Error(`Error in Cast: failed to cast ${t} to ${r}`)}function Pu(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dtype:a}=r;if(a==="complex64"){if(s.dtype==="complex64")return Po({inputs:{x:s},backend:t});const c=Fb(t,s.shape,s.dtype),d=Pu({inputs:{x:s},backend:t,attrs:{dtype:"float32"}}),p=Ds({inputs:{real:d,imag:c},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(d),p}if(s.dtype==="complex64"){const c=sc({inputs:{input:s},backend:t}),d=Pu({inputs:{x:c},backend:t,attrs:{dtype:a}});return t.disposeIntermediateTensorInfo(c),d}if(!BN(s.dtype,a)){const c=Po({inputs:{x:s},backend:t});return{dataId:c.dataId,shape:c.shape,dtype:a}}const o=t.data.get(s.dataId).values,[i,u,l]=wB(o,s.shape,s.dtype,a);return t.makeTensorInfo(i,u,l)}const cre={kernelName:fd,backendName:"cpu",kernelFunc:Pu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rr(n,e,t,r){return t==null?({inputs:s,backend:a})=>{const{a:o,b:i}=s,u=a;Ge([o,i],n);const l=u.data.get(o.dataId).values,c=u.data.get(i.dataId).values,d=o.dtype==="string"?Ci(l):l,p=o.dtype==="string"?Ci(c):c,m=r||o.dtype,[v,b]=e(o.shape,i.shape,d,p,m);return u.makeTensorInfo(b,m,v)}:({inputs:s,backend:a})=>{const{a:o,b:i}=s,u=a;if(o.dtype==="complex64"||i.dtype==="complex64"){const l=Pu({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),c=u.data.get(l.dataId),d=c.complexTensorInfos.real,p=c.complexTensorInfos.imag,m=u.data.get(d.dataId).values,v=u.data.get(p.dataId).values,b=Pu({inputs:{x:i},backend:u,attrs:{dtype:"complex64"}}),y=u.data.get(b.dataId),w=y.complexTensorInfos.real,S=y.complexTensorInfos.imag,N=u.data.get(w.dataId).values,C=u.data.get(S.dataId).values,[T,E,$]=t(o.shape,i.shape,m,v,N,C),_=u.makeTensorInfo($,"float32",T),R=u.makeTensorInfo($,"float32",E),D=Ds({inputs:{real:_,imag:R},backend:u});return u.disposeIntermediateTensorInfo(l),u.disposeIntermediateTensorInfo(b),u.disposeIntermediateTensorInfo(_),u.disposeIntermediateTensorInfo(R),D}else{const l=u.data.get(o.dataId).values,c=u.data.get(i.dataId).values,d=r||o.dtype,[p,m]=e(o.shape,i.shape,l,c,d);return u.makeTensorInfo(m,d,p)}}}function lI(n){return(e,t,r,s,a,o)=>{const i=mt(e,t),u=xe(i),l=i.length,c=rt(i),d=fr("float32",u),p=fr("float32",u),m=Ql(e,i),v=Ql(t,i),b=Si(r,s),y=Si(a,o),w=e.length,S=rt(e),N=t.length,C=rt(t);if(m.length+v.length===0)for(let T=0;T<d.length;T++){const E=T%b.length,$=T%y.length,_=n(b[E*2],b[E*2+1],y[$*2],y[$*2+1]);d[T]=_.real,p[T]=_.imag}else for(let T=0;T<d.length;T++){const E=dc(T,l,c),$=E.slice(-w);m.forEach(M=>$[M]=0);const _=qa($,w,S),R=E.slice(-N);v.forEach(M=>R[M]=0);const D=qa(R,N,C),A=n(b[_*2],b[_*2+1],y[D*2],y[D*2+1]);d[T]=A.real,p[T]=A.imag}return[d,p,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SB=Pn((n,e)=>n+e),hre=lI((n,e,t,r)=>({real:n+t,imag:e+r})),Xh=rr(fc,SB,hre),dre={kernelName:fc,backendName:"cpu",kernelFunc:Xh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cI(n,e,t,r,s){const a=xe(r),o=Rr(s,t);for(let i=0;i<n.length;i++){const u=n[i];if(u<0)throw new Error("Input x must be non-negative!");u>=s||(a>0?o[u]+=e[i]:o[u]+=1)}return o}function CB(n,e,t,r=!1){const s=n.shape[0],a=n.shape[1],o=yt([s,t],e.dtype);for(let i=0;i<s;i++)for(let u=0;u<a;u++){const l=n.get(i,u);if(l<0)throw new Error("Input x must be non-negative!");l>=t||(r?o.set(1,i,l):e.size>0?o.set(o.get(i,l)+e.get(i,u),i,l):o.set(o.get(i,l)+1,i,l))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NB=Pn((n,e)=>n&e),fre=rr(Cm,NB),pre={kernelName:Cm,backendName:"cpu",kernelFunc:fre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vo(n){return(e,t,r)=>{const s=En(t,e.length);for(let a=0;a<e.length;++a)s[a]=n(e[a],r);return s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kt(n,e,t){const r=Vo(e);return Yu(n,r,t)}function Yu(n,e,t){return({inputs:r,attrs:s,backend:a})=>{const{x:o}=r;Ge(o,n);const i=a,u=i.data.get(o.dataId).values;let l;if(o.dtype==="string"){if(!Array.isArray(u))throw new Error("String tensor's value was not an instance of Array");l=Ci(u)}else l=u;const c=t||o.dtype,d=e(l,c,s);return i.makeTensorInfo(o.shape,c,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kB=Vo(n=>Math.ceil(n)),mre=Yu(pd,kB),gre={kernelName:pd,backendName:"cpu",kernelFunc:mre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TB(n,e,t,r){const s=En(t,xe(e));if(r&&t!=="string"){let a=0;n.forEach(o=>{const i=xe(o.shape);s.set(o.vals,a),a+=i})}else{let a=0;n.forEach(o=>{const i=t==="string"?Ci(o.vals):o.vals;let u=0;for(let l=0;l<o.shape[0];++l){const c=l*e[1]+a;for(let d=0;d<o.shape[1];++d)s[c+d]=i[u++]}a+=o.shape[1]})}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IB=Pn((n,e)=>n===e?1:0),EB=rr(Dm,IB,null,"bool"),vre={kernelName:Dm,backendName:"cpu",kernelFunc:EB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _B=Vo(n=>Math.exp(n)),RB=Yu(wd,_B,"float32"),yre={kernelName:wd,backendName:"cpu",kernelFunc:RB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AB=Vo(n=>Math.expm1(n)),bre=Yu(Sd,AB),xre={kernelName:Sd,backendName:"cpu",kernelFunc:bre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DB=Vo(n=>Math.floor(n)),wre=Yu(Cd,DB),Sre={kernelName:Cd,backendName:"cpu",kernelFunc:wre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $B=Pn((n,e)=>Math.floor(n/e)),Cre=rr(Nd,$B,null,"int32"),Nre={kernelName:Nd,backendName:"cpu",kernelFunc:Cre};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OB(n,e,t,r,s,a,o,i,u){const l=yt([r,a],t);for(let c=0;c<r;c++){const d=[];let p=0;for(let m=0;m<s;m++){const v=n[c*s+m];p+=v*o[m],d.push(v)}if(p<0||p>=u/a)throw new Error(`Invalid indices: ${d} does not index into ${i}`);for(let m=0;m<a;m++)l.values[c*a+m]=e.get(...e.indexToLoc(p*a+m))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FB(n,e,t){const r=yt(t,n.dtype);for(let s=0;s<r.size;++s){const o=r.indexToLoc(s).slice(),i=o[0],u=o[2],l=e.locToIndex([i,u]);o[2]=e.values[l];const c=n.locToIndex(o);0<=c&&c<n.values.length&&(r.values[s]=n.values[c])}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MB=Pn((n,e)=>n>e?1:0),kre=rr(Mm,MB,null,"bool"),Tre={kernelName:Mm,backendName:"cpu",kernelFunc:kre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LB=Pn((n,e)=>n>=e?1:0),Ire=rr(kd,LB,null,"bool"),Ere={kernelName:kd,backendName:"cpu",kernelFunc:Ire};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PB=Pn((n,e)=>n<e?1:0),_re=rr(Pm,PB,null,"bool"),Rre={kernelName:Pm,backendName:"cpu",kernelFunc:_re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BB=Pn((n,e)=>n<=e?1:0),Are=rr(Bm,BB,null,"bool"),Dre={kernelName:Bm,backendName:"cpu",kernelFunc:Are};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zB(n,e,t){const r=(e-n)/(t-1),s=Rr(t,"float32");s[0]=n;for(let a=1;a<s.length;a++)s[a]=s[a-1]+r;return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VB=Vo(n=>Math.log(n)),$re=Yu(Rd,VB),Ore={kernelName:Rd,backendName:"cpu",kernelFunc:$re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UB(n,e,t,r){const s=fr(r,xe(t));for(let a=0;a<s.length;++a){const o=a*e;let i=n[o];for(let u=0;u<e;++u){const l=n[o+u];(Number.isNaN(l)||l>i)&&(i=l)}s[a]=i}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WB=Pn((n,e)=>Math.max(n,e)),Fre=rr(Dd,WB),Mre={kernelName:Dd,backendName:"cpu",kernelFunc:Fre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GB=Pn((n,e)=>Math.min(n,e)),Lre=rr($d,GB),Pre={kernelName:$d,backendName:"cpu",kernelFunc:Lre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hI=Pn((n,e)=>n*e),Bre=lI((n,e,t,r)=>({real:n*t-e*r,imag:n*r+e*t})),C1=rr(Fd,hI,Bre),zre={kernelName:Fd,backendName:"cpu",kernelFunc:C1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HB(n,e,t){const r=ki(-1,t);return hI([],e,r,n,t)}function Vre(n){const{inputs:e,backend:t}=n,{x:r}=e;Ge(r,"neg");const s=t.data.get(r.dataId).values,[a,o]=HB(s,r.shape,r.dtype);return t.makeTensorInfo(o,r.dtype,a)}const Ure={kernelName:Ym,backendName:"cpu",kernelFunc:Vre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jB=Pn((n,e)=>n!==e?1:0),Wre=rr(Zm,jB,null,"bool"),Gre={kernelName:Zm,backendName:"cpu",kernelFunc:Wre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dI(n,e,t,r,s){const a=e.length,o=xe(e),i=rt(e),u=rt(s),l=fr(t,xe(s));for(let c=0;c<o;++c){const d=dc(c,a,i),p=new Array(d.length);for(let v=0;v<p.length;v++)p[v]=d[r[v]];const m=qa(p,a,u);l[m]=n[c]}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xs(n){const{inputs:e,attrs:t,backend:r}=n,{x:s}=e,{perm:a}=t;Ge(s,"transpose");const o=s.shape.length,i=new Array(o);for(let d=0;d<i.length;d++)i[d]=s.shape[a[d]];const u=r.data.get(s.dataId).values,l=dI(u,s.shape,s.dtype,a,i);return{dataId:r.write(l,i,s.dtype),shape:i,dtype:s.dtype}}const Hre={kernelName:Vl,backendName:"cpu",kernelFunc:xs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qB(n,e,t,r){const[s,a]=yr(n,r),o=ms(e,"int32"),i=Rr(xe(s),o),u=xe(a);for(let l=0;l<i.length;++l){const c=l*u;let d=1;for(let p=0;p<u;++p)d*=t[c+p];i[l]=d}return{outVals:i,outShape:s,outDtype:o}}function jre(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a,keepDims:o}=r;Ge(s,"prod");const i=s.shape.length,u=Nt(a,s.shape),l=Cn(u,i);let c=u,d=s;const p=[];l!=null&&(d=xs({inputs:{x:s},backend:t,attrs:{perm:l}}),p.push(d),c=Mn(c.length,i));const m=t.data.get(d.dataId).values,{outVals:v,outShape:b,outDtype:y}=qB(d.shape,d.dtype,m,c);let w=b;return o&&(w=Fn(b,u)),p.forEach(S=>t.disposeIntermediateTensorInfo(S)),t.makeTensorInfo(w,y,v)}const qre={kernelName:rg,backendName:"cpu",kernelFunc:jre};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kre(n,e,t){n.forEach((r,s)=>{if(r<0||r>=t){const a=dc(s,e.length,rt(e)).join(",");throw new Error(`indices[${a}] = ${r} is not in [0, ${t})`)}})}function Xre(n,e){for(let t=0;t<n.length;++t){const r=n[t],s=t===n.length-1?e:n[t+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>s)throw new Error("Ragged splits must not point past values");for(let a=1;a<r.length;++a)if(r[a-1]>r[a])throw new Error("Ragged splits must be sorted in ascending order")}}function Yre(n,e,t,r){const s=[];let a=0;const o=e.length-1+t.length,i=new Array(o).fill(null).map(()=>[0]);Xre(t,r);let u=1;for(let l=0;l<e.length-1;++l){u*=e[l];const c=e[l+1];for(let d=1;d<u+1;++d)i[l].push(d*c)}for(let l=0;l<n.length;++l){let c=n[l],d=n[l]+1;for(let p=0;p<t.length;++p){const m=t[p],v=p+e.length-1;if(v>=0){const b=i[v],y=b[b.length-1]-m[c];for(let w=c;w<d;++w)i[v].push(m[w+1]+y)}c=m[c],d=m[d]}d!==c&&(s.push([c,d]),a+=d-c)}return{outSplits:i,valueSlices:s,numValues:a}}function Zre(n){const e=[];for(let t=0;t<n.length;++t){const r=n[t].length,s=En("int32",r);e.push(s),n[t].forEach((a,o)=>s[o]=a)}return e}function Q$(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let r=e;r<n.length;r++)t[e-1]*=n[r];return t}function Qre(n,e,t,r,s,a){const o=Q$(e,2)[1],i=Q$(a,2)[1];let u=0;for(const l of t)for(let c=l[0];c<l[1];++c){for(let d=0;d<r;++d)s[u*i+d]=n[c*o+d];++u}}function Jre(n,e,t,r,s){const a=e.slice();a[0]=s;const o=En(t,xe(a)),i=n.length,u=i===0?0:i/e[0];return Qre(n,e,r,u,o,a),[o,a]}function KB(n,e,t,r,s,a,o,i){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const u=e[0][0]-1;if(Kre(a,o,u),r.length===0)throw new Error("params.rank must be nonzero");const l=r[0],{outSplits:c,valueSlices:d,numValues:p}=Yre(a,o,n,l),m=Zre(c),v=Jre(t,r,s,d,p);return[m,v[0],v[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J$=2147483647;function XB(n,e,t,r,s,a,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(s.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const i=e.length===0,u=s.length===0,l=o.length===0,c=[];i||c.push(e[0]),u||c.push(s[0]),l||c.push(o[0]);for(let y=1;y<c.length;++y)if(c[y]!==c[y-1])throw new Error("starts, limits, and deltas must have the same shape");const d=c.length===0?1:c[0],p=En("int32",d+1);p[0]=0;for(let y=0;y<d;++y){const w=i?n[0]:n[y],S=u?r[0]:r[y],N=l?a[0]:a[y];if(N===0)throw new Error("Requires delta != 0");let C;if(N>0&&S<w||N<0&&S>w)C=0;else if(C=Math.ceil(Math.abs((S-w)/N)),C>J$)throw new Error(`Requires ((limit - start) / delta) <= ${J$}`);p[y+1]=p[y]+C}const m=p[d],v=En(t,m);let b=0;for(let y=0;y<d;++y){const w=p[y+1]-p[y];let S=i?n[0]:n[y];const N=l?a[0]:a[y];for(let C=0;C<w;++C)v[b++]=S,S+=N}return[p,v]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Sa=Wa;class Mb{constructor(e,t,r,s,a,o,i,u,l,c){this.shape=e,this.shapeShape=t,this.values=r,this.valuesShape=s,this.valuesDType=a,this.defaultValue=o,this.defaultValueShape=i,this.rowPartitionValues=u,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=R4(c),this.raggedRank=A4(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Sa.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Sa.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Sa.VALUE_ROWIDS:return Mb.getMaxWidthValueRowID(t);case Sa.ROW_SPLITS:return Mb.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${Sa[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let r=0;for(let s=0;s<t-1;++s){const a=e[s+1]-e[s];a>r&&(r=a)}return r}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let r=0,s=e[0],a=0;for(let o=1;o<t;++o){const i=e[o];i!==s&&(s=i,a=Math.max(o-r,a),r=o)}return Math.max(t-r,a)}tensorShapeFromTensor(e,t,r=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return tO(e,r)}calculateOutputSize(e){const t=this.valuesShape,r=this.defaultValueShape;D4(r,t);const s=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=_4(this.raggedRank,s,t);o[0]<0&&(o[0]=e);for(let i=1;i<=this.raggedRank;++i)o[i]<0&&(o[i]=this.getMaxWidth(i));return o}calculateFirstParentOutputIndex(e,t,r){const s=Math.min(e,r),a=[];let o=0;for(let i=0;i<s;++i,o+=t)a.push(o);for(let i=s;i<e;++i)a.push(-1);return B(a.length===e,()=>"Final length of result must be equal to firstDimension."),a}calculateOutputIndexRowSplit(e,t,r,s){const a=e.length,o=[];for(let i=0;i<a-1;++i){const u=e[i+1]-e[i];let l=Math.min(s,u),c=t[i];c===-1&&(l=0);for(let d=0;d<l;++d)o.push(c),c+=r;for(let d=0;d<u-l;++d)o.push(-1)}if(a>0&&o.length!==e[a-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,t,r,s){const a=e.length,o=[];if(a===0)return[];let i=0,u=e[0];if(u>=t.length)throw new Error(`Got currentValueRowId=${u}, which is not less than ${t.length}`);let l=t[u];o.push(l);for(let c=1;c<a;++c){const d=e[c];if(d===u)l>=0&&(++i,i<s?l+=r:l=-1);else{if(i=0,u=d,d>=t.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${t.length}`);l=t[d]}o.push(l)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,t,r,s){const a=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Sa.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,r,s);case Sa.ROW_SPLITS:if(a.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${a.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(a,t,r,s);default:throw new Error(`Unsupported partition type: ${Sa[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case Sa.FIRST_DIM_SIZE:return e[0];case Sa.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Sa.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Sa[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),r=this.calculateOutputSize(t),s=new Array(this.raggedRank+1);s[s.length-1]=1;for(let u=s.length-2;u>=0;--u)s[u]=s[u+1]*r[u+1];const a=tO(r,!1),o=En(this.valuesDType,xe(a));if(s[0]*r[0]>0){let u=this.calculateFirstParentOutputIndex(t,s[0],r[0]);for(let l=1;l<=this.raggedRank;++l)u=this.calculateOutputIndex(l-1,u,s[l],r[l]);this.setOutput(this.raggedRank,u,o,a)}return[a,o]}setOutput(e,t,r,s){if(r.length===0)return;const a=this.values,o=r;let i=s.slice();i=i.slice(e+1);const u=xe(i),l=t.length;let c=this.defaultValue;if(c.length!==u&&c.length!==1){const v=this.defaultValueShape;he(()=>{const b=ae(c,v);c=Ul(b,i).dataSync()})}let d=0,p=0,m=0;for(let v=0;v<=l;++v){let b=v<l?t[v]:-1;if(b===m){++m;continue}if(p<m){const y=a.subarray(d*u),w=o.subarray(p*u),S=(m-p)*u;eO(w,y,S)}if(v>=l){const y=r.length;b=Math.floor(y/u)}if(b>m)if(this.defaultValue.length===1)o.subarray(m*u,b*u).fill(this.defaultValue[0]),m=b;else for(;b>m;){const y=o.slice(m*u);eO(y,c,u),++m}b<0?(d=v+1,p=m):(d=v,p=m,m=p+1)}}}function eO(n,e,t){for(let r=0;r<t;r++)n[r]=e[r]}function tO(n,e){const t=[];for(let r of n){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}t.push(r)}return t}function YB(n,e,t,r,s,a,o,i,u,l){return new Mb(n,e,t,r,s,a,o,i,u,l).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZB(n,e,t,r){const s=n===e,a=n<e&&t<0,o=e<n&&t>1;if(s||a||o)return Rr(0,r);const i=Math.abs(Math.ceil((e-n)/t)),u=Rr(i,r);e<n&&t===1&&(t=-1),u[0]=n;for(let l=1;l<u.length;l++)u[l]=u[l-1]+t;return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QB=Vo(n=>1/Math.sqrt(n)),ese=Yu(Vd,QB),tse={kernelName:Vd,backendName:"cpu",kernelFunc:ese};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ml(n,e,t,r,s,a,o,i,u,l){const c=[r/s,s],d=n.values,p=e.values;if(r===0)return yt(t,e.dtype);const m=u instanceof Gn?u:yt(c,e.dtype);typeof u=="string"||typeof u=="number"?m.values.fill(u):typeof u=="boolean"&&m.values.fill(+u);for(let v=0;v<a;v++){const b=[];let y=0;for(let w=0;w<o;w++){const S=d[v*o+w];b.push(S),y+=S*i[w]}if(y<0||y>=r/s)throw new Error(`Invalid indices: ${b} does not index into ${t}`);for(let w=0;w<s;w++)l?m.values[y*s+w]+=p[v*s+w]:m.values[y*s+w]=e.rank===0?p[0]:p[v*s+w]}return m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nse=Vo(n=>1/(1+Math.exp(-n))),JB=Kt(jd,n=>1/(1+Math.exp(-n))),rse={kernelName:jd,backendName:"cpu",kernelFunc:JB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ez(n,e,t,r,s){const a=mT(r,e,t),o=xe(t),i=rt(r);if(a){const d=gT(e,i);return s==="string"?n.slice(d,d+o):n.subarray(d,d+o)}const u=s==="string"?Ci(n):n,l=yt(r,s,u),c=yt(t,s);for(let d=0;d<c.size;++d){const p=c.indexToLoc(d),m=p.map((v,b)=>v+e[b]);c.set(l.get(...m),...p)}return s==="string"?Q4(c.values):c.values}function ac(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:a,size:o}=r;Ge(s,"slice");const[i,u]=u1(s,a,o);fT(s,i,u);const l=t.data.get(s.dataId).values,c=ez(l,i,u,s.shape,s.dtype);return t.makeTensorInfo(u,s.dtype,c)}const sse={kernelName:lg,backendName:"cpu",kernelFunc:ac};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tz(n,e,t,r,s,a,o){const i=e[0],u=a[0],l=new Array(u),c=new Array(i),d=e[1];if(u===0){if(i!==0)throw new Error(B4(i));const y=En(t,0),w=En(s,0);return[y,[0,d],w,l,c]}let p=!0,m=0;const v=new Array(u).fill(0);for(let y=0;y<i;++y){const w=n[y*d];if(w<0)throw new Error(z4(y,w));if(w>=u)throw new Error(V4(y,w,u));++v[w],p=p&&w>=m,m=w}let b=!0;for(let y=0;y<u;++y){const w=v[y]===0;l[y]=w,b=b&&!w,v[y]=Math.max(v[y],1),y>0&&(v[y]+=v[y-1])}if(b&&p){const y=n,w=r;for(let S=0;S<i;++S)c[S]=S;return[y,[i,d],w,l,c]}else{const y=v[u-1],w=En(t,y*d),S=En(s,y),N=new Array(u).fill(0);for(let C=0;C<i;++C){const T=n[C*d],E=N[T],$=(T===0?0:v[T-1])+E;N[T]++;for(let _=0;_<d;++_)w[$*d+_]=n[C*d+_];S[$]=r[C],c[C]=$}for(let C=0;C<u;++C)if(N[C]===0){const E=C===0?0:v[C-1];w[E*d+0]=C;for(let $=1;$<d;++$)w[E*d+$]=0;S[E]=o}return[w,[y,d],S,l,c]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nz(n,e,t,r,s){const a=xe(r),o=e[0],i=s.length,u=[];let l=1,c=-1;for(let y=0;y<i;++y){const w=s[y];if(w===-1){if(c!==-1)throw new Error(U4(c,y));c=y,u.push(1)}else{if(w<0)throw new Error(W4(y,w));l*=w,u.push(w)}}if(c!==-1){if(l<=0)throw new Error(G4());const y=Math.trunc(a/l);if(l*y!==a)throw new Error(H4(r,u));u[c]=y}if(xe(u)!==a)throw new Error(j4(r,u));const p=r.length,m=[];if(p>0){m[p-1]=1;for(let y=p-2;y>=0;--y)m[y]=m[y+1]*r[y+1]}const v=[];if(i>0){v[i-1]=1;for(let y=i-2;y>=0;--y)v[y]=v[y+1]*u[y+1]}const b=En(t,o*i);for(let y=0;y<o;++y){let w=0;for(let S=0;S<p;++S)w+=n[y*p+S]*m[S];for(let S=0;S<i;++S)b[y*i+S]=Math.trunc(w/v[S]),w%=v[S]}return[b,[o,i],u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fI(n,e,t,r,s,a=!1,o=0){const i=r.length,u=[e[0],n.length/e[0]],l=u[1],d=i>0?s[i-1]+1:0;if(d<0)throw new Error($C());const p=e.slice();p[0]=d;const m=p.reduce((N,C)=>N*C,1),v=En(t,m);if(i===0)return d>0&&v.fill(o),[v,p];if(d<=0)throw new Error($C());let b=0,y=1,w=0,S=s[b];for(;;){let N=0;if(y<i){if(N=s[y],S===N){++y;continue}if(S>=N)throw new Error(q4())}if(S<0||S>=d)throw new Error(K4(S,d));S>w&&v.fill(o,w*l,S*l);for(let C=b;C<y;++C){const T=r[C];if(T<0||T>=u[0])throw new Error(X4(C,r[C],u[0]));for(let E=0;E<l;E++)v[S*l+E]+=n[T*l+E]}if(a)for(let C=0;C<l;C++)v[S*l+C]/=y-b;if(b=y,++y,w=S+1,S=N,y>i)break}return w<d&&v.fill(o,w*l,d*l),[v,p]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ase=Vo(n=>Math.sqrt(n)),ose=Kt(Kd,n=>Math.sqrt(n)),ise={kernelName:Kd,backendName:"cpu",kernelFunc:ose};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rz=Pn((n,e)=>{const t=n-e;return t*t}),use=rr(Xd,rz),lse={kernelName:Xd,backendName:"cpu",kernelFunc:use};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sz=Vo((n,e)=>{const{pattern:t,replaceGlobal:r,rewrite:s}=e;return n.replace(new RegExp(t,r?"g":""),s)}),cse=Yu(pg,sz),hse={kernelName:pg,backendName:"cpu",kernelFunc:cse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function az(n,e,t,r){const s=yt(n,e.dtype);for(let a=0;a<s.size;a++){const o=s.indexToLoc(a),i=new Array(o.length);for(let u=0;u<i.length;u++)i[u]=o[u]*t[u]+r[u];s.set(e.get(...i),...o)}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dse{constructor(e,t,r,s,a,o){this.separator=ko(e),this.nGramWidths=t,this.leftPad=ko(r),this.rightPad=ko(s),this.padWidth=a,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const r=this.getPadWidth(t);return Math.max(0,e+2*r-t+1)}createNGrams(e,t,r,s,a,o){for(let i=0;i<a;++i){const u=this.getPadWidth(o),l=Math.max(0,u-i),c=Math.max(0,u-(a-(i+1))),d=o-(l+c),p=t+(l>0?0:i-u);let m=0;m+=l*this.leftPad.length;for(let S=0;S<d;++S)m+=e[p+S].length;m+=c*this.rightPad.length;const v=l+c+d-1;m+=v*this.separator.length,r[s+i]=new Uint8Array(m);const b=r[s+i];let y=0;const w=S=>S.forEach(N=>b[y++]=N);for(let S=0;S<l;++S)w(this.leftPad),w(this.separator);for(let S=0;S<d-1;++S)w(e[p+S]),w(this.separator);if(d>0){w(e[p+d-1]);for(let S=0;S<c;++S)w(this.separator),w(this.rightPad)}else{for(let S=0;S<c-1;++S)w(this.rightPad),w(this.separator);w(this.rightPad)}}}compute(e,t){const r=e.length,s=t.length;if(s>0){let u=t[0];if(u!==0)throw new Error(`First split value must be 0, got ${u}`);for(let l=1;l<s;++l){let c=t[l]>=u;if(c=c&&t[l]<=r,!c)throw new Error(`Invalid split value ${t[l]}, must be in [${u}, ${r}]`);u=t[l]}if(u!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${u}`)}const a=s-1,o=En("int32",s);if(r===0||s===0){const u=new Array(r);for(let l=0;l<=a;++l)o[l]=0;return[u,o]}o[0]=0;for(let u=1;u<=a;++u){const l=t[u]-t[u-1];let c=0;this.nGramWidths.forEach(d=>{c+=this.getNumNGrams(l,d)}),this.preserveShort&&l>0&&c===0&&(c=1),o[u]=o[u-1]+c}const i=new Array(o[a]);for(let u=0;u<a;++u){const l=t[u];let c=o[u];if(this.nGramWidths.forEach(d=>{const p=t[u+1]-t[u],m=this.getNumNGrams(p,d);this.createNGrams(e,l,i,c,m,d),c+=m}),this.preserveShort&&c===o[u]){const d=t[u+1]-t[u];if(d===0)continue;const p=d+2*this.padWidth;this.createNGrams(e,l,i,c,1,p)}}return[i,o]}}function oz(n,e,t,r,s,a,o,i){return new dse(t,r,s,a,o,i).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fse(n,e,t,r){if(!n.length)return;if(e.length===0){for(let a=0;a<n.length;++a)r.push(n.subarray(a,a+1));return}if(e.length===1){const a=e[0];let o=n.indexOf(a);for(;o!==-1;){const i=n.subarray(0,o);(!t||i.length!==0)&&r.push(i),n=n.subarray(o+1),o=n.indexOf(a)}(!t||n.length!==0)&&r.push(n);return}let s=0;for(let a=0;a<n.length+1;a++)if(a===n.length||e.indexOf(n[a])!==-1){const o=n.subarray(s,a);(!t||o.length!==0)&&r.push(o),s=a+1}}function iz(n,e,t){const r=n.length,s=[];let a=0,o=0;const i=new Array(r);for(let p=0;p<r;++p){const m=s.length;fse(n[p],e,t,s);const v=s.length-m;i[p]=v,a+=v,o=Math.max(o,v)}const u=En("int32",a*2),l=new Array(a),c=[r,o];let d=0;for(let p=0;p<r;++p)for(let m=0;m<i[p];++m)u[d*2]=p,u[d*2+1]=m,l[d]=s[d],++d;return[u,l,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uz(n,e){const t=En("int32",n.length);for(let r=0;r<n.length;++r)t[r]=BF(n[r]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lz=Pn((n,e)=>n-e),pse=lI((n,e,t,r)=>({real:n-t,imag:e-r})),pI=rr(Yd,lz,pse),mse={kernelName:Yd,backendName:"cpu",kernelFunc:pI};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cz(n,e){const t=new Array(n.rank);for(let s=0;s<t.length;s++)t[s]=n.shape[s]*e[s];const r=yt(t,n.dtype);for(let s=0;s<r.values.length;++s){const a=r.indexToLoc(s),o=new Array(n.rank);for(let u=0;u<o.length;u++)o[u]=a[u]%n.shape[u];const i=n.locToIndex(o);r.values[s]=n.values[i]}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ap=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function hz(n,e,t=0,r=n.length-1){for(;r>t;){if(r-t>600){const i=r-t+1,u=e-t+1,l=Math.log(i),c=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*c*(i-c)/i)*Math.sign(u-i/2),p=Math.max(t,Math.floor(e-u*c/i+d)),m=Math.min(r,Math.floor(e+(i-u)*c/i+d));hz(n,e,p,m)}const s=n[e];let a=t,o=r;for(pi(n,t,e),Ap(n[r],s)>0&&pi(n,t,r);a<o;){for(pi(n,a,o),a++,o--;Ap(n[a],s)<0;)a=a+1;for(;Ap(n[o],s)>0;)o=o-1}Ap(n[t],s)===0?pi(n,t,o):(o=o+1,pi(n,o,r)),o<=e&&(t=o+1),e<=o&&(r=o-1)}}function dz(n,e,t,r,s){const a=e[e.length-1],[o,i]=[n.length/a,a],u=fr(t,o*r),l=fr("int32",o*r);for(let d=0;d<o;d++){const p=d*i,m=n.subarray(p,p+i);let v=new Array(m.length);m.forEach((S,N)=>v[N]={value:S,index:N}),r<v.length&&(hz(v,r),v=v.slice(0,r)),s&&v.sort(Ap);const b=d*r,y=u.subarray(b,b+r),w=l.subarray(b,b+r);for(let S=0;S<r;S++)y[S]=v[S].value,w[S]=v[S].index}const c=e.slice();return c[c.length-1]=r,[yt(c,t,u),yt(c,"int32",l)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fz(n,e,t,r){const s=Nt(e,t)[0],a=[1,t[0],1];for(let v=0;v<s;v++)a[0]*=t[v];a[1]=t[s];for(let v=s+1;v<t.length;v++)a[2]*=t[v];const o=new Map,i=new Int32Array(t[s]),u=new Gn(a,r,n),l=[],c=a[0]===1&&a[2]===1;for(let v=0;v<t[s];v++){let b;if(c)b=n[v].toString();else{const w=[];for(let S=0;S<a[0];S++)for(let N=0;N<a[2];N++)w.push(u.get(S,v,N));b=w.join(",")}const y=o.get(b);if(y!=null)i[v]=y;else{const w=o.size;o.set(b,w),i[v]=w,l.push(v)}}const d=a.slice();d[1]=o.size;const p=new Gn(d,r);l.forEach((v,b)=>{for(let y=0;y<a[0];y++)for(let w=0;w<a[2];w++)p.set(u.get(y,v,w),y,b,w)});const m=t.slice();return m[s]=d[1],{outputValues:p.values,outputShape:m,indices:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gse=Object.freeze(Object.defineProperty({__proto__:null,addImpl:SB,bincountImpl:cI,bincountReduceImpl:CB,bitwiseAndImpl:NB,castImpl:wB,ceilImpl:kB,concatImpl:TB,equalImpl:IB,expImpl:_B,expm1Impl:AB,floorDivImpl:$B,floorImpl:DB,gatherNdImpl:OB,gatherV2Impl:FB,greaterEqualImpl:LB,greaterImpl:MB,lessEqualImpl:BB,lessImpl:PB,linSpaceImpl:zB,logImpl:VB,maxImpl:UB,maximumImpl:WB,minimumImpl:GB,multiplyImpl:hI,negImpl:HB,notEqualImpl:jB,prodImpl:qB,raggedGatherImpl:KB,raggedRangeImpl:XB,raggedTensorToTensorImpl:YB,rangeImpl:ZB,rsqrtImpl:QB,scatterImpl:Ml,sigmoidImpl:nse,simpleAbsImpl:xB,sliceImpl:ez,sparseFillEmptyRowsImpl:tz,sparseReshapeImpl:nz,sparseSegmentReductionImpl:fI,sqrtImpl:ase,squaredDifferenceImpl:rz,staticRegexReplaceImpl:sz,stridedSliceImpl:az,stringNGramsImpl:oz,stringSplitImpl:iz,stringToHashBucketFastImpl:uz,subImpl:lz,tileImpl:cz,topKImpl:dz,transposeImpl:dI,uniqueImpl:fz},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */KN("cpu",()=>new S1,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pz=Kt(bd,n=>n>=0?n:Math.exp(n)-1),vse={kernelName:bd,backendName:"cpu",kernelFunc:pz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mz(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{alpha:a}=r;Ge([s],"leakyRelu");const o=xe(s.shape),i=t.data.get(s.dataId).values,u=fr("float32",o);for(let l=0;l<i.length;l++)u[l]=i[l]<0?a*i[l]:i[l];return t.makeTensorInfo(s.shape,"float32",u)}const yse={kernelName:Lm,backendName:"cpu",kernelFunc:mz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bse=Pn((n,e)=>n<0?e*n:n);function gz(n){const{inputs:e,backend:t}=n,{x:r,alpha:s}=e;Ge([r,s],"prelu");const a=t.data.get(r.dataId).values,o=t.data.get(s.dataId).values,[i,u]=bse(r.shape,s.shape,a,o,"float32");return t.makeTensorInfo(u,"float32",i)}const xse={kernelName:ng,backendName:"cpu",kernelFunc:gz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vz=Kt(Pd,n=>Math.max(0,n)),wse={kernelName:Pd,backendName:"cpu",kernelFunc:vz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yz=Kt(Bd,n=>Math.min(Math.max(0,n),6)),Sse={kernelName:Bd,backendName:"cpu",kernelFunc:yz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lb(n,e,t,r,s){if(t==="linear")return Po({inputs:{x:e},backend:n});if(t==="relu")return vz({inputs:{x:e},backend:n});if(t==="elu")return pz({inputs:{x:e},backend:n});if(t==="relu6")return yz({inputs:{x:e},backend:n});if(t==="prelu")return gz({inputs:{x:e,alpha:r},backend:n});if(t==="leakyrelu")return mz({inputs:{x:e},backend:n,attrs:{alpha:s}});if(t==="sigmoid")return JB({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cn(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{shape:a}=r,o=xe(s.shape),i=PN(a,o),u=xe(i);B(o===u,()=>`The new shape (${i}) has ${u} elements and the old shape (${s.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),t.incRef(s.dataId);const l=t.data.get(s.dataId);if(l.complexTensorInfos!=null){const c=l.complexTensorInfos.real,d=l.complexTensorInfos.imag;c.shape=i,d.shape=i}return{dataId:s.dataId,shape:i,dtype:s.dtype}}const Cse={kernelName:sg,backendName:"cpu",kernelFunc:cn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bz(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:a}=e,{transposeA:o,transposeB:i}=r;Ge([s,a],"matMul");const u=s.shape.length,l=a.shape.length,c=o?s.shape[u-2]:s.shape[u-1],d=i?a.shape[l-1]:a.shape[l-2],p=o?s.shape[u-1]:s.shape[u-2],m=i?a.shape[l-2]:a.shape[l-1],v=s.shape.slice(0,-2),b=a.shape.slice(0,-2),y=xe(v),w=xe(b),N=mt(s.shape.slice(0,-2),a.shape.slice(0,-2)).concat([p,m]);B(c===d,()=>`Error in matMul: inner shapes (${c}) and (${d}) of Tensors with shapes ${s.shape} and ${a.shape} and transposeA=${o} and transposeB=${i} must match.`);const C=o?[y,c,p]:[y,p,c],T=i?[w,m,d]:[w,d,m],E=cn({inputs:{x:s},backend:t,attrs:{shape:C}}),$=cn({inputs:{x:a},backend:t,attrs:{shape:T}}),_=o?E.shape[1]:E.shape[2],R=o?E.shape[2]:E.shape[1],D=i?$.shape[1]:$.shape[2],A=Math.max(y,w),M=t.data.get(E.dataId).values,H=t.data.get($.dataId).values,j=rt(E.shape),G=rt($.shape),[P,V,z]=o?[j[0],1,j[1]]:[j[0],j[1],1],[Y,L,K]=i?[1,G[1],G[0]]:[G[1],1,G[0]],J=R*D,Z=yt([A,R,D],E.dtype),le=Z.values,pe=t.blockSize;for(let ge=0;ge<A;ge++){const Ce=ge%y,Ie=ge%w;for(let $e=0;$e<R;$e+=pe){const Be=Math.min($e+pe,R);for(let Oe=0;Oe<D;Oe+=pe){const Ve=Math.min(Oe+pe,D);for(let Ze=0;Ze<_;Ze+=pe){const lt=Math.min(Ze+pe,_);for(let it=$e;it<Be;it++)for(let ot=Oe;ot<Ve;ot++){let pt=0;for(let _t=Ze;_t<lt;_t++){const hn=M[Ce*P+it*V+_t*z],en=H[_t*Y+ot*L+Ie*K];pt+=hn*en}le[ge*J+(it*D+ot)]+=pt}}}}}return t.disposeIntermediateTensorInfo(E),t.disposeIntermediateTensorInfo($),t.makeTensorInfo(N,Z.dtype,Z.values)}const Nse={kernelName:wm,backendName:"cpu",kernelFunc:bz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kse(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:a,bias:o,preluActivationWeights:i}=e,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:d}=r;let p,m,v;const b=[];p=bz({inputs:{a:s,b:a},attrs:{transposeA:u,transposeB:l},backend:t}),o&&(m=Xh({inputs:{a:p,b:o},backend:t}),b.push(p),p=m),c&&(v=Lb(t,p,c,i,d),b.push(p),p=v);for(const w of b)t.disposeIntermediateTensorInfo(w);return p}const Tse={kernelName:Up,backendName:"cpu",kernelFunc:kse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ise=Kt(od,n=>Math.acos(n)),Ese={kernelName:od,backendName:"cpu",kernelFunc:Ise};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _se=Kt(id,n=>Math.acosh(n)),Rse={kernelName:id,backendName:"cpu",kernelFunc:_se};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ase(n){const{inputs:e,backend:t}=n,r=e;Ge(e,"addN");const s=r.map(i=>t.data.get(i.dataId).values),a=yt(r[0].shape,r[0].dtype),o=a.values;for(let i=0;i<r.length;i++){const u=s[i];for(let l=0;l<o.length;l++)o[l]+=u[l]}return t.makeTensorInfo(a.shape,a.dtype,a.values)}const Dse={kernelName:gm,backendName:"cpu",kernelFunc:Ase};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $se(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a,keepDims:o}=r;Ge(s,"all");const i=Nt(a,s.shape);let u=i;const l=Cn(u,s.shape.length);let c=s;l!=null&&(c=xs({inputs:{x:s},backend:t,attrs:{perm:l}}),u=Mn(u.length,s.shape.length)),Or("all",u,c.shape.length);const[d,p]=yr(c.shape,u),m=xe(p),v=Rr(xe(d),c.dtype),b=t.data.get(c.dataId).values;for(let w=0;w<v.length;++w){const S=w*m;let N=b[S];for(let C=0;C<m;++C){const T=b[S+C];N=N&&T}v[w]=N}l!=null&&t.disposeIntermediateTensorInfo(c);const y=t.makeTensorInfo(d,c.dtype,v);if(o){const w=Fn(d,i),S=cn({inputs:{x:y},backend:t,attrs:{shape:w}});return t.disposeIntermediateTensorInfo(y),S}return y}const Ose={kernelName:v0,backendName:"cpu",kernelFunc:$se};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fse(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a,keepDims:o}=r;Ge(s,"any");const i=Nt(a,s.shape);let u=i;const l=Cn(u,s.shape.length);let c=s;l!=null&&(c=xs({inputs:{x:s},backend:t,attrs:{perm:l}}),u=Mn(u.length,s.shape.length)),Or("any",u,c.shape.length);const[d,p]=yr(c.shape,u),m=xe(p),v=Rr(xe(d),c.dtype),b=t.data.get(c.dataId).values;for(let w=0;w<v.length;++w){const S=w*m;let N=b[S];for(let C=0;C<m;++C){const T=b[S+C];N=N||T}v[w]=N}l!=null&&t.disposeIntermediateTensorInfo(c);const y=t.makeTensorInfo(d,c.dtype,v);if(o){const w=Fn(d,i),S=cn({inputs:{x:y},backend:t,attrs:{shape:w}});return t.disposeIntermediateTensorInfo(y),S}return y}const Mse={kernelName:y0,backendName:"cpu",kernelFunc:Fse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lse(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a}=r;Ge(s,"argMax");let o=Nt(a,s.shape);const i=Cn(o,s.shape.length);let u=s;const l=[];i!=null&&(u=xs({inputs:{x:s},backend:t,attrs:{perm:i}}),l.push(u),o=Mn(o.length,u.shape.length)),o=[o[0]],Or("argMax",o,u.shape.length);const[c,d]=yr(u.shape,o),p=xe(c),m=Rr(p,"int32"),v=xe(d),b=t.data.get(u.dataId).values;for(let y=0;y<m.length;++y){const w=y*v;let S=b[w],N=0;for(let C=0;C<v;++C){const T=b[w+C];T>S&&(S=T,N=C)}m[y]=N}return l.forEach(y=>t.disposeIntermediateTensorInfo(y)),t.makeTensorInfo(c,"int32",m)}const Pse={kernelName:vm,backendName:"cpu",kernelFunc:Lse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bse(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a}=r;Ge(s,"argMin");let o=Nt(a,s.shape);const i=Cn(o,s.shape.length);let u=s;const l=[];i!=null&&(u=xs({inputs:{x:s},backend:t,attrs:{perm:i}}),l.push(u),o=Mn(o.length,u.shape.length)),o=[o[0]],Or("argMin",o,u.shape.length);const[c,d]=yr(u.shape,o),p=xe(c),m=Rr(p,"int32"),v=xe(d),b=t.data.get(u.dataId).values;for(let y=0;y<m.length;++y){const w=y*v;let S=b[w],N=0;for(let C=0;C<v;++C){const T=b[w+C];T<S&&(S=T,N=C)}m[y]=N}return l.forEach(y=>t.disposeIntermediateTensorInfo(y)),t.makeTensorInfo(c,"int32",m)}const zse={kernelName:ym,backendName:"cpu",kernelFunc:Bse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vse=Kt(ud,n=>Math.asin(n)),Use={kernelName:ud,backendName:"cpu",kernelFunc:Vse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wse=Kt(ld,n=>Math.asinh(n)),Gse={kernelName:ld,backendName:"cpu",kernelFunc:Wse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hse=Kt(cd,n=>Math.atan(n)),jse={kernelName:cd,backendName:"cpu",kernelFunc:Hse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qse=Pn((n,e)=>Math.atan2(n,e)),Kse=rr(dd,qse),Xse={kernelName:dd,backendName:"cpu",kernelFunc:Kse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yse=Kt(hd,n=>Math.atanh(n)),Zse={kernelName:hd,backendName:"cpu",kernelFunc:Yse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mI(n,e,t,r,s,a){const o=s.strideHeight,i=s.strideWidth,u=s.dilationHeight,l=s.dilationWidth,c=s.effectiveFilterHeight,d=s.effectiveFilterWidth,p=s.padInfo.top,m=s.padInfo.left,v=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=yt(s.outShape,t),y=b.values,w=s.outShape[1]*s.outShape[2]*s.outShape[3],S=s.outShape[2]*s.outShape[3],N=s.outShape[3];for(let C=0;C<s.batchSize;++C){const T=C*w,E=C*r[0];for(let $=0;$<s.inChannels;++$)for(let _=0;_<s.outHeight;++_){const R=_*o-p,D=Math.max(0,R),A=Math.min(s.inHeight,c+R),M=T+_*S;for(let H=0;H<s.outWidth;++H){const j=H*i-m,G=Math.max(0,j),P=Math.min(s.inWidth,d+j);let V=v,z=0,Y=0;for(let K=D;K<A;K+=u){const J=E+K*r[1];for(let Z=G;Z<P;Z+=l){const le=J+Z*r[2],pe=n[le+$];a==="max"&&pe>V?V=pe:a==="avg"&&(z+=pe,Y++)}if(isNaN(V))break}const L=M+H*N+$;y[L]=a==="avg"?z/Y:V}}}return b}function xz(n,e,t,r,s=!1,a=!1){const o=yt(r.outShape,"int32"),i=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.top,v=r.padInfo.left,b=yt(e,t,n);for(let y=0;y<r.batchSize;++y)for(let w=0;w<r.inChannels;++w)for(let S=0;S<r.outHeight;++S){const N=S*i-m;let C=N;for(;C<0;)C+=l;const T=Math.min(r.inHeight,d+N);for(let E=0;E<r.outWidth;++E){const $=E*u-v;let _=$;for(;_<0;)_+=c;const R=Math.min(r.inWidth,p+$);let D=Number.NEGATIVE_INFINITY,A=-1;for(let M=C;M<T;M+=l){const H=M-N;for(let j=_;j<R;j+=c){const G=j-$,P=b.get(y,M,j,w);P>D&&(D=P,s?A=a?((y*r.inHeight+M)*r.inWidth+j)*r.inChannels+w:(M*r.inWidth+j)*r.inChannels+w:A=H*p+G)}}o.set(A,y,S,E,w)}}return o}function wz(n,e,t,r,s,a){const o=s.strideDepth,i=s.strideHeight,u=s.strideWidth,l=s.dilationDepth,c=s.dilationHeight,d=s.dilationWidth,p=s.effectiveFilterDepth,m=s.effectiveFilterHeight,v=s.effectiveFilterWidth,b=s.padInfo.front,y=s.padInfo.top,w=s.padInfo.left,S=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,N=yt(s.outShape,t),C=N.values,T=s.outShape[1]*s.outShape[2]*s.outShape[3]*s.outShape[4],E=s.outShape[2]*s.outShape[3]*s.outShape[4],$=s.outShape[3]*s.outShape[4],_=s.outShape[4];for(let R=0;R<s.batchSize;++R){const D=R*T,A=R*r[0];for(let M=0;M<s.inChannels;++M)for(let H=0;H<s.outDepth;++H){const j=H*o-b;let G=j;for(;G<0;)G+=l;const P=Math.min(s.inDepth,p+j),V=D+H*E;for(let z=0;z<s.outHeight;++z){const Y=z*i-y;let L=Y;for(;L<0;)L+=c;const K=Math.min(s.inHeight,m+Y),J=V+z*$;for(let Z=0;Z<s.outWidth;++Z){const le=Z*u-w;let pe=le;for(;pe<0;)pe+=d;const ge=Math.min(s.inWidth,v+le),Ce=J+Z*_;let Ie=S,$e=0,Be=0;for(let Ve=G;Ve<P;Ve+=l){const Ze=A+Ve*r[1];for(let lt=L;lt<K;lt+=c){const it=Ze+lt*r[2];for(let ot=pe;ot<ge;ot+=d){const pt=it+ot*r[3],_t=n[pt+M];if(a==="max"&&_t>Ie?Ie=_t:a==="avg"&&($e+=_t,Be++),isNaN(Ie))break}if(isNaN(Ie))break}if(isNaN(Ie))break}const Oe=Ce+M;C[Oe]=a==="avg"?$e/Math.max(Be,1):Ie}}}}return N}function Qse(n,e){const t=yt(e.outShape,"int32"),r=e.strideDepth,s=e.strideHeight,a=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=e.padInfo.front,m=e.padInfo.top,v=e.padInfo.left;for(let b=0;b<e.batchSize;++b)for(let y=0;y<e.inChannels;++y)for(let w=0;w<e.outDepth;++w){const S=w*r-p;let N=S;for(;N<0;)N+=o;const C=Math.min(e.inDepth,l+S);for(let T=0;T<e.outHeight;++T){const E=T*s-m;let $=E;for(;$<0;)$+=i;const _=Math.min(e.inHeight,c+E);for(let R=0;R<e.outWidth;++R){const D=R*a-v;let A=D;for(;A<0;)A+=u;const M=Math.min(e.inWidth,d+D);let H=Number.NEGATIVE_INFINITY,j=-1;for(let G=N;G<C;G+=o){const P=G-S;for(let V=$;V<_;V+=i){const z=V-E;for(let Y=A;Y<M;Y+=u){const L=Y-D,K=n.get(b,G,V,Y,y);K>=H&&(H=K,j=P*c*d+z*c+L)}}}t.set(j,b,w,T,R,y)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jse(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Ge(s,"avgPool");const{filterSize:a,strides:o,pad:i,dimRoundingMode:u}=r,l=1;B($r(o,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=Da(s.shape,a,o,l,i,u);let d;if(c.filterWidth===1&&c.filterHeight===1&&Et(c.inShape,c.outShape))d=Po({inputs:{x:s},backend:t});else{const p=t.data.get(s.dataId).values,m=rt(s.shape),v=mI(p,s.shape,s.dtype,m,c,"avg");d=t.makeTensorInfo(c.outShape,s.dtype,v.values)}return d}const eae={kernelName:bm,backendName:"cpu",kernelFunc:Jse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tae(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:a,strides:o,pad:i,dimRoundingMode:u,dataFormat:l}=r;Ge(s,"avgPool3d");const c=Ti(s.shape,a,o,1,i,u,l),d=t.data.get(s.dataId).values,p=wz(d,s.shape,s.dtype,rt(s.shape),c,"avg");return t.makeTensorInfo(p.shape,"float32",p.values)}const nae={kernelName:xm,backendName:"cpu",kernelFunc:tae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rae(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:a}=e,{filterSize:o,strides:i,pad:u,dimRoundingMode:l}=r;Ge([s,a],"avgPool3DGrad");const c=Ti(a.shape,o,i,1,u,l),d=c.strideDepth,p=c.strideHeight,m=c.strideWidth,v=c.filterDepth,b=c.filterHeight,y=c.filterWidth,w=c.dilationDepth,S=c.dilationHeight,N=c.dilationWidth,C=c.effectiveFilterDepth,T=c.effectiveFilterHeight,E=c.effectiveFilterWidth,$=C-1-c.padInfo.front,_=E-1-c.padInfo.left,R=T-1-c.padInfo.top,D=yt(a.shape,"float32"),A=1/(v*b*y),M=t.bufferSync(s);for(let H=0;H<c.batchSize;++H)for(let j=0;j<c.inChannels;++j)for(let G=0;G<c.inDepth;++G)for(let P=0;P<c.inHeight;++P)for(let V=0;V<c.inWidth;++V){const z=G-$,Y=P-R,L=V-_;let K=0;for(let J=0;J<C;J+=w){const Z=(z+J)/d;if(!(Z<0||Z>=c.outDepth||Math.floor(Z)!==Z))for(let le=0;le<T;le+=S){const pe=(Y+le)/p;if(!(pe<0||pe>=c.outHeight||Math.floor(pe)!==pe))for(let ge=0;ge<E;ge+=N){const Ce=(L+ge)/m;if(Ce<0||Ce>=c.outWidth||Math.floor(Ce)!==Ce)continue;const Ie=M.get(H,Z,pe,Ce,j);K+=Ie}}}D.set(K*A,H,G,P,V,j)}return t.makeTensorInfo(D.shape,D.dtype,D.values)}const sae={kernelName:x0,backendName:"cpu",kernelFunc:rae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aae(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:a}=e,o=a;Ge([s,a],"avgPoolGrad");const{filterSize:i,strides:u,pad:l}=r,c=Da(o.shape,i,u,1,l),d=c.strideHeight,p=c.strideWidth,m=c.filterHeight,v=c.filterWidth,b=c.dilationHeight,y=c.dilationWidth,w=c.effectiveFilterHeight,S=c.effectiveFilterWidth,N=S-1-c.padInfo.left,C=w-1-c.padInfo.top,T=yt(o.shape,"float32"),E=1/(m*v),$=t.data.get(s.dataId).values,_=yt(s.shape,"float32",$);for(let R=0;R<c.batchSize;++R)for(let D=0;D<c.inChannels;++D)for(let A=0;A<c.inHeight;++A)for(let M=0;M<c.inWidth;++M){const H=A-C,j=M-N;let G=0;for(let P=0;P<w;P+=b){const V=(H+P)/d;if(!(V<0||V>=c.outHeight||Math.floor(V)!==V))for(let z=0;z<S;z+=y){const Y=(j+z)/p;if(Y<0||Y>=c.outWidth||Math.floor(Y)!==Y)continue;const L=_.get(R,V,Y,D);G+=L}}T.set(G*E,R,A,M,D)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const oae={kernelName:b0,backendName:"cpu",kernelFunc:aae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iae(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,scale:a,offset:o,mean:i,variance:u}=e;B(i.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),B(o==null||i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),B(a==null||i.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ge([s,i,u,a,o],"batchNorm");let{varianceEpsilon:l}=r;l==null&&(l=.001);const c=t.data.get(s.dataId).values,d=t.data.get(i.dataId).values,p=t.data.get(u.dataId).values,m=a?t.data.get(a.dataId).values:new Float32Array([1]),v=o?t.data.get(o.dataId).values:new Float32Array([0]),b=new Float32Array(c.length),y=v.length,w=m.length,S=p.length,N=d.length;let C=0,T=0,E=0,$=0;for(let _=0;_<c.length;++_)b[_]=v[C++]+(c[_]-d[T++])*m[E++]/Math.sqrt(p[$++]+l),C>=y&&(C=0),T>=N&&(T=0),E>=w&&(E=0),$>=S&&($=0);return t.makeTensorInfo(s.shape,s.dtype,b)}const uae={kernelName:Om,backendName:"cpu",kernelFunc:iae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lae(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:a,crops:o}=r;Ge([s],"batchToSpaceND");const i=a.reduce((w,S)=>w*S),u=Pg(s.shape,a,i),l=Bg(u.length,a.length),c=zg(s.shape,a,i),d=ST(o,a.length),p=CT(c,o,a.length),m=cn({inputs:{x:s},backend:t,attrs:{shape:u}}),v=xs({inputs:{x:m},backend:t,attrs:{perm:l}}),b=cn({inputs:{x:v},backend:t,attrs:{shape:c}}),y=ac({inputs:{x:b},backend:t,attrs:{begin:d,size:p}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(b),y}const cae={kernelName:Sm,backendName:"cpu",kernelFunc:lae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hae(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:a}=e,{size:o}=r,i=t.data.get(s.dataId).values,u=t.data.get(a.dataId).values,l=cI(i,u,a.dtype,a.shape,o);return t.makeTensorInfo([o],a.dtype,l)}const dae={kernelName:w0,backendName:"cpu",kernelFunc:hae};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fae(n){const{inputs:e,backend:t}=n,{s0:r,s1:s}=e,a=t.data.get(r.dataId).values,o=t.data.get(s.dataId).values,i=mt(Array.from(a),Array.from(o));return t.makeTensorInfo([i.length],"int32",Int32Array.from(i))}const pae={kernelName:S0,backendName:"cpu",kernelFunc:fae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mae=Kt(md,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),gae={kernelName:md,backendName:"cpu",kernelFunc:mae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vae=n=>{const{x:e}=n.inputs,t=n.backend,r=new Float32Array(xe(e.shape)),s=t.data.get(e.dataId),a=s.complexTensorInfos.real,o=s.complexTensorInfos.imag,i=t.data.get(a.dataId).values,u=t.data.get(o.dataId).values;for(let l=0;l<i.length;l++){const c=i[l],d=u[l];r[l]=Math.hypot(c,d)}return t.makeOutput(r,e.shape,"float32")},yae={kernelName:Nm,backendName:"cpu",kernelFunc:vae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yh(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.data.get(r.dataId).complexTensorInfos.imag,a=t.data.get(s.dataId).values;return t.makeTensorInfo(s.shape,s.dtype,a)}const bae={kernelName:U0,backendName:"cpu",kernelFunc:Yh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zh(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r,a=Nt(s,e[0].shape)[0],o=e.map(b=>b.shape);bT(o,a);let i=Io(e.map(b=>b.shape),a);if(xe(i)===0)return t.makeTensorInfo(i,e[0].dtype,[]);const u=e.filter(b=>xe(b.shape)>0);if(u.length===1)return Po({inputs:{x:u[0]},backend:t});if(u[0].dtype==="complex64"){const b=u.map(C=>sc({inputs:{input:C},backend:t})),y=u.map(C=>Yh({inputs:{input:C},backend:t})),w=Zh({inputs:b,backend:t,attrs:{axis:a}}),S=Zh({inputs:y,backend:t,attrs:{axis:a}}),N=Ds({inputs:{real:w,imag:S},backend:t});return b.forEach(C=>t.disposeIntermediateTensorInfo(C)),y.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(S),N}const l=u.map(b=>{const w=[-1,xe(b.shape.slice(a))];return cn({inputs:{x:b},backend:t,attrs:{shape:w}})}),c=l.map(b=>({vals:t.data.get(b.dataId).values,shape:b.shape}));i=Io(l.map(b=>b.shape),1);const d=l[0].shape[0]===1,p=TB(c,i,e[0].dtype,d),m=Io(u.map(b=>b.shape),a),v=t.makeTensorInfo(m,e[0].dtype,p);return l.forEach(b=>t.disposeIntermediateTensorInfo(b)),v}const xae={kernelName:km,backendName:"cpu",kernelFunc:Zh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sz(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:a}=e,{strides:o,pad:i,dataFormat:u,dilations:l,dimRoundingMode:c}=r;Ge([s,a],"conv2d");const d=Ii(u),p=vr(s.shape,a.shape,o,l,i,c,!1,d),m=p.filterHeight,v=p.filterWidth,b=p.dilationHeight,y=p.dilationWidth,w=p.padInfo.left,S=p.padInfo.top,N=p.dataFormat==="channelsLast",C=new Gn(p.outShape,s.dtype),T=rt(s.shape),E=rt(a.shape),$=T[0],_=N?T[1]:T[2],R=N?T[2]:1,D=N?1:T[1],A=C.strides[0],M=N?C.strides[1]:C.strides[2],H=N?C.strides[2]:1,j=N?1:C.strides[1],G=t.data.get(s.dataId).values,P=t.data.get(a.dataId).values,V=C.values;for(let z=0;z<p.batchSize;++z){const Y=z*$,L=z*A;for(let K=0;K<p.outHeight;++K){const J=L+K*M,Z=K*p.strideHeight-S;for(let le=0;le<m;++le){const pe=Z+le*b;if(pe<0||pe>=p.inHeight)continue;const ge=le*E[0],Ce=Y+pe*_;for(let Ie=0;Ie<p.outWidth;++Ie){const $e=J+Ie*H,Be=Ie*p.strideWidth-w;for(let Oe=0;Oe<v;++Oe){const Ve=Be+Oe*y;if(Ve<0||Ve>=p.inWidth)continue;const Ze=ge+Oe*E[1],lt=Ce+Ve*R;let it=Ze;for(let ot=0;ot<p.inChannels;++ot){const pt=G[lt+ot*D];for(let _t=0;_t<p.outChannels;++_t)V[$e+_t*j]+=pt*P[it+_t];it+=p.outChannels}}}}}}return t.makeTensorInfo(C.shape,C.dtype,V)}const wae={kernelName:Tm,backendName:"cpu",kernelFunc:Sz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sae(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:a}=e,{strides:o,pad:i,dataFormat:u,dimRoundingMode:l,filterShape:c}=r;Ge([s,a],"conv2dBackpropFilter");const d=Ii(u),p=vr(s.shape,c,o,1,i,l,!1,d),{strideHeight:m,strideWidth:v,filterHeight:b,filterWidth:y}=p,w=p.dataFormat==="channelsLast",S=new Gn(p.filterShape,"float32"),N=p.padInfo.left,C=p.padInfo.top,T=t.data.get(s.dataId).values,E=t.data.get(a.dataId).values,$=new Gn(s.shape,s.dtype,T),_=new Gn(a.shape,a.dtype,E);for(let R=0;R<b;++R){const D=Math.max(0,Math.ceil((C-R)/m)),A=Math.min(p.outHeight,(p.inHeight+C-R)/m);for(let M=0;M<y;++M){const H=Math.max(0,Math.ceil((N-M)/v)),j=Math.min(p.outWidth,(p.inWidth+N-M)/v);for(let G=0;G<p.inChannels;++G)for(let P=0;P<p.outChannels;++P){let V=0;for(let z=0;z<p.batchSize;++z)for(let Y=D;Y<A;++Y){const L=R+Y*m-C;for(let K=H;K<j;++K){const J=M+K*v-N;w?V+=$.get(z,L,J,G)*_.get(z,Y,K,P):V+=$.get(z,G,L,J)*_.get(z,P,Y,K)}}S.set(V,R,M,G,P)}}}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const Cae={kernelName:N0,backendName:"cpu",kernelFunc:Sae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nae(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:a}=e,{inputShape:o,strides:i,pad:u,dataFormat:l,dimRoundingMode:c}=r;Ge([s,a],"conv2dBackpropInput");const d=rt(a.shape),p=rt(s.shape);let m=Ii(l);const v=vr(o,a.shape,i,1,u,c,!1,m),b=new Gn(v.inShape,"float32"),y=b.values,w=t.data.get(s.dataId).values,S=t.data.get(a.dataId).values,[N,C,T]=d,{batchSize:E,filterHeight:$,filterWidth:_,inChannels:R,inHeight:D,inWidth:A,outChannels:M,outHeight:H,outWidth:j,strideHeight:G,strideWidth:P}=v;m=v.dataFormat;const V=$-1-v.padInfo.top,z=_-1-v.padInfo.left,Y=m==="channelsLast",L=b.strides[0],K=Y?b.strides[1]:b.strides[2],J=Y?b.strides[2]:1,Z=Y?1:b.strides[1],le=p[0],pe=Y?p[1]:p[2],ge=Y?p[2]:1,Ce=Y?1:p[1];for(let Ie=0;Ie<E;++Ie)for(let $e=0;$e<R;++$e)for(let Be=0;Be<D;++Be){const Oe=Be-V,Ve=Math.max(0,Math.ceil(Oe/G)),Ze=Math.min(H,($+Oe)/G);for(let lt=0;lt<A;++lt){const it=lt-z,ot=Math.max(0,Math.ceil(it/P)),pt=Math.min(j,(_+it)/P);let _t=0;for(let en=Ve;en<Ze;++en){const Nn=en*G-Oe;for(let vn=ot;vn<pt;++vn){const qn=vn*P-it,Kn=le*Ie+pe*en+ge*vn,Bn=N*($-1-Nn)+C*(_-1-qn)+T*$e;for(let xr=0;xr<M;++xr){const Xt=w[Kn+Ce*xr],tn=S[Bn+xr];_t+=Xt*tn}}}const hn=L*Ie+K*Be+J*lt+Z*$e;y[hn]=_t}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const kae={kernelName:Im,backendName:"cpu",kernelFunc:Nae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tae(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:a}=e,{strides:o,pad:i,dilations:u}=r;Ge([s,a],"conv3d");const l=Wu(s.shape,a.shape,o,u,i),{filterDepth:c,filterHeight:d,filterWidth:p,dilationDepth:m,dilationHeight:v,dilationWidth:b,padInfo:y}=l,w=y.front,S=y.left,N=y.top,C=new Gn(l.outShape,s.dtype),T=t.data.get(s.dataId).values,E=t.data.get(a.dataId).values,$=C.values,_=rt(s.shape),R=rt(a.shape);for(let D=0;D<l.batchSize;++D){const A=D*_[0],M=D*C.strides[0];for(let H=0;H<l.outDepth;++H){const j=M+H*C.strides[1],G=H*l.strideDepth-w;for(let P=0;P<c;++P){const V=G+P*m;if(V<0||V>=l.inDepth)continue;const z=P*R[0],Y=A+V*_[1];for(let L=0;L<l.outHeight;++L){const K=j+L*C.strides[2],J=L*l.strideHeight-N;for(let Z=0;Z<d;++Z){const le=J+Z*v;if(le<0||le>=l.inHeight)continue;const pe=z+Z*R[1],ge=Y+le*_[2];for(let Ce=0;Ce<l.outWidth;++Ce){const Ie=K+Ce*l.outChannels,$e=Ce*l.strideWidth-S;for(let Be=0;Be<p;++Be){const Oe=$e+Be*b;if(Oe<0||Oe>=l.inWidth)continue;const Ve=pe+Be*R[2],Ze=ge+Oe*l.inChannels;let lt=Ve;for(let it=0;it<l.inChannels;++it){const ot=T[Ze+it];for(let pt=0;pt<l.outChannels;++pt)$[Ie+pt]+=ot*E[lt+pt];lt+=l.outChannels}}}}}}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const Iae={kernelName:Em,backendName:"cpu",kernelFunc:Tae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eae(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:a}=e,{strides:o,pad:i,filterShape:u}=r;Ge([s,a],"conv3dBackpropFilterV2");const l=rt(s.shape),c=rt(a.shape),d=Wu(s.shape,u,o,1,i),p=d.strideDepth,m=d.strideHeight,v=d.strideWidth,b=d.filterDepth,y=d.filterHeight,w=d.filterWidth,S=new Gn(d.filterShape,"float32"),N=S.values,[C,T,E,$]=S.strides,_=t.data.get(a.dataId).values,[R,D,A,M]=c,H=t.data.get(s.dataId).values,[j,G,P,V]=l,z=d.padInfo.front,Y=d.padInfo.left,L=d.padInfo.top;for(let K=0;K<b;++K){const J=Math.max(0,Math.ceil((z-K)/p)),Z=Math.min(d.outDepth,(d.inDepth+z-K)/p),le=K*C;for(let pe=0;pe<y;++pe){const ge=Math.max(0,Math.ceil((L-pe)/m)),Ce=Math.min(d.outHeight,(d.inHeight+L-pe)/m),Ie=pe*T+le;for(let $e=0;$e<w;++$e){const Be=Math.max(0,Math.ceil((Y-$e)/v)),Oe=Math.min(d.outWidth,(d.inWidth+Y-$e)/v),Ve=$e*E+Ie;for(let Ze=0;Ze<d.inChannels;++Ze){const lt=Ze*$+Ve;for(let it=0;it<d.outChannels;++it){let ot=0;for(let pt=0;pt<d.batchSize;++pt){const _t=pt*j,hn=pt*R;for(let en=J;en<Z;++en){const vn=(K+en*p-z)*G+_t,qn=en*D+hn;for(let Kn=ge;Kn<Ce;++Kn){const xr=(pe+Kn*m-L)*P+vn,Xt=Kn*A+qn;for(let tn=Be;tn<Oe;++tn){const tl=($e+tn*v-Y)*V+xr,nl=tn*M+Xt;ot+=H[tl+Ze]*_[nl+it]}}}}N[lt+it]=ot}}}}}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const _ae={kernelName:k0,backendName:"cpu",kernelFunc:Eae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rae(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:a}=e,{pad:o,strides:i,inputShape:u}=r;Ge([s],"conv3dBackpropInputV2");const l=rt(s.shape),c=rt(a.shape),d=Wu(u,a.shape,i,1,o),p=new Gn(d.inShape,"float32"),m=p.values,[v,b,y,w]=p.strides,S=t.data.get(s.dataId).values,[N,C,T,E]=l,$=t.data.get(a.dataId).values,[_,R,D,A]=c,{batchSize:M,filterDepth:H,filterHeight:j,filterWidth:G,inChannels:P,inDepth:V,inHeight:z,inWidth:Y,outChannels:L,outDepth:K,outHeight:J,outWidth:Z,strideDepth:le,strideHeight:pe,strideWidth:ge}=d,Ce=H-1-d.padInfo.front,Ie=j-1-d.padInfo.top,$e=G-1-d.padInfo.left;for(let Be=0;Be<M;++Be)for(let Oe=0;Oe<P;++Oe)for(let Ve=0;Ve<V;++Ve){const Ze=Ve-Ce,lt=Math.max(0,Math.ceil(Ze/le)),it=Math.min(K,(H+Ze)/le);for(let ot=0;ot<z;++ot){const pt=ot-Ie,_t=Math.max(0,Math.ceil(pt/pe)),hn=Math.min(J,(j+pt)/pe);for(let en=0;en<Y;++en){const Nn=en-$e,vn=Math.max(0,Math.ceil(Nn/ge)),qn=Math.min(Z,(G+Nn)/ge);let Kn=0;for(let Bn=lt;Bn<it;++Bn){const xr=Bn*le-Ze;for(let Xt=_t;Xt<hn;++Xt){const tn=Xt*pe-pt;for(let kn=vn;kn<qn;++kn){const tl=kn*ge-Nn,nl=N*Be+C*Bn+T*Xt+E*kn,xf=_*(H-1-xr)+R*(j-1-tn)+D*(G-1-tl)+A*Oe;for(let Us=0;Us<L;++Us){const io=S[nl+Us],Ws=$[xf+Us];Kn+=io*Ws}}}}m[v*Be+b*Ve+y*ot+w*en+Oe]=Kn}}}return t.makeTensorInfo(p.shape,p.dtype,p.values)}const Aae={kernelName:T0,backendName:"cpu",kernelFunc:Rae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dae=Kt(gd,n=>Math.cos(n)),$ae={kernelName:gd,backendName:"cpu",kernelFunc:Dae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oae=Kt(vd,n=>Math.cosh(n)),Fae={kernelName:vd,backendName:"cpu",kernelFunc:Oae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mae(n){const{inputs:e,backend:t,attrs:r}=n,{image:s,boxes:a,boxInd:o}=e,{cropSize:i,method:u,extrapolationValue:l}=r,[c,d,p,m]=s.shape,v=a.shape[0],[b,y]=i,w=yt([v,b,y,m],"float32"),S=t.data.get(a.dataId).values,N=t.data.get(o.dataId).values,C=t.data.get(s.dataId).values,T=rt(s.shape),E=rt(w.shape);for(let $=0;$<v;$++){const _=$*4,R=S[_],D=S[_+1],A=S[_+2],M=S[_+3],H=N[$];if(H>=c)continue;const j=b>1?(A-R)*(d-1)/(b-1):0,G=y>1?(M-D)*(p-1)/(y-1):0;for(let P=0;P<b;P++){const V=b>1?R*(d-1)+P*j:.5*(R+A)*(d-1);if(V<0||V>d-1){for(let z=0;z<y;z++)for(let Y=0;Y<m;Y++){const L=Y+z*E[2]+P*E[1]+$*E[0];w.values[L]=l}continue}if(u==="bilinear"){const z=Math.floor(V),Y=Math.ceil(V),L=V-z;for(let K=0;K<y;K++){const J=y>1?D*(p-1)+K*G:.5*(D+M)*(p-1);if(J<0||J>p-1){for(let ge=0;ge<m;ge++){const Ce=ge+K*E[2]+P*E[1]+$*E[0];w.values[Ce]=l}continue}const Z=Math.floor(J),le=Math.ceil(J),pe=J-Z;for(let ge=0;ge<m;ge++){let Ce=ge+Z*T[2]+z*T[1]+H*T[0];const Ie=C[Ce];Ce=ge+le*T[2]+z*T[1]+H*T[0];const $e=C[Ce];Ce=ge+Z*T[2]+Y*T[1]+H*T[0];const Be=C[Ce];Ce=ge+le*T[2]+Y*T[1]+H*T[0];const Oe=C[Ce],Ve=Ie+($e-Ie)*pe,Ze=Be+(Oe-Be)*pe;Ce=ge+K*E[2]+P*E[1]+$*E[0],w.values[Ce]=Ve+(Ze-Ve)*L}}}else for(let z=0;z<y;++z){const Y=y>1?D*(p-1)+z*G:.5*(D+M)*(p-1);if(Y<0||Y>p-1){for(let J=0;J<m;J++){const Z=J+z*E[2]+P*E[1]+$*E[0];w.values[Z]=l}continue}const L=Math.round(Y),K=Math.round(V);for(let J=0;J<m;J++){const Z=J+L*T[2]+K*T[1]+H*T[0],le=J+z*E[2]+P*E[1]+$*E[0];w.values[le]=C[Z]}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const Lae={kernelName:E0,backendName:"cpu",kernelFunc:Mae};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pae(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a,exclusive:o,reverse:i}=r;Ge(s,"cumprod");const u=Cn([a],s.shape.length);let l=s;u!=null&&(l=xs({inputs:{x:s},backend:t,attrs:{perm:u}}));const c=Mn(1,s.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const d=ms(l.dtype,"int32"),p=g0(xe(l.shape),d),m=t.data.get(l.dataId).values,v=l.shape[l.shape.length-1],b=i?(w,S)=>w+v-S-1:(w,S)=>w+S;for(let w=0;w<m.length;w+=v)for(let S=0;S<v;S++){const N=b(w,S);if(S===0)p[N]=o?1:m[N];else{const C=b(w,S-1);p[N]=o?m[C]*p[C]:m[N]*p[C]}}const y=t.makeTensorInfo(l.shape,d,p);if(u!=null){const w=Gu(u),S=xs({inputs:{x:y},backend:t,attrs:{perm:w}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(l),S}return y}const Bae={kernelName:I0,backendName:"cpu",kernelFunc:Pae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zae(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a,exclusive:o,reverse:i}=r;Ge(s,"cumsum");const u=Cn([a],s.shape.length);let l=s;u!=null&&(l=xs({inputs:{x:s},backend:t,attrs:{perm:u}}));const c=Mn(1,s.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const d=ms(l.dtype,"int32"),p=Rr(xe(l.shape),d),m=t.data.get(l.dataId).values,v=l.shape[l.shape.length-1],b=i?(w,S)=>w+v-S-1:(w,S)=>w+S;for(let w=0;w<m.length;w+=v)for(let S=0;S<v;S++){const N=b(w,S);if(S===0)p[N]=o?0:m[N];else{const C=b(w,S-1);p[N]=o?m[C]+p[C]:m[N]+p[C]}}const y=t.makeTensorInfo(l.shape,d,p);if(u!=null){const w=Gu(u),S=xs({inputs:{x:y},backend:t,attrs:{perm:w}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(l),S}return y}const Vae={kernelName:_m,backendName:"cpu",kernelFunc:zae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uae(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:a}=e,{size:o,binaryOutput:i}=r;if(s.shape.length===1){const u=t.data.get(s.dataId).values,l=t.data.get(a.dataId).values,c=cI(u,l,a.dtype,a.shape,o);return t.makeTensorInfo([o],a.dtype,c)}else if(s.shape.length===2){const u=t.bufferSync(s),l=t.bufferSync(a),c=CB(u,l,o,i);return t.makeTensorInfo(c.shape,a.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const Wae={kernelName:_0,backendName:"cpu",kernelFunc:Uae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gae(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockSize:a,dataFormat:o}=r;B(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const i=s.shape[0],u=s.shape[1],l=s.shape[2],c=s.shape[3],d=u*a,p=l*a,m=c/(a*a),v=t.data.get(s.dataId).values,b=new Float32Array(i*d*p*m);let y=0;for(let w=0;w<i;++w)for(let S=0;S<d;++S){const N=Math.floor(S/a),C=S%a;for(let T=0;T<p;++T){const E=Math.floor(T/a),$=T%a,_=(C*a+$)*m;for(let R=0;R<m;++R){const A=R+_+c*(E+l*(N+u*w));b[y++]=v[A]}}}return t.makeTensorInfo([i,d,p,m],s.dtype,b)}const Hae={kernelName:R0,backendName:"cpu",kernelFunc:Gae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cz(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:a}=e,{strides:o,pad:i,dilations:u,dimRoundingMode:l}=r;Ge([s,a],"depthwiseConv2DNative");const c=rt(s.shape),d=rt(a.shape);let p=u;p==null&&(p=[1,1]),B($r(o,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${p}'`);const m=vr(s.shape,a.shape,o,p,i,l,!0),{filterHeight:v,filterWidth:b,dilationHeight:y,dilationWidth:w,padInfo:S}=m,N=S.left,C=S.top,T=m.outChannels/m.inChannels,E=new Gn(m.outShape,s.dtype),$=t.data.get(s.dataId).values,_=t.data.get(a.dataId).values,R=E.values;for(let D=0;D<m.batchSize;++D){const A=D*c[0],M=D*E.strides[0];for(let H=0;H<m.outHeight;++H){const j=M+H*E.strides[1],G=H*m.strideHeight-C;for(let P=0;P<v;++P){const V=G+P*y;if(V<0||V>=m.inHeight)continue;const z=P*d[0],Y=A+V*c[1];for(let L=0;L<m.outWidth;++L){const K=j+L*E.strides[2],J=L*m.strideWidth-N;for(let Z=0;Z<b;++Z){const le=J+Z*w;if(le<0||le>=m.inWidth)continue;const pe=z+Z*d[1],ge=Y+le*m.inChannels;let Ce=K,Ie=pe;for(let $e=0;$e<m.inChannels;++$e){const Be=$[ge+$e];for(let Oe=0;Oe<T;++Oe)R[Ce+Oe]+=Be*_[Ie+Oe];Ce+=T,Ie+=T}}}}}}return t.makeTensorInfo(E.shape,E.dtype,E.values)}const jae={kernelName:Rm,backendName:"cpu",kernelFunc:Cz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qae(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:a}=e,{strides:o,dilations:i,pad:u,dimRoundingMode:l,filterShape:c}=r;Ge([s,a],"depthwiseConv2dNativeBackpropFilter");const d=vr(s.shape,c,o,i,u,l,!0),{strideHeight:p,strideWidth:m,filterHeight:v,filterWidth:b}=d,y=new Gn(d.filterShape,"float32"),w=d.padInfo.left,S=d.padInfo.top,N=d.outChannels/d.inChannels,C=t.data.get(s.dataId).values,T=new Gn(s.shape,s.dtype,C),E=t.data.get(a.dataId).values,$=new Gn(a.shape,a.dtype,E);for(let _=0;_<v;++_){const R=Math.max(0,Math.ceil((S-_)/p)),D=Math.min(d.outHeight,(d.inHeight+S-_)/p);for(let A=0;A<b;++A){const M=Math.max(0,Math.ceil((w-A)/m)),H=Math.min(d.outWidth,(d.inWidth+w-A)/m);for(let j=0;j<d.outChannels;++j){const G=Math.trunc(j/N),P=j%N;let V=0;for(let z=0;z<d.batchSize;++z)for(let Y=R;Y<D;++Y){const L=_+Y*p-S;for(let K=M;K<H;++K){const J=A+K*m-w;V+=T.get(z,L,J,G)*$.get(z,Y,K,j)}}y.set(V,_,A,G,P)}}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const Kae={kernelName:A0,backendName:"cpu",kernelFunc:qae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xae(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:a}=e,{strides:o,dilations:i,pad:u,dimRoundingMode:l,inputShape:c}=r;Ge([s,a],"depthwiseConv2DNativeBackpropInput");const d=rt(s.shape),p=rt(a.shape),m=vr(c,a.shape,o,i,u,l,!0),v=new Gn(m.inShape,"float32"),b=v.values,[y,w,S]=v.strides,N=t.data.get(s.dataId).values,[C,T,E]=d,$=t.data.get(a.dataId).values,[_,R,D]=p,{batchSize:A,filterHeight:M,filterWidth:H,inChannels:j,inHeight:G,inWidth:P,outChannels:V,outHeight:z,outWidth:Y,strideHeight:L,strideWidth:K}=m,J=M-1-m.padInfo.top,Z=H-1-m.padInfo.left,le=V/j;for(let pe=0;pe<A;++pe)for(let ge=0;ge<j;++ge)for(let Ce=0;Ce<G;++Ce){const Ie=Ce-J,$e=Math.max(0,Math.ceil(Ie/L)),Be=Math.min(z,(M+Ie)/L);for(let Oe=0;Oe<P;++Oe){const Ve=Oe-Z,Ze=Math.max(0,Math.ceil(Ve/K)),lt=Math.min(Y,(H+Ve)/K);let it=0;for(let ot=$e;ot<Be;++ot){const pt=ot*L-Ie;for(let _t=Ze;_t<lt;++_t){const hn=_t*K-Ve,en=C*pe+T*ot+E*_t,Nn=_*(M-1-pt)+R*(H-1-hn)+D*ge;for(let vn=0;vn<le;++vn){const qn=ge*le+vn,Kn=N[en+qn],Bn=$[Nn+vn];it+=Kn*Bn}}}b[y*pe+w*Ce+S*Oe+ge]=it}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const Yae={kernelName:D0,backendName:"cpu",kernelFunc:Xae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zae(n){const{inputs:e,backend:t}=n,{x:r}=e,s=xe(r.shape),a=t.data.get(r.dataId).values,o=yt([s,s],r.dtype),i=o.values;for(let l=0;l<a.length;l++)i[l*s+l]=a[l];const u=[...r.shape,...r.shape];return t.makeTensorInfo(u,o.dtype,o.values)}const Qae={kernelName:$0,backendName:"cpu",kernelFunc:Zae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jae={kernelName:Am,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s}=n,{strides:a,pad:o,dilations:i}=t,u=e,l=u.data.get(r.dataId).values,c=r.shape.length,d=u.data.get(s.dataId).values,p=s.shape.length,{batchSize:m,inHeight:v,inWidth:b,inChannels:y,outHeight:w,outWidth:S,padInfo:N,strideHeight:C,strideWidth:T,filterHeight:E,filterWidth:$,dilationHeight:_,dilationWidth:R,outShape:D}=xg(r.shape,s.shape,a,o,"NHWC",i),A=xe(D),M=D.length,H=En(r.dtype,A);for(let G=0;G<m;++G)for(let P=0;P<w;++P){const V=P*C-N.top;for(let z=0;z<S;++z){const Y=z*T-N.left;for(let L=0;L<y;++L){let K=Number.MIN_SAFE_INTEGER;for(let Z=0;Z<E;++Z){const le=V+Z*_;if(le>=0&&le<v)for(let pe=0;pe<$;++pe){const ge=Y+pe*R;if(ge>=0&&ge<b){const Ce=qa([G,le,ge,L],c,rt(r.shape)),Ie=qa([Z,pe,L],p,rt(s.shape)),$e=l[Ce]+d[Ie];$e>K&&(K=$e)}}}const J=qa([G,P,z,L],M,rt(D));H[J]=K}}}return{dataId:u.write(Vu(H,r.dtype),D,r.dtype),shape:D,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eoe={kernelName:yb,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s,dy:a}=n,{strides:o,pad:i,dilations:u}=t,l=e,c=oa(r.shape,l.data.get(r.dataId).values),d=oa(s.shape,l.data.get(s.dataId).values),{batchSize:p,inHeight:m,inWidth:v,inChannels:b,outHeight:y,outWidth:w,padInfo:S,strideHeight:N,strideWidth:C,filterHeight:T,filterWidth:E,dilationHeight:$,dilationWidth:_,outShape:R}=xg(r.shape,s.shape,o,i,"NHWC",u);B(a.rank===R.length,()=>`Error in ${yb}, dy must have the same rank as output ${R.length}, but got ${a.rank}`);const D=oa(R,l.data.get(a.dataId).values),A=zN(s.shape,s.dtype);for(let H=0;H<p;++H)for(let j=0;j<y;++j){const G=j*N-S.top;for(let P=0;P<w;++P){const V=P*C-S.left;for(let z=0;z<b;++z){let Y=Number.MIN_SAFE_INTEGER,L=0,K=0;for(let J=0;J<T;++J){const Z=G+J*$;if(Z>=0&&Z<m)for(let le=0;le<E;++le){const pe=V+le*_;if(pe>=0&&pe<v){const ge=c[H][Z][pe][z]+d[J][le][z];ge>Y&&(Y=ge,L=J,K=le)}}}A[L][K][z]+=D[H][j][P][z]}}}return{dataId:l.write(Vu(A,r.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const toe={kernelName:vb,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s,dy:a}=n,{strides:o,pad:i,dilations:u}=t,l=e,c=oa(r.shape,l.data.get(r.dataId).values),d=oa(s.shape,l.data.get(s.dataId).values),{batchSize:p,inHeight:m,inWidth:v,inChannels:b,outHeight:y,outWidth:w,padInfo:S,strideHeight:N,strideWidth:C,filterHeight:T,filterWidth:E,dilationHeight:$,dilationWidth:_,outShape:R}=xg(r.shape,s.shape,o,i,"NHWC",u);B(a.rank===R.length,()=>`Error in ${vb}, dy must have the same rank as output ${R.length}, but got ${a.rank}`);const D=oa(R,l.data.get(a.dataId).values),A=zN(r.shape,r.dtype);for(let H=0;H<p;++H)for(let j=0;j<y;++j){const G=j*N-S.top;for(let P=0;P<w;++P){const V=P*C-S.left;for(let z=0;z<b;++z){let Y=Number.MIN_SAFE_INTEGER,L=G<0?0:G,K=V<0?0:V;for(let J=0;J<T;++J){const Z=G+J*$;if(Z>=0&&Z<m)for(let le=0;le<E;++le){const pe=V+le*_;if(pe>=0&&pe<v){const ge=c[H][Z][pe][z]+d[J][le][z];ge>Y&&(Y=ge,L=Z,K=pe)}}}A[H][L][K][z]+=D[H][j][P][z]}}}return{dataId:l.write(Vu(A,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function noe(n){const{inputs:e,backend:t,attrs:r}=n,{image:s}=e,{canvas:a,options:o}=r,{contextOptions:i,imageOptions:u}=o||{},l=(u==null?void 0:u.alpha)||1,c=(i==null?void 0:i.contextType)||"2d";if(c!=="2d")throw new Error(`Context type ${i.contextType} is not supported by the CPU backend.`);const d=a.getContext(c,(i==null?void 0:i.contextAttributes)||{});if(d==null)throw new Error(`Could not get the context with ${c} type.`);const[p,m]=s.shape.slice(0,2),v=s.shape.length===2?1:s.shape[2],b=t.data.get(s.dataId).values,y=s.dtype==="float32"?255:1,w=new Uint8ClampedArray(m*p*4);for(let N=0;N<p*m;++N){const C=[0,0,0,255*l];for(let E=0;E<v;E++){const $=b[N*v+E];if(s.dtype==="float32"){if($<0||$>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${$}.`)}else if(s.dtype==="int32"&&($<0||$>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${$}.`);v===1?(C[0]=$*y,C[1]=$*y,C[2]=$*y):C[E]=$*y}const T=N*4;w[T+0]=Math.round(C[0]),w[T+1]=Math.round(C[1]),w[T+2]=Math.round(C[2]),w[T+3]=Math.round(C[3])}a.width=m,a.height=p;const S=new ImageData(w,m,p);return d.putImageData(S,0,0),s}const roe={kernelName:O0,backendName:"cpu",kernelFunc:noe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xg(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a,keepDims:o}=r;Ge(s,"sum");let i;s.dtype==="bool"?i=Pu({inputs:{x:s},backend:t,attrs:{dtype:"int32"}}):i=Po({inputs:{x:s},backend:t});const u=i.shape.length,l=Nt(a,i.shape),c=Cn(l,u);let d=l,p=i;c!=null&&(p=xs({inputs:{x:i},backend:t,attrs:{perm:c}}),d=Mn(d.length,u)),Or("sum",d,p.shape.length);const[m,v]=yr(p.shape,d),b=ms(p.dtype,"int32");let y=Fb(t,m,b);const w=xe(v),S=t.data.get(y.dataId).values,N=t.data.get(p.dataId).values;for(let C=0;C<S.length;++C){const T=C*w;let E=0;for(let $=0;$<w;++$)E+=N[T+$];S[C]=E}if(o){const C=Fn(y.shape,l),T=y;y=cn({inputs:{x:y},backend:t,attrs:{shape:C}}),t.disposeIntermediateTensorInfo(T)}return t.disposeIntermediateTensorInfo(i),c!=null&&t.disposeIntermediateTensorInfo(p),y}const soe={kernelName:cg,backendName:"cpu",kernelFunc:Xg};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aoe(n){const{inputs:e,backend:t,attrs:r}=n,{equation:s}=r,a=e,{allDims:o,summedDims:i,idDims:u}=AT(s,a.length);$T(o.length,u,a);const{path:l,steps:c}=OT(i,u),d=c.length;let p=null,m=o.length;const v=[];for(let b=0;b<d;++b){for(const y of c[b]){const{permutationIndices:w,expandDims:S}=DT(m,u[y]);let N;FT(w)?N=a[y]:(N=xs({inputs:{x:a[y]},backend:t,attrs:{perm:w}}),v.push(N));const C=N.shape.slice();for(let T=0;T<S.length;++T)C.splice(S[T],0,1);Et(N.shape,C)||(N=cn({inputs:{x:N},backend:t,attrs:{shape:C}}),v.push(N)),p===null?p=N:(p=C1({inputs:{a:N,b:p},backend:t}),v.push(p))}b<d-1&&(l[b]>=0&&(p=Xg({inputs:{x:p},backend:t,attrs:{axis:l[b]-(o.length-m),keepDims:!1}}),v.push(p)),m--)}for(const b of v)b!==p&&t.disposeIntermediateTensorInfo(b);return p}const ooe={kernelName:F0,backendName:"cpu",kernelFunc:aoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ioe(n){const{inputs:e,backend:t}=n,{dy:r,y:s}=e;Ge([r,s],"eluGrad");const a=new Float32Array(xe(s.shape)),o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values;for(let u=0;u<o.length;++u){const l=o[u];l>=0?a[u]=i[u]:a[u]=i[u]*(l+1)}return t.makeTensorInfo(s.shape,"float32",a)}const uoe={kernelName:M0,backendName:"cpu",kernelFunc:ioe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const loe=NT,coe=kT,hoe=TT,doe=IT,foe=ET,poe=_T,moe=Kt(xd,n=>{const e=Math.sign(n),t=Math.abs(n),r=1/(1+loe*t);return e*(1-((((poe*r+foe)*r+doe)*r+hoe)*r+coe)*r*Math.exp(-t*t))}),goe={kernelName:xd,backendName:"cpu",kernelFunc:moe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pb(n){const{inputs:e,backend:t,attrs:r}=n,{input:s}=e,{dim:a}=r,o=s.shape.length,i=s.shape.slice();let u=a;return a<0&&(B(-(o+1)<=a,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),u=o+a+1),i.splice(u,0,1),cn({inputs:{x:s},backend:t,attrs:{shape:i}})}const voe={kernelName:$m,backendName:"cpu",kernelFunc:Pb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yoe=Pn((n,e)=>n/e),gI=rr(yd,yoe),tN={kernelName:yd,backendName:"cpu",kernelFunc:gI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nz(n,e,t){const r=n.shape,s=r[0],a=r[1],o=t.data.get(n.dataId),i=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,l=[s,a],c=xe(l),d=fr("float32",c),p=fr("float32",c);for(let y=0;y<s;y++){const w=ac({inputs:{x:i},backend:t,attrs:{begin:[y,0],size:[1,a]}}),S=ac({inputs:{x:u},backend:t,attrs:{begin:[y,0],size:[1,a]}}),N=Ds({inputs:{real:w,imag:S},backend:t}),{real:C,imag:T}=boe(N,e,t),E=Si(C,T);for(let $=0;$<a;$++){const _=RT(E,$);d[y*a+$]=_.real,p[y*a+$]=_.imag}t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(S),t.disposeIntermediateTensorInfo(N)}const m=t.makeTensorInfo(l,"float32",d),v=t.makeTensorInfo(l,"float32",p),b=Ds({inputs:{real:m,imag:v},backend:t});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v),b}function boe(n,e,t){const r=xe(n.shape),s=t.data.get(n.dataId),a=t.data.get(s.complexTensorInfos.real.dataId).values,o=t.data.get(s.complexTensorInfos.imag.dataId).values;if(xoe(r)){const i=nN(a,o,r,e,t),u=[n.shape[0],n.shape[1]];if(e){const l=t.makeTensorInfo(u,"float32",i.real),c=t.makeTensorInfo(u,"float32",i.imag),d=t.makeTensorInfo([],"float32",ki(r,"float32")),p=Po({inputs:{x:d},backend:t}),m=tN.kernelFunc({inputs:{a:l,b:d},backend:t}),v=tN.kernelFunc({inputs:{a:c,b:p},backend:t}),b=t.data.get(m.dataId).values,y=t.data.get(v.dataId).values;return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v),{real:b,imag:y}}return i}else{const i=Si(a,o),u=woe(i,r,e);return $4(u)}}function xoe(n){return(n&n-1)===0}function nN(n,e,t,r,s){if(t===1)return{real:n,imag:e};const a=Si(n,e),o=t/2,i=O4(a),u=i.real,l=i.imag,c=[u.length],d=s.makeTensorInfo(c,"float32",u),p=s.makeTensorInfo(c,"float32",l),m=Ds({inputs:{real:d,imag:p},backend:s}),v=F4(a),b=v.real,y=v.imag,w=[b.length],S=s.makeTensorInfo(w,"float32",b),N=s.makeTensorInfo(w,"float32",y),C=Ds({inputs:{real:S,imag:N},backend:s}),T=nN(u,l,o,r,s),E=T.real,$=T.imag,_=[E.length],R=s.makeTensorInfo(_,"float32",E),D=s.makeTensorInfo(_,"float32",$),A=Ds({inputs:{real:R,imag:D},backend:s}),M=nN(b,y,o,r,s),H=M.real,j=M.imag,G=[H.length],P=s.makeTensorInfo(G,"float32",H),V=s.makeTensorInfo(G,"float32",j),z=Ds({inputs:{real:P,imag:V},backend:s}),Y=L4(t,r),L=[Y.real.length],K=s.makeTensorInfo(L,"float32",Y.real),J=s.makeTensorInfo(L,"float32",Y.imag),Z=Ds({inputs:{real:K,imag:J},backend:s}),le=C1({inputs:{a:Z,b:z},backend:s}),pe=Xh({inputs:{a:A,b:le},backend:s}),ge=pI({inputs:{a:A,b:le},backend:s}),Ce=sc({inputs:{input:pe},backend:s}),Ie=sc({inputs:{input:ge},backend:s}),$e=Yh({inputs:{input:pe},backend:s}),Be=Yh({inputs:{input:ge},backend:s}),Oe=Zh({inputs:[Ce,Ie],backend:s,attrs:{axis:0}}),Ve=Zh({inputs:[$e,Be],backend:s,attrs:{axis:0}}),Ze=s.data.get(Oe.dataId).values,lt=s.data.get(Ve.dataId).values;return s.disposeIntermediateTensorInfo(d),s.disposeIntermediateTensorInfo(p),s.disposeIntermediateTensorInfo(m),s.disposeIntermediateTensorInfo(S),s.disposeIntermediateTensorInfo(N),s.disposeIntermediateTensorInfo(C),s.disposeIntermediateTensorInfo(R),s.disposeIntermediateTensorInfo(D),s.disposeIntermediateTensorInfo(A),s.disposeIntermediateTensorInfo(P),s.disposeIntermediateTensorInfo(V),s.disposeIntermediateTensorInfo(z),s.disposeIntermediateTensorInfo(K),s.disposeIntermediateTensorInfo(J),s.disposeIntermediateTensorInfo(Z),s.disposeIntermediateTensorInfo(le),s.disposeIntermediateTensorInfo(pe),s.disposeIntermediateTensorInfo(ge),s.disposeIntermediateTensorInfo(Ce),s.disposeIntermediateTensorInfo($e),s.disposeIntermediateTensorInfo(Ie),s.disposeIntermediateTensorInfo(Be),s.disposeIntermediateTensorInfo(Oe),s.disposeIntermediateTensorInfo(Ve),{real:Ze,imag:lt}}function woe(n,e,t){const r=new Float32Array(e*2);for(let s=0;s<e;s++){let a=0,o=0;for(let i=0;i<e;i++){const u=P4(s*i,e,t),l=RT(n,i);a+=l.real*u.real-l.imag*u.imag,o+=l.real*u.imag+l.imag*u.real}t&&(a/=e,o/=e),M4(r,a,o,s)}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Soe(n){const{inputs:e,backend:t}=n,{input:r}=e,s=xe(r.shape),a=r.shape[r.shape.length-1],o=s/a,i=cn({inputs:{x:r},backend:t,attrs:{shape:[o,a]}}),u=Nz(i,!1,t),l=cn({inputs:{x:u},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(u),l}const Coe={kernelName:L0,backendName:"cpu",kernelFunc:Soe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vI(n){const{backend:e,attrs:t}=n,{shape:r,value:s,dtype:a}=t,o=a||hc(s),i=En(o,xe(r));return koe(i,s,o),e.makeTensorInfo(r,o,i)}const Noe={kernelName:P0,backendName:"cpu",kernelFunc:vI};function koe(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Toe={kernelName:B0,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,s=t,a=fr(r.dtype,xe(r.shape)),[o,i,u,l]=r.shape,c=s.data.get(r.dataId).values;for(let p=0;p<o;p++){const m=p*u*i*l;for(let v=0;v<i;v++){const b=v*(u*l);for(let y=0;y<u;y++){const w=y*l;for(let S=0;S<l;S++){const N=Math.round(u-y-1),C=m+b+w+S;let T=c[C];if(N>=0&&N<u){const E=N*l,$=m+b+E+S;T=c[$]}a[C]=T}}}}return{dataId:s.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ioe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:a,bias:o,preluActivationWeights:i}=e,{strides:u,pad:l,dataFormat:c,dilations:d,dimRoundingMode:p,activation:m,leakyreluAlpha:v}=r;let b=Sz({inputs:{x:s,filter:a},backend:t,attrs:{strides:u,pad:l,dataFormat:c,dilations:d,dimRoundingMode:p}});if(o){const y=b;if(c==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const w=cn({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});b=Xh({inputs:{a:b,b:w},backend:t}),t.disposeIntermediateTensorInfo(w)}else b=Xh({inputs:{a:b,b:o},backend:t});t.disposeIntermediateTensorInfo(y)}if(m){const y=b;if(c==="NCHW"&&m==="prelu"&&i.shape.length===1&&i.shape[0]!==1){const w=cn({inputs:{x:i},backend:t,attrs:{shape:[i.shape[0],1,1]}});b=Lb(t,b,m,w,v),t.disposeIntermediateTensorInfo(w)}else b=Lb(t,b,m,i,v);t.disposeIntermediateTensorInfo(y)}return b}const Eoe={kernelName:Wp,backendName:"cpu",kernelFunc:Ioe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _oe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:a,bias:o,preluActivationWeights:i}=e,{strides:u,pad:l,dataFormat:c,dilations:d,dimRoundingMode:p,activation:m,leakyreluAlpha:v}=r;let b=Cz({inputs:{x:s,filter:a},backend:t,attrs:{strides:u,pad:l,dataFormat:c,dilations:d,dimRoundingMode:p}});if(o){const y=b;b=Xh({inputs:{a:b,b:o},backend:t}),t.disposeIntermediateTensorInfo(y)}if(m){const y=b;b=Lb(t,b,m,i,v),t.disposeIntermediateTensorInfo(y)}return b}const Roe={kernelName:Gp,backendName:"cpu",kernelFunc:_oe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aoe(n){const{inputs:e,backend:t}=n,{params:r,indices:s}=e,a=xe(r.shape),o=s.shape,i=o[o.length-1],[u,l,c,d]=i1(r,s);if(l===0)return t.makeTensorInfo(u,r.dtype,[]);const p=t.data.get(s.dataId).values,m=t.bufferSync(r),v=OB(p,m,r.dtype,l,i,c,d,r.shape,a);return t.makeTensorInfo(u,r.dtype,v.values)}const Doe={kernelName:z0,backendName:"cpu",kernelFunc:Aoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $oe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,indices:a}=e,{axis:o,batchDims:i}=r;Ge([s,a],"gatherV2");const u=Nt(o,s.shape)[0],l=t.data.get(a.dataId).values,c=s.shape[u];for(let C=0;C<l.length;++C){const T=l[C];B(T<=c-1&&T>=0,()=>`GatherV2: the index value ${T} is not in [0, ${c-1}]`)}let d=i;i==null&&(d=0);const p=xe(a.shape),m=LT(s,a,u,d),v=cn({inputs:{x:s},backend:t,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),b=cn({inputs:{x:a},backend:t,attrs:{shape:[m.batchSize,p/m.batchSize]}}),y=[m.batchSize,m.outerSize,p/m.batchSize,m.sliceSize],w=t.bufferSync(b),S=t.bufferSync(v),N=FB(S,w,y);return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(b),t.makeTensorInfo(m.outputShape,N.dtype,N.values)}const Ooe={kernelName:Fm,backendName:"cpu",kernelFunc:$oe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Foe(n){const{inputs:e,backend:t}=n,{input:r}=e,s=xe(r.shape),a=r.shape[r.shape.length-1],o=s/a,i=cn({inputs:{x:r},backend:t,attrs:{shape:[o,a]}}),u=Nz(i,!0,t),l=cn({inputs:{x:u},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(u),l}const Moe={kernelName:V0,backendName:"cpu",kernelFunc:Foe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Loe=Kt(Id,n=>Number.isFinite(n)?1:0,"bool"),Poe={kernelName:Id,backendName:"cpu",kernelFunc:Loe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Boe=Kt(Ed,n=>Math.abs(n)===1/0?1:0,"bool"),zoe={kernelName:Ed,backendName:"cpu",kernelFunc:Boe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Voe=Kt(_d,n=>Number.isNaN(n)?1:0,"bool"),Uoe={kernelName:_d,backendName:"cpu",kernelFunc:Voe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Woe(n){const{backend:e,attrs:t}=n,{start:r,stop:s,num:a}=t,o=zB(r,s,a);return e.makeTensorInfo([o.length],"float32",o)}const Goe={kernelName:W0,backendName:"cpu",kernelFunc:Woe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hoe=Kt(Ad,n=>Math.log1p(n)),joe={kernelName:Ad,backendName:"cpu",kernelFunc:Hoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qoe=Pn((n,e)=>n&&e),Koe=rr(zm,qoe,null,"bool"),Xoe={kernelName:zm,backendName:"cpu",kernelFunc:Koe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yoe=Kt(Vm,n=>n?0:1,"bool"),Zoe={kernelName:Vm,backendName:"cpu",kernelFunc:Yoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qoe=Pn((n,e)=>n||e),Joe=rr(Um,Qoe,null,"bool"),eie={kernelName:Um,backendName:"cpu",kernelFunc:Joe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tie(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{depthRadius:a,bias:o,alpha:i,beta:u}=r;Ge(s,"LRN");const l=s.shape[3],c=l-1,d=t.data.get(s.dataId).values,p=xe(s.shape),m=new Float32Array(p);function v(b){const y=b%l;let w=b-y+Math.max(0,y-a);const S=b-y+Math.min(y+a,c);let N=0;for(;w<=S;w++){const C=d[w];N+=C*C}return N}for(let b=0;b<p;b++){const y=v(b),w=d[b]*Math.pow(o+i*y,-u);m[b]=w}return t.makeTensorInfo(s.shape,s.dtype,m)}const nie={kernelName:Wm,backendName:"cpu",kernelFunc:tie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rie(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,y:a,dy:o}=e,{depthRadius:i,bias:u,alpha:l,beta:c}=r;Ge(o,"LRNGrad");const d=xe(o.shape),p=o.shape[3],m=t.data.get(o.dataId).values,v=t.data.get(s.dataId).values,b=t.data.get(a.dataId).values,y=new Float32Array(d),w=d;for(let S=0;S<w;S++){const N=S%p,C=S-N+Math.max(0,N-i),T=S-N+Math.min(p,N+i+1);let E=0;for(let $=C;$<T;$++)E+=Math.pow(v[$],2);E=l*E+u;for(let $=C;$<T;$++){let _=-2*l*c*v[$]*b[S]/E;S===$&&(_+=Math.pow(E,-c)),_*=m[S],y[$]+=_}}return t.makeTensorInfo(o.shape,s.dtype,y)}const sie={kernelName:G0,backendName:"cpu",kernelFunc:rie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kz(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reductionIndices:a,keepDims:o}=r,i=t;let u=s.shape;const l=u.length,c=Nt(a,u);let d=c;const p=Cn(d,l);let m=i.data.get(s.dataId).values;if(p!=null){const C=new Array(l);for(let T=0;T<C.length;T++)C[T]=u[p[T]];m=dI(m,u,s.dtype,p,C),d=Mn(d.length,l),u=C}Ge(s,"max"),Or("max",d,l);const[v,b]=yr(u,d),y=xe(b),w=UB(m,y,v,s.dtype),S=i.write(w,v,s.dtype);let N=v;return o&&(N=Fn(v,c)),{dataId:S,shape:N,dtype:s.dtype}}const aie={kernelName:Gm,backendName:"cpu",kernelFunc:kz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oie(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Ge(s,"maxPool");const{filterSize:a,strides:o,pad:i,dimRoundingMode:u}=r,l=1;B($r(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=Da(s.shape,a,o,l,i,u);let d;if(c.filterWidth===1&&c.filterHeight===1&&Et(c.inShape,c.outShape))d=Po({inputs:{x:s},backend:t});else{const p=t.data.get(s.dataId).values,m=rt(s.shape),v=mI(p,s.shape,s.dtype,m,c,"max");d=t.makeTensorInfo(c.outShape,s.dtype,v.values)}return d}const iie={kernelName:Hm,backendName:"cpu",kernelFunc:oie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uie(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:a,strides:o,pad:i,dimRoundingMode:u,dataFormat:l}=r;Ge(s,"maxPool3d");const c=Ti(s.shape,a,o,1,i,u,l),d=t.data.get(s.dataId).values,p=wz(d,s.shape,s.dtype,rt(s.shape),c,"max");return t.makeTensorInfo(p.shape,"float32",p.values)}const lie={kernelName:jm,backendName:"cpu",kernelFunc:uie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cie(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:a}=e,{filterSize:o,strides:i,pad:u,dimRoundingMode:l}=r;Ge([s,a],"maxPool3DGrad");const c=Ti(a.shape,o,i,1,u,l),d=t.bufferSync(a),p=Qse(d,c),m=c.strideDepth,v=c.strideHeight,b=c.strideWidth,y=c.dilationDepth,w=c.dilationHeight,S=c.dilationWidth,N=c.effectiveFilterDepth,C=c.effectiveFilterHeight,T=c.effectiveFilterWidth,E=N-1-c.padInfo.front,$=T-1-c.padInfo.left,_=C-1-c.padInfo.top,R=yt(a.shape,"float32"),D=t.bufferSync(s);for(let A=0;A<c.batchSize;++A)for(let M=0;M<c.inChannels;++M)for(let H=0;H<c.inDepth;++H)for(let j=0;j<c.inHeight;++j)for(let G=0;G<c.inWidth;++G){const P=H-E,V=j-_,z=G-$;let Y=0;for(let L=0;L<N;L+=y){const K=(P+L)/m;if(!(K<0||K>=c.outDepth||Math.floor(K)!==K))for(let J=0;J<C;J+=w){const Z=(V+J)/v;if(!(Z<0||Z>=c.outHeight||Math.floor(Z)!==Z))for(let le=0;le<T;le+=S){const pe=(z+le)/b;if(pe<0||pe>=c.outWidth||Math.floor(pe)!==pe)continue;const ge=N*C*T-1-p.get(A,K,Z,pe,M),Ce=L*C*T+J*T+le,Ie=ge===Ce?1:0;if(Ie===0)continue;const $e=D.get(A,K,Z,pe,M);Y+=$e*Ie}}}R.set(Y,A,H,j,G,M)}return t.makeTensorInfo(R.shape,R.dtype,R.values)}const hie={kernelName:j0,backendName:"cpu",kernelFunc:cie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function die(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:a,output:o}=e,i=a;Ge([a,o],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:d}=r,p=Da(i.shape,u,l,1,c,d),m=t.data.get(i.dataId).values,v=yt(p.outShape,i.dtype,xz(m,i.shape,i.dtype,p).values),b=p.strideHeight,y=p.strideWidth,w=p.dilationHeight,S=p.dilationWidth,N=p.effectiveFilterHeight,C=p.effectiveFilterWidth,T=C-1-p.padInfo.left,E=N-1-p.padInfo.top,$=yt(i.shape,"float32"),_=t.data.get(s.dataId).values,R=yt(s.shape,"float32",_);for(let D=0;D<p.batchSize;++D)for(let A=0;A<p.inChannels;++A)for(let M=0;M<p.inHeight;++M)for(let H=0;H<p.inWidth;++H){const j=M-E,G=H-T;let P=0;for(let V=0;V<N;V+=w){const z=(j+V)/b;if(!(z<0||z>=p.outHeight||Math.floor(z)!==z))for(let Y=0;Y<C;Y+=S){const L=(G+Y)/y;if(L<0||L>=p.outWidth||Math.floor(L)!==L)continue;const K=N*C-1-v.get(D,z,L,A),J=V*C+Y,Z=K===J?1:0;if(Z===0)continue;const le=R.get(D,z,L,A);P+=le*Z}}$.set(P,D,M,H,A)}return t.makeTensorInfo($.shape,$.dtype,$.values)}const fie={kernelName:H0,backendName:"cpu",kernelFunc:die};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pie(n,e,t,r,s){const a=rt(e),o=mI(n,e,t,a,s,"max"),i=xz(n,e,t,s,!0,r);return[o.values,i.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mie={kernelName:q0,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{filterSize:s,strides:a,pad:o,includeBatchInIndex:i}=e,u=t;Ge(r,"MaxPoolWithArgmax");const l=u.data.get(r.dataId).values,c=Da(r.shape,s,a,[1,1],o),[d,p]=pie(l,r.shape,r.dtype,i,c),m=u.write(d,c.outShape,r.dtype),v=u.write(p,c.outShape,r.dtype);return[{dataId:m,shape:c.outShape,dtype:r.dtype},{dataId:v,shape:c.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gie(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a,keepDims:o}=r,i=Nt(a,s.shape),l=yr(s.shape,i)[1],c=xe(l),d=[],p=t.makeTensorInfo([],"float32",new Float32Array([c]));d.push(p);const m=Pu({inputs:{x:s},backend:t,attrs:{dtype:"float32"}});d.push(m);const v=gI({inputs:{a:m,b:p},backend:t});d.push(v);const b=Xg({inputs:{x:v},backend:t,attrs:{axis:a,keepDims:o}});return d.forEach(y=>t.disposeIntermediateTensorInfo(y)),b}const vie={kernelName:qm,backendName:"cpu",kernelFunc:gie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yie(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a,keepDims:o}=r;Ge(s,"min");const i=Nt(a,s.shape);let u=i;const l=Cn(u,s.shape.length);let c=s;l!=null&&(c=xs({inputs:{x:s},backend:t,attrs:{perm:l}}),u=Mn(u.length,s.shape.length)),Or("min",u,c.shape.length);const[d,p]=yr(c.shape,u),m=xe(p),v=Rr(xe(d),c.dtype),b=t.data.get(c.dataId).values;for(let w=0;w<v.length;++w){const S=w*m;let N=b[S];for(let C=0;C<m;++C){const T=b[S+C];(Number.isNaN(T)||T<N)&&(N=T)}v[w]=N}l!=null&&t.disposeIntermediateTensorInfo(c);const y=t.makeTensorInfo(d,c.dtype,v);if(o){const w=Fn(d,i),S=cn({inputs:{x:y},backend:t,attrs:{shape:w}});return t.disposeIntermediateTensorInfo(y),S}return y}const bie={kernelName:Km,backendName:"cpu",kernelFunc:yie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xie(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:a,mode:o}=r;Ge(s,"mirrorPad");const i=a.map((N,C)=>N[0]+s.shape[C]+N[1]),u=a.map(N=>N[0]),l=a.map((N,C)=>N[0]+s.shape[C]),c=o==="reflect"?0:1,d=t.data.get(s.dataId).values,p=s.shape.length,m=rt(s.shape),v=xe(i),b=i.length,y=rt(i),w=fr(s.dtype,v);for(let N=0;N<v;N++){let C=dc(N,b,y);for(let E=0;E<b;E++)C[E]<u[E]?C[E]=u[E]*2-C[E]-c:C[E]>=l[E]&&(C[E]=(l[E]-1)*2-C[E]+c);C=C.map((E,$)=>E-u[$]);const T=qa(C,p,m);w[N]=d[T]}return{dataId:t.write(w,i,s.dtype),shape:i,dtype:s.dtype}}const wie={kernelName:Xm,backendName:"cpu",kernelFunc:xie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sie=Pn((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),Cie=rr(Od,Sie),Nie={kernelName:Od,backendName:"cpu",kernelFunc:Cie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tz(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{dim:a}=r,o=s.shape.length;let i=a;if(i===-1&&(i=o-1),i!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${i}`);const u=Nt([i],s.shape),l=kz({inputs:{x:s},backend:t,attrs:{reductionIndices:u,keepDims:!1}}),c=Fn(l.shape,u),d=cn({inputs:{x:l},backend:t,attrs:{shape:c}}),p=pI({inputs:{a:s,b:d},backend:t}),m=RB({inputs:{x:p},backend:t}),v=Xg({inputs:{x:m},backend:t,attrs:{axis:u,keepDims:!1}}),b=cn({inputs:{x:v},backend:t,attrs:{shape:c}}),y=gI({inputs:{a:m,b},backend:t});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(b),y}const kie={kernelName:fg,backendName:"cpu",kernelFunc:Tz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tie(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{numSamples:a,seed:o,normalized:i}=r;Ge(s,"multinomial");const u=i?s:Tz({inputs:{logits:s},backend:t,attrs:{dim:-1}}),l=u.shape[0],c=u.shape[1],d=t.data.get(u.dataId).values,p=[l,a],m=Rr(xe(p),"int32");for(let v=0;v<l;++v){const b=v*c,y=new Float32Array(c-1);y[0]=d[b];for(let N=1;N<y.length;++N)y[N]=y[N-1]+d[b+N];const w=Mx.alea(o.toString()),S=v*a;for(let N=0;N<a;++N){const C=w();m[S+N]=y.length;for(let T=0;T<y.length;T++)if(C<y[T]){m[S+N]=T;break}}}return i||t.disposeIntermediateTensorInfo(u),t.makeTensorInfo(p,"int32",m)}const Iie={kernelName:K0,backendName:"cpu",kernelFunc:Tie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eie=r1;function _ie(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:a}=e,{maxOutputSize:o,iouThreshold:i,scoreThreshold:u}=r;Ge(s,"NonMaxSuppression");const l=t.data.get(s.dataId).values,c=t.data.get(a.dataId).values,{selectedIndices:d}=Eie(l,c,o,i,u);return t.makeTensorInfo([d.length],"int32",new Int32Array(d))}const Rie={kernelName:X0,backendName:"cpu",kernelFunc:_ie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aie=s1;function Die(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:a}=e,{maxOutputSize:o,iouThreshold:i,scoreThreshold:u,padToMaxOutputSize:l}=r;Ge(s,"NonMaxSuppressionPadded");const c=t.data.get(s.dataId).values,d=t.data.get(a.dataId).values,{selectedIndices:p,validOutputs:m}=Aie(c,d,o,i,u,l);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([m]))]}const $ie={kernelName:Y0,backendName:"cpu",kernelFunc:Die};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oie=a1;function Fie(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:a}=e,{maxOutputSize:o,iouThreshold:i,scoreThreshold:u,softNmsSigma:l}=r;Ge(s,"NonMaxSuppressionWithScore");const c=t.data.get(s.dataId).values,d=t.data.get(a.dataId).values,p=o,m=i,v=u,b=l,{selectedIndices:y,selectedScores:w}=Oie(c,d,p,m,v,b);return[t.makeTensorInfo([y.length],"int32",new Int32Array(y)),t.makeTensorInfo([w.length],"float32",new Float32Array(w))]}const Mie={kernelName:Z0,backendName:"cpu",kernelFunc:Fie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lie(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s}=e,{dtype:a,depth:o,onValue:i,offValue:u}=r;Ge(s,"oneHot");const l=xe(s.shape),c=new Float32Array(l*o);c.fill(u);const d=t.data.get(s.dataId).values;for(let p=0;p<l;++p)d[p]>=0&&d[p]<o&&(c[p*o+d[p]]=i);return t.makeTensorInfo([...s.shape,o],a,c)}const Pie={kernelName:Jm,backendName:"cpu",kernelFunc:Lie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bb(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){const s=sc({inputs:{input:r},backend:t}),a=Bb({inputs:{x:s},backend:t}),o=Yh({inputs:{input:r},backend:t}),i=Bb({inputs:{x:o},backend:t}),u=Ds({inputs:{real:a,imag:i},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),u}else return vI({backend:t,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const Bie={kernelName:vg,backendName:"cpu",kernelFunc:Bb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iz(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){const s=sc({inputs:{input:r},backend:t}),a=Iz({inputs:{x:s},backend:t}),o=Yh({inputs:{input:r},backend:t}),i=Bb({inputs:{x:o},backend:t}),u=Ds({inputs:{real:a,imag:i},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),u}else return vI({backend:t,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}const zie={kernelName:Qm,backendName:"cpu",kernelFunc:Iz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ez(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r;if(e.length===1)return Pb({inputs:{input:e[0]},backend:t,attrs:{dim:s}});const a=e[0].shape,o=e[0].dtype;e.forEach(c=>{Dr(a,c.shape,"All tensors passed to stack must have matching shapes"),B(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const i=[],u=e.map(c=>{const d=Pb({inputs:{input:c},backend:t,attrs:{dim:s}});return i.push(d),d}),l=Zh({inputs:u,backend:t,attrs:{axis:s}});return i.forEach(c=>t.disposeIntermediateTensorInfo(c)),l}const Vie={kernelName:eg,backendName:"cpu",kernelFunc:Ez};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uie(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:a,constantValue:o}=r;Ge(s,"pad");const i=a.map((S,N)=>S[0]+s.shape[N]+S[1]),u=a.map(S=>S[0]),l=t.data.get(s.dataId).values,c=xe(s.shape),d=s.shape.length,p=rt(s.shape),m=xe(i),v=i.length,b=rt(i),y=fr(s.dtype,m);o!==0&&y.fill(o);for(let S=0;S<c;S++){const C=dc(S,d,p).map((E,$)=>E+u[$]),T=qa(C,v,b);y[T]=l[S]}return{dataId:t.write(y,i,s.dtype),shape:i,dtype:s.dtype}}const _z={kernelName:tg,backendName:"cpu",kernelFunc:Uie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wie=Pn((n,e)=>Math.pow(n,e)),Gie=rr(Md,Wie),Hie={kernelName:Md,backendName:"cpu",kernelFunc:Gie};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jie(n){const{inputs:e,backend:t,attrs:r}=n,{paramsNestedSplits:s,paramsDenseValues:a,indices:o}=e,{outputRaggedRank:i}=r,u=s.map(w=>t.data.get(w.dataId).values),l=s.map(w=>w.shape),c=t.data.get(a.dataId).values,d=t.data.get(o.dataId).values,[p,m,v]=KB(u,l,c,a.shape,a.dtype,d,o.shape),b=p.map(w=>t.makeTensorInfo([w.length],"int32",w)),y=t.makeTensorInfo(v,a.dtype,m);return b.concat([y])}const qie={kernelName:Q0,backendName:"cpu",kernelFunc:jie};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kie(n){const{inputs:e,backend:t}=n,{starts:r,limits:s,deltas:a}=e,o=t.data.get(r.dataId).values,i=t.data.get(s.dataId).values,u=t.data.get(a.dataId).values,[l,c]=XB(o,r.shape,r.dtype,i,s.shape,u,a.shape),d=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([c.length],r.dtype,c);return[d,p]}const Xie={kernelName:J0,backendName:"cpu",kernelFunc:Kie};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yie(n){const{inputs:e,backend:t,attrs:r}=n,{shape:s,values:a,defaultValue:o,rowPartitionTensors:i}=e,{rowPartitionTypes:u}=r,l=t.data.get(s.dataId).values,c=t.data.get(a.dataId).values,d=t.data.get(o.dataId).values,p=i.map(y=>t.data.get(y.dataId).values),m=i.map(y=>y.shape),[v,b]=YB(l,s.shape,c,a.shape,a.dtype,d,o.shape,p,m,u);return t.makeTensorInfo(v,a.dtype,b)}const Zie={kernelName:ex,backendName:"cpu",kernelFunc:Yie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qie(n){const{backend:e,attrs:t}=n,{start:r,stop:s,dtype:a,step:o}=t,i=ZB(r,s,o,a);return e.makeTensorInfo([i.length],a,i)}const Jie={kernelName:tx,backendName:"cpu",kernelFunc:Qie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eue=Kt(Ld,n=>1/n),tue={kernelName:Ld,backendName:"cpu",kernelFunc:eue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nue(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:a,halfPixelCenters:o,size:i}=r;Ge(s,"resizeBilinear");const u=rt(s.shape),[l,c]=i,[d,p,m,v]=s.shape,b=t.data.get(s.dataId).values,y=new Float32Array(xe([d,l,c,v])),w=[a&&l>1?p-1:p,a&&c>1?m-1:m],S=[a&&l>1?l-1:l,a&&c>1?c-1:c];let N=0;const C=w[0]/S[0],T=w[1]/S[1];for(let E=0;E<d;E++)for(let $=0;$<l;$++){let _;o?_=C*($+.5)-.5:_=C*$;const R=Math.max(0,Math.floor(_)),D=_-R,A=Math.min(p-1,Math.ceil(_)),M=E*u[0]+R*u[1],H=E*u[0]+A*u[1];for(let j=0;j<c;j++){let G;o?G=T*(j+.5)-.5:G=T*j;const P=Math.max(0,Math.floor(G)),V=G-P,z=Math.min(m-1,Math.ceil(G)),Y=M+P*u[2],L=H+P*u[2],K=M+z*u[2],J=H+z*u[2];for(let Z=0;Z<v;Z++){const le=b[Y+Z],pe=b[L+Z],ge=b[K+Z],Ce=b[J+Z],Ie=le+(ge-le)*V,$e=pe+(Ce-pe)*V,Be=Ie+($e-Ie)*D;y[N++]=Be}}}return t.makeTensorInfo([d,l,c,v],"float32",y)}const rue={kernelName:og,backendName:"cpu",kernelFunc:nue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sue(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:a}=e,{alignCorners:o}=r;Ge([a,s],"resizeBilinearGrad");const i=rt(s.shape),[u,l,c,d]=s.shape,[,p,m]=a.shape,v=new Float32Array(u*l*c*d),b=[o&&p>1?l-1:l,o&&m>1?c-1:c],y=[o&&p>1?p-1:p,o&&m>1?m-1:m],w=b[0]/y[0],S=b[1]/y[1],N=t.data.get(a.dataId).values;let C=0;for(let T=0;T<u;T++){const E=T*i[0];for(let $=0;$<p;$++){const _=$*w,R=Math.floor(_),D=Math.min(Math.ceil(_),l-1),A=E+R*i[1],M=E+D*i[1],H=_-R,j=1-H;for(let G=0;G<m;G++){const P=G*S,V=Math.floor(P),z=Math.min(Math.ceil(P),c-1),Y=P-V,L=1-Y,K=A+V*i[2],J=A+z*i[2],Z=M+V*i[2],le=M+z*i[2],pe=j*L,ge=j*Y,Ce=H*L,Ie=H*Y;for(let $e=0;$e<d;$e++){const Be=N[C++];v[K+$e]+=Be*pe,v[J+$e]+=Be*ge,v[Z+$e]+=Be*Ce,v[le+$e]+=Be*Ie}}}}return t.makeTensorInfo([u,c,l,d],"float32",v)}const aue={kernelName:sx,backendName:"cpu",kernelFunc:sue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oue(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:a,halfPixelCenters:o,size:i}=r;Ge(s,"resizeNearestNeighbor");const u=rt(s.shape),[l,c]=i,[d,p,m,v]=s.shape,b=t.data.get(s.dataId).values,y=new Float32Array(d*l*c*v),w=[a&&l>1?p-1:p,a&&c>1?m-1:m],S=[a&&l>1?l-1:l,a&&c>1?c-1:c],N=w[0]/S[0],C=w[1]/S[1];let T=0;for(let E=0;E<d;E++){const $=E*u[0];for(let _=0;_<l;_++){const R=o?N*(_+.5):N*_;let D=Math.min(p-1,a?Math.round(R):Math.floor(R));o&&(D=Math.max(0,D));const A=$+D*u[1];for(let M=0;M<c;M++){const H=o?C*(M+.5):C*M;let j=Math.min(m-1,a?Math.round(H):Math.floor(H));o&&(j=Math.max(0,j));const G=A+j*u[2];for(let P=0;P<v;P++){const V=b[G+P];y[T++]=V}}}}return t.makeTensorInfo([d,l,c,v],s.dtype,y)}const iue={kernelName:ag,backendName:"cpu",kernelFunc:oue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uue(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:a}=e,{alignCorners:o}=r;Ge([a,s],"resizeNearestNeighborGrad");const i=rt(s.shape),u=rt(a.shape),[l,c,d,p]=s.shape,[,m,v]=a.shape,b=new Float32Array(l*c*d*p),y=t.data.get(a.dataId).values,w=[o&&m>1?c-1:c,o&&v>1?d-1:d],S=[o&&m>1?m-1:m,o&&v>1?v-1:v],N=w[0]/S[0],C=w[1]/S[1],T=1/N,E=1/C,$=Math.ceil(T)*2+2,_=Math.ceil(E)*2+2;for(let R=0;R<l;R++){const D=R*i[0];for(let A=0;A<c;A++){const M=D+A*i[1],H=Math.floor(A*T),j=Math.floor(H-$/2);for(let G=0;G<d;G++){const P=M+G*i[2],V=Math.floor(G*E),z=Math.floor(V-_/2);for(let Y=0;Y<p;Y++){let L=0;for(let K=0;K<$;K++){const J=K+j;if(J<0||J>=m)continue;const Z=D+J*u[1],le=J*N,pe=Math.min(c-1,o?Math.round(le):Math.floor(le));if(A===pe)for(let ge=0;ge<_;ge++){const Ce=ge+z;if(Ce<0||Ce>=v)continue;const Ie=Z+Ce*u[2],$e=Ce*C,Be=Math.min(d-1,o?Math.round($e):Math.floor($e));G===Be&&(L+=y[Ie+Y])}}b[P+Y]=L}}}}return t.makeTensorInfo(s.shape,s.dtype,b)}const lue={kernelName:rx,backendName:"cpu",kernelFunc:uue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cue(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dims:a}=r;Ge(s,"reverse");const o=s.shape.length,i=Nt(a,s.shape);if(o===0)return Po({inputs:{x:s},backend:t});const u=new Gn(s.shape,s.dtype),l=t.bufferSync(s);for(let c=0;c<u.size;c++){const d=u.indexToLoc(c),p=d.slice();i.forEach(m=>p[m]=s.shape[m]-1-p[m]),u.set(l.get(...p),...d)}return t.makeTensorInfo(u.shape,u.dtype,u.values)}const hue={kernelName:ig,backendName:"cpu",kernelFunc:cue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const due={kernelName:wx,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,{radians:s,fillValue:a,center:o}=e,i=t,u=fr(r.dtype,xe(r.shape)),[l,c,d,p]=r.shape,[m,v]=wT(o,c,d),b=255,y=Math.sin(s),w=Math.cos(s),S=i.data.get(r.dataId).values;for(let C=0;C<l;C++){const T=C*d*c*p;for(let E=0;E<c;E++){const $=E*(d*p);for(let _=0;_<d;_++){const R=_*p;for(let D=0;D<p;D++){const A=[l,E,_,D],M=A[2],H=A[1];let j=(M-m)*w-(H-v)*y,G=(M-m)*y+(H-v)*w;j=Math.round(j+m),G=Math.round(G+v);let P=a;if(typeof a!="number"&&(D===3?P=b:P=a[D]),j>=0&&j<d&&G>=0&&G<c){const z=G*(d*p),Y=j*p,L=T+z+Y+D;P=S[L]}const V=T+$+R+D;u[V]=P}}}}return{dataId:i.write(u,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fue=Kt(zd,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),pue={kernelName:zd,backendName:"cpu",kernelFunc:fue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mue(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s,updates:a}=e,{shape:o}=r,{sliceRank:i,numUpdates:u,sliceSize:l,strides:c,outputSize:d}=Ku(a,s,o),p=!0,m=t.bufferSync(s),v=t.bufferSync(a),b=Ml(m,v,o,d,l,u,i,c,0,p);return t.makeTensorInfo(o,b.dtype,b.values)}const gue={kernelName:ax,backendName:"cpu",kernelFunc:mue};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vue(n,e){let t=0,r=n.length,s=0;for(;t<r;)s=Math.floor((t+r)/2),n[s]<e?t=s+1:r=s;return r}function yue(n,e){let t=0,r=n.length,s=0;for(;t<r;)s=Math.floor((t+r)/2),n[s]<=e?t=s+1:r=s;return r}function bue(n,e,t,r,s,a){const o=En("int32",t*s);for(let i=0;i<t;++i){const u=n.slice(i*r,(i+1)*r),l=i*s;for(let c=0;c<s;++c)o[l+c]=a==="left"?vue(u,e[c+l]):yue(u,e[c+l])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xue(n){const{inputs:e,backend:t,attrs:r}=n,{sortedSequence:s,values:a}=e,{side:o}=r,i=t.data.get(s.dataId).values,u=t.data.get(a.dataId).values,l=bue(i,u,s.shape[0],s.shape[1],a.shape[1],o);return t.makeTensorInfo(a.shape,"int32",l)}const wue={kernelName:ix,backendName:"cpu",kernelFunc:xue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sue(n){const{inputs:e,backend:t}=n,{condition:r,t:s,e:a}=e;Ge([r,s,a],"select");const o=r.shape.length,i=t.data.get(r.dataId).values,u=t.data.get(s.dataId).values,l=t.data.get(a.dataId).values,c=ms(s.dtype,a.dtype),d=Rr(xe(s.shape),c);let p=0;const m=o===0||o>1||s.shape.length===1?1:xe(s.shape.slice(1));for(let v=0;v<i.length;v++)for(let b=0;b<m;b++)i[v]===1?d[p++]=u[v]:d[p++]=l[v];return t.makeTensorInfo(s.shape,c,d)}const Cue={kernelName:ug,backendName:"cpu",kernelFunc:Sue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nue=c1,kue=h1,Tue=Kt(Ud,n=>n>=0?kue*n:Nue*(Math.exp(n)-1)),Iue={kernelName:Ud,backendName:"cpu",kernelFunc:Tue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eue=Kt(Hd,n=>n<0?-1:n>0?1:0),_ue={kernelName:Hd,backendName:"cpu",kernelFunc:Eue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rue=Kt(Wd,n=>Math.sin(n)),Aue={kernelName:Wd,backendName:"cpu",kernelFunc:Rue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Due=Kt(Gd,n=>Math.sinh(n)),$ue={kernelName:Gd,backendName:"cpu",kernelFunc:Due};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oue=11920928955078125e-23,nO=Math.log(Oue)+2,Fue=Kt(qd,n=>{const e=n>-nO,t=n<nO,r=Math.exp(n);let s;return t?s=r:e?s=n:s=Math.log(1+r),s}),Mue={kernelName:qd,backendName:"cpu",kernelFunc:Fue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lue(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:a,paddings:o}=r;Ge([s],"spaceToBatchND");const i=xe(a),u=[[0,0]];u.push(...o);for(let E=1+a.length;E<s.shape.length;++E)u.push([0,0]);const l=_z.kernelFunc({inputs:{x:s},backend:t,attrs:{paddings:u,constantValue:0}}),c=Pg(l.shape,a,i,!1),d=Bg(c.length,a.length,!1),p=zg(l.shape,a,i,!1),b=cn({inputs:{x:l},backend:t,attrs:{shape:c}}),S=xs({inputs:{x:b},backend:t,attrs:{perm:d}}),T=cn({inputs:{x:S},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(S),T}const Pue={kernelName:hg,backendName:"cpu",kernelFunc:Lue};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bue(n){const{inputs:e,backend:t}=n,{indices:r,values:s,denseShape:a,defaultValue:o}=e;if(a.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${a.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${s.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const i=t.data.get(r.dataId).values,u=t.data.get(s.dataId).values,l=t.data.get(a.dataId).values,c=t.data.get(o.dataId).values[0],[d,p,m,v,b]=tz(i,r.shape,r.dtype,u,s.dtype,l,c);return[t.makeTensorInfo(p,r.dtype,d),t.makeTensorInfo([p[0]],s.dtype,m),t.makeTensorInfo([v.length],"bool",new Uint8Array(v.map(y=>Number(y)))),t.makeTensorInfo([b.length],r.dtype,new Int32Array(b))]}const zue={kernelName:ux,backendName:"cpu",kernelFunc:Bue};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vue(n){const{inputs:e,backend:t}=n,{inputIndices:r,inputShape:s,newShape:a}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${s.shape}`);if(a.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${a.shape}`);const o=Array.from(t.data.get(s.dataId).values),i=t.data.get(r.dataId).values,u=Array.from(t.data.get(a.dataId).values),[l,c,d]=nz(i,r.shape,r.dtype,o,u);return[t.makeTensorInfo(c,r.dtype,l),t.makeTensorInfo([d.length],a.dtype,new Int32Array(d))]}const Uue={kernelName:lx,backendName:"cpu",kernelFunc:Vue};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wue(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:a}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${s.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${a.shape}`);if(s.shape[0]!==a.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(r.dataId).values,i=t.data.get(s.dataId).values,u=t.data.get(a.dataId).values,[l,c]=fI(o,r.shape,r.dtype,i,u,!0);return t.makeTensorInfo(c,r.dtype,l)}const Gue={kernelName:cx,backendName:"cpu",kernelFunc:Wue};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hue(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:a}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${s.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${a.shape}`);if(s.shape[0]!==a.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(r.dataId).values,i=t.data.get(s.dataId).values,u=t.data.get(a.dataId).values,[l,c]=fI(o,r.shape,r.dtype,i,u);return t.makeTensorInfo(c,r.dtype,l)}const jue={kernelName:hx,backendName:"cpu",kernelFunc:Hue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function que(n){const{inputs:e,backend:t,attrs:r}=n,{sparseIndices:s,sparseValues:a,defaultValue:o}=e,{outputShape:i}=r,{sliceRank:u,numUpdates:l,sliceSize:c,strides:d,outputSize:p}=Ku(a,s,i),m=!1,v=t.bufferSync(s);let b;switch(a.dtype){case"bool":{const y=t.bufferSync(a),w=!!t.data.get(o.dataId).values[0];b=Ml(v,y,i,p,c,l,u,d,w,m);break}case"float32":{const y=t.bufferSync(a),w=t.data.get(o.dataId).values[0];b=Ml(v,y,i,p,c,l,u,d,w,m);break}case"int32":{const y=t.bufferSync(a),w=t.data.get(o.dataId).values[0];b=Ml(v,y,i,p,c,l,u,d,w,m);break}case"string":{const y=t.bufferSync(a),w=bi(t.data.get(o.dataId).values[0]);b=Ml(v,y,i,p,c,l,u,d,w,m);break}default:throw new Error(`Unsupported type ${a.dtype}`)}return t.makeTensorInfo(i,b.dtype,b.values)}const Kue={kernelName:dx,backendName:"cpu",kernelFunc:que};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xue(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{numOrSizeSplits:a,axis:o}=r,i=Nt(o,s.shape)[0],u=MT(s,a,i),l=new Array(s.shape.length).fill(0),c=s.shape.slice();return u.map(d=>{const p=[...c];p[i]=d;const m=ac({inputs:{x:s},backend:t,attrs:{begin:l,size:p}});return l[i]+=d,m})}const Yue={kernelName:dg,backendName:"cpu",kernelFunc:Xue};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zue={kernelName:fx,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,r=e;Ge(t,"square");const s=r.data.get(t.dataId).values,a=new Float32Array(s.length);for(let i=0;i<s.length;++i){const u=s[i];a[i]=u*u}return{dataId:r.write(a,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Que=Kt(ef,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),Jue={kernelName:ef,backendName:"cpu",kernelFunc:Que};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ele(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:a,end:o,strides:i,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:d,shrinkAxisMask:p}=r;Ge(s,"stridedSlice");const{finalShapeSparse:m,finalShape:v,isIdentity:b,sliceDim0:y,isSimpleSlice:w,begin:S,end:N,strides:C}=vT(s.shape,a,o,i,u,l,c,d,p);let T;if(b)T=cn({inputs:{x:s},backend:t,attrs:{shape:v}});else if(y||w){B(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const E=pT(S,N,C),$=ac({inputs:{x:s},backend:t,attrs:{begin:S,size:E}});T=cn({inputs:{x:$},backend:t,attrs:{shape:v}}),t.disposeIntermediateTensorInfo($)}else{const E=t.bufferSync(s),$=az(m,E,C,S);T=t.makeTensorInfo(v,$.dtype,$.values)}return T}const tle={kernelName:px,backendName:"cpu",kernelFunc:ele};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nle(n){const{inputs:e,backend:t,attrs:r}=n,{separator:s,nGramWidths:a,leftPad:o,rightPad:i,padWidth:u,preserveShortSequences:l}=r,{data:c,dataSplits:d}=e,p=t.data.get(c.dataId).values,m=t.data.get(d.dataId).values,[v,b]=oz(p,m,s,a,o,i,u,l);return[t.makeTensorInfo([v.length],"string",v),t.makeTensorInfo(d.shape,"int32",b)]}const rle={kernelName:mx,backendName:"cpu",kernelFunc:nle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sle(n){const{inputs:e,backend:t,attrs:r}=n,{skipEmpty:s}=r,{input:a,delimiter:o}=e;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(a.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${a.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const i=t.data.get(a.dataId).values,u=t.data.get(o.dataId).values[0],[l,c,d]=iz(i,u,s),p=c.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",c),t.makeTensorInfo([2],"int32",new Int32Array(d))]}const ale={kernelName:gx,backendName:"cpu",kernelFunc:sle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ole(n){const{inputs:e,backend:t,attrs:r}=n,{numBuckets:s}=r,{input:a}=e;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const o=t.data.get(a.dataId).values,i=uz(o,s);return t.makeTensorInfo(a.shape,"int32",i)}const ile={kernelName:vx,backendName:"cpu",kernelFunc:ole};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ule=Kt(Zd,n=>Math.tan(n)),lle={kernelName:Zd,backendName:"cpu",kernelFunc:ule};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cle=Kt(Qd,n=>Math.tanh(n)),hle={kernelName:Qd,backendName:"cpu",kernelFunc:cle};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dle(n){const{inputs:e,backend:t}=n,{tensor:r,indices:s,updates:a}=e,{sliceRank:o,numUpdates:i,sliceSize:u,strides:l,outputSize:c}=Ku(a,s,r.shape),d=!1,p=t.bufferSync(s),m=t.bufferSync(a),v=t.bufferSync(r),b=Ml(p,m,r.shape,c,u,i,o,l,v,d);return t.makeTensorInfo(r.shape,b.dtype,b.values)}const fle={kernelName:ox,backendName:"cpu",kernelFunc:dle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ple(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reps:a}=r;Ge(s,"tile");const o=cz(t.bufferSync(s),a);return t.makeTensorInfo(o.shape,o.dtype,o.values)}const mle={kernelName:Jd,backendName:"cpu",kernelFunc:ple};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gle(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{k:a,sorted:o}=r;Ge(s,"topk");const i=t.data.get(s.dataId).values,[u,l]=dz(i,s.shape,s.dtype,a,o);return[t.makeTensorInfo(u.shape,u.dtype,u.values),t.makeTensorInfo(l.shape,l.dtype,l.values)]}const vle={kernelName:yx,backendName:"cpu",kernelFunc:gle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yle(n){const{inputs:e,attrs:t,backend:r}=n,{image:s,transforms:a}=e,{interpolation:o,fillMode:i,fillValue:u,outputShape:l}=t,[c,d,p,m]=s.shape,[v,b]=l??[d,p],y=[c,v,b,m],w=rt(s.shape),S=w[0],N=w[1],C=w[2],T=rt(y),E=T[0],$=T[1],_=T[2],R=fr(s.dtype,xe(y));R.fill(u);const D=r.data.get(s.dataId).values,A=r.data.get(a.dataId).values;for(let H=0;H<c;++H){const j=a.shape[0]===1?A:A.subarray(H*8,H*8+8);for(let G=0;G<v;++G)for(let P=0;P<b;++P)for(let V=0;V<m;++V){let z;const Y=j[6]*P+j[7]*G+1;if(Y===0)continue;const L=(j[0]*P+j[1]*G+j[2])/Y,K=(j[3]*P+j[4]*G+j[5])/Y,J=rO(L,p,i),Z=rO(K,d,i);switch(o){case"nearest":z=Nle(D,d,p,S,N,C,H,Z,J,V,u);break;case"bilinear":z=kle(D,d,p,S,N,C,H,Z,J,V,u);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const le=H*E+G*$+P*_+V;R[le]=z}return r.makeTensorInfo(y,s.dtype,R)}return{dataId:r.write(R,y,s.dtype),shape:s.shape,dtype:s.dtype}}const ble={kernelName:bx,backendName:"cpu",kernelFunc:yle};function rO(n,e,t){switch(t){case"reflect":return xle(n,e);case"wrap":return wle(n,e);case"nearest":return Cle(n,e);case"constant":default:return Sle(n)}}function xle(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const r=2*e;t<r&&(t=r*Math.trunc(-t/r)+t),t=t<-e?t+r:-t-1}else if(t>e-1)if(e<=1)t=0;else{const r=2*e;t-=r*Math.trunc(t/r),t>=e&&(t=r-t-1)}return Iu(0,t,e-1)}function wle(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const r=e-1;t+=e*(Math.trunc(-t/r)+1)}else if(t>e-1)if(e<=1)t=0;else{const r=e-1;t-=e*Math.trunc(t/r)}return Iu(0,t,e-1)}function Sle(n,e){return n}function Cle(n,e){return Iu(0,n,e-1)}function Dp(n,e,t,r,s,a,o,i,u,l,c){const d=o*r+i*s+u*a+l;return 0<=i&&i<e&&0<=u&&u<t?n[d]:c}function Nle(n,e,t,r,s,a,o,i,u,l,c){const d=Math.round(i),p=Math.round(u);return Dp(n,e,t,r,s,a,o,d,p,l,c)}function kle(n,e,t,r,s,a,o,i,u,l,c){const d=Math.floor(i),p=Math.floor(u),m=d+1,v=p+1,b=(v-u)*Dp(n,e,t,r,s,a,o,d,p,l,c)+(u-p)*Dp(n,e,t,r,s,a,o,d,v,l,c),y=(v-u)*Dp(n,e,t,r,s,a,o,m,p,l,c)+(u-p)*Dp(n,e,t,r,s,a,o,m,v,l,c);return(m-i)*b+(i-d)*y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tle(n){const{inputs:e,attrs:t,backend:r}=n,{axis:s}=t,{x:a}=e;Ge(a,"unique");const o=r.data.get(a.dataId).values,{outputValues:i,outputShape:u,indices:l}=fz(o,s,a.shape,a.dtype);return[r.makeTensorInfo(u,a.dtype,i),r.makeTensorInfo([l.length],"int32",l)]}const Ile={kernelName:xx,backendName:"cpu",kernelFunc:Tle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ele(n){const{inputs:e,backend:t,attrs:r}=n,{value:s}=e;let{axis:a}=r;a<0&&(a+=s.shape.length);const o=s.shape.length,i=s.shape[a],u=new Array(o-1);let l=0;for(let m=0;m<o;m++)m!==a&&(u[l++]=s.shape[m]);const c=new Array(o).fill(0),d=s.shape.slice();d[a]=1;const p=new Array(i);for(let m=0;m<p.length;m++){c[a]=m;const v=ac({inputs:{x:s},backend:t,attrs:{begin:c,size:d}});p[m]=cn({inputs:{x:v},backend:t,attrs:{shape:u}}),t.disposeIntermediateTensorInfo(v)}return p}const _le={kernelName:mg,backendName:"cpu",kernelFunc:Ele};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rle(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,segmentIds:a}=e,{numSegments:o}=r;Ge(s,"unsortedSegmentSum");const i=s.shape.length,u=a.shape.length,l=[],c=[],d=i-u;let p=a;for(let v=0;v<d;++v){const b=Pb({inputs:{input:p},backend:t,attrs:{dim:v+1}});p=b,c.push(b)}for(let v=0;v<o;++v){const b=ki(v,"int32"),y=t.makeTensorInfo([],"int32",b),w=EB({inputs:{a:y,b:p},backend:t}),S=Pu({inputs:{x:w},backend:t,attrs:{dtype:"float32"}}),N=C1({inputs:{a:S,b:s},backend:t}),C=Xg({inputs:{x:N},backend:t,attrs:{axis:0,keepDims:!1}});l.push(C),c.push(y),c.push(w),c.push(S),c.push(N),c.push(C)}const m=Ez({inputs:l,backend:t,attrs:{axis:0}});return c.forEach(v=>t.disposeIntermediateTensorInfo(v)),m}const Ale={kernelName:gg,backendName:"cpu",kernelFunc:Rle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dle=[Tse,ore,Ese,Rse,dre,Dse,Ose,Mse,Pse,zse,Use,Gse,jse,Xse,Zse,eae,nae,sae,oae,Nse,uae,cae,dae,pre,pae,cre,gre,gae,ire,yae,xae,wae,Cae,kae,Iae,_ae,Aae,$ae,Fae,Lae,Bae,Vae,Wae,Hae,jae,Kae,Yae,Qae,Jae,eoe,toe,roe,ooe,vse,uoe,vre,goe,yre,voe,xre,Coe,Noe,Toe,Sre,Nre,Eoe,Roe,Doe,Ooe,Tre,Ere,ure,Moe,bae,Poe,zoe,Uoe,yse,Rre,Dre,Goe,Ore,joe,Xoe,Zoe,eie,nie,sie,aie,Mre,iie,lie,hie,fie,mie,vie,bie,Pre,wie,Nie,Iie,zre,Ure,Rie,$ie,Mie,Gre,Pie,zie,Vie,_z,Hie,xse,qre,qie,Xie,Zie,Jie,lre,tN,tue,wse,Sse,Cse,rue,aue,iue,lue,hue,due,pue,tse,gue,wue,Cue,Iue,rse,_ue,Aue,$ue,sse,kie,Mue,Pue,zue,Uue,Gue,jue,Kue,Yue,ise,Zue,lse,hse,Jue,tle,rle,ale,ile,mse,soe,lle,hle,fle,mle,vle,ble,Hre,Ile,_le,Ale,Bie];for(const n of Dle)Sx(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $l={},Dy={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function $le(n,e){$l[n]=e}function eo(n,e){if(!(n in $l)||e!=null){const r=Fle(n,e);if(r!==null)$l[n]=r;else return console.log("Could not get context for WebGL version",n),null}const t=$l[n];return t==null||t.isContextLost()?(delete $l[n],eo(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),$l[n])}function Ole(n){if(!de().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Fle(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??Ole(n);return t.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete $l[n]},!1),de().getBool("SOFTWARE_WEBGL_ENABLED")&&(Dy.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",Dy)||t.getContext("experimental-webgl",Dy):t.getContext("webgl2",Dy)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var rm;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(rm||(rm={}));var na;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(na||(na={}));var Ir;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Ir||(Ir={}));function Yg(n,e){return[e,n]}function Mle(n,e){return n*e}function $y(n){const e=xe(n),t=Math.ceil(e/4);return pb(t)}function cf(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function Lle(n,e){const[t,r]=cf(n,e);return t*r*4}function yI(n,e){const t=n;let r,s,a,o,i,u,l,c,d,p;return de().getNumber("WEBGL_VERSION")===2?(r=t.R32F,s=t.R16F,a=t.RGBA16F,o=t.RGBA32F,i=t.RED,l=4,c=1,d=t.HALF_FLOAT,p=t.FLOAT,u=t.RGBA8):(r=n.RGBA,s=n.RGBA,a=n.RGBA,o=t.RGBA,i=n.RGBA,l=4,c=4,d=e!=null?e.HALF_FLOAT_OES:null,p=n.FLOAT,u=n.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:s,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:o,textureFormatFloat:i,downloadTextureFormat:u,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:d,textureTypeFloat:p}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pe(n,e){const t=e();return de().getBool("DEBUG")&&Ple(n),t}function Ple(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+Ule(n,e))}const Ble=596e-10,zle=65504;function Vle(n){return!!(de().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||Ble<Math.abs(n)&&Math.abs(n)<zle)}function Ule(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Oy(n,e){return Di(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function Wle(n,e){const t=Di(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Pe(n,()=>n.shaderSource(t,e)),Pe(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function Gle(n,e){const t=Di(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Pe(n,()=>n.shaderSource(t,e)),Pe(n,()=>n.compileShader(t)),de().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw Rz(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const Hle=/ERROR: [0-9]+:([0-9]+):/g;function Rz(n,e){const t=Hle.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const r=+t[1],s=n.split(`
`),a=s.length.toString().length+2,o=s.map((d,p)=>zl((p+1).toString(),a)+d);let i=0;for(let d=0;d<o.length;d++)i=Math.max(o[d].length,i);const u=o.slice(0,r-1),l=o.slice(r-1,r),c=o.slice(r);console.log(u.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${zl(l[0],i)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function jle(n){return Di(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function qle(n,e){if(Pe(n,()=>n.linkProgram(e)),!de().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function IS(n,e){if(Pe(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function Kle(n,e){const t=Di(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Pe(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Pe(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function Xle(n,e){const t=Di(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Pe(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Pe(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function Yle(n){return Di(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function Zle(n,e){const t=de().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const r=`[${n}x${e}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t){const r=`[${n}x${e}]`,s=`[${t}x${t}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+s+".")}}function Qle(n){return Di(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function sO(n,e,t,r,s,a,o){const i=n.getAttribLocation(e,t);return i===-1?!1:(Pe(n,()=>n.bindBuffer(n.ARRAY_BUFFER,r)),Pe(n,()=>n.vertexAttribPointer(i,s,n.FLOAT,!1,a,o)),Pe(n,()=>n.enableVertexAttribArray(i)),!0)}function Jle(n,e,t){sce(n,t),Pe(n,()=>n.activeTexture(n.TEXTURE0+t)),Pe(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function ece(n,e,t){return Di(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function tce(n,e,t){return n.getUniformLocation(e,t)}function nce(n,e,t,r){Pe(n,()=>Jle(n,e,r)),Pe(n,()=>n.uniform1i(t,r))}function ES(n,e,t){Pe(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Pe(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function aO(n,e){Pe(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Pe(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function Fy(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+rce(n,e))}function rce(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Di(n,e,t){const r=Pe(n,()=>e());if(r==null)throw new Error(t);return r}function sce(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t){const s=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${s}.`)}}function Qh(n,e=2){return xe(n.slice(0,n.length-e))}function Jh(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function My(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[Qh(n),...Jh(n)]),e}function ace(n,e=!1){let t=de().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=de().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&de().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=t/2),e&&(t=t*2,r=r*2,n=n.map((i,u)=>u>=n.length-2?m0(n[u]):n[u]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Ni(n).newShape);let s=xe(n),a=null;n.length<=1&&s<=t?a=[1,s]:n.length===2&&n[0]<=t&&n[1]<=t?a=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?a=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?a=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?a=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(a=[n[0],n[1]*n[2]*n[3]]);const o=a!=null&&Math.max(...a)>r&&Math.min(...a)<=(e?2:1)&&Math.min(...a)>0;if(a==null||o)if(e){const i=Qh(n);let u=2,l=2;n.length&&([u,l]=Jh(n)),s=i*(u/2)*(l/2),a=pb(s).map(c=>c*2)}else a=pb(s);return a}function Ly(n){return n%2===0}function zb(n,e){if(n=n.slice(-2),e=e.slice(-2),Et(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],r=e[e.length-1];if(t===r||Ly(t)&&Ly(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Ly(n[0])&&Ly(e[0])}let _S,RS;function oce(n){if(_S==null){const e=eo(n);_S=e.getParameter(e.MAX_TEXTURE_SIZE)}return _S}function ice(n){if(RS==null){const e=eo(n);RS=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,RS)}function uce(n){if(n===0)return 0;let e;const t=eo(n);return Ea(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Ea(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Ea(n,e){return n.getExtension(e)!=null}function oO(n){try{if(eo(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function lce(n){if(n===0)return!1;const e=eo(n);if(n===1){if(!Ea(e,"OES_texture_float"))return!1}else if(!Ea(e,"EXT_color_buffer_float"))return!1;return rN(e)}function cce(n){if(n===0)return!1;const e=eo(n);if(n===1){if(!Ea(e,"OES_texture_float")||!Ea(e,"WEBGL_color_buffer_float"))return!1}else{if(Ea(e,"EXT_color_buffer_float"))return rN(e);const r="EXT_color_buffer_half_float";if(Ea(e,r)){const s=e.getExtension(r);return hce(e,s)}return!1}return rN(e)}function rN(n){const e=yI(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const a=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,a),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(a),o}function hce(n,e){const t=yI(n,e),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);const i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(o),i}function dce(n){return n!==2?!1:eo(n).fenceSync!=null}function Zg(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&B(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ye=de();Ye.registerFlag("HAS_WEBGL",()=>Ye.getNumber("WEBGL_VERSION")>0);Ye.registerFlag("WEBGL_VERSION",()=>oO(2)?2:oO(1)?1:0);Ye.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Ye.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ye.get("WEBGL_VERSION")===2);Ye.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Ye.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Ye.registerFlag("WEBGL_PACK",()=>Ye.getBool("HAS_WEBGL"));Ye.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ye.getBool("WEBGL_PACK"));Ye.registerFlag("WEBGL_PACK_CLIP",()=>Ye.getBool("WEBGL_PACK"));Ye.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ye.getBool("WEBGL_PACK"));Ye.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ye.getBool("WEBGL_PACK"));Ye.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ye.getBool("WEBGL_PACK"));Ye.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ye.getBool("WEBGL_PACK"));Ye.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ye.getBool("WEBGL_PACK"));Ye.registerFlag("WEBGL_PACK_REDUCE",()=>Ye.getBool("WEBGL_PACK"));Ye.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ye.getBool("WEBGL_PACK"));Ye.registerFlag("WEBGL_CONV_IM2COL",()=>Ye.getBool("WEBGL_PACK"));Ye.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ye.getBool("WEBGL_PACK"));Ye.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>oce(Ye.getNumber("WEBGL_VERSION")));Ye.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>ice(Ye.getNumber("WEBGL_VERSION")));Ye.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Ye.getNumber("WEBGL_VERSION");return n===0?0:uce(n)});Ye.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ye.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!HN());Ye.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>lce(Ye.getNumber("WEBGL_VERSION")));Ye.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ye.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ye.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Ye.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>cce(Ye.getNumber("WEBGL_VERSION")));Ye.registerFlag("WEBGL_FENCE_API_ENABLED",()=>dce(Ye.getNumber("WEBGL_VERSION")));Ye.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ye.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Ye.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Ye.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>HN()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Ye.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Ye.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Ye.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Ye.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Ye.registerFlag("WEBGL_EXP_CONV",()=>!1);Ye.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ye.getBool("IS_TEST"));Ye.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Ye.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Ye.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Ye.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ls(){let n,e,t,r,s,a,o,i,u,l;return de().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",s="texture",a="outputColor",o="out vec4 outputColor;",i=de().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",s="texture2D",a="gl_FragColor",o="",i=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:s,output:a,defineOutput:o,defineSpecialNaN:i,defineSpecialInf:u,defineRound:l}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xc(n,e,t="index"){const r=rt(e);return r.map((s,a)=>{const o=`int ${n[a]} = ${t} / ${s}`,i=a===r.length-1?`int ${n[a+1]} = ${t} - ${n[a]} * ${s}`:`index -= ${n[a]} * ${s}`;return`${o}; ${i};`}).join("")}function N1(n,e,t="index"){const r=rt(e);return r.map((s,a)=>{const o=`int ${n[a]} = ${t} / outShapeStrides[${a}]`,i=a===r.length-1?`int ${n[a+1]} = ${t} - ${n[a]} * outShapeStrides[${a}]`:`index -= ${n[a]} * outShapeStrides[${a}]`;return`${o}; ${i};`}).join("")}function fce(n,e){const t=n.length,r=n.map(a=>`${e}[${a}]`),s=new Array(t-1);s[t-2]=r[t-1];for(let a=t-3;a>=0;--a)s[a]=`(${s[a+1]} * ${r[a+1]})`;return s}function pce(n,e,t="index"){const r=n.map((a,o)=>o),s=fce(r,e);return s.map((a,o)=>{const i=`int ${n[o]} = ${t} / ${s[o]}`,u=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${s[o]}`:`index -= ${n[o]} * ${s[o]}`;return`${i}; ${u};`}).join("")}function bI(n){const e=rt(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function xI(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const Az=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:Dz}=J4;function mce(n,e,t){const r=[];if(n.forEach(m=>{const v=xe(m.shapeInfo.logicalShape);if(m.shapeInfo.isUniform?r.push(`uniform float ${m.name}${v>1?`[${v}]`:""};`):(r.push(`uniform sampler2D ${m.name};`),r.push(`uniform int offset${m.name};`)),t.enableShapeUniforms){const{uniformShape:b}=wI(t.packedInputs,m.shapeInfo.logicalShape,m.shapeInfo.texShape);switch(b.length){case 1:r.push(`uniform int ${m.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${m.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${m.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${m.name}Shape;`);break}r.push(`uniform ivec2 ${m.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(m=>{r.push(`uniform ${m.type} ${m.name}${m.arrayIndex?`[${m.arrayIndex}]`:""};`)});const s=r.join(`
`),a=n.map(m=>gce(m,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),o=e.texShape,i=ls(),u=bce(i);let l,c,d=Sce(i);return e.isPacked?(l=vce(e.logicalShape,o,t.enableShapeUniforms),c=wce(i)):(l=yce(e.logicalShape,o,t.enableShapeUniforms),c=xce(i)),t.packedInputs&&(d+=Tce),[d,u,c,s,l,a,t.userCode].join(`
`)}function hf(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return Pce(n,e);case 1:return zce(n,e);case 2:return Uce(n,e);case 3:return Gce(n,e);case 4:return jce(n,e);case 5:return qce(n);case 6:return Kce(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function $z(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return Lce(n);case 1:return Bce(n,e);case 2:return Vce(n,e);case 3:return Wce(n,e);default:return Hce(n,e)}}function gce(n,e,t=!1,r){let s="";t?s+=$z(n,r):s+=hf(n,r);const a=n.shapeInfo.logicalShape,o=e.logicalShape;return a.length<=o.length&&(t?s+=Xce(n,e):s+=Yce(n,e)),s}function vce(n,e,t){switch(n.length){case 0:return Oz();case 1:return Ice(n,e,t);case 2:return Fce(n,e,t);case 3:return _ce(n,e,t);default:return Ace(n,e,t)}}function yce(n,e,t){switch(n.length){case 0:return Oz();case 1:return Ece(n,e,t);case 2:return Mce(n,e,t);case 3:return Rce(n,e,t);case 4:return Dce(n,e,t);case 5:return $ce(n,e);case 6:return Oce(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function bce(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function xce(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function wce(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function Sce(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Cce}
    ${Nce}
    ${kce}
  `}const Cce=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Nce=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,kce=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Tce=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Oz(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Ice(n,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return r[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function Ece(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function _ce(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(n[2]/2),a=s*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${a};
      index -= b * ${a};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec3(b, r, c);
    }
  `}function Rce(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${N1(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const r=xc(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function Ace(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(n[n.length-1]/2),a=s*Math.ceil(n[n.length-2]/2);let o=a,i="",u="b, r, c";for(let l=2;l<n.length-1;l++)o*=n[n.length-l-1],i=`
      int b${l} = index / ${o};
      index -= b${l} * ${o};
    `+i,u=`b${l}, `+u;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${i}

      int b = index / ${a};
      index -= b * ${a};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec${n.length}(${u});
    }
  `}function Dce(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${N1(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const r=xc(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function $ce(n,e){const t=xc(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Oce(n,e){const t=xc(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Fce(n,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Et(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;const s=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec2(r, c);
    }
  `}function Mce(n,e,t){return Et(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function wc(n){return`offset${n}`}function Lce(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=ls();return`
    vec4 ${t}() {
      return ${r.texture2D}(${e}, halfCR);
    }
  `}function Pce(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${r}() {return ${t};}`;const[s,a]=n.shapeInfo.texShape;if(s===1&&a===1)return`
      float ${r}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const o=wc(t);if(e)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${o});
      return sampleTexture(${t}, uv);
    }
  `;const[i,u]=n.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${i}, ${u}, ${o});
      return sampleTexture(${t}, uv);
    }
  `}function Bce(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=n.shapeInfo.texShape,a=ls();if(e)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${a.texture2D}(${t}, uv);
    }
  `;const o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${a.texture2D}(${t}, uv);
    }
  `}function zce(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${df(n)}
      }
    `;const s=n.shapeInfo.texShape,a=s[0],o=s[1];if(o===1&&a===1)return`
      float ${r}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const i=wc(t);return o===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${i}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${i}) + 0.5) / ${a}.0);
        return sampleTexture(${t}, uv);
      }
    `:a===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${i}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${i}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${i});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${a}, ${o}, index + ${i});
      return sampleTexture(${t}, uv);
    }
  `}function Vce(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n.shapeInfo.texShape,o=a[0],i=a[1],u=ls();if(a!=null&&Et(t,a))return e?`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${u.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}.0, ${o}.0);

        return ${u.texture2D}(${r}, uv);
      }
    `;if(e)return`
    vec4 ${s}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `;const l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=Math.ceil(t[1]/2);return`
    vec4 ${s}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${l[0]}, ${l[1]}, row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `}function Uce(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n.shapeInfo.texShape;if(a!=null&&Et(t,a)){if(e)return`
      float ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;const p=a[0],m=a[1];return`
    float ${s}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${m}.0, ${p}.0);
      return sampleTexture(${r}, uv);
    }
  `}const{newShape:o,keptDims:i}=Ni(t),u=o;if(u.length<t.length){const p=ff(n,u),m=["row","col"];return`
      ${hf(p,e)}
      float ${s}(int row, int col) {
        return ${s}(${pf(m,i)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${df(n)}
      }
    `;const l=a[0],c=a[1],d=wc(r);return c===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${r}, uv);
    }
  `:l===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:e?`
      float ${s}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${s}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${d};
    vec2 uv = uvFromFlat(${l}, ${c}, index);
    return sampleTexture(${r}, uv);
  }
`}function Wce(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(t[0]===1){const p=t.slice(1),m=[1,2],v=ff(n,p),b=["b","row","col"];return`
        ${$z(v,e)}
        vec4 ${s}(int b, int row, int col) {
          return ${s}(${pf(b,m)});
        }
      `}const i=ls();if(e)return`
    vec4 ${s}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${i.texture2D}(${r}, uv);
    }
  `;const u=o[0],l=o[1],c=Math.ceil(t[2]/2),d=c*Math.ceil(t[1]/2);return`
    vec4 ${s}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${u}, ${l}, ${d}, ${c}, b, row, col);
      return ${i.texture2D}(${r}, uv);
    }
  `}function Gce(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),a=t[1]*t[2],o=t[2],{newShape:i,keptDims:u}=Ni(t),l=i;if(l.length<t.length){const b=ff(n,l),y=["row","col","depth"];return`
        ${hf(b,e)}
        float ${s}(int row, int col, int depth) {
          return ${s}(${pf(y,u)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${a}, ${o}, 1)));
        ${df(n)}
      }
    `;const c=n.shapeInfo.texShape,d=c[0],p=c[1],m=n.shapeInfo.flatOffset;if(p===a&&m==null)return e?`
      float ${s}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${s}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${d}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(p===o&&m==null)return e?`
      float ${s}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${d}.0);
      return sampleTexture(${r}, uv);
    }
  `;const v=wc(r);return e?`
    float ${s}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${v};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${s}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${a} + col * ${o} + depth + ${v};
        vec2 uv = uvFromFlat(${d}, ${p}, index);
        return sampleTexture(${r}, uv);
      }
  `}function Hce(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=ls();if(e)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${s.texture2D}(${t}, uv);
    }
  `;const a=n.shapeInfo.logicalShape,o=a.length,i=n.shapeInfo.texShape,u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=u[0],c=u[1],d=Math.ceil(a[o-1]/2);let p=d*Math.ceil(a[o-2]/2),m="int b, int row, int col",v=`b * ${p} + (row / 2) * ${d} + (col / 2)`;for(let b=2;b<o-1;b++)m=`int b${b}, `+m,p*=a[o-b-1],v=`b${b} * ${p} + `+v;return`
    vec4 ${r}(${m}) {
      int index = ${v};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${l});
      return ${s.texture2D}(${t}, uv);
    }
  `}function jce(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),a=t[3],o=t[2]*a,i=t[1]*o,{newShape:u,keptDims:l}=Ni(t);if(u.length<t.length){const S=ff(n,u),N=["row","col","depth","depth2"];return`
      ${hf(S,e)}
      float ${s}(int row, int col, int depth, int depth2) {
        return ${s}(${pf(N,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${i}, ${o}, ${a}, 1)));
        ${df(n)}
      }
    `;const c=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,p=d[0],m=d[1],v=`int stride2 = ${r}Shape[3];`,b=`int stride1 = ${r}Shape[2] * stride2;`,y=`int stride0 = ${r}Shape[1] * stride1;`;if(m===i&&c==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        ${v}
        ${b}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${a}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${p}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(m===a&&c==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${p}.0);
        return sampleTexture(${r}, uv);
      }
    `;const w=wc(r);return e?`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${v}
      ${b}
      ${y}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${w});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${i} + col * ${o} +
          depth * ${a} + depth2;
      vec2 uv = uvFromFlat(${p}, ${m}, index + ${w});
      return sampleTexture(${r}, uv);
    }
  `}function qce(n){const e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=e[4],a=e[3]*s,o=e[2]*a,i=e[1]*o,{newShape:u,keptDims:l}=Ni(e);if(u.length<e.length){const b=ff(n,u),y=["row","col","depth","depth2","depth3"];return`
      ${hf(b)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${pf(y,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${i}, ${o}, ${a}, ${s})) +
          depth3;
        ${df(n)}
      }
    `;const c=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,p=d[0],m=d[1];if(m===i&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${a}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(m===s&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const v=wc(t);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${i} + col * ${o} + depth * ${a} +
          depth2 * ${s} + depth3 + ${v};
      vec2 uv = uvFromFlat(${p}, ${m}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Kce(n){const e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:s,keptDims:a}=Ni(e);if(s.length<e.length){const y=ff(n,s),w=["row","col","depth","depth2","depth3","depth4"];return`
      ${hf(y)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${pf(w,a)});
      }
    `}const o=e[5],i=e[4]*o,u=e[3]*i,l=e[2]*u,c=e[1]*l;if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${l}, ${u}, ${i})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${df(n)}
      }
    `;const d=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,m=p[0],v=p[1];if(v===c&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${l}, ${u}, ${i}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${v}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(v===o&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${v}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;const b=wc(t);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${l} + depth * ${u} +
          depth2 * ${i} + depth3 * ${o} + depth4 + ${b};
      vec2 uv = uvFromFlat(${m}, ${v}, index);
      return sampleTexture(${t}, uv);
    }
  `}function df(n){const e=n.name,t=xe(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function Xce(n,e){const t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),s="get"+r+"AtOutCoords",a=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,i=Dz(n.shapeInfo.logicalShape,e.logicalShape),u=Jt(o),l=o-a;let c;const d=["x","y","z","w","u","v"];a===0?c="":o<2&&i.length>=1?c="coords = 0;":c=i.map(S=>`coords.${d[S+l]} = 0;`).join(`
`);let p="";o<2&&a>0?p="coords":p=n.shapeInfo.logicalShape.map((S,N)=>`coords.${d[N+l]}`).join(", ");let m="return outputValue;";const b=xe(n.shapeInfo.logicalShape)===1,w=xe(e.logicalShape)===1;if(a===1&&!b&&!w)m=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(b&&!w)o===1?m=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:m=`
        return vec4(outputValue.x);
      `;else if(i.length){const S=a-2,N=a-1;i.indexOf(S)>-1&&i.indexOf(N)>-1?m="return vec4(outputValue.x);":i.indexOf(S)>-1?m="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":i.indexOf(N)>-1&&(m="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${s}() {
      ${u} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${r}(${p});
      ${m}
    }
  `}function Yce(n,e){const t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),s="get"+r+"AtOutCoords",a=e.texShape,o=n.shapeInfo.texShape,i=n.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!n.shapeInfo.isUniform&&i===u&&n.shapeInfo.flatOffset==null&&Et(o,a))return`
      float ${s}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const l=Jt(u),c=Dz(n.shapeInfo.logicalShape,e.logicalShape),d=u-i;let p;const m=["x","y","z","w","u","v"];i===0?p="":u<2&&c.length>=1?p="coords = 0;":p=c.map(b=>`coords.${m[b+d]} = 0;`).join(`
`);let v="";return u<2&&i>0?v="coords":v=n.shapeInfo.logicalShape.map((b,y)=>`coords.${m[y+d]}`).join(", "),`
    float ${s}() {
      ${l} coords = getOutputCoords();
      ${p}
      return get${r}(${v});
    }
  `}function Jt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function wI(n,e,t){const{newShape:r,keptDims:s}=Ni(e),a=e.length,o=n&&a===3&&e[0]===1,i=o?e.slice(1):r,u=!n&&a>1&&!Et(e,t)&&r.length<a||o;return{useSqueezeShape:u,uniformShape:u?i:e,keptDims:s}}function ff(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function pf(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zce(n,e,t,r){const s=t.map((c,d)=>{const p={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(p.flatOffset=c.texData.slice.flatOffset),{name:e.variableNames[d],shapeInfo:p}}),a=s.map(c=>c.shapeInfo),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},i=mce(s,o,e),u=Gle(n.gl,i),l=n.createProgram(u);return de().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:u,source:i,webGLProgram:l,inShapeInfos:a,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(l),Object.assign({program:e,fragmentShader:u,source:i,webGLProgram:l,inShapeInfos:a,outShapeInfo:o},Fz(n,e,l)))}function Fz(n,e,t){const r=[],s=[];let a,o,i,u=null,l=null;l=n.getUniformLocation(t,"NAN",!1),de().getNumber("WEBGL_VERSION")===1&&(u=n.getUniformLocation(t,"INFINITY",!1));const c=!1;for(const d of e.variableNames){const p={name:d,uniform:n.getUniformLocation(t,d,c),offset:n.getUniformLocation(t,`offset${d}`,c)};e.enableShapeUniforms&&(p.shape=n.getUniformLocation(t,`${d}Shape`,c),p.texShape=n.getUniformLocation(t,`${d}TexShape`,c)),r.push(p)}if(e.enableShapeUniforms&&(a=n.getUniformLocation(t,"outShape",c),i=n.getUniformLocation(t,"outShapeStrides",c),o=n.getUniformLocation(t,"outTexShape",c)),e.customUniforms)for(const d of e.customUniforms)s.push(n.getUniformLocation(t,d.name,c));return{variablesLocations:r,customUniformLocations:s,infLoc:u,nanLoc:l,outShapeLocation:a,outShapeStridesLocation:i,outTexShapeLocation:o}}function iO(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,r)=>{const s=t.logicalShape,a=e[r],o=a.shape;if(!Et(s,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${s} and ${o} must match`);if(t.isUniform&&a.isUniform)return;const i=t.texShape,u=a.isUniform?null:a.texData.texShape;if(!Et(i,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${i} and ${u} must match`)})}function Qce(n,e,t,r,s){e.program.enableShapeUniforms||(iO(e.inShapeInfos,t),iO([e.outShapeInfo],[r]));const a=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(a.texture,o[0],o[1]):n.setOutputMatrixTexture(a.texture,o[0],o[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),de().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let u=0;u<t.length;++u){const l=t[u],{uniform:c,offset:d,shape:p,texShape:m}=e.variablesLocations[u];if(p){const{uniformShape:v}=wI(e.program.packedInputs,l.shape,l.texData.texShape);switch(v.length){case 1:n.gl.uniform1iv(p,new Int32Array(v));break;case 2:n.gl.uniform2iv(p,new Int32Array(v));break;case 3:n.gl.uniform3iv(p,new Int32Array(v));break;case 4:n.gl.uniform4iv(p,new Int32Array(v));break}}if(m&&n.gl.uniform2i(m,l.texData.texShape[0],l.texData.texShape[1]),c!=null){if(l.isUniform){if(xe(l.shape)<2)n.gl.uniform1f(c,l.uniformValues[0]);else{let v=l.uniformValues;v instanceof Float32Array||(v=new Float32Array(v)),n.gl.uniform1fv(c,v)}continue}l.texData.slice!=null&&d!=null&&n.gl.uniform1i(d,l.texData.slice.flatOffset),n.setInputMatrixTexture(l.texData.texture.texture,c,u)}}const i=e.outShapeLocation;if(i)switch(r.shape.length){case 1:n.gl.uniform1iv(i,new Int32Array(r.shape));break;case 2:n.gl.uniform2iv(i,new Int32Array(r.shape));break;case 3:n.gl.uniform3iv(i,new Int32Array(r.shape));break;case 4:n.gl.uniform4iv(i,new Int32Array(r.shape));break}if(e.outShapeStridesLocation){const u=rt(r.shape);switch(r.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(u));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(u));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(u));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&s)for(let u=0;u<e.program.customUniforms.length;++u){const l=e.program.customUniforms[u],c=e.customUniformLocations[u],d=s[u];if(l.type==="float")n.gl.uniform1fv(c,d);else if(l.type==="vec2")n.gl.uniform2fv(c,d);else if(l.type==="vec3")n.gl.uniform3fv(c,d);else if(l.type==="vec4")n.gl.uniform4fv(c,d);else if(l.type==="int")n.gl.uniform1iv(c,d);else if(l.type==="ivec2")n.gl.uniform2iv(c,d);else if(l.type==="ivec3")n.gl.uniform3iv(c,d);else if(l.type==="ivec4")n.gl.uniform4iv(c,d);else throw Error(`uniform type ${l.type} is not supported yet.`)}n.executeProgram()}function Jce(n,e,t){let r="";e.concat(t).forEach(o=>{const i=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const u=o.texData.texShape,{useSqueezeShape:l,uniformShape:c,keptDims:d}=wI(n.packedInputs,o.shape,u);let p="",m="",v="";if(c.length===1&&n.packedInputs){const T=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];p=`${T[0]>1}_${T[1]>1}`}else if(c.length===2&&!n.packedInputs)m=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!n.packedInputs){const T=rt(c);v=`${T[0]===u[1]}_${T[T.length-1]===u[1]}`}const b=o.shape.length,y=c.length===2&&Et(o.shape,u),w=xe(o.shape)===1,S=Ql(o.shape,t.shape),N=!n.packedInputs&&b===t.shape.length&&Et(u,t.texData.texShape),C=n.packedInputs||c.length>2?"":`${u[0]>1}_${u[1]>1}`;r+=`${b}_${N}_${l?d:""}_${c.length}_${w}_${S}_${y}_${p}_${m}_${v}_${C}_${i}`}else{const u=o.isUniform?"uniform":o.texData.texShape;r+=`${o.shape}_${u}_${i}`}});const s=n.userCode;let a=n.constructor.name;return a+="_"+r+"_"+s+`${de().getNumber("WEBGL_VERSION")}`,a}function jr(n){return de().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ehe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=rm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=ls();this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?N1(["r","c","d"],e):xc(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class the{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=rm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=ls();this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?N1(["r","c","d"],e):xc(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nhe{constructor(e){this.variableNames=["A"],this.outTexUsage=na.DOWNLOAD;const t=ls();this.outputShape=e,this.userCode=`
      ${Az}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rhe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=na.DOWNLOAD;const t=ls();this.outputShape=e,this.userCode=`
      ${Az}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const she={R:0,G:1,B:2,A:3};class uO{constructor(e,t=!1,r="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=ls();this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length);let a="result";t&&(a="floor(result * 255. + 0.5)");let o="";for(let i=0;i<r.length;i++){const u=r[i];o+=`
          if(offset == ${i}) {
            result = values[${she[u]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?xI():bI(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${r.length});

        flatIndex = idiv(flatIndex, ${r.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${s.texture2D}(A, uv);
          ${o}
        }
        ${s.output} = vec4(${a}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ahe{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=ls();this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length);let s="",a="result";t&&(a="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let i=0;i<=1;i++){const u=o*2+i;s+=`
          localCoords = coords;
          if(localCoords[2] + ${i} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${i};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${u}] = values[0];
            } else if (offset == 1) {
              result[${u}] = values[1];
            } else if (offset == 2) {
              result[${u}] = values[2];
            } else {
              result[${u}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?xI():bI(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${s}

          ${r.output} = ${a};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ohe(n){const e=ls(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return Wle(n,t)}function ihe(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return Kle(n,e)}function uhe(n){const e=new Uint16Array([0,1,2,2,1,3]);return Xle(n,e)}function Qg(n,e,t,r,s,a){Zle(e,t);const o=Yle(n),i=n.TEXTURE_2D;return Pe(n,()=>n.bindTexture(i,o)),Pe(n,()=>n.texParameteri(i,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Pe(n,()=>n.texParameteri(i,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Pe(n,()=>n.texParameteri(i,n.TEXTURE_MIN_FILTER,n.NEAREST)),Pe(n,()=>n.texParameteri(i,n.TEXTURE_MAG_FILTER,n.NEAREST)),de().getNumber("WEBGL_VERSION")===1?Pe(n,()=>n.texImage2D(i,0,r,e,t,0,s,a,null)):Pe(n,()=>n.texStorage2D(i,1,r,e,t)),Pe(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[t,e]}}function Mz(n){return n.internalFormatFloat}function lhe(n,e,t,r){const[s,a]=Yg(e,t);return Qg(n,s,a,Mz(r),r.textureFormatFloat,n.FLOAT)}function Lz(n){return n.internalFormatHalfFloat}function che(n,e,t,r){const[s,a]=Yg(e,t);return Qg(n,s,a,Lz(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function Pz(n){return n.downloadTextureFormat}function hhe(n,e,t,r){const[s,a]=Yg(e,t);return Qg(n,s,a,Pz(r),n.RGBA,n.UNSIGNED_BYTE)}function Bz(n){return n.internalFormatPackedFloat}function dhe(n,e,t,r){const[s,a]=cf(e,t);return Qg(n,s,a,Bz(r),n.RGBA,n.FLOAT)}function zz(n){return n.internalFormatPackedHalfFloat}function fhe(n,e,t,r){const[s,a]=cf(e,t);return Qg(n,s,a,zz(r),n.RGBA,r.textureTypeHalfFloat)}function phe(n,e,t){return Pe(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),sO(n,e,"clipSpacePos",t,3,20,0)&&sO(n,e,"uv",t,2,20,12)}function mhe(n,e,t,r,s,a){Pe(n,()=>n.bindTexture(n.TEXTURE_2D,e));let o,i,u;s instanceof Uint8Array?(o=new Uint8Array(t*r*4),i=n.UNSIGNED_BYTE,u=n.RGBA):(o=new Float32Array(t*r*4),i=n.FLOAT,u=a.internalFormatPackedFloat),o.set(s),de().getNumber("WEBGL_VERSION")===2?Pe(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,r,n.RGBA,i,o)):Pe(n,()=>n.texImage2D(n.TEXTURE_2D,0,u,t,r,0,n.RGBA,i,o)),Pe(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function ghe(n,e,t){Pe(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?de().getNumber("WEBGL_VERSION")===2?Pe(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Pe(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):de().getNumber("WEBGL_VERSION")===2?Pe(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Pe(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Pe(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function vhe(n,e,t,r){const s=n.createBuffer();Pe(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,s));const i=4*4*e*t;return Pe(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,i,n.STREAM_READ)),Pe(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Pe(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),s}function yhe(n,e,t){const r=n,s=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,s),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),s}function bhe(n,e,t,r){const[s,a]=Yg(e,t),o=4,i=new Uint8Array(Mle(e*t,o));return Pe(n,()=>n.readPixels(0,0,s,a,r.downloadTextureFormat,n.UNSIGNED_BYTE,i)),new Float32Array(i.buffer)}function xhe(n,e,t,r,s,a,o,i){const u=n,l=new Float32Array(Lle(a,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function whe(n,e,t){const r=new Float32Array(e*t*4);return Pe(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,r)),r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AS{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=de().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,$le(t,e)):this.gl=eo(t),e=this.gl,de().getNumber("WEBGL_VERSION")===2){const a=e;this.createVertexArray=()=>Pe(a,()=>a.createVertexArray()),this.bindVertexArray=o=>Pe(a,()=>a.bindVertexArray(o)),this.deleteVertexArray=o=>Pe(a,()=>a.deleteVertexArray(o)),this.getVertexArray=()=>Pe(a,()=>a.getParameter(a.VERTEX_ARRAY_BINDING))}else if(e!=null){const a=e.getExtension("OES_vertex_array_object");if(a==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Pe(e,()=>a.createVertexArrayOES()),this.bindVertexArray=o=>Pe(e,()=>a.bindVertexArrayOES(o)),this.deleteVertexArray=o=>Pe(e,()=>a.deleteVertexArrayOES(o)),this.getVertexArray=()=>Pe(e,()=>e.getParameter(a.VERTEX_ARRAY_BINDING_OES))}let r="WEBGL_color_buffer_float";const s="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),de().getNumber("WEBGL_VERSION")===1){const a="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=Oy(this.gl,a),Ea(this.gl,o))this.textureHalfFloatExtension=Oy(this.gl,o);else if(de().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Ea(this.gl,s))this.colorBufferHalfFloatExtension=Oy(this.gl,s);else if(de().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Ea(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(Ea(this.gl,s))this.colorBufferHalfFloatExtension=this.gl.getExtension(s);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=ihe(this.gl),this.indexBuffer=uhe(this.gl),this.framebuffer=Qle(this.gl),this.textureConfig=yI(this.gl,this.textureHalfFloatExtension)}get debug(){return de().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Pe(e,()=>e.finish()),Pe(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Pe(e,()=>e.deleteFramebuffer(this.framebuffer)),Pe(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Pe(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Pe(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),lhe(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),che(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),hhe(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),ghe(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,r,s){this.throwIfDisposed(),mhe(this.gl,e,t,r,s,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),fhe(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),dhe(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(aO(this.gl,this.framebuffer),this.outputTexture=null),Pe(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,r){return this.downloadMatrixDriver(e,()=>bhe(this.gl,t,r,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,r,s,a,o){return xhe(this.gl,e,t,r,s,a,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return yhe(this.gl,e,t)}createBufferFromTexture(e,t,r){this.bindTextureToFrameBuffer(e);const s=vhe(this.gl,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),s}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,r;if(de().getBool("WEBGL_FENCE_API_ENABLED")){const s=e,a=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=()=>{const o=s.clientWaitSync(a,0,0);return o===s.ALREADY_SIGNALED||o===s.CONDITION_SATISFIED},t=a}else de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(t,de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:t,isFencePassed:r}}downloadMatrixFromPackedTexture(e,t,r){return this.downloadMatrixDriver(e,()=>whe(this.gl,t,r))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=ohe(t));const r=jle(t);Pe(t,()=>t.attachShader(r,this.vertexShader)),Pe(t,()=>t.attachShader(r,e)),qle(t,r);const s=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&IS(t,s),s}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Pe(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),phe(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Pe(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&IS(this.gl,this.program),Pe(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,r=!0){return this.throwIfDisposed(),r?ece(this.gl,e,t):tce(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Pe(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),nce(this.gl,e,t,r)}setOutputMatrixTexture(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)}setOutputPackedMatrixTexture(e,t,r){this.throwIfDisposed();const[s,a]=cf(t,r);this.setOutputMatrixTextureDriver(e,s,a)}setOutputMatrixWriteRegion(e,t,r,s){this.setOutputMatrixWriteRegionDriver(r,e,s,t)}setOutputPackedMatrixWriteRegion(e,t,r,s){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&IS(this.gl,this.program),Fy(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Pe(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Pe(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Oy(this.gl,de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),a=r.createQuery();return r.beginQuery(s.TIME_ELAPSED_EXT,a),a}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await fC(()=>this.disposed||this.isQueryAvailable(e,de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}else{const r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),a=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),a&&!this.disjoint}else{const r=this.getQueryTimerExtensionWebGL1(),s=r.getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),s&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=She(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:r}=this.itemsToPoll[t];r()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in de().platform&&(r=de().platform.setTimeoutCustom.bind(de().platform)),fC(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),ES(this.gl,e,this.framebuffer),this.debug&&Fy(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(ES(this.gl,this.outputTexture,this.framebuffer),this.debug&&Fy(this.gl)):aO(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const r=t();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(e,t,r){this.throwIfDisposed();const s=this.gl;ES(s,e,this.framebuffer),this.debug&&Fy(s),this.outputTexture=e,Pe(s,()=>s.viewport(0,0,t,r)),Pe(s,()=>s.scissor(0,0,t,r))}setOutputMatrixWriteRegionDriver(e,t,r,s){this.throwIfDisposed(),Pe(this.gl,()=>this.gl.scissor(e,t,r,s))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function She(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:Che,bincountImpl:Vz,bincountReduceImpl:Nhe,bitwiseAndImpl:khe,castImpl:The,ceilImpl:Ihe,concatImpl:Ehe,equalImpl:_he,expImpl:Rhe,expm1Impl:Ahe,floorImpl:Dhe,gatherNdImpl:$he,gatherV2Impl:Ohe,greaterImpl:Fhe,greaterEqualImpl:Mhe,lessImpl:Lhe,lessEqualImpl:Phe,linSpaceImpl:Bhe,logImpl:zhe,maxImpl:Vhe,maximumImpl:Uhe,minimumImpl:Whe,multiplyImpl:Ghe,negImpl:Hhe,notEqualImpl:jhe,prodImpl:qhe,raggedGatherImpl:Khe,raggedRangeImpl:Xhe,raggedTensorToTensorImpl:Yhe,rangeImpl:Zhe,rsqrtImpl:Qhe,scatterImpl:Jhe,sigmoidImpl:ede,simpleAbsImpl:Uz,sliceImpl:tde,sparseFillEmptyRowsImpl:nde,sparseReshapeImpl:rde,sparseSegmentReductionImpl:Wz,sqrtImpl:sde,staticRegexReplaceImpl:ade,stridedSliceImpl:ode,stringNGramsImpl:ide,stringSplitImpl:ude,stringToHashBucketFastImpl:lde,subImpl:cde,tileImpl:hde,topKImpl:dde,transposeImpl:SI,uniqueImpl:fde}=gse;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gz(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function ns(n,e){return e===1?[n]:Gz(n,e)}function pde(n,e){if(n===1)return"rc";let t="";for(let r=0;r<n;r++)t+=e[r],r<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mde{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=jr(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=ns("rc",this.rank),r=Jt(this.rank),s=this.getOutOfBoundsCondition(t),a=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${s}) {
            setOutput(vec4(0));
          } else {
            ${a}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){let a=`${r===0?"r":"rp1"}, ${s===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)a=`${e[e.length-1-o]},`+a;t.push(a)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let r=this.rank-2;r<this.rank;r++)t+=`${e[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],s=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${s};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hz{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length);let r="";for(let s=0;s<4;s++){let a="thisRC = rc;";s%2===1&&(a+="thisRC.z += 1;"),s>1&&(a+="thisRC.y += 1;"),r+=`
        ${a}
        ${s>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${s}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${s>0?"}":""}
      `}this.userCode=`
      ${gde(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?xI():bI(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${r}

        setOutput(result);
      }
    `}}function gde(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?pce(["r","c","d"],"inputShape"):xc(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vde{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,r){const s=cO(t,r),a=hO(e,s,r);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);const o=lO(e,s,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const u=this.freeTextures[a].pop();return this.usedTextures[a].push(u),u}let i;return s===Ir.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):s===Ir.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):s===Ir.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):s===Ir.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):s===Ir.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}releaseTexture(e,t,r,s){if(this.freeTextures==null)return;const a=cO(r,s),o=hO(t,a,s);o in this.freeTextures||(this.freeTextures[o]=[]);const i=lO(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,s),u=de().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=i):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=i),this.numUsedTextures--;const l=this.usedTextures[o],c=l&&l.indexOf(e);if(c==null||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[c]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function yde(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function lO(n,e,t,r,s){const a=bde(e,r);let o;if(s){const[u,l]=cf(n[0],n[1]);o=u*l}else{const[u,l]=Yg(n[0],n[1]);o=u*l}const i=yde(t,a);return o*i}function bde(n,e){switch(n){case Ir.PACKED_2X2_FLOAT32:return Bz(e);case Ir.PACKED_2X2_FLOAT16:return zz(e);case Ir.UNPACKED_FLOAT32:return Mz(e);case Ir.UNPACKED_FLOAT16:return Lz(e);case Ir.PACKED_4X1_UNSIGNED_BYTE:return Pz(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function xde(n){return de().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Ir.PACKED_2X2_FLOAT32:Ir.UNPACKED_FLOAT32:n?Ir.PACKED_2X2_FLOAT16:Ir.UNPACKED_FLOAT16}function cO(n,e){if(n===na.UPLOAD)return Ir.PACKED_2X2_FLOAT32;if(n===na.RENDER||n==null)return xde(e);if(n===na.DOWNLOAD||n===na.PIXELS)return Ir.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function hO(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Co{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Oa="if (isnan(x)) return x;",wde="return x;",dO="return abs(x);",Sde="return (x >= 0.0) ? x : (exp(x) - 1.0);",Cde=Oa+`
  return (x < 0.0) ? 0.0 : x;
`,Nde=Oa+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,mu="return x;",kde="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tde="return x;",Ide=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Ede=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,_de=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Rde="return 1.0 / (1.0 + exp(-1.0 * x));";class yu{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ade{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length);const t=e.length,r=ns("rc",t),s=Jt(t),a=pde(t,r),o=r.slice(-2),i=t<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${s} rc = getOutputCoords();
        vec4 packedInput = getA(${a});

        setOutput(getChannel(packedInput, ${i}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dde=Zx,$de=1e-7,Ode=1e-4,Py={};function Fde(n){return n in Py||(Py[n]={}),Py[n]}const Mde=de().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Lde=600;function Pde(){return de().global.screen==null?1024:de().global.screen.height*de().global.screen.width*window.devicePixelRatio*Lde/1024/1024}class k1 extends p0{nextDataId(){return k1.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!de().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof AS)t=e;else{const r=eo(de().getNumber("WEBGL_VERSION"),e);t=new AS(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const r=eo(de().getNumber("WEBGL_VERSION"));t=new AS(r),this.binaryCache=Fde(de().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new vde(this.gpgpu),this.numMBBeforeWarning=Pde(),this.texData=new MN(this,Va())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,r,s,a,o){const i=this.makeTensorInfo(t,r),u=this.texData.get(i.dataId);u.isPacked=!1,u.texture={texture:e,texShape:[s,a]},u.texShape=[s,a];const l=My(t),c=new uO(l,!1,o),d=this.runWebGLProgram(c,[i],r,[[s,a]]);return d.shape=t,u.texture=null,this.disposeIntermediateTensorInfo(i),d.dataId}write(e,t,r){if((de().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||de().getBool("DEBUG"))&&this.checkNumericalProblems(e),r==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const s={id:this.nextDataId()};return this.texData.set(s,{shape:t,dtype:r,values:e,usage:na.UPLOAD,refCount:1}),s}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,r,s,a){if(de().getBool("DEBUG")&&this.checkNumericalProblems(t),s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:r,dtype:s,values:t,usage:na.UPLOAD,refCount:a})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:r,dtype:s,complexTensorInfos:a,slice:o,shape:i,isPacked:u}=t;if(o!=null){let p;u?p=new yu(i,mu):p=new Co(i,mu);const m=this.runWebGLProgram(p,[{dataId:e,shape:i,dtype:s}],s),v=this.readSync(m.dataId);return this.disposeIntermediateTensorInfo(m),v}if(r!=null)return this.convertAndCacheOnCPU(e);if(s==="string")return r;const l=this.activeTimers!=null;let c;l&&(c=Zr());let d;if(s==="complex64"){const p=this.readSync(a.real.dataId),m=this.readSync(a.imag.dataId);d=Si(p,m)}else d=this.getValuesFromTexture(e);return l&&(this.downloadWaitMs+=Zr()-c),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const v=this.pendingRead.get(e);return new Promise(b=>v.push(b))}const t=this.texData.get(e),{values:r,shape:s,slice:a,dtype:o,complexTensorInfos:i,isPacked:u}=t;if(a!=null){let v;u?v=new yu(s,mu):v=new Co(s,mu);const b=this.runWebGLProgram(v,[{dataId:e,shape:s,dtype:o}],o),y=this.read(b.dataId);return this.disposeIntermediateTensorInfo(b),y}if(r!=null)return this.convertAndCacheOnCPU(e);if(de().getBool("DEBUG")&&!de().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&de().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l=null,c;if(o!=="complex64"&&de().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(e);const v=this.texData.get(c.dataId);l=this.gpgpu.createBufferFromTexture(v.texture.texture,...$y(s))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(o==="complex64"){const v=await Promise.all([this.read(i.real.dataId),this.read(i.imag.dataId)]),b=v[0],y=v[1];d=Si(b,y)}else if(l==null)d=this.getValuesFromTexture(e);else{const v=xe(s);d=this.gpgpu.downloadFloat32MatrixFromBuffer(l,v)}if(c!=null&&this.disposeIntermediateTensorInfo(c),l!=null){const v=this.gpgpu.gl;Pe(v,()=>v.deleteBuffer(l))}const p=this.convertAndCacheOnCPU(e,d),m=this.pendingRead.get(e);return this.pendingRead.delete(e),m.forEach(v=>v(p)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Va().removeDataId(e,this),this.pendingDeletes--),p}readToGPU(e,t={}){const r=this.texData.get(e),{values:s,shape:a,slice:o,dtype:i,isPacked:u,texture:l}=r;if(i==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let m;u?m=new yu(a,mu):m=new Co(a,mu);const v=this.runWebGLProgram(m,[{dataId:e,shape:a,dtype:i}],i),b=this.readToGPU(v,t);return this.disposeIntermediateTensorInfo(v),b}if(l==null)throw s!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(e,t.customTexShape),d=Va().makeTensorFromTensorInfo(c),p=this.texData.get(c.dataId);return Object.assign({tensorRef:d},p.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(s=>bi(s));return yt(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return yt(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const r=e[t];if(!Vle(r))throw de().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:r,isPacked:s}=this.texData.get(e),a=xe(t);if(de().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const p=this.decode(e),m=this.texData.get(p.dataId),v=this.gpgpu.downloadMatrixFromPackedTexture(m.texture.texture,...$y(t)).subarray(0,a);return this.disposeIntermediateTensorInfo(p),v}const o=de().getBool("WEBGL_PACK")&&s===!0,i=o?My(t):t,u=o?new rhe(i):new nhe(i),l=this.runWebGLProgram(u,[{shape:i,dtype:r,dataId:e}],"float32"),c=this.texData.get(l.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(l),d}timerAvailable(){return de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,r=[];let s=!1;this.programTimersStack==null?(this.programTimersStack=r,s=!0):this.activeTimers.push(r),this.activeTimers=r,e();const a=$o(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),o=$o(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=t,s&&(this.programTimersStack=null);const i={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const u=await Promise.all(a);i.kernelMs=wF(u),i.getExtraProfileInfo=()=>u.map((l,c)=>({name:o[c],ms:l})).map(l=>`${l.name}: ${l.ms}`).join(", ")}else i.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,i})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Zr(),endMs:null}}endTimer(e){return de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Zr(),e)}async getQueryTime(e){if(de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:r}=this.texData.get(e);return r!=null&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:r,texShape:s,usage:a,isPacked:o,slice:i}=this.texData.get(e),u=i&&i.origDataId||e,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),t!=null&&(this.numBytesInGPU-=this.computeBytes(s,r),this.textureManager.releaseTexture(t,s,a,o)));const c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=Mde){return de().getBool("WEBGL_CPU_FORWARD")&&e.every(r=>this.texData.get(r.dataId).texture==null&&xe(r.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Js("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return Dde(e.shape,t)}packedUnaryOp(e,t,r){const s=new yu(e.shape,t),a=this.compileAndRun(s,[e],r);return Va().makeTensorFromTensorInfo(a)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const s=Uz(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,s)}if(de().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,dO,e.dtype);const t=new Co(e.shape,dO),r=this.compileAndRun(t,[e]);return Va().makeTensorFromTensorInfo(r)}makeTensorInfo(e,t,r){let s;if(t==="string"&&r!=null&&r.length>0&&So(r[0])){const a=r.map(o=>ko(o));s=this.write(a,e,t)}else s=this.write(r,e,t);return this.texData.get(s).usage=null,{dataId:s,shape:e,dtype:t}}makeOutput(e,t,r){return Va().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,r),this)}unpackTensor(e){const t=new Ade(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new mde(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const r=[Qh(e.shape),...Jh(e.shape)],s={dtype:e.dtype,shape:r,dataId:e.dataId},a=[Qh(t),...Jh(t)],o=new Hz(a,r),i=!0,u=[r],l=this.runWebGLProgram(o,[s],e.dtype,u,i);return{dataId:l.dataId,shape:t,dtype:l.dtype}}decode(e,t){const r=this.texData.get(e),{isPacked:s,shape:a,dtype:o}=r;if(t!=null){const p=xe(a),m=t[0]*t[1]*4;B(p<=m,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const i=My(a);let u;s?u=new the(i):u=new ehe(i);const l=!0,c=[t??$y(i)],d=this.runWebGLProgram(u,[{shape:i,dtype:o,dataId:e}],o,c,l,t);return{dtype:o,shape:a,dataId:d.dataId}}runWebGLProgram(e,t,r,s,a=!1,o){const i=this.makeTensorInfo(e.outputShape,r),u=this.texData.get(i.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===rm.DENSE){const w=o??$y(e.outputShape);u.texShape=w.map(S=>S*2)}if(e.outTexUsage!=null&&(u.usage=e.outTexUsage),xe(i.shape)===0)return u.values=fr(i.dtype,0),i;const l=[],c=t.map(w=>{if(w.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let S=this.texData.get(w.dataId);if(S.texture==null){if(!e.packedInputs&&xe(w.shape)<=de().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:w.shape,texData:null,isUniform:!0,uniformValues:S.values};e.packedInputs&&(S.isPacked=!0,S.shape=w.shape)}if(this.uploadToGPU(w.dataId),!!S.isPacked!=!!e.packedInputs)w=S.isPacked?this.unpackTensor(w):this.packTensor(w),l.push(w),S=this.texData.get(w.dataId);else if(S.isPacked&&!zb(S.shape,w.shape)){const N=w,C=w.shape;w.shape=S.shape,w=this.packedReshape(w,C),l.push(w),S=this.texData.get(w.dataId),N.shape=C}return{shape:w.shape,texData:S,isUniform:!1}});this.uploadToGPU(i.dataId);const d={shape:i.shape,texData:u,isUniform:!1},p=Jce(e,c,d),m=this.getAndSaveBinary(p,()=>Zce(this.gpgpu,e,c,d)),v=this.activeTimers!=null;let b;v&&(b=this.startTimer()),de().get("ENGINE_COMPILE_ONLY")||Qce(this.gpgpu,m,c,d,s),l.forEach(w=>this.disposeIntermediateTensorInfo(w)),v&&(b=this.endTimer(b),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(b)}));const y=de().getNumber("WEBGL_FLUSH_THRESHOLD");if(y>0){const w=Zr();w-this.lastGlFlushTime>y&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=w)}if(!de().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&a===!1){const w=this.unpackTensor(i);return this.disposeIntermediateTensorInfo(i),w}return i}compileAndRun(e,t,r,s,a=!1){return r=r||t[0].dtype,this.runWebGLProgram(e,t,r,s,a)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(de().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=he(()=>{if(!de().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=de().getBool("DEBUG");de().set("DEBUG",!1);const t=this.abs(st(1e-8)).dataSync()[0];if(de().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?$de:Ode}uploadToGPU(e){const t=this.texData.get(e),{shape:r,dtype:s,values:a,texture:o,usage:i,isPacked:u}=t;if(o!=null)return;const l=this.activeTimers!=null;let c;l&&(c=Zr());let d=t.texShape;if(d==null&&(d=ace(r,u),t.texShape=d),a!=null){const p=My(r);let m,v=d[1],b=d[0];const y=a instanceof Uint8Array||a instanceof Uint8ClampedArray;(u||!y)&&([v,b]=cf(d[0],d[1])),u?m=new ahe(p,y):m=new uO(p,y);const w=y?[b,v]:d,S=this.makeTensorInfo(w,s),N=this.texData.get(S.dataId);y?N.usage=na.PIXELS:N.usage=na.UPLOAD,N.texShape=w,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(S.dataId),v,b,a);const C=[[b,v]],E=this.runWebGLProgram(m,[S],s,C,!0),$=this.texData.get(E.dataId);t.texShape=$.texShape,t.isPacked=$.isPacked,t.usage=$.usage,de().get("ENGINE_COMPILE_ONLY")?this.disposeData(E.dataId):(t.texture=$.texture,t.values=null,this.texData.delete(E.dataId)),this.disposeIntermediateTensorInfo(S),l&&(this.uploadWaitMs+=Zr()-c)}else{const p=this.acquireTexture(d,i,s,u);t.texture=p}}convertAndCacheOnCPU(e,t){const r=this.texData.get(e),{dtype:s}=r;return t!=null&&(r.values=Bde(t,s)),r.values}acquireTexture(e,t,r,s){if(this.numBytesInGPU+=this.computeBytes(e,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${a} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,s)}computeBytes(e,t){return e[0]*e[1]*Vp(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const r=new Promise(s=>{try{this.checkCompletion_(t),s(!0)}catch(a){throw a}});e.push(r)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await yT(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(Rz(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:r,infLoc:s,nanLoc:a,outShapeLocation:o,outShapeStridesLocation:i,outTexShapeLocation:u}=Fz(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=r,e.infLoc=s,e.nanLoc=a,e.outShapeLocation=o,e.outShapeStridesLocation=i,e.outTexShapeLocation=u}}createTensorFromGPUData(e,t,r){e.channels=e.channels||"RGBA";const{texture:s,height:a,width:o,channels:i}=e,u=Va().backend;if(!u.gpgpu.gl.isTexture(s))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=u.writeTexture(s,t,r,a,o,i);return Va().makeTensorFromDataId(l,t,r,u)}}k1.nextDataId=0;function Bde(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let r=0;r<t.length;++r)t[r]=Math.round(n[r]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */jN()&&KN("webgl",()=>new k1,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CI=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class oc{constructor(e,t,r){this.variableNames=["A","B"],this.outputShape=mt(t,r),this.enableShapeUniforms=jr(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sc=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class mf{constructor(e,t,r,s=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=mt(t,r);const a=this.outputShape.length;this.enableShapeUniforms=jr(a);let o="";if(s)if(a===0||xe(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${Jt(a)} coords = getOutputCoords();
        `,a===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const u=ns("coords",a);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${u[a-2]} + 1) >= outShape[${a} - 2];
            bool nextColOutOfBounds =
              (${u[a-1]} + 1) >= outShape[${a} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${u[a-2]} + 1) >= ${this.outputShape[a-2]};
            bool nextColOutOfBounds =
              (${u[a-1]} + 1) >= ${this.outputShape[a-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ps(n){const{inputs:e,backend:t}=n,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const zde={kernelName:Td,backendName:"webgl",kernelFunc:Ps};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zu(n){const{inputs:e,backend:t}=n,{real:r,imag:s}=e,a=t.makeTensorInfo(r.shape,"complex64"),o=t.texData.get(a.dataId),i=Ps({inputs:{x:r},backend:t}),u=Ps({inputs:{x:s},backend:t});return o.complexTensorInfos={real:i,imag:u},a}const Vde={kernelName:C0,backendName:"webgl",kernelFunc:Zu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jz="return (a < 0.) ? b * a : a;",qz=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Ude(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{alpha:a}=r,o=t.makeTensorInfo([],"float32",ki(a,"float32")),i=de().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new mf(qz,s.shape,o.shape):new oc(jz,s.shape,o.shape),u=t.runWebGLProgram(i,[s,o],"float32");return t.disposeIntermediateTensorInfo(o),u}const Wde={kernelName:Lm,backendName:"webgl",kernelFunc:Ude};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kz="return (a < 0.) ? b * a : a;",Xz=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Gde(n){const{inputs:e,backend:t}=n,{x:r,alpha:s}=e,a=de().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new mf(Xz,r.shape,s.shape):new oc(Kz,r.shape,s.shape);return t.runWebGLProgram(a,[r,s],"float32")}const Hde={kernelName:ng,backendName:"webgl",kernelFunc:Gde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gf="if (isnan(x)) return x;";function Pt({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:r}){return({inputs:s,backend:a})=>{const{x:o}=s,i=a,u=r||o.dtype;if(i.shouldExecuteOnCPU([o])&&t!=null){const d=i.texData.get(o.dataId),p=t(d.values,u);return i.makeTensorInfo(o.shape,u,p)}const l=de().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let c;return l?c=new yu(o.shape,e):c=new Co(o.shape,n),i.runWebGLProgram(c,[o],u)}}function Mr({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:r=!1,cpuKernelImpl:s,dtype:a}){return({inputs:o,backend:i})=>{const{a:u,b:l}=o,c=i;if(r&&u.dtype==="complex64"){const v=c.texData.get(u.dataId),b=c.texData.get(l.dataId),[y,w]=[[v.complexTensorInfos.real,b.complexTensorInfos.real],[v.complexTensorInfos.imag,b.complexTensorInfos.imag]].map(N=>{const[C,T]=N,E={dataId:C.dataId,dtype:C.dtype,shape:u.shape},$={dataId:T.dataId,dtype:T.dtype,shape:l.shape},_=new oc(n,u.shape,l.shape);return c.runWebGLProgram(_,[E,$],ms(C.dtype,T.dtype))}),S=Zu({inputs:{real:y,imag:w},backend:c});return c.disposeIntermediateTensorInfo(y),c.disposeIntermediateTensorInfo(w),S}const d=a||ms(u.dtype,l.dtype);if((u.dtype==="string"||l.dtype==="string"||c.shouldExecuteOnCPU([u,l]))&&s!=null){const v=c.texData.get(u.dataId).values,b=c.texData.get(l.dataId).values,y=u.dtype==="string"?Ci(v):v,w=u.dtype==="string"?Ci(b):b,[S,N]=s(u.shape,l.shape,y,w,d),C=c.makeTensorInfo(N,d),T=c.texData.get(C.dataId);return T.values=S,C}const p=de().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let m;return p?m=new mf(e,u.shape,l.shape,t):m=new oc(n,u.shape,l.shape),c.runWebGLProgram(m,[u,l],d)}}function sm(n,e=!1){if(n==="linear")return e?Tde:wde;if(n==="relu")return e?Ede:Cde;if(n==="elu")return e?Ide:Sde;if(n==="relu6")return e?_de:Nde;if(n==="prelu")return e?Xz:Kz;if(n==="leakyrelu")return e?qz:jz;if(n==="sigmoid")return e?Rde:kde;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yz{constructor(e,t,r,s=!1,a=!1,o=!1,i=null,u=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=jr(this.outputShape.length);const c=s?e[1]:e[2],d=Math.ceil(c/2),p=s?"i * 2, rc.y":"rc.y, i * 2",m=a?"rc.z, i * 2":"i * 2, rc.z",v=s?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],b=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let y="",w="";i&&(u?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:l?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:y=`vec4 activation(vec4 x) {
          ${i}
        }`,w="result = activation(result);");const S=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let N="rc.x",C="rc.x";e[0]<t[0]?N=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(C=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${y}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${N};
        int batchB = ${C};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${m});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${v[0]} * ${b[0]});
          result += (${v[1]} * ${b[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${S}

        ${w}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fO={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class pO{constructor(e,t,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=mt(t,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mO="return a * b;";function NI(n){const{inputs:e,backend:t}=n,{a:r,b:s}=e,a=ms(r.dtype,s.dtype);if(r.dtype==="complex64"){const i=t.texData.get(r.dataId),u=t.texData.get(s.dataId),l=new pO(fO.REAL,r.shape,s.shape),c=new pO(fO.IMAG,r.shape,s.shape),d=[{dataId:i.complexTensorInfos.real.dataId,dtype:i.complexTensorInfos.real.dtype,shape:r.shape},{dataId:i.complexTensorInfos.imag.dataId,dtype:i.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:s.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:s.shape}],p=t.runWebGLProgram(l,d,"float32"),m=t.runWebGLProgram(c,d,"float32"),v=Zu({inputs:{real:p,imag:m},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),v}if(t.shouldExecuteOnCPU([r,s])){const i=t.texData.get(r.dataId),u=t.texData.get(s.dataId),[l,c]=Ghe(r.shape,s.shape,i.values,u.values,a),d=t.makeTensorInfo(c,a),p=t.texData.get(d.dataId);return p.values=l,d}let o;return de().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new mf(mO,r.shape,s.shape):o=new oc(mO,r.shape,s.shape),t.runWebGLProgram(o,[r,s],a)}const jde={kernelName:Fd,backendName:"webgl",kernelFunc:NI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qde(n,e,t){const r=[Qh(n.shape),...Jh(n.shape)],s={dtype:n.dtype,shape:r,dataId:n.dataId},a=[Qh(e),...Jh(e)],o=new Hz(a,r),i=!0,u=[r],l=t.runWebGLProgram(o,[s],n.dtype,u,i);return{dataId:l.dataId,shape:e,dtype:l.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Me(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{shape:a}=r,o=t,i=xe(s.shape),u=PN(a,i),l=xe(u);B(i===l,()=>`The new shape (${u}) has ${l} elements and the old shape (${s.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`);const c=o.texData.get(s.dataId);return c.isPacked&&!zb(s.shape,u)&&!(c.texture!==null&&zb(c.shape,u))?qde(s,u,o):(o.incRef(s.dataId),{dataId:s.dataId,shape:u,dtype:s.dtype})}const Kde={kernelName:sg,backendName:"webgl",kernelFunc:Me};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gO{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:a,outSize:o}=e;this.outputShape=[s,o];const i=Math.floor(r/4)*4,u=r%4;let l="sumValue += dot(values, ones);";if(t!=null){const d=1/t;l=`sumValue += dot(values * ${jl(d)?d.toPrecision(2):d}, ones);`}let c="";a%r>0&&(c=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${i}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${i};
        if (${u===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${u===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${u===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xde{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:a,outSize:o}=e;this.outputShape=[s,o];let i="0.0",u="";t==="prod"?i="1.0":t==="min"?(i="1.0 / 1e-20",u="min"):t==="max"&&(i="-1.0 / 1e-20",u="max");let l=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?l="sumValue":t==="prod"?l="prodValue":t==="all"?l="allValue":t==="any"&&(l="anyValue");const c=Math.floor(r/4)*4,d=r%4;let p=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${u}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${u}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,m="vec4";t==="all"?(i="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,m="bvec4"):t==="any"&&(i="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,m="bvec4");let v="";a%r>0&&(v=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${i};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${v}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${i});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${c};
        if (${d===1}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===2}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===3}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yde(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],r=l1(t);e.push({inSize:t,windowSize:r,outSize:Math.ceil(t/r)})}return e}function Cc(n,e,t,r){const s=Yde(n.shape);let a=n;for(let o=0;o<s.length;o++){const{inSize:i,windowSize:u,outSize:l}=s[o];let c,d;t==="mean"?c=o===0?new gO({windowSize:u,inSize:i,batchSize:n.shape[0],outSize:l},i):new gO({windowSize:u,inSize:i,batchSize:n.shape[0],outSize:l}):c=new Xde({windowSize:u,inSize:i,batchSize:n.shape[0],outSize:l},t),d=a,a=r.runWebGLProgram(c,[a],e),d.dataId!==n.dataId&&r.disposeIntermediateTensorInfo(d)}return a}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zde{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let o=0;o<r.length;o++)r[o]=e[t[o]];this.outputShape=r,this.rank=r.length;const s=Jt(this.rank),a=Qde(t);this.userCode=`
    void main() {
      ${s} resRC = getOutputCoords();
      setOutput(getA(${a}));
    }
    `}}function Qde(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let s=0;s<n.length;s++)r[n[s]]=t[s];return r.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jde{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const r=new Array(e.length);for(let c=0;c<r.length;c++)r[c]=e[t[c]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const s=Jt(this.rank),a=Gz("rc",this.rank),o=new Array(this.rank);for(let c=0;c<t.length;c++)o[t[c]]=a[c];const i=`vec2(${o.slice(-2).join()})`,u=`++${a[this.rank-1]} < ${r[this.rank-1]}`,l=`getChannel(getA(${o.join()}), ${i})`;this.userCode=`
    void main() {
      ${s} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${u}) {
        result[1] = ${l};
      }
      --${a[this.rank-1]};
      if(++${a[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${l};
        if(${u}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T1(n,e,t){const r=de().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Jde(n.shape,e):new Zde(n.shape,e);return t.runWebGLProgram(r,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function efe(n,e,t,r){const s=e,a=n.shape.length,o=Nt(s,n.shape);let i=o;const u=Cn(i,a),l=u!=null;let c=n;l&&(c=T1(n,u,r),i=Mn(i.length,a)),Or("sum",i,a);const[d,p]=yr(c.shape,i);let m=d;t&&(m=Fn(d,o));const v=xe(p),y=xe(n.shape)/v,w=Me({inputs:{x:c},attrs:{shape:[y,v]},backend:r}),S=Cx(n.dtype),N=Cc(w,S,"sum",r),C=Me({inputs:{x:N},attrs:{shape:m},backend:r});return r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(N),l&&r.disposeIntermediateTensorInfo(c),C}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I1(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a,keepDims:o}=r;return efe(s,a,o,t)}const tfe={kernelName:cg,backendName:"webgl",kernelFunc:I1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function os(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{perm:a}=r,o=t,i=s.shape.length,u=new Array(i);for(let c=0;c<u.length;c++)u[c]=s.shape[a[c]];let l;if(o.shouldExecuteOnCPU([s])){const d=o.texData.get(s.dataId).values,p=SI(d,s.shape,s.dtype,a,u);l=o.makeTensorInfo(u,s.dtype);const m=o.texData.get(l.dataId);m.values=p}else l=T1(s,a,o);return l}const nfe={kernelName:Vl,backendName:"webgl",kernelFunc:os};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zz=1e3;function Vb({a:n,b:e,transposeA:t,transposeB:r,backend:s,bias:a=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:u=null}){const l=n.shape.length,c=e.shape.length,d=t?n.shape[l-2]:n.shape[l-1],p=r?e.shape[c-1]:e.shape[c-2],m=t?n.shape[l-1]:n.shape[l-2],v=r?e.shape[c-2]:e.shape[c-1],b=n.shape.slice(0,-2),y=e.shape.slice(0,-2),w=xe(b),S=xe(y),C=mt(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([m,v]);B(d===p,()=>`Error in matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${r} must match.`);const T=t?[w,d,m]:[w,m,d],E=r?[S,v,p]:[S,p,v],$=Me({inputs:{x:n},backend:s,attrs:{shape:T}}),_=Me({inputs:{x:e},backend:s,attrs:{shape:E}}),R=[$,_],D=Math.max(w,S),A=t?$.shape[1]:$.shape[2],M=a!=null,H=o!=null,j=u==="leakyrelu",G=u!=null?sm(u,!0):null,P=M||H||j||G!=null;let V;if((m===1||v===1)&&A>Zz&&P===!1){let Y=$,L=_;t&&(Y=os({inputs:{x:$},backend:s,attrs:{perm:[0,2,1]}}),R.push(Y)),r&&(L=os({inputs:{x:_},backend:s,attrs:{perm:[0,2,1]}}),R.push(L));const K=v!==1,J=v===1;let Z=Y;K&&(Z=Me({inputs:{x:Y},backend:s,attrs:{shape:[D,A,1]}}),R.push(Z));const le=v===1?2:1;let pe=L;J&&(pe=Me({inputs:{x:L},backend:s,attrs:{shape:[D,1,A]}}),R.push(pe));const ge=NI({inputs:{a:Z,b:pe},backend:s});V=I1({inputs:{x:ge},backend:s,attrs:{axis:le,keepDims:!0}}),R.push(ge)}else{const Y=ms(n.dtype,e.dtype),L=new Yz(T,E,[D,m,v],t,r,M,G,H,j),K=[$,_];if(a!=null&&K.push(a),H&&K.push(o),j){const J=s.makeTensorInfo([],"float32",ki(i,"float32"));K.push(J),R.push(J)}V=s.runWebGLProgram(L,K,Y)}const z=Me({inputs:{x:V},backend:s,attrs:{shape:C}});R.push(V);for(const Y of R)s.disposeIntermediateTensorInfo(Y);return z}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rfe(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:a,bias:o,preluActivationWeights:i}=e,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:d}=r;return Vb({a:s,b:a,transposeA:u,transposeB:l,backend:t,bias:o,preluActivationWeights:i,leakyreluAlpha:d,activation:c})}const sfe={kernelName:Up,backendName:"webgl",kernelFunc:rfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vO="return abs(x);";function afe(n){const{inputs:e,backend:t}=n,{x:r}=e;if(t.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const a=t.texData.get(r.dataId),o=Uz(a.values);return t.makeTensorInfo(r.shape,r.dtype,o)}let s;return de().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new yu(r.shape,vO):s=new Co(r.shape,vO),t.runWebGLProgram(s,[r],r.dtype)}const ofe={kernelName:mm,backendName:"webgl",kernelFunc:afe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ife=Oa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,ufe=Pt({opSnippet:ife}),lfe={kernelName:od,backendName:"webgl",kernelFunc:ufe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cfe=Oa+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,hfe=Pt({opSnippet:cfe}),dfe={kernelName:id,backendName:"webgl",kernelFunc:hfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yO="return a + b;",ffe=Mr({opSnippet:yO,packedOpSnippet:yO,supportsComplex:!0,cpuKernelImpl:Che}),pfe={kernelName:fc,backendName:"webgl",kernelFunc:ffe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mfe{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((a,o)=>`T${o}`);const r=[];this.variableNames.forEach(a=>{r.push(`float v${a} = get${a}AtOutCoords();`)});const s=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${s};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gfe{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((a,o)=>`T${o}`);const r=[];this.variableNames.forEach(a=>{r.push(`vec4 v${a} = get${a}AtOutCoords();`)});const s=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${s};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cb(n){const{inputs:e,backend:t}=n,r=e;if(r.length===1)return Ps({inputs:{x:r[0]},backend:t});if(r.length>de().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const u=Math.floor(r.length/2),l=cb({inputs:r.slice(0,u),backend:t}),c=cb({inputs:r.slice(u),backend:t});return cb({inputs:[l,c],backend:t})}const s=r.map(u=>u.dtype).reduce((u,l)=>ms(u,l)),a=r.map(u=>u.shape),i=de().getBool("WEBGL_PACK")?new gfe(r[0].shape,a):new mfe(r[0].shape,a);return t.runWebGLProgram(i,r,s)}const vfe={kernelName:gm,backendName:"webgl",kernelFunc:cb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yfe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a,keepDims:o}=r,i=s.shape.length,u=Nt(a,s.shape);let l=u;const c=Cn(l,i);let d=s;c!=null&&(d=os({inputs:{x:s},backend:t,attrs:{perm:c}}),l=Mn(l.length,i)),Or("all",l,i);const[p,m]=yr(d.shape,l),v=xe(m),b=Me({inputs:{x:d},backend:t,attrs:{shape:[-1,v]}}),y=Cc(b,b.dtype,"all",t);let w;if(o){const S=Fn(p,u);w=Me({inputs:{x:y},backend:t,attrs:{shape:S}})}else w=Me({inputs:{x:y},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(y),c!=null&&t.disposeIntermediateTensorInfo(d),w}const bfe={kernelName:v0,backendName:"webgl",kernelFunc:yfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xfe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a,keepDims:o}=r,i=s.shape.length,u=Nt(a,s.shape);let l=u;const c=Cn(l,i);let d=s;c!=null&&(d=os({inputs:{x:s},backend:t,attrs:{perm:c}}),l=Mn(l.length,i)),Or("any",l,i);const[p,m]=yr(d.shape,l),v=xe(m),b=Me({inputs:{x:d},backend:t,attrs:{shape:[-1,v]}}),y=Cc(b,b.dtype,"any",t);let w;if(o){const S=Fn(p,u);w=Me({inputs:{x:y},backend:t,attrs:{shape:S}})}else w=Me({inputs:{x:y},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(y),c!=null&&t.disposeIntermediateTensorInfo(d),w}const wfe={kernelName:y0,backendName:"webgl",kernelFunc:xfe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sfe{constructor(e,t,r){this.variableNames=["A"];const{windowSize:s,batchSize:a,outSize:o}=e;r||this.variableNames.push("bestIndicesA"),this.outputShape=[a,o];const i=t==="max"?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${s}; i++) {
          int inIdx = ${u};
          float candidate = getA(batch, inIdx);
          if (candidate ${i} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cfe{constructor(e,t,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,B(e.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);const a=e[e.length-1],o=Math.ceil(a/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),s||this.variableNames.push("bestIndicesA");const i=this.outputShape,u=i.length,l=Jt(u),c=ns("coords",u);let d,p;if(o===1){p=u+1;const _=Jt(p);d=`
        ${_} sourceLocR = ${_}(${c.join()}, 0);
        ++${c[u-1]};
        ${_} sourceLocG = ${_}(${c.join()}, 0);
        ++${c[u-2]};
        ${_} sourceLocA = ${_}(${c.join()}, 0);
        --${c[u-1]};
        ${_} sourceLocB = ${_}(${c.join()}, 0);
        --${c[u-2]};`}else p=u,d=`
        ${l} sourceLocR = coords;
        ++${c[u-1]};
        ${l} sourceLocG = coords;
        ++${c[u-2]};
        ${l} sourceLocA = coords;
        --${c[u-1]};
        ${l} sourceLocB = coords;
        --${c[u-2]};`;const m=["x","y","z","w","u","v"].slice(0,p),v="."+m[p-1],b=m.map(_=>"int "+_),y=ns("sourceLocR",p-1).concat("inIdx.r"),w=ns("sourceLocG",p-1).concat("inIdx.g"),S=ns("sourceLocB",p-1).concat("inIdx.b"),N=ns("sourceLocA",p-1).concat("inIdx.a"),C=r==="max"?"greaterThan":"lessThan",T=s?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${S.join()}),
                             getBestIndicesAChannel(${N.join()})));`,E=`vec4(
            getAChannel(${y.join()}),
            hasNextCol ? getAChannel(${w.join()}) : 0.,
            hasNextRow ? getAChannel(${S.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${N.join()}) : 0.)`,$=s?"":`
      float getBestIndicesAChannel(${b.join()}) {
        return getChannel(getBestIndicesA(${m.join()}),
                                          vec2(${m.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${b.join()}) {
        return getChannel(getA(${m.join()}),
                               vec2(${m.slice(-2).join()}));
      }
      ${$}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${c[u-1]} < ${i[u-1]-1};
        bool hasNextRow = ${c[u-2]} < ${i[u-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${v}, sourceLocG${v},
          sourceLocB${v}, sourceLocA${v}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${E};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${T}
          vec4 candidate = ${E};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${C}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qz(n,e,t,r=null){let s=e.shape[0],a=e.shape[1];r!=null&&(s=r.shape[0],a=r.shape[1]);const o=l1(a),i={windowSize:o,inSize:a,batchSize:s,outSize:Math.ceil(a/o)},u=new Sfe(i,t,r==null),l=[e];r!=null&&l.push(r);const c=n.runWebGLProgram(u,l,"int32");if(c.shape[1]===1)return c;const d=Qz(n,e,t,c);return n.disposeIntermediateTensorInfo(c),d}function Jz(n,e,t,r=null){const s=r!=null?r.shape:e.shape,a=s[s.length-1],o=l1(a),i=new Cfe(s,o,t,r==null),u=r==null?[e]:[e,r],l=n.runWebGLProgram(i,u,"int32");if(l.shape.length===e.shape.length){const c=Jz(n,e,t,l);return n.disposeIntermediateTensorInfo(l),c}return l}function eV(n,e,t,r){const s=[t];if(Or("arg"+r.charAt(0).toUpperCase()+r.slice(1),s,e.shape.length),!de().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const a=[],o=n.texData.get(e.dataId),i=o!==null&&o.isPacked;let u=e;i&&(u=n.unpackTensor(e),a.push(u));const[l,c]=yr(u.shape,s),d=xe(c),p=Me({inputs:{x:u},backend:n,attrs:{shape:[-1,d]}});a.push(p);const m=Qz(n,p,r);a.push(m);const v=Me({inputs:{x:m},backend:n,attrs:{shape:l}});return a.forEach(b=>n.disposeIntermediateTensorInfo(b)),v}return Jz(n,e,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nfe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a}=r;let o=Nt(a,s.shape);const i=Cn(o,s.shape.length);let u=s;const l=[];i!=null&&(u=os({inputs:{x:s},backend:t,attrs:{perm:i}}),l.push(u),o=Mn(o.length,u.shape.length)),Or("argMax",[o[0]],u.shape.length);const c=eV(t,u,o[0],"max");return l.forEach(d=>t.disposeIntermediateTensorInfo(d)),c}const kfe={kernelName:vm,backendName:"webgl",kernelFunc:Nfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tfe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a}=r;let o=Nt(a,s.shape);const i=Cn(o,s.shape.length);let u=s;const l=[];i!=null&&(u=os({inputs:{x:s},backend:t,attrs:{perm:i}}),l.push(u),o=Mn(o.length,u.shape.length)),Or("argMin",[o[0]],u.shape.length);const c=eV(t,u,o[0],"min");return l.forEach(d=>t.disposeIntermediateTensorInfo(d)),c}const Ife={kernelName:ym,backendName:"webgl",kernelFunc:Tfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Efe=Oa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,_fe=Pt({opSnippet:Efe}),Rfe={kernelName:ud,backendName:"webgl",kernelFunc:_fe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Afe=Oa+"return log(x + sqrt(x * x + 1.0));",Dfe=Pt({opSnippet:Afe}),$fe={kernelName:ld,backendName:"webgl",kernelFunc:Dfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ofe=Oa+`
  return atan(x);
`,Ffe=Pt({opSnippet:Ofe}),Mfe={kernelName:cd,backendName:"webgl",kernelFunc:Ffe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lfe=CI+`
  return atan(a, b);
`,Pfe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Sc+`
  return result;
`,Bfe=Mr({opSnippet:Lfe,packedOpSnippet:Pfe}),zfe={kernelName:dd,backendName:"webgl",kernelFunc:Bfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vfe=Oa+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Ufe=Pt({opSnippet:Vfe}),Wfe={kernelName:hd,backendName:"webgl",kernelFunc:Ufe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class am{constructor(e,t,r,s=!1,a=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,i=e.strideHeight,u=e.strideWidth,l=e.dilationHeight,c=e.dilationWidth,d=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;const b=t==="avg",y=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,w=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let S="0.0";if(b||(S="-1.0 / 1e-20"),r){const _=">=";this.userCode=`
        const ivec2 strides = ivec2(${i}, ${u});
        const ivec2 pads = ivec2(${m}, ${v});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${_} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${s?a?y:w:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const N="max";let C=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(C="avgValue / max(count, 1.0)");const T=Math.floor(o/4)*4,E=o%4,$=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${N}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${u});
      const ivec2 pads = ivec2(${m}, ${v});
      const float initializationValue = ${S};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${S});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${T}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${$}
          }

          int xC = xCCorner + ${T};
          if (${E===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${$}
          } else if (${E===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${$}
          } else if (${E===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${$}
          }
        }
        setOutput(${C});
      }
    `}}class kI{constructor(e,t,r,s=!1,a=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,i=e.strideDepth,u=e.strideHeight,l=e.strideWidth,c=e.dilationDepth,d=e.dilationHeight,p=e.dilationWidth,m=e.effectiveFilterDepth,v=e.effectiveFilterHeight,b=e.effectiveFilterWidth,y=e.padInfo.front,w=e.padInfo.top,S=e.padInfo.left;this.outputShape=e.outShape;const N=t==="avg";let C="0.0";if(N||(C="-1.0 / 1e-20"),r){const D=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${i}, ${u}, ${l});
        const ivec3 pads = ivec3(${y}, ${w}, ${S});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${m};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${v};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${b};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${D} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${s?a?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${v} * ${b} +
                      wR * ${b} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const T="max";let E=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(E="avgValue / max(count, 1.0)");const $=Math.floor(o/4)*4,_=o%4,R=`
      if (${N}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${T}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${i}, ${u}, ${l});
      const ivec3 pads = ivec3(${y}, ${w}, ${S});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${m};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${v};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${$}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${R}
            }

            int xC = xCCorner + ${$};
            if (${_===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${_===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${_===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${R}
            }
          }
        }
        setOutput(${E});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gfe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Zg(s,"avgPool");const{filterSize:a,strides:o,pad:i,dimRoundingMode:u}=r,l=1;B($r(o,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=Da(s.shape,a,o,l,i,u);if(c.filterWidth===1&&c.filterHeight===1&&Et(c.inShape,c.outShape))return Ps({inputs:{x:s},backend:t});const d=new am(c,"avg",!1);return t.runWebGLProgram(d,[s],"float32")}const Hfe={kernelName:bm,backendName:"webgl",kernelFunc:Gfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jfe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:a,strides:o,pad:i,dimRoundingMode:u,dataFormat:l}=r,c=[1,1,1],d=Ti(s.shape,a,o,c,i,u,l),p=new kI(d,"avg",!1);return t.runWebGLProgram(p,[s],"float32")}const qfe={kernelName:xm,backendName:"webgl",kernelFunc:jfe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kfe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,a=e.strideWidth,o=e.dilationHeight,i=e.dilationWidth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=u-1-e.padInfo.top,d=l-1-e.padInfo.left,p=1/(t*r);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${d});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${u};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${i}) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Xfe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,s=e.filterWidth,a=e.strideDepth,o=e.strideHeight,i=e.strideWidth,u=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,d=e.effectiveFilterDepth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,v=d-1-e.padInfo.front,b=p-1-e.padInfo.top,y=m-1-e.padInfo.left,w=1/(t*r*s);this.userCode=`
      const ivec3 pads = ivec3(${v}, ${b}, ${y});
      const float avgMultiplier = float(${w});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${u}) {
          float dyD = float(dyDCorner + wD) / ${a}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${m};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yfe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:a}=e,o=a,{filterSize:i,strides:u,pad:l,dimRoundingMode:c}=r,d=[1,1,1],p=Ti(o.shape,i,u,d,l,c),m=new Xfe(p);return t.runWebGLProgram(m,[s],o.dtype)}const Zfe={kernelName:x0,backendName:"webgl",kernelFunc:Yfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qfe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:a}=e,o=a;Zg([s,a],"avgPoolGrad");const{filterSize:i,strides:u,pad:l}=r,c=Da(o.shape,i,u,1,l),d=new Kfe(c);return t.runWebGLProgram(d,[s],o.dtype)}const Jfe={kernelName:b0,backendName:"webgl",kernelFunc:Qfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function epe(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:a}=e,{transposeA:o,transposeB:i}=r;return Vb({a:s,b:a,transposeA:o,transposeB:i,backend:t})}const tpe={kernelName:wm,backendName:"webgl",kernelFunc:epe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class npe{constructor(e,t,r,s,a,o){this.outputShape=[],this.variableNames=["x","mean","variance"],mt(e,t),mt(e,r);let i="0.0";s!=null&&(mt(e,s),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");let u="1.0";a!=null&&(mt(e,a),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${i};
        float scale = ${u};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rpe{constructor(e,t,r,s,a,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],mt(e,t),mt(e,r);let i="vec4(0.0)";s!=null&&(mt(e,s),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");let u="vec4(1.0)";a!=null&&(mt(e,a),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${i};
        vec4 scale = ${u};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const spe=({inputs:n,backend:e,attrs:t})=>{const{x:r,mean:s,variance:a,offset:o,scale:i}=n;B(s.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),B(o==null||s.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),B(i==null||s.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:u}=t;u==null&&(u=.001);const l=[r,s,a];let c=null;o!=null&&(c=o.shape,l.push(o));let d=null;i!=null&&(d=i.shape,l.push(i));const p=de().getBool("WEBGL_PACK_NORMALIZATION")?new rpe(r.shape,s.shape,a.shape,c,d,u):new npe(r.shape,s.shape,a.shape,c,d,u);return e.runWebGLProgram(p,l,l[0].dtype)},ape={kernelName:Om,backendName:"webgl",kernelFunc:spe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ope{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=Jt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const r=ipe(this.rank);let s;const a=e.map((o,i)=>`sourceLoc.${sN[i]} = start[${i}] + coords.${sN[i]};`);s=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${a.join(`
`)}
      `,this.userCode=`
      void main() {
        ${s}
        setOutput(getSource(${r}));
      }
    `}}const sN=["x","y","z","w","u","v"];function ipe(n){if(n===1)return"sourceLoc";if(n<=6)return sN.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class upe{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=Jt(this.rank),r=ns("coords",this.rank),s=ns("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":`vec2(${s.slice(-2).join()})`,o=`getChannel(getSource(${s.join()}), ${a})`,i=`
      result.x = ${o};
      if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
        ++${s[this.rank-1]};
        result.y = ${o};
        --${s[this.rank-1]};
      }
    `,u=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${e[this.rank-2]}) {
        ++${s[this.rank-2]};
        result.z = ${o};
        if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
          ++${s[this.rank-1]};
          result.w = ${o};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((c,d)=>`start[${d}]`).join()});`:e.map((c,d)=>`${s[d]} = ${r[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${i}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lpe(n,e,t,r){const s=r.texData.get(n.dataId),a=r.makeTensorInfo(t,n.dtype),o=r.texData.get(a.dataId);Object.assign(o,s),o.refCount=1,o.shape=t,o.dtype=n.dtype;let i=gT(e,rt(n.shape));s.slice&&(i+=s.slice.flatOffset),o.slice={flatOffset:i,origDataId:s.slice&&s.slice.origDataId||n.dataId};const u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),a}function vf(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:a,size:o}=r,[i,u]=u1(s,a,o);if(fT(s,i,u),xe(u)===0)return t.makeTensorInfo(u,s.dtype,[]);if(t.shouldExecuteOnCPU([s])||s.dtype==="string"){const d=t.texData.get(s.dataId),p=tde(d.values,i,u,s.shape,s.dtype);return t.makeTensorInfo(u,s.dtype,p)}const{isPacked:l}=t.texData.get(s.dataId),c=mT(s.shape,i,u);if(l||!c){const d=de().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new upe(u):new ope(u),p=[i];return t.runWebGLProgram(d,[s],s.dtype,p)}return t.uploadToGPU(s.dataId),lpe(s,i,u,t)}const cpe={kernelName:lg,backendName:"webgl",kernelFunc:vf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hpe=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:a,crops:o}=r;B(s.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const i=a.reduce((S,N)=>S*N),u=Pg(s.shape,a,i),l=Bg(u.length,a.length),c=zg(s.shape,a,i),d=ST(o,a.length),p=CT(c,o,a.length),m=[],v=Me({inputs:{x:s},backend:t,attrs:{shape:u}}),b=os({inputs:{x:v},backend:t,attrs:{perm:l}}),y=Me({inputs:{x:b},backend:t,attrs:{shape:c}}),w=vf({inputs:{x:y},backend:t,attrs:{begin:d,size:p}});return m.push(v),m.push(b),m.push(y),m.forEach(S=>t.disposeIntermediateTensorInfo(S)),w},dpe={kernelName:Sm,backendName:"webgl",kernelFunc:hpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fpe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:a}=e,{size:o}=r,i=t.readSync(s.dataId),u=t.readSync(a.dataId),l=Vz(i,u,a.dtype,a.shape,o);return t.makeTensorInfo([o],a.dtype,l)}const ppe={kernelName:w0,backendName:"webgl",kernelFunc:fpe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mpe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,gpe=`
  return float(int(a.r) & int(b.r));
`;function vpe(n){const{inputs:e,backend:t}=n,{a:r,b:s}=e,a=de().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=de().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([r,s])||o===1){const u=t.texData.get(r.dataId).values,l=t.texData.get(s.dataId).values,[c,d]=khe(r.shape,s.shape,u,l,r.dtype),p=t.makeTensorInfo(d,r.dtype),m=t.texData.get(p.dataId);return m.values=c,p}let i;return a?i=new mf(mpe,r.shape,s.shape,!1):i=new oc(gpe,r.shape,s.shape),t.runWebGLProgram(i,[r,s],r.dtype)}const ype={kernelName:Cm,backendName:"webgl",kernelFunc:vpe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bpe(n){const{inputs:e,backend:t}=n,{s0:r,s1:s}=e,a=t.readSync(r.dataId),o=t.readSync(s.dataId),i=mt(Array.from(a),Array.from(o));return t.makeTensorInfo([i.length],"int32",Int32Array.from(i))}const xpe={kernelName:S0,backendName:"webgl",kernelFunc:bpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wpe="return float(a != b);",tV=Mr({opSnippet:wpe,cpuKernelImpl:jhe,dtype:"bool"}),Spe={kernelName:Zm,backendName:"webgl",kernelFunc:tV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jg(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.texData.get(r.dataId);return Ps({inputs:{x:s.complexTensorInfos.real},backend:t})}const Cpe={kernelName:nx,backendName:"webgl",kernelFunc:Jg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Npe="return float(int(x));";function kpe(n,e){const t=new Co(n.shape,Npe),r=e.runWebGLProgram(t,[n],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aN(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dtype:a}=r;if(a==="complex64"){if(s.dtype==="complex64")return Ps({inputs:{x:s},backend:t});const o=Wn(s.shape),i=aN({inputs:{x:s},backend:t,attrs:{dtype:"float32"}}),u=Zu({inputs:{real:i,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(i),u}if(s.dtype==="complex64"){const o=Jg({inputs:{input:s},backend:t}),i=aN({inputs:{x:o},backend:t,attrs:{dtype:a}});return t.disposeIntermediateTensorInfo(o),i}if(!BN(s.dtype,a)){const o=Ps({inputs:{x:s},backend:t});return{dataId:o.dataId,shape:o.shape,dtype:a}}if(t.shouldExecuteOnCPU([s])){const o=t.texData.get(s.dataId).values,[i,u,l]=The(o,s.shape,s.dtype,a);return t.makeTensorInfo(i,u,l)}if(a==="int32")return kpe(s,t);if(a==="bool"){const o=t.makeTensorInfo([],"bool",fr("bool",1)),u=tV({inputs:{a:s,b:o},backend:t});return t.disposeIntermediateTensorInfo(o),u}throw new Error(`Error in Cast: failed to cast ${s.dtype} to ${a}`)}const Tpe={kernelName:fd,backendName:"webgl",kernelFunc:aN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bO="return ceil(x);",Ipe=Pt({opSnippet:bO,packedOpSnippet:bO,cpuKernelImpl:Ihe}),Epe={kernelName:pd,backendName:"webgl",kernelFunc:Ipe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _pe{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rpe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ape(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{clipValueMin:a,clipValueMax:o}=r;let i;de().getBool("WEBGL_PACK_CLIP")?i=new Rpe(s.shape):i=new _pe(s.shape);const u=[[a],[o]];return t.runWebGLProgram(i,[s],s.dtype,u)}const Dpe={kernelName:md,backendName:"webgl",kernelFunc:Ape};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $pe{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xO(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function Ope(n){const{inputs:e,backend:t}=n,{x:r}=e,s=t.texData.get(r.dataId),a=new $pe(r.shape),o=[xO(r,s.complexTensorInfos.real),xO(r,s.complexTensorInfos.imag)];return t.runWebGLProgram(a,o,o[0].dtype)}const Fpe={kernelName:Nm,backendName:"webgl",kernelFunc:Ope};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mpe{constructor(e){this.outputShape=[],this.outputShape=Io(e,1),this.variableNames=e.map((o,i)=>`T${i}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let o=1;o<t.length;o++)t[o]=t[o-1]+e[o][1];const r=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<t.length;o++){const i=t[o-1];r.push(`else if (yC < ${t[o]}) setOutput(getT${o}(yR, yC-${i}));`)}const s=t.length,a=t[t.length-1];r.push(`else setOutput(getT${s}(yR, yC-${a}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lpe{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Io(e,t);const r=this.outputShape,s=r.length,a=Jt(s),o=ns("coords",s),i=["x","y","z","w","u","v"].slice(0,s);this.variableNames=e.map((b,y)=>`T${y}`);const u=new Array(e.length-1);u[0]=e[0][t];for(let b=1;b<u.length;b++)u[b]=u[b-1]+e[b][t];const l=i[t],c=i.slice(-2),d=i.join();let p=`if (${l} < ${u[0]}) {
        return getChannel(
            getT0(${d}), vec2(${c.join()}));
        }`;for(let b=1;b<u.length;b++){const y=u[b-1];p+=`
        if (${l} < ${u[b]}  && ${l} >= ${u[b-1]}) {
          return getChannel(
            getT${b}(${By(i,l,y)}),
            vec2(${By(c,l,y)}));
        }`}const m=u.length,v=u[u.length-1];p+=`
        return getChannel(
          getT${m}(${By(i,l,v)}),
          vec2(${By(c,l,v)}));`,this.userCode=`
      float getValue(${i.map(b=>"int "+b)}) {
        ${p}
      }

      void main() {
        ${a} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[s-1]} = ${o[s-1]} + 1;
        if (${o[s-1]} < ${r[s-1]}) {
          result.g = getValue(${o});
        }

        ${o[s-2]} = ${o[s-2]} + 1;
        if (${o[s-2]} < ${r[s-2]}) {
          result.a = getValue(${o});
        }

        ${o[s-1]} = ${o[s-1]} - 1;
        if (${o[s-2]} < ${r[s-2]} &&
            ${o[s-1]} < ${r[s-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function By(n,e,t){const r=n.indexOf(e);return n.map((a,o)=>o===r?`${a} - ${t}`:a).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E1(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.texData.get(r.dataId);return Ps({inputs:{x:s.complexTensorInfos.imag},backend:t})}const Ppe={kernelName:U0,backendName:"webgl",kernelFunc:E1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $p(n,e,t){const r=n[0].dtype;if(r==="complex64"){const m=n.map(S=>Jg({inputs:{input:S},backend:t})),v=n.map(S=>E1({inputs:{input:S},backend:t})),b=$p(m,e,t),y=$p(v,e,t),w=Zu({inputs:{real:b,imag:y},backend:t});return m.forEach(S=>t.disposeIntermediateTensorInfo(S)),v.forEach(S=>t.disposeIntermediateTensorInfo(S)),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(y),w}let s=t.shouldExecuteOnCPU(n);if(r==="string"&&(s=!0),s){const m=n.map(C=>{const E=[-1,xe(C.shape.slice(e))];return Me({inputs:{x:C},backend:t,attrs:{shape:E}})}),v=m.map(C=>({vals:t.readSync(C.dataId),shape:C.shape})),b=Io(m.map(C=>C.shape),1),y=m[0].shape[0]===1,w=Ehe(v,b,r,y),S=Io(n.map(C=>C.shape),e),N=t.makeTensorInfo(S,r,w);return m.forEach(C=>t.disposeIntermediateTensorInfo(C)),N}const a=n.filter(m=>xe(m.shape)>0),o=de().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&a[0].shape.length>1;if(a.length===1){const m=o?new Co(n[0].shape,mu):new yu(n[0].shape,mu);return t.runWebGLProgram(m,n,r)}const i=de().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(a.length>i){const m=[];for(let b=0;b<a.length;b+=i){const y=a.slice(b,b+i);m.push($p(y,e,t))}const v=$p(m,e,t);for(const b of m)t.disposeIntermediateTensorInfo(b);return v}if(o){const m=new Lpe(a.map(v=>v.shape),e);return t.runWebGLProgram(m,a,r)}const{tensors2D:u,outShape:l}=Bpe(a,e,t),c=new Mpe(u.map(m=>m.shape)),d=t.runWebGLProgram(c,u,r);u.forEach(m=>t.disposeIntermediateTensorInfo(m));const p=Me({inputs:{x:d},attrs:{shape:l},backend:t});return t.disposeIntermediateTensorInfo(d),p}function Bpe(n,e,t){const r=Io(n.map(a=>a.shape),e);return{tensors2D:n.map(a=>Me({inputs:{x:a},attrs:{shape:[-1,xe(a.shape.slice(e))]},backend:t})),outShape:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nV(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r,a=Nt(s,e[0].shape)[0],o=e.map(l=>l.shape);bT(o,a);const i=Io(e.map(l=>l.shape),a);if(xe(i)===0)return t.makeTensorInfo(i,e[0].dtype,[]);const u=e.filter(l=>xe(l.shape)>0);return u.length===1?Ps({inputs:{x:u[0]},backend:t}):$p(u,a,t)}const zpe={kernelName:km,backendName:"webgl",kernelFunc:nV};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rV{constructor(e,t=!1,r=null,s=!1,a=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,i=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,d=e.dilationWidth,p=e.filterHeight,m=e.filterWidth,v=Math.floor(e.inChannels/4)*4,b=e.inChannels%4,y=e.dataFormat==="channelsLast",w=y?1:2,S=y?2:3,N=y?3:1;let C="",T="";r&&(s?C=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:a?C=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:C=`
          float activation(float x) {
            ${r}
          }
        `,T="result = activation(result);");const E=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${C}

      const ivec2 strides = ivec2(${u}, ${l});
      const ivec2 pads = ivec2(${o}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${N}];

        ivec2 xRCCorner =
            ivec2(coords[${w}], coords[${S}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${m}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${v}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${y}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${b===1}) {

              if (${y}) {
                dotProd +=
                    getX(batch, xR, xC, ${v}) *
                    getW(wR, wC, ${v}, d2);
              } else {
                dotProd +=
                    getX(batch, ${v}, xR, xC) *
                    getW(wR, wC, ${v}, d2);
              }

            } else if (${b===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${v}, d2),
                getW(wR, wC, ${v} + 1, d2)
              );

              if (${y}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${v}),
                  getX(batch, xR, xC, ${v} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${v}, xR, xC),
                  getX(batch, ${v} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${b===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${v}, d2),
                getW(wR, wC, ${v} + 1, d2),
                getW(wR, wC, ${v} + 2, d2)
              );

              if (${y}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${v}),
                  getX(batch, xR, xC, ${v} + 1),
                  getX(batch, xR, xC, ${v} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${v}, xR, xC),
                  getX(batch, ${v} + 1, xR, xC),
                  getX(batch, ${v} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${E}
        ${T}
        setOutput(result);
      }
    `}}class Vpe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,r=e.padInfo.top,s=e.padInfo.left,a=e.strideDepth,o=e.strideHeight,i=e.strideWidth,u=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,d=e.filterDepth,p=e.filterHeight,m=e.filterWidth,v=Math.floor(e.inChannels/4)*4,b=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${a}, ${o}, ${i});
      const ivec3 pads = ivec3(${t}, ${r}, ${s});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${u};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${m}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${v}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${b===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${v}) *
                  getW(wF, wR, wC, ${v}, d2);
              } else if (${b===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${v}),
                  getX(batch, xF, xR, xC, ${v} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${v}, d2),
                  getW(wF, wR, wC, ${v} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${b===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${v}),
                  getX(batch, xF, xR, xC, ${v} + 1),
                  getX(batch, xF, xR, xC, ${v} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${v}, d2),
                  getW(wF, wR, wC, ${v} + 1, d2),
                  getW(wF, wR, wC, ${v} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sV{constructor(e,t=!1,r=null,s=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=jr(this.outputShape.length);const o=e.padInfo.left,i=e.strideWidth,u=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,d=c;let p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<c;y++)p+=`
           vec4 xTexelC${y*2};
           int xTexelC${y*2}Ready;
           vec4 xTexelC${y*2+1};
           int xTexelC${y*2+1}Ready;
           vec4 xC${y};`;p+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let y=0;y<c;y++)p+=`
           xTexelC${y*2} = vec4(0.0);
           xTexelC${y*2}Ready = 0;
           xTexelC${y*2+1} = vec4(0.0);
           xTexelC${y*2+1}Ready = 0;
           xC${y} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let y=0;y<(d+1)/2;y++){const w=y*2;if(p+=`
           xC = xCCorner + ${w*u};
           `,i===1){if(w<c&&(o%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                   xTexelC${w} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${w}.zw = vec2(0.0);
                   }
                   xTexelC${w}Ready = 1;
                 }
               `,u===1&&w>0?p+=`
                 xC${w} = vec4(xTexelC${w-2}.zw, xTexelC${w}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${w} = vec4(previous.zw, xTexelC${w}.xy);
                   } else {
                     xC${w} = vec4(0.0, 0.0, xTexelC${w}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                   xTexelC${w} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${w}.zw = vec2(0.0);
                   }
                   xTexelC${w}Ready = 1;
                 }

                 xC${w} = xTexelC${w};
                 `,w+1<c)){const S=o%2===0?m0(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${S};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                     xTexelC${w+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${w+1}.zw = vec2(0.0);
                     }
                     xTexelC${w+1}Ready = 1;
                   }
                   `,u>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${w+1} = vec4(previous.zw, xTexelC${w+1}.xy);
                     } else {
                      xC${w+1} = vec4(0.0, 0.0, xTexelC${w+1}.xy);
                     }
                     `:p+=`
                     xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.xy);
                     `):S===1?p+=`
                     xC${w+1} = xTexelC${w};
                     `:p+=`
                     xCOffset = xC + ${S};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                       xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${w+1}.zw = vec2(0.0);
                       }
                       xTexelC${w+1}Ready = 1;
                     }

                     xC${w+1} = xTexelC${w+1};
                     `}}else w<c&&(o%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                   xTexelC${w} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${w}.zw = vec2(0.0);
                   }
                   xTexelC${w}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${w+1}Ready == 0) {
                   xTexelC${w+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${w+1}.zw = vec2(0.0);
                   }
                   xTexelC${w+1}Ready = 1;
                 }

                 xC${w} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
               `,w+1<c&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${w+1} = vec4(xTexelC${w+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                   xTexelC${w} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${w}.zw = vec2(0.0);
                   }
                   xTexelC${w}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                   xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${w+1}.zw = vec2(0.);
                   }
                   xTexelC${w+1}Ready = 1;
                 }

                 xC${w} = vec4(
                   xTexelC${w}.xy, xTexelC${w+1}.xy);
               `,w+1<c&&(p+=`
                   xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
                 `)));w<c&&(p+=`
             wTexel = getW(r, ${w}, d1, d2);
             dotProd += xC${w}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${w}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,w+1<c&&(p+=`
               wTexel = getW(r, ${w+1}, d1, d2);
               dotProd += xC${w+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${w+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let m="",v="";r&&(s?m=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:a?m=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:m=`vec4 activation(vec4 x) {
           ${r}
         }`,v="result = activation(result);");const b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${m}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${b}
         ${v}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Upe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length);const{dataFormat:r}=t,s=ls(),a=r==="channelsLast",o=a?1:2,i=a?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let l="";for(let c=0;c<=1;c++)for(let d=0;d<=1;d++)l+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${c};

          ${u}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${i}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${a}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${s.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ub(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function aV({x:n,filter:e,convInfo:t,backend:r,bias:s=null,preluActivationWeights:a=null,leakyreluAlpha:o=0,activation:i=null}){const u=n.shape,l=r.texData.get(n.dataId),c=t.inChannels,d=u[0]*u[1]*u[2],p=t.outChannels,m=t.dataFormat==="channelsLast",v=!1,b=!1;let y;const w=[];if(a!=null){const C=Ub(a.shape,m);C!=null&&(a=Me({inputs:{x:a},backend:r,attrs:{shape:C}}),w.push(a))}if(s!=null){const C=Ub(s.shape,m);C!=null&&(s=Me({inputs:{x:s},backend:r,attrs:{shape:C}}),w.push(s))}if(!((d===1||p===1)&&c>Zz)&&l.isPacked&&m&&l.texture!=null&&u[2]%2!==0&&Et(l.shape.slice(-3),u.slice(-3))){const C=u[0]*u[1]*(u[2]+1),T={dataId:n.dataId,shape:[1,C,t.inChannels],dtype:n.dtype},E=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,B(zb(l.shape,T.shape),()=>`packed reshape ${l.shape} to ${T.shape} isn't free`);const $=Me({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}});w.push($);const _=Vb({a:T,b:$,backend:r,transposeA:v,transposeB:b,bias:s,activation:i,preluActivationWeights:a,leakyreluAlpha:o}),R=r.texData.get(_.dataId);B(R.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=E,R.shape=t.outShape,y=Ps({inputs:{x:_},backend:r}),y.shape=t.outShape,w.push(_)}else{const C=t.outHeight*t.outWidth,T=Me({inputs:{x:n},backend:r,attrs:{shape:m?[t.batchSize,C,t.inChannels]:[t.batchSize,t.inChannels,C]}}),E=Me({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}}),$=Vb({a:m?T:E,b:m?E:T,transposeA:!m,transposeB:b,backend:r,bias:s,activation:i,preluActivationWeights:a,leakyreluAlpha:o});y=Me({inputs:{x:$},backend:r,attrs:{shape:t.outShape}}),w.push(T),w.push(E),w.push($)}for(const C of w)r.disposeIntermediateTensorInfo(C);return y}function oV({x:n,filter:e,convInfo:t,backend:r,bias:s=null,preluActivationWeights:a=null,leakyreluAlpha:o=0,activation:i=null}){const{filterWidth:u,filterHeight:l,inChannels:c,outWidth:d,outHeight:p,dataFormat:m}=t,v=m==="channelsLast",b=u*l*c,y=p*d,w=[t.batchSize,b,y],S=!0,N=!1,C=[];if(a!=null){const z=Ub(a.shape,v);z!=null&&(a=Me({inputs:{x:a},backend:r,attrs:{shape:z}}),C.push(a))}if(s!=null){const z=Ub(s.shape,v);z!=null&&(s=Me({inputs:{x:s},backend:r,attrs:{shape:z}}),C.push(s))}const T=Me({inputs:{x:e},backend:r,attrs:{shape:[1,b,xe(e.shape)/b]}});C.push(T);const E=new Upe(w,t),$=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],_=r.runWebGLProgram(E,[n],"float32",$),R=Me({inputs:{x:_},backend:r,attrs:{shape:w}});C.push(_),C.push(R);const D=s!=null,A=a!=null,M=i==="leakyrelu",H=i?sm(i,!0):null,j=new Yz(v?R.shape:T.shape,v?T.shape:R.shape,v?[t.batchSize,y,t.outChannels]:[t.batchSize,t.outChannels,y],S,N,D,H,A,M),G=v?[R,T]:[T,R];if(s&&G.push(s),A&&G.push(a),M){const z=r.makeTensorInfo([],"float32",ki(o,"float32"));G.push(z),C.push(z)}const P=r.runWebGLProgram(j,G,"float32"),V=Me({inputs:{x:P},backend:r,attrs:{shape:t.outShape}});C.push(P);for(const z of C)r.disposeIntermediateTensorInfo(z);return V}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wpe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:a}=e,{strides:o,pad:i,dataFormat:u,dilations:l,dimRoundingMode:c}=r,d=Ii(u),p=vr(s.shape,a.shape,o,l,i,c,!1,d);let m;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))m=aV({x:s,filter:a,convInfo:p,backend:t});else if(p.strideWidth<=2&&d==="channelsLast"&&de().getBool("WEBGL_EXP_CONV")){const b=new sV(p),y=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];m=t.runWebGLProgram(b,[s,a],"float32",y)}else if(de().getBool("WEBGL_CONV_IM2COL"))m=oV({x:s,filter:a,convInfo:p,backend:t});else{const b=new rV(p);m=t.runWebGLProgram(b,[s,a],"float32")}const v=Me({inputs:{x:m},backend:t,attrs:{shape:p.outShape}});return t.disposeIntermediateTensorInfo(m),v}const Gpe={kernelName:Tm,backendName:"webgl",kernelFunc:Wpe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hpe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,a=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${a};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class jpe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,a=e.strideWidth,o=e.dataFormat==="channelsLast",i=t-1-e.padInfo.top,u=r-1-e.padInfo.left,l=o?1:2,c=o?2:3,d=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class qpe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,r=e.strideHeight,s=e.strideWidth,a=e.padInfo.front,o=e.padInfo.top,i=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${a};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${s} - ${i};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Kpe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,s=e.filterWidth,a=e.strideDepth,o=e.strideHeight,i=e.strideWidth,u=t-1-e.padInfo.front,l=r-1-e.padInfo.top,c=s-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${u}, ${l}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${a}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${s}; wC++) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${s} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xpe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:a}=e,{strides:o,pad:i,dataFormat:u,dimRoundingMode:l,filterShape:c}=r,d=Ii(u),p=vr(s.shape,c,o,1,i,l,!1,d),m=new Hpe(p);return t.runWebGLProgram(m,[s,a],"float32")}const Ype={kernelName:N0,backendName:"webgl",kernelFunc:Xpe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zpe{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=jr(this.outputShape.length);const t=e.filterHeight,r=e.filterWidth,s=t-1-e.padInfo.top,a=r-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            int wCPerm = ${r} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qpe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:a}=e,{inputShape:o,strides:i,pad:u,dataFormat:l,dimRoundingMode:c}=r,d=Ii(l),p=vr(o,a.shape,i,1,u,c,!1,d);if(de().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){const m=[[p.strideHeight,p.strideWidth]],v=new Zpe(p);return t.runWebGLProgram(v,[s,a],"float32",m)}else{const m=new jpe(p);return t.runWebGLProgram(m,[s,a],"float32")}}const Jpe={kernelName:Im,backendName:"webgl",kernelFunc:Qpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eme(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:a}=e,{strides:o,pad:i,dilations:u}=r,l=Wu(s.shape,a.shape,o,u,i),c=new Vpe(l);return t.runWebGLProgram(c,[s,a],"float32")}const tme={kernelName:Em,backendName:"webgl",kernelFunc:eme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nme(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:a}=e,{strides:o,pad:i,filterShape:u}=r,l=Wu(s.shape,u,o,1,i),c=new qpe(l);return t.runWebGLProgram(c,[s,a],"float32")}const rme={kernelName:k0,backendName:"webgl",kernelFunc:nme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sme(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:a}=e,{pad:o,strides:i,inputShape:u}=r,l=Wu(u,a.shape,i,1,o),c=new Kpe(l);return t.runWebGLProgram(c,[s,a],"float32")}const ame={kernelName:T0,backendName:"webgl",kernelFunc:sme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ome=gf+`
  return cos(x);
`,ime=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Sc}
  return result;
`,ume=Pt({opSnippet:ome,packedOpSnippet:ime}),lme={kernelName:gd,backendName:"webgl",kernelFunc:ume};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cme=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,hme=Pt({opSnippet:cme}),dme={kernelName:vd,backendName:"webgl",kernelFunc:hme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fme{constructor(e,t,r,s,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,i,u,l]=e,[c]=t,[d,p]=r;this.outputShape=[c,d,p,l];const m=s==="bilinear"?1:0,[v,b]=[`${i-1}.0`,`${u-1}.0`],[y,w,S]=d>1?[`${(i-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${v} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${v}`],[N,C,T]=p>1?[`${(u-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${b} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${b}`];this.userCode=`
      const float height_ratio = float(${y});
      const float width_ratio = float(${N});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${w};
        float width_scale = ${C};

        float in_y = ${S};
        if( in_y < 0.0 || in_y > ${v} ) {
          setOutput(float(${a}));
          return;
        }
        float in_x = ${T};
        if( in_x < 0.0 || in_x > ${b} ) {
          setOutput(float(${a}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${m} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pme=n=>{const{inputs:e,backend:t,attrs:r}=n,{image:s,boxes:a,boxInd:o}=e,{cropSize:i,method:u,extrapolationValue:l}=r,c=new fme(s.shape,a.shape,i,u,l);return t.runWebGLProgram(c,[s,a,o],"float32")},mme={kernelName:E0,backendName:"webgl",kernelFunc:pme};var om;(function(n){n.Prod="*",n.Sum="+"})(om||(om={}));class wO{constructor(e,t,r,s){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const a=this.outputShape.length,o=this.op===om.Prod?"1.0":"0.0",i=r?o:`getX(${SO(a,"coords",this.op)})`,u=this.outputShape[this.outputShape.length-1];let l="",c="";r?(l=s?`end != ${u-1}`:"end != 0",c=s?"end + 1":"end - 1"):(l=s?`end + pow2 < ${u}`:"end >= pow2",c=s?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Jt(a)} coords = getOutputCoords();
        int end = ${CO(a,"coords",this.op)};
        float val = ${i};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${c};
          ${CO(a,"coords",this.op)} = idx;
          val ${this.op}= getX(${SO(a,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function SO(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function CO(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iV(n,e,t,r,s,a){const o=e.shape.length,i=Cn([r],o);let u=e;i!=null&&(u=os({inputs:{x:e},backend:t,attrs:{perm:i}}));const l=Mn(1,o)[0];if(l!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const c=u.shape[l];let d=Ps({inputs:{x:u},backend:t});for(let p=0;p<=Math.ceil(Math.log2(c))-1;p++){const m=new wO(n,u.shape,!1,a),v=[[p]],b=d;d=t.runWebGLProgram(m,[d],d.dtype,v),t.disposeIntermediateTensorInfo(b)}if(s){const p=new wO(n,u.shape,s,a),m=d;d=t.runWebGLProgram(p,[d],d.dtype),t.disposeIntermediateTensorInfo(m)}if(i!=null){const p=Gu(i),m=os({inputs:{x:d},backend:t,attrs:{perm:p}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(u),m}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gme(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a,exclusive:o,reverse:i}=r;return iV(om.Prod,s,t,a,o,i)}const vme={kernelName:I0,backendName:"webgl",kernelFunc:gme};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yme(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a,exclusive:o,reverse:i}=r;return iV(om.Sum,s,t,a,o,i)}const bme={kernelName:_m,backendName:"webgl",kernelFunc:yme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xme(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:a}=e,{size:o,binaryOutput:i}=r;if(s.shape.length===1){const u=t.readSync(s.dataId),l=t.readSync(a.dataId),c=Vz(u,l,a.dtype,a.shape,o);return t.makeTensorInfo([o],a.dtype,c)}else if(s.shape.length===2){const u=t.bufferSync(s),l=t.bufferSync(a),c=Nhe(u,l,o,i);return t.makeTensorInfo(c.shape,a.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const wme={kernelName:_0,backendName:"webgl",kernelFunc:xme};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sme{constructor(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cme(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockSize:a,dataFormat:o}=r,i=s.shape[0],u=o==="NHWC"?s.shape[1]:s.shape[2],l=o==="NHWC"?s.shape[2]:s.shape[3],c=o==="NHWC"?s.shape[3]:s.shape[1],d=u*a,p=l*a,m=c/(a*a),v=o==="NHWC"?[i,d,p,m]:[i,m,d,p],b=new Sme(v,a,o);return t.runWebGLProgram(b,[s],s.dtype)}const Nme={kernelName:R0,backendName:"webgl",kernelFunc:Cme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uV{constructor(e,t=!1,r=null,s=!1,a=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=jr(this.outputShape.length);const o=e.filterHeight,i=e.filterWidth,u=e.outChannels/e.inChannels;let l="",c="";r&&(s?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:a?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:l=`
          float activation(float x) {
            ${r}
          }
        `,c="result = activation(result);");const d=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${u};
        int q = d2 - d1 * ${u};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${i}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lV{constructor(e,t=!1,r=null,s=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=jr(this.outputShape.length);const o=e.outChannels/e.inChannels,i=e.padInfo.left,u=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,d=e.filterWidth,p=d;let m=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let w=0;w<d;w++)m+=`
          vec4 xTexelC${w*2};
          int xTexelC${w*2}Ready;
          vec4 xTexelC${w*2+1};
          int xTexelC${w*2+1}Ready;
          vec4 xC${w};`;m+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let w=0;w<d;w++)m+=`
          xTexelC${w*2} = vec4(0.0);
          xTexelC${w*2}Ready = 0;
          xTexelC${w*2+1} = vec4(0.0);
          xTexelC${w*2+1}Ready = 0;
          xC${w} = vec4(0.0);`;m+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let w=0;w<(p+1)/2;w++){const S=w*2;if(m+=`
          xC = xCCorner + ${S*l};
          `,u===1){if(S<d&&(i%2===1?(m+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S}Ready == 0) {
                  xTexelC${S} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${S}.zw = vec2(0.0);
                  }
                  xTexelC${S}Ready = 1;
                }
              `,l===1&&S>0?m+=`
                xC${S} = vec4(xTexelC${S-2}.zw, xTexelC${S}.xy);
                `:m+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${S} = vec4(previous.zw, xTexelC${S}.xy);
                  } else {
                    xC${S} = vec4(0.0, 0.0, xTexelC${S}.xy);
                  }
                  `):m+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${S}Ready == 0) {
                  xTexelC${S} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${S}.zw = vec2(0.0);
                  }
                  xTexelC${S}Ready = 1;
                }

                xC${S} = xTexelC${S};
                `,S+1<d)){const N=i%2===0?m0(l):l;l%2===0&&i%2===1||l%2!==0&&i%2!==1?(m+=`
                  xCOffset = xC + imod(pads[1], 2) + ${N};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S+1}Ready == 0) {
                    xTexelC${S+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${S+1}.zw = vec2(0.0);
                    }
                    xTexelC${S+1}Ready = 1;
                  }
                  `,l>1?m+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${S+1} = vec4(previous.zw, xTexelC${S+1}.xy);
                    } else {
                     xC${S+1} = vec4(0.0, 0.0, xTexelC${S+1}.xy);
                    }
                    `:m+=`
                    xC${S+1} = vec4(xTexelC${S}.zw, xTexelC${S+1}.xy);
                    `):N===1?m+=`
                    xC${S+1} = xTexelC${S};
                    `:m+=`
                    xCOffset = xC + ${N};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S+1}Ready == 0) {
                      xTexelC${S+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${S+1}.zw = vec2(0.0);
                      }
                      xTexelC${S+1}Ready = 1;
                    }

                    xC${S+1} = xTexelC${S+1};
                    `}}else S<d&&(i%2===1?(m+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S}Ready == 0) {
                  xTexelC${S} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${S}.zw = vec2(0.0);
                  }
                  xTexelC${S}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${S+1}Ready == 0) {
                  xTexelC${S+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${S+1}.zw = vec2(0.0);
                  }
                  xTexelC${S+1}Ready = 1;
                }

                xC${S} = vec4(xTexelC${S}.zw, xTexelC${S+1}.zw);
              `,S+1<d&&(m+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${S+1} = vec4(xTexelC${S+1}.xy, final.xy);
                `)):(m+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${S}Ready == 0) {
                  xTexelC${S} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${S}.zw = vec2(0.0);
                  }
                  xTexelC${S}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S+1}Ready == 0) {
                  xTexelC${S+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${S+1}.zw = vec2(0.);
                  }
                  xTexelC${S+1}Ready = 1;
                }

                xC${S} = vec4(
                  xTexelC${S}.xy, xTexelC${S+1}.xy);
              `,S+1<d&&(m+=`
                  xC${S+1} = vec4(xTexelC${S}.zw, xTexelC${S+1}.zw);
                `)));S<d&&(m+=`
            wTexel = getW(r, ${S}, d1, q);
            dotProd += xC${S} * vec4(wTexel.xz, wTexel.xz);
          `,S+1<d&&(m+=`
              wTexel = getW(r, ${S+1}, d1, q);
              dotProd += xC${S+1} * vec4(wTexel.xz, wTexel.xz);
            `))}m+=`
    }
  `,m+=`
      }
    `;let v="",b="";r&&(s?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:a?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:v=`vec4 activation(vec4 x) {
          ${r}
        }`,b="result = activation(result);");const y=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${v}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${m}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${y}
        ${b}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kme(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:a}=e,{strides:o,pad:i,dilations:u,dimRoundingMode:l}=r;let c=u;c==null&&(c=[1,1]),B($r(o,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const d=vr(s.shape,a.shape,o,c,i,l,!0);let p;de().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?p=new lV(d):p=new uV(d);const m=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return t.runWebGLProgram(p,[s,a],"float32",m)}const Tme={kernelName:Rm,backendName:"webgl",kernelFunc:kme};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ime{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,a=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${a};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Eme{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,a=e.strideWidth,o=t-1-e.padInfo.top,i=r-1-e.padInfo.left,u=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${u}; dm++) {
              int d2 = d1 * ${u} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _me(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:a}=e,{strides:o,dilations:i,pad:u,dimRoundingMode:l,filterShape:c}=r,d=vr(s.shape,c,o,i,u,l,!0),p=new Ime(d);return t.runWebGLProgram(p,[s,a],"float32")}const Rme={kernelName:A0,backendName:"webgl",kernelFunc:_me};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ame(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:a}=e,{strides:o,dilations:i,pad:u,dimRoundingMode:l,inputShape:c}=r,d=vr(c,a.shape,o,i,u,l,!0),p=new Eme(d);return t.runWebGLProgram(p,[s,a],"float32")}const Dme={kernelName:D0,backendName:"webgl",kernelFunc:Ame};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $me{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ome(n){const{inputs:e,backend:t}=n,{x:r}=e,s=[...r.shape,...r.shape],a=xe(r.shape),o=Me({inputs:{x:r},backend:t,attrs:{shape:[a]}}),i=new $me(a),u=t.runWebGLProgram(i,[o],o.dtype),l=Me({inputs:{x:u},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(u),l}const Fme={kernelName:$0,backendName:"webgl",kernelFunc:Ome};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mme{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:r,padInfo:s,strideHeight:a,strideWidth:o,filterHeight:i,filterWidth:u,dilationHeight:l,dilationWidth:c}=e,{top:d,left:p}=s;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${o});
      const ivec2 pads = ivec2(${d}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${i}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${u}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lme(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:a}=e,{strides:o,pad:i,dilations:u}=r,l=xg(s.shape,a.shape,o,i,"NHWC",u);let c;const d=new Mme(l);c=t.runWebGLProgram(d,[s,a],"float32");const p=Me({inputs:{x:c},backend:t,attrs:{shape:l.outShape}});return t.disposeIntermediateTensorInfo(c),p}const Pme={kernelName:Am,backendName:"webgl",kernelFunc:Lme};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bme(n){const{inputs:e,backend:t,attrs:r}=n,{equation:s}=r,a=e,{allDims:o,summedDims:i,idDims:u}=AT(s,a.length);$T(o.length,u,a);const{path:l,steps:c}=OT(i,u),d=c.length;let p=null,m=o.length;const v=[];for(let b=0;b<d;++b){for(const y of c[b]){const{permutationIndices:w,expandDims:S}=DT(m,u[y]);let N;FT(w)?N=a[y]:(N=os({inputs:{x:a[y]},backend:t,attrs:{perm:w}}),v.push(N));const C=N.shape.slice();for(let T=0;T<S.length;++T)C.splice(S[T],0,1);Et(N.shape,C)||(N=Me({inputs:{x:N},backend:t,attrs:{shape:C}}),v.push(N)),p===null?p=N:(p=NI({inputs:{a:N,b:p},backend:t}),v.push(p))}b<d-1&&(l[b]>=0&&(p=I1({inputs:{x:p},backend:t,attrs:{axis:l[b]-(o.length-m),keepDims:!1}}),v.push(p)),m--)}for(const b of v)b!==p&&t.disposeIntermediateTensorInfo(b);return p}const zme={kernelName:F0,backendName:"webgl",kernelFunc:Bme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vme="return (x >= 0.0) ? x : (exp(x) - 1.0);",Ume=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Wme=Pt({opSnippet:Vme,packedOpSnippet:Ume}),Gme={kernelName:bd,backendName:"webgl",kernelFunc:Wme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hme="return (b >= 0.0) ? a : a * (b + 1.0);",jme=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,qme=n=>{const{inputs:e,backend:t}=n,{dy:r,y:s}=e,a=de().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new mf(jme,r.shape,s.shape):new oc(Hme,r.shape,s.shape);return t.runWebGLProgram(a,[r,s],r.dtype)},Kme={kernelName:M0,backendName:"webgl",kernelFunc:qme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xme=`
  return vec4(equal(a, b));
`,Yme="return float(a == b);",Zme=Mr({opSnippet:Yme,packedOpSnippet:Xme,dtype:"bool",cpuKernelImpl:_he}),Qme={kernelName:Dm,backendName:"webgl",kernelFunc:Zme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jme=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${NT};
  float a1 = ${kT};
  float a2 = ${TT};
  float a3 = ${IT};
  float a4 = ${ET};
  float a5 = ${_T};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,ege=Pt({opSnippet:Jme}),tge={kernelName:xd,backendName:"webgl",kernelFunc:ege};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nge=gf+`
  return exp(x);
`,rge=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cV=Pt({opSnippet:nge,packedOpSnippet:rge,cpuKernelImpl:Rhe,dtype:"float32"}),sge={kernelName:wd,backendName:"webgl",kernelFunc:cV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oN(n){const{inputs:e,attrs:t,backend:r}=n,{dim:s}=t,{input:a}=e,o=a.shape.length,i=a.shape.slice();let u=s;return s<0&&(B(-(o+1)<=s,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),u=o+s+1),i.splice(u,0,1),Me({inputs:{x:a},backend:r,attrs:{shape:i}})}const age={kernelName:$m,backendName:"webgl",kernelFunc:oN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NO="return exp(x) - 1.0;",oge=Pt({opSnippet:NO,packedOpSnippet:NO,cpuKernelImpl:Ahe}),ige={kernelName:Sd,backendName:"webgl",kernelFunc:oge};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kO{constructor(e,t,r){this.variableNames=["real","imag"];const s=t[1];this.outputShape=t;const a=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=r?`${s}.0`:"1.0";let i;if(e==="real")i="return real * expR - imag * expI;";else if(e==="imag")i="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${a};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${i}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${s});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${s}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hV(n,e,t){const r=t.texData.get(n.dataId),s=xe(n.shape),a=n.shape[n.shape.length-1],o=s/a,i=Me({inputs:{x:n},backend:t,attrs:{shape:[o,a]}}),u=i.shape,l=new kO("real",u,e),c=new kO("imag",u,e),d=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:u},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:u}],p=t.runWebGLProgram(l,d,"float32"),m=t.runWebGLProgram(c,d,"float32"),v=Zu({inputs:{real:p,imag:m},backend:t});t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m);const b=Me({inputs:{x:v},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(v),b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uge(n){const{inputs:e,backend:t}=n,{input:r}=e;return hV(r,!1,t)}const lge={kernelName:L0,backendName:"webgl",kernelFunc:uge};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cge{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ev(n){const{backend:e,attrs:t}=n,{shape:r,value:s}=t;let{dtype:a}=t;if(a=a||hc(s),a==="string"){const o=En(a,xe(r));return o.fill(s),e.makeTensorInfo(r,a,o)}else{const o=new cge(r,s),i=[[s]];return e.runWebGLProgram(o,[],a,i)}}const hge={kernelName:P0,backendName:"webgl",kernelFunc:ev};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dge{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fge={kernelName:B0,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,r=e,s=new dge(t.shape);return r.runWebGLProgram(s,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TO="return floor(x);",pge=Pt({opSnippet:TO,packedOpSnippet:TO,cpuKernelImpl:Dhe}),mge={kernelName:Cd,backendName:"webgl",kernelFunc:pge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gge=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,vge=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,yge=Mr({opSnippet:gge,packedOpSnippet:vge,dtype:"int32"}),bge={kernelName:Nd,backendName:"webgl",kernelFunc:yge};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xge{constructor(e){this.variableNames=["A"];const t=ls(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}.0, ${r}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wge{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=ls(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${s}.0, ${r}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sge={kernelName:bb,backendName:"webgl",kernelFunc:Cge};let gh,DS=de().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function Cge(n){const{inputs:e,backend:t,attrs:r}=n;let{pixels:s}=e;const{numChannels:a}=r,o=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement,i=typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement,[u,l]=o?[s.videoWidth,s.videoHeight]:[s.width,s.height],c=[l,u],d=[l,u,a];if(i||o){const b=de().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(gh==null||b!==DS)&&(DS=b,gh=document.createElement("canvas").getContext("2d",{willReadFrequently:DS})),gh.canvas.width=u,gh.canvas.height=l,gh.drawImage(s,0,0,u,l),s=gh.canvas}const p=t.makeTensorInfo(c,"int32");t.texData.get(p.dataId).usage=na.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),s);const m=de().getBool("WEBGL_PACK")?new wge(d):new xge(d),v=t.runWebGLProgram(m,[p],"int32");return t.disposeData(p.dataId),v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nge(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:a,bias:o,preluActivationWeights:i}=e,{strides:u,pad:l,dataFormat:c,dilations:d,dimRoundingMode:p,activation:m,leakyreluAlpha:v}=r,b=Ii(c),y=vr(s.shape,a.shape,u,d,l,p,!1,b);let w;const S=[],N=o!=null,C=i!=null,T=m==="leakyrelu",E=()=>{const _=[s,a],R=(D,A)=>{if(A==="NCHW"&&D.shape.length===1&&D.shape[0]!==1){const M=Me({inputs:{x:D},backend:t,attrs:{shape:[D.shape[0],1,1]}});return S.push(M),M}return D};if(N&&_.push(R(o,c)),C&&_.push(R(i,c)),T){const D=t.makeTensorInfo([],"float32",ki(v,"float32"));_.push(D),S.push(D)}return _};if(y.filterHeight===1&&y.filterWidth===1&&y.dilationHeight===1&&y.dilationWidth===1&&y.strideHeight===1&&y.strideWidth===1&&(y.padInfo.type==="SAME"||y.padInfo.type==="VALID"))w=aV({x:s,filter:a,convInfo:y,backend:t,bias:o,activation:m,preluActivationWeights:i,leakyreluAlpha:v});else if(y.strideWidth<=2&&b==="channelsLast"&&de().getBool("WEBGL_EXP_CONV")){const _=m?sm(m,!0):null,R=new sV(y,N,_,C,T),D=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],A=E();w=t.runWebGLProgram(R,A,"float32",D)}else if(de().getBool("WEBGL_CONV_IM2COL"))w=oV({x:s,filter:a,convInfo:y,backend:t,bias:o,activation:m,preluActivationWeights:i,leakyreluAlpha:v});else{const _=m?sm(m,!1):null,R=new rV(y,N,_,C,T),D=E();w=t.runWebGLProgram(R,D,"float32")}const $=Me({inputs:{x:w},backend:t,attrs:{shape:y.outShape}});return S.push(w),S.forEach(_=>t.disposeIntermediateTensorInfo(_)),$}const kge={kernelName:Wp,backendName:"webgl",kernelFunc:Nge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tge(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:a,bias:o,preluActivationWeights:i}=e,{strides:u,pad:l,dilations:c,dimRoundingMode:d,activation:p,leakyreluAlpha:m}=r,v=[];let b=c;b==null&&(b=[1,1]),B($r(u,b),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${b}'`);const y=vr(s.shape,a.shape,u,b,l,d,!0),w=de().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels===1,S=p?sm(p,w):null,N=[s,a],C=o!=null,T=i!=null,E=p==="leakyrelu";if(C&&N.push(o),T&&N.push(i),E){const D=t.makeTensorInfo([],"float32",ki(m,"float32"));N.push(D),v.push(D)}let $;w?$=new lV(y,C,S,T,E):$=new uV(y,C,S,T,E);const _=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],R=t.runWebGLProgram($,N,"float32",_);return v.forEach(D=>t.disposeIntermediateTensorInfo(D)),R}const Ige={kernelName:Gp,backendName:"webgl",kernelFunc:Tge};class Ege{constructor(e,t,r,s){this.sliceDim=e,this.strides=t,this.paramsShape=s,this.variableNames=["x","indices"],this.outputShape=r;const a=Jt(r.length);let o=`
    int index;`;for(let i=0;i<this.sliceDim;i++)o+=`
          index = round(getIndices(coords[0], ${i}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[i]};
          flattenIndex += index * ${this.strides[i]};`;this.userCode=`
         void main() {
          ${a} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ge(n){const{inputs:e,backend:t}=n,{params:r,indices:s}=e,a=s.shape,o=a[a.length-1],i=xe(r.shape),[u,l,c,d]=i1(r,s),p=Me({inputs:{x:s},backend:t,attrs:{shape:[l,o]}}),m=Me({inputs:{x:r},backend:t,attrs:{shape:[xe(r.shape)/c,c]}});if(t.shouldExecuteOnCPU([r,s])||r.dtype==="string"){const w=t.readSync(s.dataId),S=t.bufferSync(r),N=$he(w,S,r.dtype,l,o,c,d,r.shape,i);return t.makeTensorInfo(u,r.dtype,N.values)}const v=new Ege(o,d,[l,c],r.shape),b=t.runWebGLProgram(v,[m,p],m.dtype),y=Me({inputs:{x:b},backend:t,attrs:{shape:u}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(b),y}const Rge={kernelName:z0,backendName:"webgl",kernelFunc:_ge};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Age{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const r=Jt(this.rank),s=Dge(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${s}));
      }
    `}}function Dge(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let s=0;s<n.length;s++)s===2?r.push("index"):r.push(`${t[s]}`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dV(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,indices:a}=e,{axis:o,batchDims:i}=r,u=Nt(o,s.shape)[0];if(de().get("DEBUG")){const S=t.readSync(a.dataId),N=s.shape[u];for(let C=0;C<S.length;++C){const T=S[C];B(T<=N-1&&T>=0,()=>`GatherV2: the index value ${T} is not in [0, ${N-1}]`)}}const l=LT(s,a,u,i),c=xe(a.shape),d=[],p=Me({inputs:{x:s},backend:t,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),m=Me({inputs:{x:a},backend:t,attrs:{shape:[l.batchSize,c/l.batchSize]}});d.push(p),d.push(m);const v=[l.batchSize,l.outerSize,c/l.batchSize,l.sliceSize];if(t.shouldExecuteOnCPU([s,a])||s.dtype==="string"){const S=t.bufferSync(m),N=t.bufferSync(p),C=Ohe(N,S,v);return d.forEach(T=>t.disposeIntermediateTensorInfo(T)),t.makeTensorInfo(l.outputShape,C.dtype,C.values)}const b=new Age(p.shape,v),y=t.runWebGLProgram(b,[p,m],p.dtype);d.push(y);const w=Me({inputs:{x:y},backend:t,attrs:{shape:l.outputShape}});return d.forEach(S=>t.disposeIntermediateTensorInfo(S)),w}const $ge={kernelName:Fm,backendName:"webgl",kernelFunc:dV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oge="return float(a > b);",Fge=`
  return vec4(greaterThan(a, b));
`,Mge=Mr({opSnippet:Oge,packedOpSnippet:Fge,cpuKernelImpl:Fhe,dtype:"bool"}),Lge={kernelName:Mm,backendName:"webgl",kernelFunc:Mge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pge="return float(a >= b);",Bge=`
  return vec4(greaterThanEqual(a, b));
`,zge=Mr({opSnippet:Pge,packedOpSnippet:Bge,dtype:"bool",cpuKernelImpl:Mhe}),Vge={kernelName:kd,backendName:"webgl",kernelFunc:zge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uge(n){const{inputs:e,backend:t}=n,{input:r}=e;return hV(r,!0,t)}const Wge={kernelName:V0,backendName:"webgl",kernelFunc:Uge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gge="return float(!isnan(x) && !isinf(x));",Hge=Pt({opSnippet:Gge,dtype:"bool"}),jge={kernelName:Id,backendName:"webgl",kernelFunc:Hge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qge="return float(isinf(x));",Kge=Pt({opSnippet:qge,dtype:"bool"}),Xge={kernelName:Ed,backendName:"webgl",kernelFunc:Kge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yge="return float(isnan(x));",Zge=Pt({opSnippet:Yge,dtype:"bool"}),Qge={kernelName:_d,backendName:"webgl",kernelFunc:Zge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jge="return float(a < b);",eve=`
  return vec4(lessThan(a, b));
`,tve=Mr({opSnippet:Jge,packedOpSnippet:eve,cpuKernelImpl:Lhe,dtype:"bool"}),nve={kernelName:Pm,backendName:"webgl",kernelFunc:tve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rve="return float(a <= b);",sve=`
  return vec4(lessThanEqual(a, b));
`,ave=Mr({opSnippet:rve,packedOpSnippet:sve,cpuKernelImpl:Phe,dtype:"bool"}),ove={kernelName:Bm,backendName:"webgl",kernelFunc:ave};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ive(n){const{backend:e,attrs:t}=n,{start:r,stop:s,num:a}=t,o=Bhe(r,s,a);return e.makeTensorInfo([o.length],"float32",o)}const uve={kernelName:W0,backendName:"webgl",kernelFunc:ive};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lve=gf+`
  return x < 0.0 ? 0./0. : log(x);
`,cve=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,hve=Pt({opSnippet:lve,packedOpSnippet:cve,cpuKernelImpl:zhe}),dve={kernelName:Rd,backendName:"webgl",kernelFunc:hve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fve=gf+`
  return log(1.0 + x);
`,pve=Pt({opSnippet:fve}),mve={kernelName:Ad,backendName:"webgl",kernelFunc:pve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gve="return float(a >= 1.0 && b >= 1.0);",vve=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,yve=Mr({opSnippet:gve,packedOpSnippet:vve,dtype:"bool"}),bve={kernelName:zm,backendName:"webgl",kernelFunc:yve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xve="return float(!(x >= 1.0));",wve=Pt({opSnippet:xve}),Sve={kernelName:Vm,backendName:"webgl",kernelFunc:wve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cve="return float(a >= 1.0 || b >= 1.0);",Nve=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,kve=Mr({opSnippet:Cve,packedOpSnippet:Nve,dtype:"bool"}),Tve={kernelName:Um,backendName:"webgl",kernelFunc:kve};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ive{constructor(e,t,r,s,a){this.variableNames=["x"],this.outputShape=[];const o=t,i=e[3]-1;this.outputShape=e;let u;const l=`float(${r}) + float(${s}) * sum`;a===.5?u=`inversesqrt(${l})`:a===1?u=`1.0/(${l})`:u=`exp(log(${l}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${i}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${u};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Eve{constructor(e,t,r,s,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=t,i=e[3]-1;this.outputShape=e;let u;const l=`float(${r}) + float(${s}) * sum`;a===.5?u=`inversesqrt(${l})`:a===1?u=`1.0/(${l})`:u=`exp(log(${l}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${i}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${u};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ve=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{depthRadius:a,bias:o,alpha:i,beta:u}=r,l=de().getBool("WEBGL_PACK_NORMALIZATION")?new Eve(s.shape,a,o,i,u):new Ive(s.shape,a,o,i,u);return t.runWebGLProgram(l,[s],s.dtype)},Rve={kernelName:Wm,backendName:"webgl",kernelFunc:_ve};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ave{constructor(e,t,r,s,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=r,this.alpha=s,this.beta=a,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${s}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${s})
                * float(${a})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${a});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dve=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s,y:a,dy:o}=e,{depthRadius:i,bias:u,alpha:l,beta:c}=r,d=new Ave(s.shape,i,u,l,c);return t.runWebGLProgram(d,[s,a,o],s.dtype)},$ve={kernelName:G0,backendName:"webgl",kernelFunc:Dve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ove(n,e,t,r){const s=xe(e),o=xe(n.shape)/s,i=Me({inputs:{x:n},attrs:{shape:[o,s]},backend:r}),u=Cc(i,n.dtype,"max",r),l=Me({inputs:{x:u},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(u),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fV(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reductionIndices:a,keepDims:o}=r,i=s.shape.length,u=Nt(a,s.shape);let l=u;const c=Cn(l,i),d=c!=null,p=t.shouldExecuteOnCPU([s]);let m=s;if(d){if(p){const N=t.texData.get(m.dataId).values,C=new Array(i);for(let $=0;$<C.length;$++)C[$]=s.shape[c[$]];const T=SI(N,s.shape,s.dtype,c,C);m=t.makeTensorInfo(C,s.dtype);const E=t.texData.get(m.dataId);E.values=T}else m=T1(s,c,t);l=Mn(l.length,i)}Or("max",l,i);const[v,b]=yr(m.shape,l);let y=v;o&&(y=Fn(v,u));let w;if(p){const N=t.texData.get(m.dataId).values,C=Vhe(N,xe(b),y,s.dtype);w=t.makeTensorInfo(y,s.dtype);const T=t.texData.get(w.dataId);T.values=C}else w=Ove(m,b,y,t);return d&&t.disposeIntermediateTensorInfo(m),w}const Fve={kernelName:Gm,backendName:"webgl",kernelFunc:fV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mve=CI+`
  return max(a, b);
`,Lve=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Sc+`
  return result;
`,Pve=Mr({opSnippet:Mve,packedOpSnippet:Lve,cpuKernelImpl:Uhe}),Bve={kernelName:Dd,backendName:"webgl",kernelFunc:Pve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zve(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Zg(s,"maxPool");const{filterSize:a,strides:o,pad:i,dimRoundingMode:u}=r,l=1;B($r(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=Da(s.shape,a,o,l,i,u);if(c.filterWidth===1&&c.filterHeight===1&&Et(c.inShape,c.outShape))return Ps({inputs:{x:s},backend:t});const d=new am(c,"max",!1);return t.runWebGLProgram(d,[s],s.dtype)}const Vve={kernelName:Hm,backendName:"webgl",kernelFunc:zve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uve(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:a,strides:o,pad:i,dataFormat:u,dimRoundingMode:l}=r,c=[1,1,1],d=Ti(s.shape,a,o,c,i,l,u),p=new kI(d,"max",!1);return t.runWebGLProgram(p,[s],s.dtype)}const Wve={kernelName:jm,backendName:"webgl",kernelFunc:Uve};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gve{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,r=e.strideWidth,s=e.dilationHeight,a=e.effectiveFilterHeight,o=e.effectiveFilterWidth,i=a-1-e.padInfo.top,u=o-1-e.padInfo.left,l=a*o-1;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${a};
          wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Hve{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,r=e.strideHeight,s=e.strideWidth,a=e.dilationDepth,o=e.dilationHeight,i=e.dilationWidth,u=e.effectiveFilterDepth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,d=u-1-e.padInfo.front,p=l-1-e.padInfo.top,m=c-1-e.padInfo.left,v=u*l*c-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${p}, ${m});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${u};
           wD += ${a}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${i}) {
              float dyC = float(dyCCorner + wC) / ${s}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${v} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jve(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:a}=e,o=a,{filterSize:i,strides:u,pad:l,dimRoundingMode:c}=r,d=[1,1,1],p=Ti(o.shape,i,u,d,l,c),m=new kI(p,"max",!0),v=t.runWebGLProgram(m,[o],o.dtype),b=new Hve(p),y=t.runWebGLProgram(b,[s,v],o.dtype);return t.disposeIntermediateTensorInfo(v),y}const qve={kernelName:j0,backendName:"webgl",kernelFunc:jve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kve(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:a,output:o}=e,i=a;Zg([a,o],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:d}=r,p=Da(i.shape,u,l,1,c,d),m=!0,v=new am(p,"max",m),b=t.runWebGLProgram(v,[i],i.dtype),y=new Gve(p),w=t.runWebGLProgram(y,[s,b],i.dtype);return t.disposeIntermediateTensorInfo(b),w}const Xve={kernelName:H0,backendName:"webgl",kernelFunc:Kve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yve(n,e,t,r){let s=new am(t,"max",!1);const a=r.runWebGLProgram(s,[n],"float32");s=new am(t,"max",!0,!0,e);const o=r.runWebGLProgram(s,[n],"float32");return[a,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zve={kernelName:q0,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{filterSize:s,strides:a,pad:o,includeBatchInIndex:i}=e,u=t;B(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const l=[1,1];B($r(a,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${l}'`);const c=Da(r.shape,s,a,l,o),[d,p]=Yve(r,i,c,u);return[d,p]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qve(n,e,t,r){const s=xe(e),o=xe(n.shape)/s,i=Me({inputs:{x:n},attrs:{shape:[o,s]},backend:r}),u=Cc(i,"float32","mean",r),l=Me({inputs:{x:u},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(u),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jve={kernelName:qm,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{keepDims:s,axis:a}=e,o=t,i=r.shape.length,u=Nt(a,r.shape);let l=u;const c=Cn(l,i),d=c!=null,p=o.shouldExecuteOnCPU([r]),m=[];let v=r;if(d){if(p){const C=o.texData.get(v.dataId).values,T=new Array(i);for(let _=0;_<T.length;_++)T[_]=r.shape[c[_]];const E=SI(C,r.shape,r.dtype,c,T);v=o.makeTensorInfo(T,r.dtype);const $=o.texData.get(v.dataId);$.values=E}else v=T1(r,c,o);m.push(v),l=Mn(l.length,i)}Or("sum",l,i);const[b,y]=yr(v.shape,l);let w=b;s&&(w=Fn(b,u));const S=Qve(v,y,w,o);for(const N of m)o.disposeIntermediateTensorInfo(N);return S}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a,keepDims:o}=r,i=s.shape.length,u=Nt(a,s.shape);let l=u;const c=Cn(l,i);let d=s;c!=null&&(d=os({inputs:{x:s},backend:t,attrs:{perm:c}}),l=Mn(l.length,s.shape.length)),Or("min",l,i);const[p,m]=yr(d.shape,l),v=xe(m),b=Me({inputs:{x:d},backend:t,attrs:{shape:[-1,v]}}),y=Cc(b,b.dtype,"min",t);let w;if(o){const S=Fn(p,u);w=Me({inputs:{x:y},backend:t,attrs:{shape:S}})}else w=Me({inputs:{x:y},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(y),c!=null&&t.disposeIntermediateTensorInfo(d),w}const tye={kernelName:Km,backendName:"webgl",kernelFunc:eye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nye=CI+`
  return min(a, b);
`,rye=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Sc+`
  return result;
`,sye=Mr({opSnippet:nye,packedOpSnippet:rye,cpuKernelImpl:Whe}),aye={kernelName:$d,backendName:"webgl",kernelFunc:sye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oye{constructor(e,t,r){this.variableNames=["x"],this.outputShape=t.map((c,d)=>c[0]+e[d]+c[1]);const s=e.length,a=Jt(s),o=t.map(c=>c[0]).join(","),i=t.map((c,d)=>c[0]+e[d]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s),l=r==="reflect"?0:1;if(s===1){this.userCode=`
        int start = ${o};
        int end = ${i};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${o});
      ${a} end = ${a}(${i});

      void main() {
        ${a} outC = getOutputCoords();
        for (int i = 0; i < ${s}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${a} coords = outC - start;
        setOutput(getX(${u}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iye{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((v,b)=>v[0]+e[b]+v[1]);const s=e.length,a=Jt(s),o=t.map(v=>v[0]).join(","),i=t.map((v,b)=>v[0]+e[b]).join(","),u=ns("rc",s),l=ns("source",s),c=`${u[s-1]} < ${this.outputShape[s-1]}`,d=s===1?"source":`vec2(${l.slice(-2).join()})`,p=r==="reflect"?0:1;let m="";if(s===1){const v=`
        ${a} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;m=`
        ${a} rc = outputLoc;
        ${v}
        result[0] = getChannel(getX(${l.join()}), ${d});
        ${u[s-1]} += 1;
        if(${c}) {
          ${v}
          result[1] = getChannel(getX(${l.join()}), ${d});
        }
      `}else{const v=`
        ${a} source = rc;
        ${a} lt = ${a}(lessThan(source, start));
        ${a} gte = ${a}(greaterThanEqual(source, end));
        ${a} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;m=`
        ${a} rc = outputLoc;
        ${v}
        result[0] = getChannel(getX(${l.join()}), ${d});
        ${u[s-1]} += 1;
        if(${c}) {
          ${v}
          result[1] = getChannel(getX(${l.join()}), ${d});
        }
        rc = outputLoc;
        ${u[s-2]} += 1;
        if(${u[s-2]} < ${this.outputShape[s-2]}) {
          ${v}
          result[2] = getChannel(getX(${l.join()}), ${d});
          ${u[s-1]} += 1;
          if(${c}) {
            ${v}
            result[3] = getChannel(getX(${l.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${a} start = ${a}(${o});
      const ${a} end = ${a}(${i});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uye=({inputs:n,backend:e,attrs:t})=>{const{x:r}=n,{paddings:s,mode:a}=t,o=de().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new iye(r.shape,s,a):new oye(r.shape,s,a);return e.runWebGLProgram(o,[r],r.dtype)},lye={kernelName:Xm,backendName:"webgl",kernelFunc:uye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cye=`if (b == 0.0) return NAN;
  return mod(a, b);`,hye=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Sc+`
  return result;
`,dye=Mr({opSnippet:cye,packedOpSnippet:hye}),fye={kernelName:Od,backendName:"webgl",kernelFunc:dye};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pye{constructor(e,t,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mye=`
if (a == b) {
  return 1.0;
};
return a / b;`,gye=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,pV=Mr({opSnippet:mye,packedOpSnippet:gye,checkOutOfBounds:!0}),vye={kernelName:yd,backendName:"webgl",kernelFunc:pV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IO="return a - b;",mV=Mr({opSnippet:IO,packedOpSnippet:IO,supportsComplex:!0,cpuKernelImpl:cde}),yye={kernelName:Yd,backendName:"webgl",kernelFunc:mV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gV(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{dim:a}=r,o=Nt([a],s.shape),i=fV({inputs:{x:s},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),u=Fn(i.shape,o),l=Me({inputs:{x:i},backend:t,attrs:{shape:u}}),c=mV({inputs:{a:s,b:l},backend:t}),d=cV({inputs:{x:c},backend:t}),p=I1({inputs:{x:d},backend:t,attrs:{axis:o,keepDims:!1}}),m=Me({inputs:{x:p},backend:t,attrs:{shape:u}}),v=pV({inputs:{a:d,b:m},backend:t});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),v}const bye={kernelName:fg,backendName:"webgl",kernelFunc:gV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xye(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{numSamples:a,seed:o,normalized:i}=r,u=i?s:gV({inputs:{logits:s},backend:t,attrs:{dim:s.shape.length-1}}),l=u.shape[0],c=u.shape[1],d=new pye(l,c,a),p=[[o]],m=t.runWebGLProgram(d,[u],"int32",p);return i||t.disposeIntermediateTensorInfo(u),m}const wye={kernelName:K0,backendName:"webgl",kernelFunc:xye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sye=Oa+`
  return -x;
`,Cye=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Nye(n){const{inputs:e,backend:t}=n,{x:r}=e;if(t.shouldExecuteOnCPU([r])){const a=t.texData.get(r.dataId),[o,i]=Hhe(a.values,r.shape,r.dtype);return t.makeTensorInfo(i,r.dtype,o)}let s;return de().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new yu(r.shape,Cye):s=new Co(r.shape,Sye),t.runWebGLProgram(s,[r],r.dtype)}const kye={kernelName:Ym,backendName:"webgl",kernelFunc:Nye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tye=r1;function Iye(n){Js("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:a}=e,{maxOutputSize:o,iouThreshold:i,scoreThreshold:u}=r,l=t.readSync(s.dataId),c=t.readSync(a.dataId),{selectedIndices:d}=Tye(l,c,o,i,u);return t.makeTensorInfo([d.length],"int32",new Int32Array(d))}const Eye={kernelName:X0,backendName:"webgl",kernelFunc:Iye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ye=s1;function Rye(n){Js("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:a}=e,{maxOutputSize:o,iouThreshold:i,scoreThreshold:u,padToMaxOutputSize:l}=r,c=t.readSync(s.dataId),d=t.readSync(a.dataId),{selectedIndices:p,validOutputs:m}=_ye(c,d,o,i,u,l);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([m]))]}const Aye={kernelName:Y0,backendName:"webgl",kernelFunc:Rye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dye=a1;function $ye(n){Js("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:a}=e,{maxOutputSize:o,iouThreshold:i,scoreThreshold:u,softNmsSigma:l}=r,c=t.readSync(s.dataId),d=t.readSync(a.dataId),p=o,m=i,v=u,b=l,{selectedIndices:y,selectedScores:w}=Dye(c,d,p,m,v,b);return[t.makeTensorInfo([y.length],"int32",new Int32Array(y)),t.makeTensorInfo([w.length],"float32",new Float32Array(w))]}const Oye={kernelName:Z0,backendName:"webgl",kernelFunc:$ye};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fye{constructor(e,t,r,s){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${s}), float(${r}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mye=n=>{const{inputs:e,backend:t,attrs:r}=n,{indices:s}=e,{dtype:a,depth:o,onValue:i,offValue:u}=r,l=xe(s.shape),c=new Fye(l,o,i,u),d=Me({inputs:{x:s},backend:t,attrs:{shape:[l]}}),p=t.runWebGLProgram(c,[d],a);t.disposeIntermediateTensorInfo(d);const m=[...s.shape,o],v=Me({inputs:{x:p},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(p),v},Lye={kernelName:Jm,backendName:"webgl",kernelFunc:Mye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wb(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="complex64"){const s=Jg({inputs:{input:r},backend:t}),a=Wb({inputs:{x:s},backend:t}),o=E1({inputs:{input:r},backend:t}),i=Wb({inputs:{x:o},backend:t}),u=Zu({inputs:{real:a,imag:i},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),u}else return ev({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:t})}const Pye={kernelName:vg,backendName:"webgl",kernelFunc:Wb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vV(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){const s=Jg({inputs:{input:r},backend:t}),a=vV({inputs:{x:s},backend:t}),o=E1({inputs:{input:r},backend:t}),i=Wb({inputs:{x:o},backend:t}),u=Zu({inputs:{real:a,imag:i},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),u}else return ev({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:t})}const Bye={kernelName:Qm,backendName:"webgl",kernelFunc:vV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zye(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r;if(e.length===1)return oN({inputs:{input:e[0]},backend:t,attrs:{dim:s}});const a=e[0].shape,o=e[0].dtype;e.forEach(c=>{Dr(a,c.shape,"All tensors passed to stack must have matching shapes"),B(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const i=[],u=e.map(c=>{const d=oN({inputs:{input:c},backend:t,attrs:{dim:s}});return i.push(d),d}),l=nV({inputs:u,backend:t,attrs:{axis:s}});return i.forEach(c=>t.disposeIntermediateTensorInfo(c)),l}const Vye={kernelName:eg,backendName:"webgl",kernelFunc:zye};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uye{constructor(e,t,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((l,c)=>l[0]+e[c]+l[1]);const s=e.length,a=Jt(s),o=t.map(l=>l[0]).join(","),i=t.map((l,c)=>l[0]+e[c]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s);if(s===1){this.userCode=`
        int start = ${o};
        int end = ${i};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${o});
      ${a} end = ${a}(${i});

      void main() {
        ${a} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${a} coords = outC - start;
          setOutput(getX(${u}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wye{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((b,y)=>b[0]+e[y]+b[1]);const s=e.length,a=Jt(s),o=t.map(b=>b[0]).join(","),i=t.map((b,y)=>b[0]+e[y]).join(","),u=ns("rc",s),l=ns("source",s),c=`${u[s-1]} < ${this.outputShape[s-1]}`,d=s===1?"source":`vec2(${l.slice(-2).join()})`,p=[`${a} rc = outputLoc;`,`${u[s-1]} += 1;
       if(${c}) {
      `,s===1?"":`}
       rc = outputLoc;
       ${u[s-2]} += 1;
       if(${u[s-2]} < ${this.outputShape[s-2]}) {`,s===1?"":`  ${u[s-1]} += 1;
         if(${c}) {`],m=s===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let v="";for(let b=0,y=s===1?2:4;b<y;b++)v+=`
        ${p[b]}
        if (${m}) {
          result[${b}] = float(value);
        } else {
          ${a} source = rc - start;
          result[${b}] = getChannel(getX(${l.join()}), ${d});
        }
      `;v+=s===1?"} ":"}}",this.userCode=`
      const ${a} start = ${a}(${o});
      const ${a} end = ${a}(${i});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${v}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yV=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:a,constantValue:o}=r;if(xe(s.shape)===0){const l=a.map((c,d)=>c[0]+s.shape[d]+c[1]);return ev({backend:t,attrs:{shape:l,value:o,dtype:s.dtype}})}const i=de().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Wye(s.shape,a,o):new Uye(s.shape,a,o),u=[[o]];return t.runWebGLProgram(i,[s],s.dtype,u)},Gye={kernelName:tg,backendName:"webgl",kernelFunc:yV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hye=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,jye=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Sc+`
  return result;
`,qye=Mr({opSnippet:Hye,packedOpSnippet:jye}),Kye={kernelName:Md,backendName:"webgl",kernelFunc:qye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:a,keepDims:o}=r,i=s.shape.length,u=[],l=Nt(a,s.shape);let c=l;const d=Cn(c,i);let p=s;d!=null&&(p=os({inputs:{x:s},backend:t,attrs:{perm:d}}),c=Mn(c.length,i),u.push(p)),Or("prod",c,i);let m;if(t.shouldExecuteOnCPU([p])){const v=t.texData.get(p.dataId).values,{outVals:b,outShape:y,outDtype:w}=qhe(p.shape,p.dtype,v,c);m=t.makeTensorInfo(y,w,b)}else{const[v,b]=yr(p.shape,c),y=xe(b),w=Me({inputs:{x:p},backend:t,attrs:{shape:[-1,y]}}),S=Cx(s.dtype),N=Cc(w,S,"prod",t);m=Me({inputs:{x:N},backend:t,attrs:{shape:v}}),u.push(w),u.push(N)}if(o){u.push(m);const v=Fn(m.shape,l);m=Me({inputs:{x:m},backend:t,attrs:{shape:v}})}return u.forEach(v=>t.disposeIntermediateTensorInfo(v)),m}const Yye={kernelName:rg,backendName:"webgl",kernelFunc:Xye};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zye(n){const{inputs:e,backend:t,attrs:r}=n,{paramsNestedSplits:s,paramsDenseValues:a,indices:o}=e,{outputRaggedRank:i}=r,u=s.map(w=>t.readSync(w.dataId)),l=s.map(w=>w.shape),c=t.readSync(a.dataId),d=t.readSync(o.dataId),[p,m,v]=Khe(u,l,c,a.shape,a.dtype,d,o.shape,i),b=p.map(w=>t.makeTensorInfo([w.length],"int32",w)),y=t.makeTensorInfo(v,a.dtype,m);return b.concat([y])}const Qye={kernelName:Q0,backendName:"webgl",kernelFunc:Zye};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jye(n){const{inputs:e,backend:t}=n,{starts:r,limits:s,deltas:a}=e,o=t.readSync(r.dataId),i=t.readSync(s.dataId),u=t.readSync(a.dataId),[l,c]=Xhe(o,r.shape,r.dtype,i,s.shape,u,a.shape),d=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([c.length],r.dtype,c);return[d,p]}const ebe={kernelName:J0,backendName:"webgl",kernelFunc:Jye};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tbe(n){const{inputs:e,backend:t,attrs:r}=n,{shape:s,values:a,defaultValue:o,rowPartitionTensors:i}=e,{rowPartitionTypes:u}=r,l=t.readSync(s.dataId),c=t.readSync(a.dataId),d=t.readSync(o.dataId),p=i.map(y=>t.readSync(y.dataId)),m=i.map(y=>y.shape),[v,b]=Yhe(l,s.shape,c,a.shape,a.dtype,d,o.shape,p,m,u);return t.makeTensorInfo(v,a.dtype,b)}const nbe={kernelName:ex,backendName:"webgl",kernelFunc:tbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bV=n=>{const{backend:e,attrs:t}=n,{start:r,stop:s,step:a,dtype:o}=t,i=Zhe(r,s,a,o);return e.makeTensorInfo([i.length],o,i)},rbe={kernelName:tx,backendName:"webgl",kernelFunc:bV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sbe="return 1.0 / x;",abe=Pt({opSnippet:sbe}),obe={kernelName:Ld,backendName:"webgl",kernelFunc:abe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ibe=Oa+`
  return (x < 0.0) ? 0.0 : x;
`,ube=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,lbe=Pt({opSnippet:ibe,packedOpSnippet:ube}),cbe={kernelName:Pd,backendName:"webgl",kernelFunc:lbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hbe=Oa+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,dbe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,fbe=Pt({opSnippet:hbe,packedOpSnippet:dbe}),pbe={kernelName:Bd,backendName:"webgl",kernelFunc:fbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mbe{constructor(e,t,r,s,a){this.variableNames=["A"],this.outputShape=[];const[o,i,u,l]=e;this.outputShape=[o,t,r,l];const c=[s&&t>1?i-1:i,s&&r>1?u-1:u],d=[s&&t>1?t-1:t,s&&r>1?r-1:r];let p;a?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/d[0]},
          ${c[1]/d[1]});
      const vec2 inputShapeRC = vec2(${i}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gbe{constructor(e,t,r,s,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,i,u,l]=e;this.outputShape=[o,t,r,l];const c=[s&&t>1?i-1:i,s&&r>1?u-1:u],d=[s&&t>1?t-1:t,s&&r>1?r-1:r];let p;a?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/d[0]},
          ${c[1]/d[1]},
          ${c[1]/d[1]});
      const vec3 inputShapeRC = vec3(${i}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vbe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:a,halfPixelCenters:o,size:i}=r,[u,l]=i,c=de().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new gbe(s.shape,u,l,a,o):new mbe(s.shape,u,l,a,o);return t.runWebGLProgram(c,[s],"float32")}const ybe={kernelName:og,backendName:"webgl",kernelFunc:vbe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bbe{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,s,a]=t,[,o,i]=e,u=[r&&o>1?s-1:s,r&&i>1?a-1:a],l=[r&&o>1?o-1:o,r&&i>1?i-1:i],c=u[0]/l[0],d=u[1]/l[1],p=1/c,m=1/d,v=Math.ceil(p)*2+2,b=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${m});

        const int winHeight = int(${v});
        const int winWidth = int(${b});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${i}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${s-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${a-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xbe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:a}=e,{alignCorners:o}=r,i=new bbe(a.shape,s.shape,o);return t.runWebGLProgram(i,[a],a.dtype)}const wbe={kernelName:sx,backendName:"webgl",kernelFunc:xbe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sbe{constructor(e,t,r,s,a){this.variableNames=["A"],this.outputShape=[];const[o,i,u,l]=e;this.outputShape=[o,t,r,l];const c=[s&&t>1?i-1:i,s&&r>1?u-1:u],d=[s&&t>1?t-1:t,s&&r>1?r-1:r],p=s?"0.5":"0.0";let m;a?m="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":m="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/d[0]},
          ${c[1]/d[1]});
      const vec2 inputShapeRC = vec2(${i}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${m};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cbe{constructor(e,t,r,s,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,i,u,l]=e;this.outputShape=[o,t,r,l];const c=[s&&t>1?i-1:i,s&&r>1?u-1:u],d=[s&&t>1?t-1:t,s&&r>1?r-1:r],p=s?"0.5":"0.0";let m;a?m="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":m="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/d[0]},
          ${c[1]/d[1]},
          ${c[1]/d[1]});
      const vec3 inputShapeRC = vec3(${i}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${m};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nbe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:a,halfPixelCenters:o,size:i}=r,[u,l]=i,c=de().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Cbe(s.shape,u,l,a,o):new Sbe(s.shape,u,l,a,o);return t.runWebGLProgram(c,[s],s.dtype)}const kbe={kernelName:ag,backendName:"webgl",kernelFunc:Nbe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tbe{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,s,a]=t,[,o,i]=e,u=[r&&o>1?s-1:s,r&&i>1?a-1:a],l=[r&&o>1?o-1:o,r&&i>1?i-1:i],c=u[0]/l[0],d=u[1]/l[1],p=1/c,m=1/d,v=Math.ceil(p)*2+2,b=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${m});

        const int winHeight = int(${v});
        const int winWidth = int(${b});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${i}) {
              continue;
            }

            float sourceFracRow =
              float(${u[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${u[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${s}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${a}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ibe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:a}=e,{alignCorners:o}=r,i=new Tbe(a.shape,s.shape,o);return t.runWebGLProgram(i,[a],a.dtype)}const Ebe={kernelName:rx,backendName:"webgl",kernelFunc:Ibe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _be{constructor(e,t){this.variableNames=["x"];const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=e,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const s=i=>t.indexOf(i)!==-1&&e[i]!==1?`${e[i]} - coords[${i}] - 1`:`coords[${i}]`,a=e.map((i,u)=>s(u)).join(","),o=Jt(r);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rbe{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=e;const s=ns("rc",r),a=`${s[r-1]} + 1 < ${this.outputShape[r-1]}`,o=`${s[r-2]} + 1 < ${this.outputShape[r-2]}`,i=Jt(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${a}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${i} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${u(s.slice())};
          if(${a}){
            result.g = ${l(s.slice())};
          }
          if(${o}) {
            result.b = ${c(s.slice())};
            if(${a}) {
              result.a = ${d(s.slice())};
            }
          }
          setOutput(result);
        }
    `;function u(v){return p(v)}function l(v){return v[r-1]="("+v[r-1]+" + 1)",p(v)}function c(v){return v[r-2]="("+v[r-2]+" + 1)",p(v)}function d(v){return v[r-1]="("+v[r-1]+" + 1)",v[r-2]="("+v[r-2]+" + 1)",p(v)}function p(v){const b=e.map((S,N)=>m(N,v)),y=b.join(","),w=b.slice(-2).join(",");return`getChannel(getX(${y}), vec2(${w}))`}function m(v,b){return t.indexOf(v)!==-1&&e[v]!==1?`${e[v]} - ${b[v]} - 1`:`${b[v]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Abe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dims:a}=r,o=s.shape.length,i=Nt(a,s.shape);if(o===0)return Ps({inputs:{x:s},backend:t});const u=de().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Rbe(s.shape,i):new _be(s.shape,i);return t.runWebGLProgram(u,[s],s.dtype)}const Dbe={kernelName:ig,backendName:"webgl",kernelFunc:Abe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $be{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const r=e[1],s=e[2];this.outputShape=e;let a="";typeof t=="number"?a=`float outputValue = ${t.toFixed(2)};`:a=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${a}
          if(coordX >= 0 && coordX < ${s} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Obe={kernelName:wx,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,{radians:s,fillValue:a,center:o}=e,i=t,u=new $be(r.shape,a),[l,c]=wT(o,r.shape[1],r.shape[2]),d=[[l,c,Math.sin(s),Math.cos(s)]];return i.runWebGLProgram(u,[r],r.dtype,d)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fbe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Mbe=Pt({opSnippet:Fbe}),Lbe={kernelName:zd,backendName:"webgl",kernelFunc:Mbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pbe="return inversesqrt(x);",Bbe=Pt({opSnippet:Pbe,cpuKernelImpl:Qhe}),zbe={kernelName:Vd,backendName:"webgl",kernelFunc:Bbe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TI{constructor(e,t,r,s,a,o,i=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const l=Jt(a.length),c=Jt(o.length);let d="";r===1?d="i":r===2&&(d="i, j");const p=`getIndices(${d})`;let m="";s===1?m="i":s===2&&(m="i, coords[1]");const v=`getUpdates(${m})`;let b="";u&&(b="coords[0], coords[1]");const y=`getDefaultValue(${b})`,w=t>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${a});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${w};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${v};
              found = true;
            }
          }
          setOutput(mix(${y}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vbe{constructor(e,t,r,s,a,o,i=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const l=Jt(a.length),c=Jt(o.length);let d="";r===1?d="i":r===2&&(d="i, j");const p=`getIndices(${d})`;let m="";s===1?m="i":s===2&&(m="i, coords[1]");const v=`getUpdates(${m})`;let b="";u&&(b="coords[0], coords[1]");const y=`getDefaultValue(${b})`,w=t>1?"strides[j]":"strides",S=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${a});

        void main() {
          ${c} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${p});
              flattenedIndex += index.xz * ${w};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${S};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${v};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${y}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ube(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s,updates:a}=e,{shape:o}=r,{sliceRank:i,numUpdates:u,sliceSize:l,strides:c,outputSize:d}=Ku(a,s,o),p=[d/l,l];if(d===0)return t.makeTensorInfo(o,s.dtype);const m=Me({inputs:{x:s},backend:t,attrs:{shape:[u,i]}}),v=Me({inputs:{x:a},backend:t,attrs:{shape:[u,l]}}),b=t.makeTensorInfo([],"float32",new Float32Array([0]));let y;de().getBool("WEBGL_PACK")?y=new Vbe(u,i,m.shape.length,v.shape.length,c,p):y=new TI(u,i,m.shape.length,v.shape.length,c,p);const w=t.runWebGLProgram(y,[v,m,b],v.dtype),S=Me({inputs:{x:w},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(b),S}const Wbe={kernelName:ax,backendName:"webgl",kernelFunc:Ube};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gbe{constructor(e,t,r,s){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,r];const a="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,i=de().getNumber("WEBGL_VERSION")===2?a:o,u=s==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${i}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${u} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hbe(n){const{inputs:e,backend:t,attrs:r}=n,{sortedSequence:s,values:a}=e,{side:o}=r,i=new Gbe(s.shape[0],s.shape[1],a.shape[1],o),u=[[s.shape[1]]];return t.runWebGLProgram(i,[s,a],"int32",u)}const jbe={kernelName:ix,backendName:"webgl",kernelFunc:Hbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qbe{constructor(e,t,r){this.variableNames=["c","a","b"],this.outputShape=t;let s,a;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)a="resRC",s="resRC";else{const i=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],l=[];for(let c=0;c<t.length;c++)l.push(`${i[c]}`),c<e&&u.push(`${i[c]}`);s=u.join(),a=l.join()}const o=Jt(r);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${s});
        if (cVal >= 1.0) {
          setOutput(getA(${a}));
        } else {
          setOutput(getB(${a}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kbe(n){const{inputs:e,backend:t}=n,{condition:r,t:s,e:a}=e,o=new qbe(r.shape.length,s.shape,s.shape.length);return t.runWebGLProgram(o,[r,s,a],ms(s.dtype,a.dtype))}const Xbe={kernelName:ug,backendName:"webgl",kernelFunc:Kbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ybe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${c1};
  float scale = ${h1};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Zbe=Pt({opSnippet:Ybe}),Qbe={kernelName:Ud,backendName:"webgl",kernelFunc:Zbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jbe=gf+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,e0e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,t0e=Pt({opSnippet:Jbe,packedOpSnippet:e0e,cpuKernelImpl:ede}),n0e={kernelName:jd,backendName:"webgl",kernelFunc:t0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r0e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,s0e=Pt({opSnippet:r0e}),a0e={kernelName:Hd,backendName:"webgl",kernelFunc:s0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o0e=gf+`
  return sin(x);
`,i0e=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Sc}
  return result;
`,u0e=Pt({opSnippet:o0e,packedOpSnippet:i0e}),l0e={kernelName:Wd,backendName:"webgl",kernelFunc:u0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c0e=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,h0e=Pt({opSnippet:c0e}),d0e={kernelName:Gd,backendName:"webgl",kernelFunc:h0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f0e=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,p0e=Pt({opSnippet:f0e}),m0e={kernelName:qd,backendName:"webgl",kernelFunc:p0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g0e=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:a,paddings:o}=r;B(s.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const i=a.reduce((w,S)=>w*S),u=[[0,0]];u.push(...o);for(let w=1+a.length;w<s.shape.length;++w)u.push([0,0]);const l=[],c=yV({inputs:{x:s},backend:t,attrs:{paddings:u,constantValue:0}}),d=Pg(c.shape,a,i,!1),p=Bg(d.length,a.length,!1),m=zg(c.shape,a,i,!1),v=Me({inputs:{x:c},backend:t,attrs:{shape:d}}),b=os({inputs:{x:v},backend:t,attrs:{perm:p}}),y=Me({inputs:{x:b},backend:t,attrs:{shape:m}});return l.push(c),l.push(v),l.push(b),l.forEach(w=>t.disposeIntermediateTensorInfo(w)),y},v0e={kernelName:hg,backendName:"webgl",kernelFunc:g0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y0e(n){const{inputs:e,backend:t}=n,{indices:r,values:s,denseShape:a,defaultValue:o}=e;if(a.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${a.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${s.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const i=t.readSync(r.dataId),u=t.readSync(s.dataId),l=t.readSync(a.dataId),c=t.readSync(o.dataId)[0],[d,p,m,v,b]=nde(i,r.shape,r.dtype,u,s.dtype,l,c);return[t.makeTensorInfo(p,r.dtype,d),t.makeTensorInfo([p[0]],s.dtype,m),t.makeTensorInfo([v.length],"bool",new Uint8Array(v.map(y=>Number(y)))),t.makeTensorInfo([b.length],r.dtype,new Int32Array(b))]}const b0e={kernelName:ux,backendName:"webgl",kernelFunc:y0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x0e(n){const{inputs:e,backend:t}=n,{inputIndices:r,inputShape:s,newShape:a}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${s.shape}`);if(a.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${a.shape}`);const o=Array.from(t.readSync(s.dataId)),i=t.readSync(r.dataId),u=Array.from(t.readSync(a.dataId)),[l,c,d]=rde(i,r.shape,r.dtype,o,u);return[t.makeTensorInfo(c,r.dtype,l),t.makeTensorInfo([d.length],a.dtype,new Int32Array(d))]}const w0e={kernelName:lx,backendName:"webgl",kernelFunc:x0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S0e(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:a}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${s.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${a.shape}`);const o=t.readSync(r.dataId),i=t.readSync(s.dataId),u=t.readSync(a.dataId),[l,c]=Wz(o,r.shape,r.dtype,i,u,!0);return t.makeTensorInfo(c,r.dtype,l)}const C0e={kernelName:cx,backendName:"webgl",kernelFunc:S0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N0e(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:a}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${s.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${a.shape}`);const o=t.readSync(r.dataId),i=t.readSync(s.dataId),u=t.readSync(a.dataId),[l,c]=Wz(o,r.shape,r.dtype,i,u);return t.makeTensorInfo(c,r.dtype,l)}const k0e={kernelName:hx,backendName:"webgl",kernelFunc:N0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T0e(n){const{inputs:e,backend:t,attrs:r}=n,{sparseIndices:s,sparseValues:a,defaultValue:o}=e,{outputShape:i}=r,{sliceRank:u,numUpdates:l,sliceSize:c,strides:d,outputSize:p}=Ku(a,s,i),m=!1;if(a.dtype==="string"){const w=t.bufferSync(s),S=t.bufferSync(a),N=bi(t.readSync(o.dataId)[0]),C=Jhe(w,S,i,p,c,l,u,d,N,m);return t.makeTensorInfo(i,C.dtype,C.values)}const v=new TI(l,u,s.shape.length,a.shape.length,d,[p,1],m),b=t.runWebGLProgram(v,[a,s,o],a.dtype),y=Me({inputs:{x:b},backend:t,attrs:{shape:i}});return t.disposeIntermediateTensorInfo(b),y}const I0e={kernelName:dx,backendName:"webgl",kernelFunc:T0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E0e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{numOrSizeSplits:a,axis:o}=r,i=Nt(o,s.shape)[0],u=MT(s,a,i),l=s.shape.length,c=new Array(l).fill(0),d=s.shape.slice();return u.map(p=>{const m=[...d];m[i]=p;const v=vf({inputs:{x:s},backend:t,attrs:{begin:c,size:m}});return c[i]+=p,v})}const _0e={kernelName:dg,backendName:"webgl",kernelFunc:E0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EO="return sqrt(x);",R0e=Pt({opSnippet:EO,packedOpSnippet:EO,cpuKernelImpl:sde}),A0e={kernelName:Kd,backendName:"webgl",kernelFunc:R0e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D0e="return x * x;",$0e=Pt({opSnippet:D0e}),O0e={kernelName:fx,backendName:"webgl",kernelFunc:$0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _O="return (a - b) * (a - b);",F0e=Mr({opSnippet:_O,packedOpSnippet:_O}),M0e={kernelName:Xd,backendName:"webgl",kernelFunc:F0e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L0e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");const a=t.readSync(s.dataId),o=Ci(a),i=ade(o,"string",r);return t.makeTensorInfo(s.shape,"string",i)}const P0e={kernelName:pg,backendName:"webgl",kernelFunc:L0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B0e({inputs:n,attrs:e,backend:t}){const{x:r}=n,s=Oa+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,a=new Co(r.shape,s);return t.runWebGLProgram(a,[r],r.dtype)}const z0e={kernelName:ef,backendName:"webgl",kernelFunc:B0e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class V0e{constructor(e,t,r){this.variableNames=["x"],this.outputShape=r;const s=r.length,a=Jt(r.length),o=Jt(r.length);let i="";if(s===1)i="coords * strides + begin";else{let u=0;i=r.map((l,c)=>(u++,r.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${u-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${a} begin = ${a}(${e});
      ${a} strides = ${a}(${t});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U0e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:a,end:o,strides:i,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:d,shrinkAxisMask:p}=r,{finalShapeSparse:m,finalShape:v,isIdentity:b,sliceDim0:y,isSimpleSlice:w,begin:S,end:N,strides:C}=vT(s.shape,a,o,i,u,l,c,d,p);let T;if(b)T=Me({inputs:{x:s},backend:t,attrs:{shape:v}});else if(y||w){B(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const $=pT(S,N,C),_=vf({inputs:{x:s},backend:t,attrs:{begin:S,size:$}});T=Me({inputs:{x:_},backend:t,attrs:{shape:v}}),t.disposeIntermediateTensorInfo(_)}else if(t.shouldExecuteOnCPU([s])){const _=t.readSync(s.dataId),R=yt(s.shape,s.dtype,_),D=ode(m,R,C,S);T=t.makeTensorInfo(v,s.dtype,D.values)}else{const _=new V0e(S,C,m);T=t.runWebGLProgram(_,[s],s.dtype)}const E=Me({inputs:{x:T},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(T),E}const W0e={kernelName:px,backendName:"webgl",kernelFunc:U0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G0e(n){const{inputs:e,backend:t,attrs:r}=n,{separator:s,nGramWidths:a,leftPad:o,rightPad:i,padWidth:u,preserveShortSequences:l}=r,{data:c,dataSplits:d}=e,p=t.readSync(c.dataId),m=t.readSync(d.dataId),[v,b]=ide(p,m,s,a,o,i,u,l);return[t.makeTensorInfo([v.length],"string",v),t.makeTensorInfo(d.shape,"int32",b)]}const H0e={kernelName:mx,backendName:"webgl",kernelFunc:G0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j0e(n){const{inputs:e,backend:t,attrs:r}=n,{skipEmpty:s}=r,{input:a,delimiter:o}=e;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(a.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${a.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const i=t.readSync(a.dataId),u=t.readSync(o.dataId)[0],[l,c,d]=ude(i,u,s),p=c.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",c),t.makeTensorInfo([2],"int32",new Int32Array(d))]}const q0e={kernelName:gx,backendName:"webgl",kernelFunc:j0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K0e(n){const{inputs:e,backend:t,attrs:r}=n,{numBuckets:s}=r,{input:a}=e;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const o=t.readSync(a.dataId),i=lde(o,s);return t.makeTensorInfo(a.shape,"int32",i)}const X0e={kernelName:vx,backendName:"webgl",kernelFunc:K0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y0e="return tan(x);",Z0e=Pt({opSnippet:Y0e}),Q0e={kernelName:Zd,backendName:"webgl",kernelFunc:Z0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J0e=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,exe=Pt({opSnippet:J0e}),txe={kernelName:Qd,backendName:"webgl",kernelFunc:exe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nxe(n){const{inputs:e,backend:t,attrs:r}=n,{tensor:s,indices:a,updates:o}=e,{sliceRank:i,numUpdates:u,sliceSize:l,strides:c,outputSize:d}=Ku(o,a,s.shape),p=[d/l,l];if(d===0)return t.makeTensorInfo(s.shape,a.dtype);const m=Me({inputs:{x:a},backend:t,attrs:{shape:[u,i]}}),v=Me({inputs:{x:o},backend:t,attrs:{shape:[u,l]}}),b=Me({inputs:{x:s},backend:t,attrs:{shape:p}}),y=new TI(u,i,m.shape.length,v.shape.length,c,p,!1,!0),w=t.runWebGLProgram(y,[v,m,b],b.dtype),S=Me({inputs:{x:w},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(w),S}const rxe={kernelName:ox,backendName:"webgl",kernelFunc:nxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sxe{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let o=0;o<r.length;o++)r[o]=e[o]*t[o];this.outputShape=r,this.rank=r.length;const s=Jt(this.rank),a=axe(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        setOutput(getA(${a}));
      }
    `}}function axe(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let s=0;s<n.length;s++)r.push(`imod(${t[s]}, ${n[s]})`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xV(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reps:a}=r;if(s.dtype==="string"||s.shape.length>5){const u=t.readSync(s.dataId),l=s.dtype==="string"?u.map(p=>bi(p)):u,c=yt(s.shape,s.dtype,l),d=hde(c,a);return t.makeTensorInfo(d.shape,d.dtype,d.values)}const o=new sxe(s.shape,a);return t.runWebGLProgram(o,[s],s.dtype)}const oxe={kernelName:Jd,backendName:"webgl",kernelFunc:xV};class ixe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class uxe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cl(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function RO(n){let e=1;for(;e<n;)e*=2;return e}function lxe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{k:a,sorted:o}=r,i=de().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=de().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=s.shape,c=l[l.length-1];if(t.shouldExecuteOnCPU([s])||c<i||a>u){const D=t.readSync(s.dataId),[A,M]=dde(D,l,s.dtype,a,o);return[t.makeTensorInfo(A.shape,A.dtype,A.values),t.makeTensorInfo(M.shape,M.dtype,M.values)]}if(a===0)return l[l.length-1]=0,[t.makeTensorInfo(l,s.dtype,[]),t.makeTensorInfo(l,"int32",[])];if(c===1)return[s,ev({attrs:{shape:l,dtype:"int32",value:0},backend:t})];const d=t.texData.get(s.dataId),p=d!==null&&d.isPacked,m=p?t.unpackTensor(s):s,b=xe(l)/c,y=Me({inputs:{x:m},attrs:{shape:[b,c]},backend:t});p&&Cl(t,m);const w=RO(a),S=RO(c);let N=null;const C=()=>N===null?[y,y]:[y,N],T=(D,A,M)=>{const H=C(),j=new ixe(M),P=[[c],[N===null?1:0],[Number.NEGATIVE_INFINITY],[D],[A]],V=N;N=t.runWebGLProgram(j,H,"int32",P),Cl(t,V)};for(let D=1;D<w;D*=2){const A=D*2;for(let M=D;M>=1;M/=2)T(A,M,[b,S])}for(let D=S;D>w;D/=2){const A=C(),M=new uxe([b,D/2]),j=[[c],[N===null?1:0],[w]],G=N;N=t.runWebGLProgram(M,A,"int32",j),Cl(t,G);const P=w/2,V=P*2;for(let z=P;z>=1;z/=2)T(V,z,N.shape)}let E=N;N=vf({inputs:{x:N},backend:t,attrs:{begin:0,size:[b,a]}}),Cl(t,E);let $=dV({inputs:{x:y,indices:N},backend:t,attrs:{axis:1,batchDims:1}});Cl(t,y);const _=l.slice(0,-1);_.push(a),E=N,N=Me({inputs:{x:N},attrs:{shape:_},backend:t}),Cl(t,E);const R=$;return $=Me({inputs:{x:$},attrs:{shape:_},backend:t}),Cl(t,R),[$,N]}const cxe={kernelName:yx,backendName:"webgl",kernelFunc:lxe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hxe{constructor(e,t,r,s,a,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const i=r==="nearest"?1:2;let u;switch(s){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${u} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${a});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${a});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${i} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dxe(n){const{inputs:e,backend:t,attrs:r}=n,{image:s,transforms:a}=e,{interpolation:o,fillMode:i,fillValue:u,outputShape:l}=r,[c,d,p,m]=s.shape,[v,b]=l??[d,p],y=[c,v,b,m],w=new hxe(d,p,o,i,u,y);return t.runWebGLProgram(w,[s,a],"float32")}const fxe={kernelName:bx,backendName:"webgl",kernelFunc:dxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pxe(n){const{inputs:e,attrs:t,backend:r}=n,{axis:s}=t,{x:a}=e;Zg(a,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(a.dataId),{outputValues:i,outputShape:u,indices:l}=fde(o,s,a.shape,a.dtype);return[r.makeTensorInfo(u,a.dtype,i),r.makeTensorInfo([l.length],"int32",l)]}const mxe={kernelName:xx,backendName:"webgl",kernelFunc:pxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gxe(n){const{inputs:e,backend:t,attrs:r}=n,{value:s}=e;let{axis:a}=r;a<0&&(a+=s.shape.length);const o=s,i=o.shape.length,u=s.shape[a],l=new Array(i-1);let c=0;for(let b=0;b<i;b++)b!==a&&(l[c++]=o.shape[b]);const d=[],p=new Array(i).fill(0),m=o.shape.slice();m[a]=1;const v=new Array(u);for(let b=0;b<v.length;b++){p[a]=b;const y=vf({inputs:{x:o},backend:t,attrs:{begin:p,size:m}}),w=Me({inputs:{x:y},backend:t,attrs:{shape:l}});v[b]=w,d.push(y)}return d.forEach(b=>t.disposeIntermediateTensorInfo(b)),v}const vxe={kernelName:mg,backendName:"webgl",kernelFunc:gxe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yxe{constructor(e,t){this.variableNames=["x","segmentIds"];const r=e.windowSize,s=e.batchSize,a=e.inSize,o=e.numSegments,i=o*Math.ceil(a/r);this.outputShape=[s,i];const u="0.0",l="sumValue",c=Math.floor(r/4)*4,d=r%4,p=`
        sumValue += dot(values, segFilter);
    `;let m="";a%r>0&&(m=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `);let v="";a%r>0&&(v=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${u};

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${v}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${c};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bxe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,segmentIds:a}=e,{numSegments:o}=r,i=s.shape.length,u=[];let l=0;const c=Cn([l],i);let d=s;c!=null&&(d=os({inputs:{x:s},backend:t,attrs:{perm:c}}),u.push(d),l=Mn(1,i)[0]);const p=Z4(d.shape,l,o),m=xe([d.shape[l]]),v=Me({inputs:{x:d},backend:t,attrs:{shape:[-1,m]}});u.push(v);const b=Cx(s.dtype),y=(C,T,E,$,_)=>{const R=C.shape[0],D=C.shape[1],A=Y4(D,_),M={windowSize:A,inSize:D,batchSize:R,numSegments:_},H=new yxe(M,T),j=t.compileAndRun(H,[C,E],$);if(u.push(j),j.shape[1]===_)return j;const G=bV({backend:t,attrs:{start:0,stop:_,step:1,dtype:"float32"}}),P=xV({inputs:{x:G},backend:t,attrs:{reps:[D/A]}});return u.push(G),u.push(P),y(j,T,P,$,_)},w=y(v,"unsortedSegmentSum",a,b,o),S=Me({inputs:{x:w},backend:t,attrs:{shape:p}});let N=S;if(c!=null){u.push(S);const C=Gu(c);N=os({inputs:{x:N},backend:t,attrs:{perm:C}})}return u.forEach(C=>t.disposeIntermediateTensorInfo(C)),N}const xxe={kernelName:gg,backendName:"webgl",kernelFunc:bxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wxe=[sfe,ofe,lfe,dfe,pfe,vfe,bfe,wfe,kfe,Ife,Rfe,$fe,Mfe,zfe,Wfe,Hfe,qfe,Zfe,Jfe,tpe,ape,dpe,ppe,ype,xpe,Tpe,Epe,Dpe,Vde,Fpe,zpe,Gpe,Ype,Jpe,tme,rme,ame,lme,dme,mme,vme,bme,wme,Nme,Tme,Rme,Dme,Fme,Pme,zme,Gme,Kme,Qme,tge,sge,age,ige,lge,hge,fge,mge,bge,Sge,kge,Ige,Rge,$ge,Lge,Vge,zde,Wge,Ppe,jge,Xge,Qge,Wde,nve,ove,uve,dve,mve,bve,Sve,Tve,Rve,$ve,Fve,Bve,Vve,Wve,qve,Xve,Zve,Jve,tye,aye,lye,fye,wye,jde,kye,Eye,Aye,Oye,Spe,Lye,Bye,Vye,Gye,Kye,Hde,Yye,Qye,ebe,nbe,rbe,Cpe,vye,obe,cbe,pbe,Kde,ybe,wbe,kbe,Ebe,Dbe,Obe,Lbe,zbe,Wbe,jbe,Xbe,Qbe,n0e,a0e,l0e,d0e,cpe,bye,m0e,v0e,b0e,w0e,C0e,k0e,I0e,_0e,A0e,O0e,M0e,P0e,z0e,W0e,H0e,q0e,X0e,yye,tfe,Q0e,txe,rxe,oxe,cxe,fxe,nfe,mxe,vxe,xxe,Pye];for(const n of wxe)Sx(n);var Op={exports:{}};const Sxe=RN(rre),Cxe=RN(IZ);/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Nxe=Op.exports,AO;function kxe(){return AO||(AO=1,function(n,e){(function(t,r){r(e,Sxe,Cxe)})(Nxe,function(t,r,s){const a={1:{name:"/m/01g317",id:1,displayName:"person"},2:{name:"/m/0199g",id:2,displayName:"bicycle"},3:{name:"/m/0k4j",id:3,displayName:"car"},4:{name:"/m/04_sv",id:4,displayName:"motorcycle"},5:{name:"/m/05czz6l",id:5,displayName:"airplane"},6:{name:"/m/01bjv",id:6,displayName:"bus"},7:{name:"/m/07jdr",id:7,displayName:"train"},8:{name:"/m/07r04",id:8,displayName:"truck"},9:{name:"/m/019jd",id:9,displayName:"boat"},10:{name:"/m/015qff",id:10,displayName:"traffic light"},11:{name:"/m/01pns0",id:11,displayName:"fire hydrant"},13:{name:"/m/02pv19",id:13,displayName:"stop sign"},14:{name:"/m/015qbp",id:14,displayName:"parking meter"},15:{name:"/m/0cvnqh",id:15,displayName:"bench"},16:{name:"/m/015p6",id:16,displayName:"bird"},17:{name:"/m/01yrx",id:17,displayName:"cat"},18:{name:"/m/0bt9lr",id:18,displayName:"dog"},19:{name:"/m/03k3r",id:19,displayName:"horse"},20:{name:"/m/07bgp",id:20,displayName:"sheep"},21:{name:"/m/01xq0k1",id:21,displayName:"cow"},22:{name:"/m/0bwd_0j",id:22,displayName:"elephant"},23:{name:"/m/01dws",id:23,displayName:"bear"},24:{name:"/m/0898b",id:24,displayName:"zebra"},25:{name:"/m/03bk1",id:25,displayName:"giraffe"},27:{name:"/m/01940j",id:27,displayName:"backpack"},28:{name:"/m/0hnnb",id:28,displayName:"umbrella"},31:{name:"/m/080hkjn",id:31,displayName:"handbag"},32:{name:"/m/01rkbr",id:32,displayName:"tie"},33:{name:"/m/01s55n",id:33,displayName:"suitcase"},34:{name:"/m/02wmf",id:34,displayName:"frisbee"},35:{name:"/m/071p9",id:35,displayName:"skis"},36:{name:"/m/06__v",id:36,displayName:"snowboard"},37:{name:"/m/018xm",id:37,displayName:"sports ball"},38:{name:"/m/02zt3",id:38,displayName:"kite"},39:{name:"/m/03g8mr",id:39,displayName:"baseball bat"},40:{name:"/m/03grzl",id:40,displayName:"baseball glove"},41:{name:"/m/06_fw",id:41,displayName:"skateboard"},42:{name:"/m/019w40",id:42,displayName:"surfboard"},43:{name:"/m/0dv9c",id:43,displayName:"tennis racket"},44:{name:"/m/04dr76w",id:44,displayName:"bottle"},46:{name:"/m/09tvcd",id:46,displayName:"wine glass"},47:{name:"/m/08gqpm",id:47,displayName:"cup"},48:{name:"/m/0dt3t",id:48,displayName:"fork"},49:{name:"/m/04ctx",id:49,displayName:"knife"},50:{name:"/m/0cmx8",id:50,displayName:"spoon"},51:{name:"/m/04kkgm",id:51,displayName:"bowl"},52:{name:"/m/09qck",id:52,displayName:"banana"},53:{name:"/m/014j1m",id:53,displayName:"apple"},54:{name:"/m/0l515",id:54,displayName:"sandwich"},55:{name:"/m/0cyhj_",id:55,displayName:"orange"},56:{name:"/m/0hkxq",id:56,displayName:"broccoli"},57:{name:"/m/0fj52s",id:57,displayName:"carrot"},58:{name:"/m/01b9xk",id:58,displayName:"hot dog"},59:{name:"/m/0663v",id:59,displayName:"pizza"},60:{name:"/m/0jy4k",id:60,displayName:"donut"},61:{name:"/m/0fszt",id:61,displayName:"cake"},62:{name:"/m/01mzpv",id:62,displayName:"chair"},63:{name:"/m/02crq1",id:63,displayName:"couch"},64:{name:"/m/03fp41",id:64,displayName:"potted plant"},65:{name:"/m/03ssj5",id:65,displayName:"bed"},67:{name:"/m/04bcr3",id:67,displayName:"dining table"},70:{name:"/m/09g1w",id:70,displayName:"toilet"},72:{name:"/m/07c52",id:72,displayName:"tv"},73:{name:"/m/01c648",id:73,displayName:"laptop"},74:{name:"/m/020lf",id:74,displayName:"mouse"},75:{name:"/m/0qjjc",id:75,displayName:"remote"},76:{name:"/m/01m2v",id:76,displayName:"keyboard"},77:{name:"/m/050k8",id:77,displayName:"cell phone"},78:{name:"/m/0fx9l",id:78,displayName:"microwave"},79:{name:"/m/029bxz",id:79,displayName:"oven"},80:{name:"/m/01k6s3",id:80,displayName:"toaster"},81:{name:"/m/0130jx",id:81,displayName:"sink"},82:{name:"/m/040b_t",id:82,displayName:"refrigerator"},84:{name:"/m/0bt_c3",id:84,displayName:"book"},85:{name:"/m/01x3z",id:85,displayName:"clock"},86:{name:"/m/02s195",id:86,displayName:"vase"},87:{name:"/m/01lsmm",id:87,displayName:"scissors"},88:{name:"/m/0kmg4",id:88,displayName:"teddy bear"},89:{name:"/m/03wvsk",id:89,displayName:"hair drier"},90:{name:"/m/012xff",id:90,displayName:"toothbrush"}};class o{constructor(u,l){this.modelPath=l||`https://storage.googleapis.com/tfjs-models/savedmodel/${this.getPrefix(u)}/model.json`}getPrefix(u){return u==="lite_mobilenet_v2"?`ssd${u}`:`ssd_${u}`}async load(){this.model=await r.loadGraphModel(this.modelPath);const u=s.zeros([1,300,300,3],"int32"),l=await this.model.executeAsync(u);await Promise.all(l.map(c=>c.data())),l.map(c=>c.dispose()),u.dispose()}async infer(u,l,c){const d=s.tidy(()=>(u instanceof s.Tensor||(u=s.browser.fromPixels(u)),s.expandDims(u))),p=d.shape[1],m=d.shape[2],v=await this.model.executeAsync(d),b=v[0].dataSync(),y=v[1].dataSync();d.dispose(),s.dispose(v);const[w,S]=this.calculateMaxScores(b,v[0].shape[1],v[0].shape[2]),N=s.getBackend();s.getBackend()==="webgl"&&s.setBackend("cpu");const C=s.tidy(()=>{const E=s.tensor2d(y,[v[1].shape[1],v[1].shape[3]]);return s.image.nonMaxSuppression(E,w,l,c,c)}),T=C.dataSync();return C.dispose(),N!==s.getBackend()&&s.setBackend(N),this.buildDetectedObjects(m,p,y,w,T,S)}buildDetectedObjects(u,l,c,d,p,m){const v=p.length,b=[];for(let y=0;y<v;y++){const w=[];for(let E=0;E<4;E++)w[E]=c[4*p[y]+E];const S=w[0]*l,N=w[1]*u,C=w[2]*l,T=w[3]*u;w[0]=N,w[1]=S,w[2]=T-N,w[3]=C-S,b.push({bbox:w,class:a[m[p[y]]+1].displayName,score:d[p[y]]})}return b}calculateMaxScores(u,l,c){const d=[],p=[];for(let m=0;m<l;m++){let v=Number.MIN_VALUE,b=-1;for(let y=0;y<c;y++)u[m*c+y]>v&&(v=u[m*c+y],b=y);d[m]=v,p[m]=b}return[d,p]}async detect(u,l=20,c=.5){return this.infer(u,l,c)}dispose(){this.model!=null&&this.model.dispose()}}t.ObjectDetection=o,t.load=async function(i={}){if(s==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");const u=i.base||"lite_mobilenet_v2",l=i.modelUrl;if(["mobilenet_v1","mobilenet_v2","lite_mobilenet_v2"].indexOf(u)===-1)throw new Error(`ObjectDetection constructed with invalid base model ${u}. Valid names are 'mobilenet_v1', 'mobilenet_v2' and 'lite_mobilenet_v2'.`);const c=new o(u,l);return await c.load(),c},t.version="2.2.3",Object.defineProperty(t,"__esModule",{value:!0})})}(Op,Op.exports)),Op.exports}var Txe=kxe();const Ixe=()=>{const[n,e]=_e.useState(null),[t,r]=_e.useState(!0),[s,a]=_e.useState([]),[o,i]=_e.useState(null),u=_e.useRef(null);_e.useEffect(()=>{(async()=>{try{r(!0),i(null),await qF("webgl");const m=await Txe.load();e(m),r(!1)}catch(m){console.error("Error loading model:",m),i("Failed to load object detection model"),r(!1)}})()},[]);const l=async p=>{if(!(!n||!p))try{const m=await n.detect(p);a(m)}catch(m){console.error("Error during detection:",m),i("Error during object detection")}},c=(p,m=100)=>{u.current&&clearInterval(u.current),u.current=setInterval(()=>{l(p)},m)},d=()=>{u.current&&(clearInterval(u.current),u.current=null),a([])};return _e.useEffect(()=>()=>{u.current&&clearInterval(u.current)},[]),{model:n,isLoading:t,predictions:s,error:o,detectObjects:l,startDetection:c,stopDetection:d}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var wV=function(n,e){return(wV=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var s in r)r.hasOwnProperty(s)&&(t[s]=r[s])})(n,e)};function ao(n,e){function t(){this.constructor=n}wV(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ke(n,e,t,r){return new(t||(t=Promise))(function(s,a){function o(l){try{u(r.next(l))}catch(c){a(c)}}function i(l){try{u(r.throw(l))}catch(c){a(c)}}function u(l){l.done?s(l.value):new t(function(c){c(l.value)}).then(o,i)}u((r=r.apply(n,[])).next())})}function Xe(n,e){var t,r,s,a,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function i(u){return function(l){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,r&&(s=2&c[0]?r.return:c[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,c[1])).done)return s;switch(r=0,s&&(c=[2&c[0],s.value]),c[0]){case 0:case 1:s=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){o=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){o.label=c[1];break}if(c[0]===6&&o.label<s[1]){o.label=s[1],s=c;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(c);break}s[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(n,o)}catch(d){c=[6,d],r=0}finally{t=s=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var Exe=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var s=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+s+"."),this.set(e,s)}},n.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,r,s=(t=this.global.location.search,r={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(a){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];return _xe(r,o[0],o[1]),o.join("=")}),r);"tfjsflags"in s&&s.tfjsflags.split(",").forEach(function(a){var o=a.split(":"),i=o[0],u=o[1];e.urlFlags[i]=function(l,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")}(i,u)})}},n}();function _xe(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Ne(){return SV}var SV=null,Gb=new Map,iN=new Map;function CV(n,e){var t=kV(n,e);return Gb.get(t)}function Rxe(n){return iN.get(n)}function DO(n){for(var e=Gb.entries(),t=[];;){var r=e.next(),s=r.done,a=r.value;if(s)break;var o=a[0],i=a[1];o.split("_")[0]===n&&t.push(i)}return t}function NV(n){var e=n.kernelName,t=n.backendName,r=kV(e,t);if(Gb.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");Gb.set(r,n)}function Axe(n){var e=n.kernelName;iN.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),iN.set(e,n)}function kV(n,e){return e+"_"+n}function uN(n,e,t){return Math.max(n,Math.min(e,t))}function TV(n){return n%2==0?n:n+1}function Dxe(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function X(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function qt(n,e,t){t===void 0&&(t=""),X(_r(n,e),function(){return t+" Shapes "+n+" and "+e+" must match"})}function yf(n){X(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function ed(n,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(n)||Ro(n)&&!t)for(var r=0;r<n.length;++r)ed(n[r],e,t);else e.push(n);return e}function Je(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function _r(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Hn(n){return n%1==0}function $xe(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function lN(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Dh(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function $O(n,e,t){return e===void 0&&(e=function(r){return 0}),new Promise(function(r,s){var a=0,o=function(){if(n())r();else{a++;var i=e(a);t!=null&&a>=t?s():setTimeout(o,i)}};o()})}function Oxe(n,e){for(var t=1,r=-1,s=0;s<n.length;++s)if(n[s]>=0)t*=n[s];else if(n[s]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+s);r=s}else if(n[s]<0)throw Error("Shapes can not be < 0. Found "+n[s]+" at dim "+s);if(r===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(t===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var a=n.slice();return a[r]=e/t,a}function br(n,e){var t=e.length;return X((n=n==null?e.map(function(r,s){return s}):[].concat(n)).every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n}),X(n.every(function(r){return Hn(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?t+r:r})}function Ol(n,e){for(var t=[],r=[],s=e!=null&&Array.isArray(e)&&e.length===0,a=e==null||s?null:br(e,n).sort(),o=0,i=0;i<n.length;++i){if(a!=null){if(a[o]===i&&n[i]!==1)throw new Error("Can't squeeze axis "+i+" since its dim '"+n[i]+"' is not 1");(a[o]==null||a[o]>i)&&n[i]===1&&(t.push(n[i]),r.push(i)),a[o]<=i&&o++}n[i]!==1&&(t.push(n[i]),r.push(i))}return{newShape:t,keptDims:r}}function im(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else{if(n!=="bool")throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function Hb(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else{if(n!=="string")throw new Error("Unknown data type "+n);t=new Array(e)}return t}function Fxe(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function Mxe(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function Lxe(n,e){return e!=="complex64"&&(e!=="float32"||n==="complex64")&&(e!=="int32"||n==="float32"||n==="complex64")&&(e!=="bool"||n!=="bool")}function Ro(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function IV(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function Pxe(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function II(n){return typeof n=="string"||n instanceof String}function Bxe(n){return typeof n=="boolean"}function zxe(n){return typeof n=="number"}function tv(n){return Array.isArray(n)?tv(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":zxe(n)?"float32":II(n)?"string":Bxe(n)?"bool":"float32"}function cN(n){return!!(n&&n.constructor&&n.call&&n.apply)}function hN(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function Ao(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function EV(n,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=ed(n)),t&&Fxe(n,e),function(a,o){return a instanceof Float32Array&&o==="float32"||a instanceof Int32Array&&o==="int32"||a instanceof Uint8Array&&o==="bool"}(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var r=new Uint8Array(n.length),s=0;s<r.length;++s)Math.round(n[s])!==0&&(r[s]=1);return r}throw new Error("Unknown data type "+e)}function OO(n,e){if(n.length===0)return e[0];var t=n.reduce(function(r,s){return r*s});if(t===0)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return function r(s,a,o){var i=new Array;if(a.length===1)for(var u=a[0],l=0;l<u;l++)i[l]=o[s+l];else{u=a[0];var c=a.slice(1),d=c.reduce(function(p,m){return p*m});for(l=0;l<u;l++)i[l]=r(s+l*d,c,o)}return i}(0,n,e)}function _V(n,e){for(var t=nv(n,e),r=0;r<t.length;r++)t[r]=1;return t}function nv(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+e)}function bo(){return Ne().platform.now()}function RV(n){n.forEach(function(e){X(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function Vxe(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Ne().platform.encode(n,e)}function jb(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Ne().platform.decode(n,e)}function FO(n,e,t){if(e===0)return 0;if(e===1)return n[0];for(var r=n[n.length-1],s=0;s<n.length-1;++s)r+=t[s]*n[s];return r}function Uxe(n,e,t){if(e===0)return[];if(e===1)return[n];for(var r=new Array(e),s=0;s<r.length-1;++s)r[s]=Math.floor(n/t[s]),n-=r[s]*t[s];return r[r.length-1]=n,r}var Wxe=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Gxe)}return n.prototype.profileKernel=function(e,t,r){var s,a=this,o=this.backendTimer.time(function(){s=r()});return s.forEach(function(i){i.data().then(function(u){(function(l,c,d){if(c!=="float32")return!1;for(var p=0;p<l.length;p++){var m=l[p];if(isNaN(m)||!isFinite(m))return console.warn("Found "+m+" in the result of '"+d+"'"),!0}})(u,i.dtype,e),o.then(function(l){var c="";l.getExtraProfileInfo!=null&&(c=l.getExtraProfileInfo()),a.logger.logKernelProfile(e,i,u,l.kernelMs,t,c)})})}),s},n}(),Gxe=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,s,a,o){var i=typeof s=="number"?Dh(s+"ms",9):s.error,u=Dh(e,25),l=t.rank,c=t.size,d=Dh(t.shape.toString(),14),p="";for(var m in a){var v=a[m].shape||t.shape,b=v.length;p+=m+": "+b+"D "+(b>0?v:"")+" "}console.log("%c"+u+"	%c"+i+"	%c"+l+"D "+d+"	%c"+c+"	%c"+p+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}(),MO=20,Np=3,$S=7;function Hxe(n,e,t,r){var s=Ao(e),a=function(l,c,d,p){var m=Je(c),v=p[p.length-1],b=new Array(v).fill(0),y=c.length,w=d==="complex64"?Tp(l):l;if(y>1)for(var S=0;S<m/v;S++)for(var N=S*v,C=0;C<v;C++)b[C]=Math.max(b[C],kp(w[N+C],0,d).length);return b}(n,e,t,s),o=e.length,i=function l(c,d,p,m,v,b){b===void 0&&(b=!0);var y=p==="complex64"?2:1,w=d[0],S=d.length;if(S===0)return p==="complex64"?[kp(Tp(c)[0],0,p)]:p==="bool"?[AV(c[0])]:[c[0].toString()];if(S===1){if(w>MO){var N=Np*y,C=Array.from(c.slice(0,N)),T=Array.from(c.slice((w-Np)*y,w*y));return p==="complex64"&&(C=Tp(C),T=Tp(T)),["["+C.map(function(G,P){return kp(G,v[P],p)}).join(", ")+", ..., "+T.map(function(G,P){return kp(G,v[w-Np+P],p)}).join(", ")+"]"]}return["["+(p==="complex64"?Tp(c):Array.from(c)).map(function(G,P){return kp(G,v[P],p)}).join(", ")+"]"]}var E=d.slice(1),$=m.slice(1),_=m[0]*y,R=[];if(w>MO){for(var D=0;D<Np;D++){var A=(M=D*_)+_;R.push.apply(R,l(c.slice(M,A),E,p,$,v,!1))}for(R.push("..."),D=w-Np;D<w;D++)A=(M=D*_)+_,R.push.apply(R,l(c.slice(M,A),E,p,$,v,D===w-1))}else for(D=0;D<w;D++){var M;A=(M=D*_)+_,R.push.apply(R,l(c.slice(M,A),E,p,$,v,D===w-1))}var H=S===2?",":"";for(R[0]="["+R[0]+H,D=1;D<R.length-1;D++)R[D]=" "+R[D]+H;var j=`,
`;for(D=2;D<S;D++)j+=`
`;return R[R.length-1]=" "+R[R.length-1]+"]"+(b?"":j),R}(n,e,t,s,a),u=["Tensor"];return r&&(u.push("  dtype: "+t),u.push("  rank: "+o),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(i.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function kp(n,e,t){return Dh(Array.isArray(n)?parseFloat(n[0].toFixed($S))+" + "+parseFloat(n[1].toFixed($S))+"j":II(n)?"'"+n+"'":t==="bool"?AV(n):parseFloat(n.toFixed($S)).toString(),e)}function AV(n){return n===0?"false":"true"}function Tp(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var um=function(){function n(e,t,r){var s=this;if(this.dtype=t,this.shape=e.slice(),this.size=Je(e),r!=null){var a=r.length;X(a===this.size,function(){return"Length of values '"+a+"' does not match the size inferred by the shape '"+s.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Hb(t,this.size),this.strides=Ao(e)}return n.prototype.set=function(e){for(var t=this,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];r.length===0&&(r=[0]),X(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"});var a=this.locToIndex(r);this.values[a]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var r=0,s=0,a=e;s<a.length;s++){var o=a[s];if(o<0||o>=this.shape[r]){var i="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(i)}r++}for(var u=e[e.length-1],l=0;l<e.length-1;++l)u+=this.strides[l]*e[l];return this.values[u]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return xo().makeTensor(this.values,this.shape,this.dtype)},n}(),xo=null,we=null,DV=null,In=function(){function n(e,t,r,s){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Je(e),this.strides=Ao(e),this.dataId=r,this.id=s,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),X(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,s){return this.throwIfDisposed(),this.reshape([e,t,r,s])},n.prototype.as5D=function(e,t,r,s,a){return this.throwIfDisposed(),this.reshape([e,t,r,s,a])},n.prototype.asType=function(e){return this.throwIfDisposed(),we.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return Ke(this,void 0,void 0,function(){var e;return Xe(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,we.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return we.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Ke(this,void 0,void 0,function(){var e;return Xe(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,OO(this.shape,e)]}})})},n.prototype.arraySync=function(){return OO(this.shape,this.dataSync())},n.prototype.data=function(){return Ke(this,void 0,void 0,function(){var e,t;return Xe(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=xo().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(s){return jb(s)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataSync=function(){this.throwIfDisposed();var e=xo().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return jb(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return Ke(this,void 0,void 0,function(){var e;return Xe(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,xo().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(xo().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return e===void 0&&(e=!1),we.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),we.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return e===void 0&&(e=0),we.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1),we.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),we.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),we.clone(this)},n.prototype.oneHot=function(e,t,r){return this.throwIfDisposed(),we.oneHot(this,e,t,r)},n.prototype.toString=function(e){return e===void 0&&(e=!1),Hxe(this.dataSync(),this.shape,this.dtype,e)},n.prototype.tile=function(e){return this.throwIfDisposed(),we.tile(this,e)},n.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),we.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),we.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),we.dot(this,e)},n.prototype.norm=function(e,t,r){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),we.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),we.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),we.reverse(this,e)},n.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),we.concat([this].concat(e),t)},n.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),we.split(this,e,t)},n.prototype.stack=function(e,t){return t===void 0&&(t=0),we.stack([this,e],t)},n.prototype.unstack=function(e){return e===void 0&&(e=0),we.unstack(this,e)},n.prototype.pad=function(e,t){return t===void 0&&(t=0),we.pad(this,e,t)},n.prototype.batchNormalization=function(e,t,r,s,a){return r===void 0&&(r=.001),DV("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,a,s,r)},n.prototype.batchNorm=function(e,t,r,s,a){return a===void 0&&(a=.001),this.throwIfDisposed(),we.batchNorm(this,e,t,r,s,a)},n.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),we.all(this,e,t)},n.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),we.any(this,e,t)},n.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),we.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),we.sum(this,e,t)},n.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),we.prod(this,e,t)},n.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),we.mean(this,e,t)},n.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),we.min(this,e,t)},n.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),we.max(this,e,t)},n.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),we.argMin(this,e)},n.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),we.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),we.cast(this,e)},n.prototype.add=function(e){return this.throwIfDisposed(),we.add(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),we.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),we.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),we.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),we.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),we.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),we.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),we.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),we.mulStrict(this,e)},n.prototype.div=function(e){return this.throwIfDisposed(),we.div(this,e)},n.prototype.divNoNan=function(e){return this.throwIfDisposed(),we.divNoNan(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),we.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),we.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),we.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),we.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),we.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),we.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),we.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),we.modStrict(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),we.squaredDifferenceStrict(this,e)},n.prototype.transpose=function(e){return this.throwIfDisposed(),we.transpose(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),we.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),we.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),we.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),we.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),we.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),we.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),we.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),we.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),we.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),we.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),we.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),we.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),we.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),we.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),we.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),we.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),we.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),we.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),we.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),we.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),we.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),we.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),we.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),we.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),we.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),we.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),we.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),we.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),we.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),we.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),we.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),we.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),we.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),we.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),we.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),we.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),we.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),we.selu(this)},n.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),we.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),we.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),we.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),we.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),we.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),we.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),we.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),we.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),we.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),we.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),we.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),we.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),we.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),we.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),we.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),we.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),we.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),we.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),we.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),we.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),we.round(this)},n.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),we.step(this,e)},n.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),we.softmax(this,e)},n.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),we.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),we.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),we.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,s,a,o){return s===void 0&&(s="NWC"),a===void 0&&(a=1),this.throwIfDisposed(),we.conv1d(this,e,t,r,s,a,o)},n.prototype.conv2d=function(e,t,r,s,a,o){return s===void 0&&(s="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),we.conv2d(this,e,t,r,s,a,o)},n.prototype.conv2dTranspose=function(e,t,r,s,a){return this.throwIfDisposed(),we.conv2dTranspose(this,e,t,r,s,a)},n.prototype.depthwiseConv2D=function(e,t,r,s,a,o){return s===void 0&&(s="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),we.depthwiseConv2d(this,e,t,r,s,a,o)},n.prototype.separableConv2d=function(e,t,r,s,a,o){return a===void 0&&(a=[1,1]),o===void 0&&(o="NHWC"),this.throwIfDisposed(),we.separableConv2d(this,e,t,r,s,a,o)},n.prototype.avgPool=function(e,t,r,s){return this.throwIfDisposed(),we.avgPool(this,e,t,r,s)},n.prototype.maxPool=function(e,t,r,s){return this.throwIfDisposed(),we.maxPool(this,e,t,r,s)},n.prototype.localResponseNormalization=function(e,t,r,s){return e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),s===void 0&&(s=.5),we.localResponseNormalization(this,e,t,r,s)},n.prototype.pool=function(e,t,r,s,a){return this.throwIfDisposed(),we.pool(this,e,t,r,s,a)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),xo().makeVariable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),we.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),we.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),we.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),we.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,s,a,o,i,u){return s===void 0&&(s=0),a===void 0&&(a=0),o===void 0&&(o=0),i===void 0&&(i=0),u===void 0&&(u=0),this.throwIfDisposed(),we.stridedSlice(this,e,t,r,s,a,o,i,u)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),we.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),we.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),we.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),we.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),we.spectral.irfft(this)},n}();Object.defineProperty(In,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var LO,dN,fN,pN,mN,td=function(n){function e(t,r,s,a){var o=n.call(this,t.shape,t.dtype,t.dataId,a)||this;return o.trainable=r,o.name=s,o}return ao(e,n),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!_r(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");xo().disposeTensor(this),this.dataId=t.dataId,xo().incRef(this,null)},e.prototype.dispose=function(){xo().disposeVariable(this),this.isDisposedInternal=!0},e}(In);Object.defineProperty(td,Symbol.hasInstance,{value:function(n){return n instanceof In&&n.assign!=null&&n.assign instanceof Function}}),function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"}(LO||(LO={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(dN||(dN={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(fN||(fN={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(pN||(pN={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(mN||(mN={}));var jxe={float32:pN,int32:dN,bool:fN,complex64:mN};function Vr(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast "+n+" with "+e)}return jxe[n][e]}function OS(n){return Vr(n,"int32")}function Rn(n,e){if(n.dtype===e.dtype)return[n,e];var t=Vr(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function qxe(n,e){X(n.dtype===e.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"})}function $V(n){var e=[];return function t(r,s,a){if(r!=null){if(r instanceof In)return void s.push(r);if(o=r,!(!Array.isArray(o)&&typeof o!="object")){var o,i=r;for(var u in i){var l=i[u];a.has(l)||(a.add(l),t(l,s,a))}}}}(n,e,new Set),e}var FS,PO=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),Kxe=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new PO}return n.prototype.ready=function(){return Ke(this,void 0,void 0,function(){var e,t,r;return Xe(this,function(s){switch(s.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,s.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return s.sent()?[4,this.setBackend(r)]:[3,4];case 3:return s.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return Ke(this,void 0,void 0,function(){var t,r,s;return Xe(this,function(a){switch(a.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return s=a.sent(),[3,3];case 2:s=r,a.label=3;case 3:if(!s)return[2,!1];a.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Wxe(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this;DO(this.backendName).forEach(function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this;DO(e).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var s=r.factory();if(Promise.resolve(s)===s){var a=++this.pendingBackendInitId,o=s.then(function(i){return!(a<t.pendingBackendInitId)&&(t.registry[e]=i,t.pendingBackendInit=null,!0)}).catch(function(i){return!(a<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(i.stack||i.message),!1)});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(i){return console.warn("Initialization of backend "+e+" failed"),console.warn(i.stack||i.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],s=this.initializeBackend(r),a=s.success,o=s.asyncInit;if(o||a)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),s=r.backend,a=this.readSync(t);s.disposeData(t),r.backend=e,e.move(t,a,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r,s=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun(function(){return s.startScope(a)},function(){return s.endScope(r)},function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(e,t,r){e();try{var s=r();return t(),s}catch(a){throw t(),a}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[t],function(s){return{x:function(){return s.toFloat()}}},[]),t},n.prototype.runKernel=function(e,t,r,s,a){return this.runKernelFunc(null,t,null,e,r,s,a)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var s=this.backend.numDataIds(),a=0;r.forEach(function(u){a+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=s-t-a-o;if(i>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+i+" data ids) after running '"+e+"'")},n.prototype.runKernelFunc=function(e,t,r,s,a,o,i){var u,l=this;o===void 0&&(o=[]),i===void 0&&(i=[]);var c=[],d=this.isTapeOn();s==null&&(s=this.state.activeScope!=null?this.state.activeScope.name:"");var p,m=function(S){d&&(c=S.map(function(N){return l.keep(l.clone(N))}))},v=this.state.numBytes,b=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var y,w=CV(s,this.backendName);return p=w!=null?function(){var S=l.backend.numDataIds();y=w.kernelFunc({inputs:t,attrs:a,backend:l.backend});var N=Array.isArray(y)?y:[y];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(s,S,N);var C=N.map(function(E){var $=E.dataId,_=E.shape,R=E.dtype;return l.makeTensorFromDataId($,_,R)}),T=C.filter(function(E,$){return i[$]});return m((o||[]).slice().concat(T)),C}:function(){var S=l.backend.numDataIds();y=l.tidy(function(){return e(l.backend,m)});var N=Array.isArray(y)?y:[y];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(s,S,N),N},this.scopedRun(function(){return l.state.kernelDepth++},function(){return l.state.kernelDepth--},function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(s,t,function(){return p()}):p()}),d&&this.addTapeNode(s,t,u,r,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:s,bytesAdded:this.state.numBytes-v,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-b,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(S){return t[S].shape}),outputShapes:u.map(function(S){return S.shape})}),Array.isArray(y)?u:u[0]},n.prototype.makeTensor=function(e,t,r,s){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",s=s||this.backend;var a=e;r==="string"&&II(e[0])&&(a=e.map(function(c){return Vxe(c)}));var o=s.write(a,t,r),i=new In(t,r,o,this.nextTensorId());if(this.incRef(i,s),r==="string"){var u=this.state.tensorInfo.get(o),l=Pxe(a);this.state.numBytes+=l-u.bytes,u.bytes=l}return i},n.prototype.makeTensorFromDataId=function(e,t,r,s){var a=new In(t,r=r||"float32",e,this.nextTensorId());return this.incRef(a,s),a},n.prototype.makeVariable=function(e,t,r,s){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),s!=null&&s!==e.dtype&&(e=e.asType(s));var a=new td(e,t,r,this.nextTensorId());if(this.state.registeredVariables[a.name]!=null)throw new Error("Variable with name "+a.name+" was already registered");return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a},n.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*IV(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s,refCount:0}),this.state.numBytes+=s}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof td||this.track(e)},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Ke(this,void 0,void 0,function(){var t,r;return Xe(this,function(s){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(a){return a.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,s,a){var o=this,i={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:a},u=Rxe(e);u!=null&&(s=u.gradFunc),s!=null&&(i.gradient=function(l){return l=l.map(function(c,d){if(c==null){var p=r[d],m=nv(p.size,p.dtype);return o.makeTensor(m,p.shape,p.dtype)}return c}),s(l.length>1?l:l[0],a)}),this.state.activeTape.push(i)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=$V(e),s=new Set(r.map(function(u){return u.id})),a=0;a<this.state.activeScope.track.length;a++){var o=this.state.activeScope.track[a];o.kept||s.has(o.id)||o.dispose()}var i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==i.id||t.track(u)})},n.prototype.gradients=function(e,t,r,s){var a=this;if(s===void 0&&(s=!1),X(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var o=this.scopedRun(function(){return a.startTape()},function(){return a.endTape()},function(){return a.tidy("forward",e)});X(o instanceof In,function(){return"The result y returned by f() must be a tensor."});var i=function(u,l,c){for(var d={},p={},m=0;m<l.length;m++)d[l[m].id]=!0;for(m=0;m<u.length;m++){var v=(E=u[m]).inputs;for(var b in v){for(var y=v[b],w=!1,S=0;S<l.length;S++)if(d[y.id]){E.outputs.forEach(function(D){return d[D.id]=!0}),w=!0,p[E.id]=!0;break}if(w)break}}var N={};N[c.id]=!0;var C={};for(m=u.length-1;m>=0;m--)for(v=(E=u[m]).inputs,S=0;S<E.outputs.length;S++)if(N[E.outputs[S].id]){for(var b in v)N[v[b].id]=!0,C[E.id]=!0;break}var T=[];for(m=0;m<u.length;m++){var E;if(p[(E=u[m]).id]&&C[E.id]){var $={};for(var b in E.inputs){var _=E.inputs[b];d[_.id]&&($[b]=_)}var R=Object.assign({},E);R.inputs=$,R.outputs=E.outputs,T.push(R)}}return T}(this.state.activeTape,t,o);if(!s&&i.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[o.id]=r??(u=o.shape,l=_V(Je(u),"float32"),ue.makeTensor(l,u,"float32")),function(p,m,v){for(var b=function(w){var S=m[w],N=[];if(S.outputs.forEach(function($){var _=p[$.id];_!=null?N.push(_):N.push(null)}),S.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+S.kernelName+".");var C=S.gradient(N),T=function($){if(!($ in C))throw new Error("Cannot backprop through input "+$+". Available gradients found: "+Object.keys(C)+".");var _=v(function(){return C[$]()});if(_.dtype!=="float32")throw new Error("Error in gradient for op "+S.kernelName+". The gradient of input "+$+" must have 'float32' dtype, but has '"+_.dtype+"'");var R=S.inputs[$];if(!_r(_.shape,R.shape))throw new Error("Error in gradient for op "+S.kernelName+". The gradient of input '"+$+"' has shape '"+_.shape+"', which does not match the shape of the input '"+R.shape+"'");if(p[R.id]==null)p[R.id]=_;else{var D=p[R.id];p[R.id]=D.add(_),D.dispose()}};for(var E in S.inputs)T(E)},y=m.length-1;y>=0;y--)b(y)}(c,i,function(p){return a.tidy(p)});var d=t.map(function(p){return c[p.id]});return a.state.gradientDepth===0&&(a.state.activeTape.forEach(function(p){for(var m=0,v=p.saved;m<v.length;m++)v[m].dispose()}),a.state.activeTape=null),{value:o,grads:d}})},n.prototype.customGrad=function(e){var t=this;return X(cN(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];X(s.every(function(i){return i instanceof In}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var o={};return s.forEach(function(i,u){o[u]=i}),t.runKernelFunc(function(i,u){return X((r=e.apply(void 0,s.concat([u]))).value instanceof In,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),X(cN(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},o,function(i,u){var l=r.gradFunc(i,u),c=Array.isArray(l)?l:[l];X(c.length===s.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),X(c.every(function(p){return p instanceof In}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return c.forEach(function(p,m){d[m]=function(){return p}}),d})}},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.time=function(e){return Ke(this,void 0,void 0,function(){var t,r;return Xe(this,function(s){switch(s.label){case 0:return t=bo(),[4,this.backend.time(e)];case 1:return(r=s.sent()).wallMs=bo()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new PO,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),ue=function(){var n=function(){if(FS==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}FS=t}return FS}();if(n._tfengine==null){var e=new Exe(n);n._tfengine=new Kxe(e)}return function(t){SV=t}(n._tfengine.ENV),xo=function(){return n._tfengine},n._tfengine}();function OV(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var ui=Ne();ui.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),ui.registerFlag("IS_BROWSER",function(){return OV()}),ui.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),ui.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),ui.registerFlag("PROD",function(){return!1}),ui.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return ui.getBool("DEBUG")}),ui.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),ui.registerFlag("IS_TEST",function(){return!1});var lm,ra,Qs,Il={},MS={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Xxe(n,e){Il[n]=e}function Uo(n){n in Il||(Il[n]=function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(s){if(typeof OffscreenCanvas<"u"&&s===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return r.addEventListener("webglcontextlost",function(s){s.preventDefault(),delete Il[t]},!1),t===1?r.getContext("webgl",MS)||r.getContext("experimental-webgl",MS):r.getContext("webgl2",MS)}(n));var e=Il[n];return e.isContextLost()?(delete Il[n],Uo(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Il[n])}function _1(n,e){return[e,n]}function Lp(n){var e=Je(n);return lN(Math.ceil(e/4))}function rv(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function EI(n,e){var t,r,s,a,o,i,u,l,c,d=n;return Ne().getNumber("WEBGL_VERSION")===2?(t=d.R32F,r=d.R16F,s=d.RGBA16F,a=d.RGBA32F,o=d.RED,i=4,u=1,l=d.HALF_FLOAT,c=d.FLOAT):(t=n.RGBA,r=n.RGBA,s=n.RGBA,a=d.RGBA,o=n.RGBA,i=4,u=4,l=e!=null?e.HALF_FLOAT_OES:null,c=n.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:a,textureFormatFloat:o,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:i,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function et(n,e,t){var r=t();return e&&function(s){var a=s.getError();if(a!==s.NO_ERROR)throw new Error("WebGL Error: "+Jxe(s,a))}(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(lm||(lm={})),function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"}(ra||(ra={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Qs||(Qs={}));var Yxe=596e-10,Zxe=65504;function Qxe(n){return!!(Ne().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||Yxe<Math.abs(n)&&Math.abs(n)<Zxe)}function Jxe(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function zy(n,e,t){return $i(n,e,function(){return n.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function e1e(n,e,t){var r=$i(n,e,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(et(n,e,function(){return n.shaderSource(r,t)}),et(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function t1e(n,e,t){var r=$i(n,e,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(et(n,e,function(){return n.shaderSource(r,t)}),et(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw function(s,a){var o=n1e.exec(a);if(o==null)return console.log("Couldn't parse line number in error: "+a),void console.log(s);for(var i=+o[1],u=s.split(`
`),l=u.length.toString().length+2,c=u.map(function(y,w){return Dh((w+1).toString(),l)+y}),d=0,p=0;p<c.length;p++)d=Math.max(c[p].length,d);var m=c.slice(0,i-1),v=c.slice(i-1,i),b=c.slice(i);console.log(m.join(`
`)),console.log(a.split(`
`)[0]),console.log("%c "+Dh(v[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(b.join(`
`))}(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var LS,PS,n1e=/ERROR: [0-9]+:([0-9]+):/g;function r1e(n,e){return $i(n,e,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function s1e(n,e,t){if(et(n,e,function(){return n.linkProgram(t)}),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function BS(n,e,t){if(et(n,e,function(){return n.validateProgram(t)}),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function a1e(n,e,t){var r=$i(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return et(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),et(n,e,function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function o1e(n,e,t){var r=$i(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return et(n,e,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),et(n,e,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function i1e(n,e){return $i(n,e,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function u1e(n,e){var t=Ne().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function l1e(n,e){return $i(n,e,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function BO(n,e,t,r,s,a,o,i){var u=n.getAttribLocation(t,r);return u!==-1&&(et(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,s)}),et(n,e,function(){return n.vertexAttribPointer(u,a,n.FLOAT,!1,o,i)}),et(n,e,function(){return n.enableVertexAttribArray(u)}),!0)}function c1e(n,e,t,r){m1e(n,r),et(n,e,function(){return n.activeTexture(n.TEXTURE0+r)}),et(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)})}function h1e(n,e,t,r){return $i(n,e,function(){return n.getUniformLocation(t,r)},'uniform "'+r+'" not present in program.')}function d1e(n,e,t){return n.getUniformLocation(e,t)}function f1e(n,e,t,r,s,a){et(n,e,function(){return c1e(n,e,r,a)}),et(n,e,function(){return n.uniform1i(s,a)})}function zS(n,e,t,r){et(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),et(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)})}function zO(n,e,t){et(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),et(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function Vy(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+p1e(n,e))}function p1e(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function $i(n,e,t,r){var s=et(n,e,function(){return t()});if(s==null)throw new Error(r);return s}function m1e(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function qb(n,e){return e===void 0&&(e=2),Je(n.slice(0,n.length-e))}function Kb(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function VS(n){var e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[qb(n)].concat(Kb(n))),e}function g1e(n,e){var t;e===void 0&&(e=!1);var r=Ne().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(n=n.map(function(l,c){return c>=n.length-2?TV(n[c]):n[c]})).length===1&&(n=[2,n[0]])),n.length!==2){var s=Ol(n);n=s.newShape}var a=Je(n);if(n.length<=1&&a<=r)return[1,a];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var o=qb(n),i=2,u=2;return n.length&&(i=(t=Kb(n))[0],u=t[1]),lN(a=o*(i/2)*(u/2)).map(function(l){return 2*l})}return lN(a)}function Uy(n){return n%2==0}function Wy(n,e){if(_r(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||Uy(t)&&Uy(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Uy(n[0])&&Uy(e[0])}function v1e(n){if(LS==null){var e=Uo(n);LS=e.getParameter(e.MAX_TEXTURE_SIZE)}return LS}function y1e(n){if(PS==null){var e=Uo(n);PS=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,PS)}function b1e(n){if(n===0)return 0;var e=Uo(n);return _a(e,"EXT_disjoint_timer_query_webgl2")&&n===2?2:_a(e,"EXT_disjoint_timer_query")?1:0}function _a(n,e){return n.getExtension(e)!=null}function VO(n){try{if(Uo(n)!=null)return!0}catch{return!1}return!1}function x1e(n){if(n===0)return!1;var e=Uo(n);if(n===1){if(!_a(e,"OES_texture_float"))return!1}else if(!_a(e,"EXT_color_buffer_float"))return!1;return gN(e)}function w1e(n){if(n===0)return!1;var e=Uo(n);if(n!==1){if(_a(e,"EXT_color_buffer_float"))return gN(e);if(_a(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return function(r,s){var a=EI(r,s),o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,a.internalFormatHalfFloat,1,1,0,a.textureFormatFloat,a.textureTypeHalfFloat,null);var i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(o),r.deleteFramebuffer(i),u}(e,t)}return!1}return!!_a(e,"OES_texture_float")&&!!_a(e,"WEBGL_color_buffer_float")&&gN(e)}function gN(n){var e=EI(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var s=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),s}function S1e(n){return n===2&&Uo(n).fenceSync!=null}var ft=Ne();function FV(n){Ne().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Ue(n,e){return ue.tidy(n,e)}function Os(n){$V(n).forEach(function(e){return e.dispose()})}function C1e(n){return ue.keep(n)}function Xb(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];Ne().getBool("IS_TEST")||console.warn.apply(console,n)}function Qu(n,e){var t=n;if(Ro(n))return e==="string"?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(t)||Ro(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&Ne().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function s(a,o,i){if(i=i||[],!Array.isArray(a)&&!Ro(a))return void X(o.length===0,function(){return"Element arr["+i.join("][")+"] is a primitive, but should be an array/TypedArray of "+o[0]+" elements"});X(o.length>0,function(){return"Element arr["+i.join("][")+"] should be a primitive, but is an array of "+a.length+" elements"}),X(a.length===o[0],function(){return"Element arr["+i.join("][")+"] should have "+o[0]+" elements, but has "+a.length+" elements"});for(var u=o.slice(1),l=0;l<a.length;++l)s(a[l],u,i.concat(l))}(n,r,[]),r}function UO(n,e,t,r){if(n!=null&&(n!=="numeric"&&n!==e||n==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function q(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof In)return UO(r,n.dtype,e,t),n;var s=tv(n);if(s!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),UO(r,s,e,t),n==null||!Ro(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var a=n==null?"null":n.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+a+"'")}var o=Qu(n,s);Ro(n)||Array.isArray(n)||(n=[n]);var i=s!=="string"?EV(n,s,Ne().getBool("DEBUG")):ed(n,[],!0);return ue.makeTensor(i,o,s)}function Yb(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(s,a){return q(s,e+"["+a+"]",t)},r)}function MV(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function N1e(n,e,t){for(var r=n.length+e.length,s=[],a=0,o=0,i=0;i<r;i++)t.indexOf(i)===-1?s.push(n[a++]):s.push(e[o++]);return s}function Yr(n,e){for(var t=[],r=n.length,s=0;s<r;s++)e.indexOf(s)===-1&&t.push(n[s]);return[t,e.map(function(a){return n[a]})]}function Bs(n,e){return N1e(n,e.map(function(t){return 1}),e)}function Zs(n,e,t){X(MV(e,t),function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function Wo(n,e){if(MV(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(function(s){return t.push(s)}),t}function _I(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function Go(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function k1e(n,e){var t=n[0].length;n.forEach(function(s,a){X(s.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+a+"] must be the same as the rank of the rest ("+t+")"})}),X(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var r=n[0];n.forEach(function(s,a){for(var o=0;o<t;o++)X(o===e||s[o]===r[o],function(){return"Error in concat"+t+"D: Shape of tensors["+a+"] ("+s+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+a+"."})})}function nd(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function se(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var s=function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];ue.startScope(t);try{var i=r.apply(void 0,a);return i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),ue.endScope(i),i}catch(u){throw ue.endScope(null),u}};return Object.defineProperty(s,"name",{value:t,configurable:!0}),s}ft.registerFlag("HAS_WEBGL",function(){return ft.getNumber("WEBGL_VERSION")>0}),ft.registerFlag("WEBGL_VERSION",function(){return VO(2)?2:VO(1)?1:0}),ft.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return ft.get("WEBGL_VERSION")===2}),ft.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),ft.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),ft.registerFlag("WEBGL_PACK",function(){return ft.getBool("HAS_WEBGL")}),ft.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return ft.getBool("WEBGL_PACK")}),ft.registerFlag("WEBGL_PACK_CLIP",function(){return ft.getBool("WEBGL_PACK")}),ft.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),ft.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return ft.getBool("WEBGL_PACK")}),ft.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return ft.getBool("WEBGL_PACK")}),ft.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return ft.getBool("WEBGL_PACK")}),ft.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return ft.getBool("WEBGL_PACK")}),ft.registerFlag("WEBGL_PACK_REDUCE",function(){return ft.getBool("WEBGL_PACK")}),ft.registerFlag("WEBGL_LAZILY_UNPACK",function(){return ft.getBool("WEBGL_PACK")}),ft.registerFlag("WEBGL_CONV_IM2COL",function(){return ft.getBool("WEBGL_PACK")}),ft.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return v1e(ft.getNumber("WEBGL_VERSION"))}),ft.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return y1e(ft.getNumber("WEBGL_VERSION"))}),ft.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=ft.getNumber("WEBGL_VERSION");return n===0?0:b1e(n)}),ft.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return ft.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),ft.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return x1e(ft.getNumber("WEBGL_VERSION"))}),ft.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!ft.getBool("WEBGL_FORCE_F16_TEXTURES")&&ft.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),ft.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return w1e(ft.getNumber("WEBGL_VERSION"))}),ft.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return S1e(ft.getNumber("WEBGL_VERSION"))}),ft.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return ft.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),DV=FV;var zr=se({complex_:function(n,e){var t=q(n,"real","complex"),r=q(e,"imag","complex");return qt(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),ue.runKernelFunc(function(s){return s.complex(t,r)},{$real:t,$imag:r})}}),Ta=se({real_:function(n){var e=q(n,"input","real");return ue.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),wo=se({imag_:function(n){var e=q(n,"input","imag");return ue.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function Ur(n,e,t){return Ju(n,e,Qu(n,t),t)}function Ju(n,e,t,r){if(r==null&&(r=tv(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ro(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){RV(e);var s=Je(e),a=Je(t);X(s===a,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+s+" values but has "+a});for(var o=0;o<t.length;++o){var i=t[o],u=o!==t.length-1||i!==Je(e.slice(o));X(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return Ro(n)||Array.isArray(n)||(n=[n]),e=e||t,n=r!=="string"?EV(n,r,Ne().getBool("DEBUG")):ed(n,[],!0),ue.makeTensor(n,e,r)}function Le(n,e){if((Ro(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Ro(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Ju(n,[],[],e)}function Zn(n,e){yf(n);var t=Qu(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Ju(n,null,t,e)}function Nu(n,e,t){if(yf(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Qu(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Ju(n,e,r,t)}function RI(n,e,t){if(yf(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Qu(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Ju(n,e,r,t)}function As(n,e,t){if(yf(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Qu(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Ju(n,e,r,t)}function T1e(n,e,t){if(yf(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Qu(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Ju(n,e,r,t)}function I1e(n,e,t){if(yf(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Qu(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Ju(n,e=e||r,r,t)}function E1e(n,e,t,r){return e===void 0&&(e=!0),ue.makeVariable(n,e,t,r)}function bf(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=bf(n,"float32"),r=pn(n,"float32");return zr(t,r)}var s=_V(Je(n),e);return ue.makeTensor(s,n,e)}function pn(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=pn(n,"float32"),r=pn(n,"float32");return zr(t,r)}var s=nv(Je(n),e);return ue.makeTensor(s,n,e)}function Do(n,e,t){return ue.runKernelFunc(function(r){return r.fill(n,e,t)},{})}function _1e(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return ue.runKernelFunc(function(r){return r.linspace(n,e,t)},{})}function Zb(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return pn([0],r);var s=nv(Math.abs(Math.ceil((e-n)/t)),r);e<n&&t===1&&(t=-1),s[0]=n;for(var a=1;a<s.length;a++)s[a]=s[a-1]+t;return Zn(s,r)}var LV=se({onesLike_:function(n){var e=q(n,"x","onesLike");if(e.dtype==="complex64"){var t=LV(Ta(e)),r=zt(wo(e));return zr(t,r)}return ue.runKernelFunc(function(s){return s.onesLike(e)},{$x:e},function(s,a){return{$x:function(){return zt(s)}}})}}),zt=se({zerosLike_:function(n){var e=q(n,"x","zerosLike");return ue.runKernelFunc(function(t){return t.zerosLike(e)},{$x:e},function(t,r){return{$x:function(){return zt(t)}}})}}),hr=se({concat_:function(n,e){e===void 0&&(e=0),X(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=Yb(n,"tensors","concat");t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+i.dtype+". ")}),e=br(e,t[0].shape)[0];var r=nd(t.map(function(i){return i.shape}),e);if(Je(r)===0)return Ur([],r);if((t=t.filter(function(i){return i.size>0})).length===1)return t[0];var s=t.map(function(i){return i.shape});k1e(s,e);var a=t,o={axis:e};return ue.runKernelFunc(function(i){return i.concat(t,e)},a,function(i){var u=s.map(function(l){return l[e]});return AI(i,u,e).map(function(l){return function(){return l}})},"Concat",o)}}),R1e=se({concat1d_:function(n){return hr(n,0)}}),A1e=se({concat2d_:function(n,e){return hr(n,e)}}),D1e=se({concat3d_:function(n,e){return hr(n,e)}}),$1e=se({concat4d_:function(n,e){return hr(n,e)}}),AI=se({split_:function(n,e,t){t===void 0&&(t=0);var r,s=q(n,"x","split");return t=br(t,s.shape)[0],typeof e=="number"?(X(s.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(s.shape[t]/e)):(X(s.shape[t]===e.reduce(function(a,o){return a+o}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),ue.runKernelFunc(function(a){return a.split(s,r,t)},{$x:s},function(a){return{$x:function(){return hr(a,t)}}})}});function Nc(n,e){return n(e={exports:{}},e.exports),e.exports}var O1e=Nc(function(n){(function(e,t,r){function s(i){var u,l=this,c=(u=4022871197,function(d){d=d.toString();for(var p=0;p<d.length;p++){var m=.02519603282416938*(u+=d.charCodeAt(p));m-=u=m>>>0,u=(m*=u)>>>0,u+=4294967296*(m-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var d=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=d-(l.c=0|d)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(i),l.s0<0&&(l.s0+=1),l.s1-=c(i),l.s1<0&&(l.s1+=1),l.s2-=c(i),l.s2<0&&(l.s2+=1),c=null}function a(i,u){return u.c=i.c,u.s0=i.s0,u.s1=i.s1,u.s2=i.s2,u}function o(i,u){var l=new s(i),c=u&&u.state,d=l.next;return d.int32=function(){return 4294967296*l.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,c&&(typeof c=="object"&&a(c,l),d.state=function(){return a(l,{})}),d}t&&t.exports?t.exports=o:this.alea=o})(0,n)}),F1e=Nc(function(n){(function(e,t,r){function s(i){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},i===(0|i)?u.x=i:l+=i;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function a(i,u){return u.x=i.x,u.y=i.y,u.z=i.z,u.w=i.w,u}function o(i,u){var l=new s(i),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var p=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&a(c,l),d.state=function(){return a(l,{})}),d}t&&t.exports?t.exports=o:this.xor128=o})(0,n)}),M1e=Nc(function(n){(function(e,t,r){function s(i){var u=this,l="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^d^d<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,i===(0|i)?u.x=i:l+=i;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function a(i,u){return u.x=i.x,u.y=i.y,u.z=i.z,u.w=i.w,u.v=i.v,u.d=i.d,u}function o(i,u){var l=new s(i),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var p=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&a(c,l),d.state=function(){return a(l,{})}),d}t&&t.exports?t.exports=o:this.xorwow=o})(0,n)}),L1e=Nc(function(n){(function(e,t,r){function s(i){var u=this;u.next=function(){var l,c,d=u.x,p=u.i;return l=d[p],c=(l^=l>>>7)^l<<24,c^=(l=d[p+1&7])^l>>>10,c^=(l=d[p+3&7])^l>>>3,c^=(l=d[p+4&7])^l<<7,l=d[p+7&7],c^=(l^=l<<13)^l<<9,d[p]=c,u.i=p+1&7,c},function(l,c){var d,p=[];if(c===(0|c))p[0]=c;else for(c=""+c,d=0;d<c.length;++d)p[7&d]=p[7&d]<<15^c.charCodeAt(d)+p[d+1&7]<<13;for(;p.length<8;)p.push(0);for(d=0;d<8&&p[d]===0;++d);for(d==8?p[7]=-1:p[d],l.x=p,l.i=0,d=256;d>0;--d)l.next()}(u,i)}function a(i,u){return u.x=i.x.slice(),u.i=i.i,u}function o(i,u){i==null&&(i=+new Date);var l=new s(i),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var p=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=l.next,d.quick=d,c&&(c.x&&a(c,l),d.state=function(){return a(l,{})}),d}t&&t.exports?t.exports=o:this.xorshift7=o})(0,n)}),P1e=Nc(function(n){(function(e,t,r){function s(i){var u=this;u.next=function(){var l,c,d=u.w,p=u.X,m=u.i;return u.w=d=d+1640531527|0,c=p[m+34&127],l=p[m=m+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=p[m]=c^l,u.i=m,c+(d^d>>>16)|0},function(l,c){var d,p,m,v,b,y=[],w=128;for(c===(0|c)?(p=c,c=null):(c+="\0",p=0,w=Math.max(w,c.length)),m=0,v=-32;v<w;++v)c&&(p^=c.charCodeAt((v+32)%c.length)),v===0&&(b=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,v>=0&&(b=b+1640531527|0,m=(d=y[127&v]^=p+b)==0?m+1:0);for(m>=128&&(y[127&(c&&c.length||0)]=-1),m=127,v=512;v>0;--v)p=y[m+34&127],d=y[m=m+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,y[m]=p^d;l.w=b,l.X=y,l.i=m}(u,i)}function a(i,u){return u.i=i.i,u.w=i.w,u.X=i.X.slice(),u}function o(i,u){i==null&&(i=+new Date);var l=new s(i),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var p=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=l.next,d.quick=d,c&&(c.X&&a(c,l),d.state=function(){return a(l,{})}),d}t&&t.exports?t.exports=o:this.xor4096=o})(0,n)}),B1e=Nc(function(n){(function(e,t,r){function s(i){var u=this,l="";u.next=function(){var d=u.b,p=u.c,m=u.d,v=u.a;return d=d<<25^d>>>7^p,p=p-m|0,m=m<<24^m>>>8^v,v=v-d|0,u.b=d=d<<20^d>>>12^p,u.c=p=p-m|0,u.d=m<<16^p>>>16^v,u.a=v-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,i===Math.floor(i)?(u.a=i/4294967296|0,u.b=0|i):l+=i;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function a(i,u){return u.a=i.a,u.b=i.b,u.c=i.c,u.d=i.d,u}function o(i,u){var l=new s(i),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var p=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&a(c,l),d.state=function(){return a(l,{})}),d}t&&t.exports?t.exports=o:this.tychei=o})(0,n)}),El=Nc(function(n){(function(e,t){var r,s=this,a=256,o=6,i="random",u=t.pow(a,o),l=t.pow(2,52),c=2*l,d=a-1;function p(w,S,N){var C=[],T=b(function _(R,D){var A,M=[],H=typeof R;if(D&&H=="object")for(A in R)try{M.push(_(R[A],D-1))}catch{}return M.length?M:H=="string"?R:R+"\0"}((S=S==1?{entropy:!0}:S||{}).entropy?[w,y(e)]:w??function(){try{var _;return r&&(_=r.randomBytes)?_=_(a):(_=new Uint8Array(a),(s.crypto||s.msCrypto).getRandomValues(_)),y(_)}catch{var R=s.navigator,D=R&&R.plugins;return[+new Date,s,D,s.screen,y(e)]}}(),3),C),E=new m(C),$=function(){for(var _=E.g(o),R=u,D=0;_<l;)_=(_+D)*a,R*=a,D=E.g(1);for(;_>=c;)_/=2,R/=2,D>>>=1;return(_+D)/R};return $.int32=function(){return 0|E.g(4)},$.quick=function(){return E.g(4)/4294967296},$.double=$,b(y(E.S),e),(S.pass||N||function(_,R,D,A){return A&&(A.S&&v(A,E),_.state=function(){return v(E,{})}),D?(t[i]=_,R):_})($,T,"global"in S?S.global:this==t,S.state)}function m(w){var S,N=w.length,C=this,T=0,E=C.i=C.j=0,$=C.S=[];for(N||(w=[N++]);T<a;)$[T]=T++;for(T=0;T<a;T++)$[T]=$[E=d&E+w[T%N]+(S=$[T])],$[E]=S;(C.g=function(_){for(var R,D=0,A=C.i,M=C.j,H=C.S;_--;)R=H[A=d&A+1],D=D*a+H[d&(H[A]=H[M=d&M+R])+(H[M]=R)];return C.i=A,C.j=M,D})(a)}function v(w,S){return S.i=w.i,S.j=w.j,S.S=w.S.slice(),S}function b(w,S){for(var N,C=w+"",T=0;T<C.length;)S[d&T]=d&(N^=19*S[d&T])+C.charCodeAt(T++);return y(S)}function y(w){return String.fromCharCode.apply(0,w)}if(t["seed"+i]=p,b(t.random(),e),n.exports){n.exports=p;try{r=require("crypto")}catch{}}})([],Math)});El.alea=O1e,El.xor128=F1e,El.xorwow=M1e,El.xorshift7=L1e,El.xor4096=P1e,El.tychei=B1e;var R1=El.alea,DI=function(){function n(e,t,r,s,a){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=s,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=a||Math.random();this.random=R1(o.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,s=!1;!s;){var a=void 0,o=void 0,i=void 0;do i=(a=2*this.random()-1)*a+(o=2*this.random()-1)*o;while(i>=1||i===0);var u=Math.sqrt(-2*Math.log(i)/i);t=this.mean+this.stdDev*a*u,r=this.mean+this.stdDev*o*u,this.truncated&&!this.isValidTruncated(t)||(s=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),z1e=function(){function n(e,t,r,s){this.alpha=e,this.beta=1/t,this.dtype=r;var a=s||Math.random();this.randu=R1(a.toString()),this.randn=new DI(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,s,a,o;;){do s=this.randn.nextValue(),o=1+this.c*s;while(o<=0);if(o*=o*o,t=1-.331*(e=s*s)*e,r=.5*e+this.d*(1-o+Math.log(o)),(a=this.randu())<t||Math.log(a)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n}(),V1e=function(){function n(e,t,r,s){var a=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return a.dtype==null||a.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,s==null&&(s=Math.random()),typeof s=="number"&&(s=s.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=R1(s)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function vt(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",RV(n),new um(n,e,t)}function U1e(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}var PV=se({batchToSpaceND_:function(n,e,t){var r=q(n,"x","batchToSpaceND"),s=e.reduce(function(a,o){return a*o});return X(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),X(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),X(r.shape[0]%s==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+s}),ue.runKernelFunc(function(a){return a.batchToSpaceND(r,e,t)},{$x:r},function(a){return{$x:function(){return a.spaceToBatchND(e,t)}}})}}),W1e=se({broadcastTo_:function(n,e){var t=q(n,"broadcastTo","x"),r=t.shape;if(e.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var s=t.shape.slice();s.length<e.length;)s.unshift(1);t=t.reshape(s)}for(var a=Array.from(e),o=e.length-1;o>=0;o--)if(t.shape[o]===e[o])a[o]=1;else if(t.shape[o]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var i=a.map(function(u,l){return u>1?l:-1}).filter(function(u){return u>=0});return i.length===0?t.clone():ue.runKernelFunc(function(u){return u.tile(t,a)},{input:t},function(u){return{input:function(){return u.sum(i,!0)}}})}}),G1e=se({cast_:function(n,e){var t=q(n,"x","cast");if(!Mxe(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:e};return ue.runKernelFunc(function(s){return s.cast(t,e)},{x:t},function(s){return{x:function(){return s.clone()}}},"Cast",r)}}),H1e=se({clone_:function(n){var e=q(n,"x","clone",null);return ue.runKernelFunc(function(){return ue.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),j1e=se({cumsum_:function(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var s=q(n,"x","cumsum"),a=Wo([e|=0],s.rank),o=s;a!=null&&(o=s.transpose(a));var i=Go(1,s.rank)[0],u=ue.runKernelFunc(function(l){return l.cumsum(o,i,t,r)},{permutedX:o},function(l){return{permutedX:function(){return l.cumsum(e,t,!r)}}});return a!=null&&(u=u.transpose(a)),u}}),q1e=se({depthToSpace_:function(n,e,t){t===void 0&&(t="NHWC");var r=q(n,"x","depthToSpace"),s=t==="NHWC"?r.shape[1]:r.shape[2],a=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];return X(s*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+s+" and "+e+`  for depthToSpace with input shape
      `+r.shape}),X(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+e+` for depthToSpace with input shape
          `+r.shape}),X(o%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+o+" for depthToSpace with input shape "+r.shape}),ue.runKernelFunc(function(i){return i.depthToSpace(r,e,t)},{$x:r})}}),ka=se({expandDims_:function(n,e){e===void 0&&(e=0);var t=q(n,"x","expandDims",null);X(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r=t.shape.slice();return e<0&&(X(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),r.splice(e,0,1),ja(t,r)}}),BV=se({eye_:function(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var s=vt([n,e],r),a=n<=e?n:e,o=0;o<a;++o)s.set(1,o,o);var i=s.toTensor().as2D(n,e);if(t==null)return i;if(t.length===1)return $h(ka(i,0),[t[0],1,1]);if(t.length===2)return $h(ka(ka(i,0),0),[t[0],t[1],1,1]);if(t.length===3)return $h(ka(ka(ka(i,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),K1e=se({multinomial_:function(n,e,t,r){r===void 0&&(r=!1);var s=q(n,"logits","multinomial"),a=s.size,o=s.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);t=t||Math.random();var i=o===1?s.as2D(1,-1):s,u=ue.runKernelFunc(function(l){return l.multinomial(i,r,e,t)},{logits2D:i});return o===1?u.as1D():u}}),vN=se({oneHot_:function(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var s=q(n,"indices","oneHot","int32"),a=s.shape.concat([e]);return s=s.flatten(),ue.runKernelFunc(function(o){return o.oneHot(s,e,t,r)},{$indices:s},function(o){return{$indices:function(){return pn(s.shape,"float32")}}}).reshape(a)}}),kc=se({pad_:function(n,e,t){t===void 0&&(t=0);var r=q(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var s={paddings:e,constantValue:t};return ue.runKernelFunc(function(a){return a.pad(r,e,t)},{x:r},function(a){var o=e.map(function(i){return i[0]});return{x:function(){return a.slice(o,r.shape)}}},"PadV2",s)}}),X1e=se({pad1d_:function(n,e,t){return t===void 0&&(t=0),X(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),kc(n,[e],t)}}),Y1e=se({pad2d_:function(n,e,t){return t===void 0&&(t=0),X(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),kc(n,e,t)}}),Z1e=se({pad3d_:function(n,e,t){return t===void 0&&(t=0),X(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),kc(n,e,t)}}),Q1e=se({pad4d_:function(n,e,t){return t===void 0&&(t=0),X(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),kc(n,e,t)}}),J1e=se({rand_:function(n,e,t){var r=Je(n),s=null;if(t==null||t==="float32")s=new Float32Array(r);else if(t==="int32")s=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);s=new Uint8Array(r)}for(var a=0;a<r;a++)s[a]=e();return ue.makeTensor(s,n,t)}}),ewe=se({randomNormal_:function(n,e,t,r,s){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var a=new DI(e,t,r,!1,s),o=vt(n,r),i=0;i<o.values.length;i++)o.values[i]=a.nextValue();return o.toTensor()}}),twe=se({randomGamma_:function(n,e,t,r,s){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var a=new z1e(e,t,r,s),o=vt(n,r),i=0;i<o.values.length;i++)o.values[i]=a.nextValue();return o.toTensor()}}),zV=se({randomUniform_:function(n,e,t,r,s){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var a=vt(n,r),o=new V1e(e,t,null,s),i=0;i<a.values.length;i++)a.values[i]=o.nextValue();return a.toTensor()}}),ja=se({reshape_:function(n,e){var t=q(n,"x","reshape",null);e=Oxe(e,t.size),X(t.size===Je(e),function(){return"new shape and old shape must have the same number of elements."});var r={shape:e};return ue.runKernelFunc(function(s){return s.reshape(t,e)},{x:t},function(s){return{x:function(){return s.reshape(t.shape)}}},"Reshape",r)}}),VV=se({spaceToBatchND_:function(n,e,t){var r=q(n,"x","spaceToBatchND");return X(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),X(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),X(r.shape.reduce(function(s,a,o){return o>0&&o<=e.length?s&&(a+t[o-1][0]+t[o-1][1])%e[o-1]==0:s},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),ue.runKernelFunc(function(s){return s.spaceToBatchND(r,e,t)},{$x:r},function(s){return{$x:function(){return s.batchToSpaceND(e,t)}}})}}),UV=se({squeeze_:function(n,e){var t=q(n,"x","squeeze");return ja(t,Ol(t.shape,e).newShape)}}),ua=se({stack_:function(n,e){e===void 0&&(e=0);var t=Yb(n,"tensors","stack");if(X(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(e);var r=t[0].rank,s=t[0].shape,a=t[0].dtype;X(e<=r,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(i){qt(s,i.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(i){X(a===i.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var o=t.map(function(i){return i.expandDims(e)});return hr(o,e)}}),$h=se({tile_:function(n,e){var t=q(n,"x","tile",null);X(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."});var r=[t],s={reps:e};return ue.runKernelFunc(function(a,o){var i=a.tile(t,e);return o([t]),i},{x:t},function(a,o){var i=o[0];return{x:function(){var u=zt(i);if(i.rank===1)for(var l=0;l<e[0];++l)u=u.add(a.slice([l*i.shape[0]],[i.shape[0]]));else if(i.rank===2)for(l=0;l<e[0];++l)for(var c=0;c<e[1];++c)u=u.add(a.slice([l*i.shape[0],c*i.shape[1]],[i.shape[0],i.shape[1]]));else if(i.rank===3)for(l=0;l<e[0];++l)for(c=0;c<e[1];++c)for(var d=0;d<e[2];++d)u=u.add(a.slice([l*i.shape[0],c*i.shape[1],d*i.shape[2]],[i.shape[0],i.shape[1],i.shape[2]]));else{if(i.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+i.rank+" tensors yet.");for(l=0;l<e[0];++l)for(c=0;c<e[1];++c)for(d=0;d<e[2];++d)for(var p=0;p<e[3];++p)u=u.add(a.slice([l*i.shape[0],c*i.shape[1],d*i.shape[2],p*i.shape[3]],[i.shape[0],i.shape[1],i.shape[2],i.shape[3]]))}return u}}},"Tile",s,r)}}),nwe=se({truncatedNormal_:function(n,e,t,r,s){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var a=new DI(e,t,r,!0,s),o=vt(n,r),i=0;i<o.values.length;i++)o.values[i]=a.nextValue();return o.toTensor()}}),dr=se({unstack_:function(n,e){e===void 0&&(e=0),e=e||0;var t=q(n,"x","unstack");X(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length);var r={axis:e};return ue.runKernelFunc(function(s){return s.unstack(t,e)},{x:t},function(s){return{x:function(){return ua(s,e)}}},"Unpack",r)}}),rwe=function(n,e){return Ke(this,void 0,void 0,function(){var t,r,s,a,o,i,u,l,c,d;return Xe(this,function(p){switch(p.label){case 0:return t=q(n,"x","setdiff1d"),r=q(e,"y","setdiff1d"),X(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."}),X(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),X(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,t.data()];case 1:return s=p.sent(),[4,r.data()];case 2:for(a=p.sent(),o=new Set(a),i=0,c=0;c<s.length;c++)o.has(s[c])||i++;for(u=new um([i],t.dtype),l=new um([i],"int32"),c=0,d=0;c<s.length;c++)o.has(s[c])||(u.values[d]=s[c],l.values[d]=c,d++);return[2,[u.toTensor(),l.toTensor()]]}})})};function Qb(n,e,t,r){r===void 0&&(r=!0);var s=[];if(r)(s=s.concat(e.slice(0))).push(n[0]/t),s=s.concat(n.slice(1));else{s=s.concat(n[0]);for(var a=e.length,o=0;o<a;++o)s=s.concat([n[o+1]/e[o],e[o]]);s=s.concat(n.slice(a+1))}return s}function Jb(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var s=e+1;s<n;++s)s<=2*e?(r.push(s),r.push(s-(e+1))):r.push(s)}else{var a=[],o=[];for(s=1;s<n;++s)s>=2*e+1||s%2==1?o.push(s):a.push(s);r.push.apply(r,a),r.push(0),r.push.apply(r,o)}return r}function e0(n,e,t,r){r===void 0&&(r=!0);var s=[];r?s.push(n[0]/t):s.push(n[0]*t);for(var a=1;a<n.length;++a)a<=e.length?r?s.push(e[a-1]*n[a]):s.push(n[a]/e[a-1]):s.push(n[a]);return s}function WV(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function GV(n,e,t){for(var r=n.slice(0,1),s=0;s<t;++s)r.push(n[s+1]-e[s][0]-e[s][1]);return r}function HV(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],s=1,a=0;a<t.length-1;++a)s*=t[a];var o=n.shape,i=t.slice();i.pop();var u=1;for(a=r;a<n.rank;++a)u*=o[a],i.push(o[a]);var l=Ao(n.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[i,s,u,l]}var jV=30;function US(n){return n<=jV?n:hN(n,Math.floor(Math.sqrt(n)))}function swe(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+s+".";if(t.rank<s)throw new Error(a+" update.rank < "+s+". ");if(n.length<r+(t.rank-s))throw new Error(a+" Output shape length < "+(r+(t.rank-s)));if(t.rank!==s+n.length-r)throw new Error(a+" update.rank != "+(s+n.length-r));for(var o=0;o<s;++o)if(t.shape[o]!==e.shape[o])throw new Error(a+" updates.shape["+o+"] ("+t.shape[o]+") != indices.shape["+o+"] ("+e.shape[o]+").");for(o=0;o<t.rank-s;++o)if(t.shape[o+s]!==n[o+r])throw new Error(a+" updates.shape["+(o+s)+"] ("+t.shape[o+s]+") != shape["+(o+s)+"] ("+n[o+s]+")")}function awe(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}swe(t,e,n)}function t0(n,e,t){for(var r=e.shape.length,s=r>1?e.shape[r-1]:1,a=t.length,o=1,i=s;i<a;++i)o*=t[i];var u=s<1?1:s;return{sliceRank:s,numUpdates:Je(e.shape)/u,sliceSize:o,strides:Ao(t.slice(0,s)).concat([1]),outputSize:Je(t)}}function owe(n,e,t){X(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."}),X(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."});for(var r=function(a){X(e[a]+t[a]<=n.shape[a],function(){return"Error in slice"+n.rank+"D: begin["+a+"] + size["+a+"] ("+(e[a]+t[a])+") would overflow input.shape["+a+"] ("+n.shape[a]+")"})},s=0;s<n.rank;++s)r(s)}function WO(n){for(var e=[],t=0;n>0;)1&n&&e.push(t),n/=2,t++;return e}function $I(n,e,t){for(var r=[],s=0;s<n.length;s++)r[s]=Math.ceil((e[s]-n[s])/t[s]);return r}function iwe(n,e,t,r,s){var a=e[s],o=t[s]||1;(n&1<<s||a==null)&&(a=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var i=r[s];return a<0&&(a+=i),a=uN(0,a,i-1)}function uwe(n,e,t,r,s){var a=e[s],o=t[s]||1;(n&1<<s||a==null)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var i=r[s];return a<0&&(a+=i),a=o>0?uN(0,a,i):uN(-1,a,i-1)}function qV(n,e,t){for(var r=t.length,s=0;s<t.length;s++)if(t[s]>1){r=s;break}for(s=r+1;s<t.length;s++)if(e[s]>0||t[s]!==n[s])return!1;return!0}function KV(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function lwe(n,e){X(cN(n),function(){return"The f passed in variableGrads(f) must be a function"}),X(e==null||Array.isArray(e)&&e.every(function(c){return c instanceof td}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t)for(var r in e=[],ue.registeredVariables)e.push(ue.registeredVariables[r]);var s=t?e.filter(function(c){return!c.trainable}):null,a=e.length;X((e=e.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."});var o=ue.gradients(n,e,null,!0),i=o.value,u=o.grads;X(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),X(i.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+i.rank+" tensor"});var l={};return e.forEach(function(c,d){u[d]!=null&&(l[c.name]=u[d])}),s!=null&&s.forEach(function(c){return l[c.name]=null}),{value:i,grads:l}}function A1(n){return ue.customGrad(n)}var Oi=se({softmax_:function(n,e){e===void 0&&(e=-1);var t=q(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return ue.runKernelFunc(function(r,s){var a=r.softmax(t,e);return s([a]),a},{logits:t},function(r,s){var a=s[0],o=r.mul(a);return{logits:function(){return o.sub(o.sum([e],!0).mul(a))}}},"Softmax",{dim:e},[],[!0])}}),cwe=se({logSoftmax_:function(n,e){e===void 0&&(e=-1);var t=q(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return A1(function(r,s){var a=r.max(e,!0),o=r.sub(a),i=o.toFloat().sub(o.exp().sum(e,!0).log());return s([i]),{value:i,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(e,!0).mul(c))}}})(t)}}),XV=function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),YV=function(){function n(){}return n.prototype.time=function(e){return be("time")},n.prototype.read=function(e){return be("read")},n.prototype.readSync=function(e){return be("readSync")},n.prototype.numDataIds=function(){return be("numDataIds")},n.prototype.disposeData=function(e){return be("disposeData")},n.prototype.write=function(e,t,r){return be("write")},n.prototype.move=function(e,t,r,s){return be("move")},n.prototype.memory=function(){return be("memory")},n.prototype.floatPrecision=function(){return be("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.batchMatMul=function(e,t,r,s){return be("batchMatMul")},n.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,be("fusedBatchMatMul")},n.prototype.slice=function(e,t,r){return be("slice")},n.prototype.stridedSlice=function(e,t,r,s){return be("stridedSlice")},n.prototype.unstack=function(e,t){return be("unstack")},n.prototype.reverse=function(e,t){return be("reverse")},n.prototype.concat=function(e,t){return be("concat")},n.prototype.neg=function(e){return be("neg")},n.prototype.add=function(e,t){return be("add")},n.prototype.addN=function(e){return be("addN")},n.prototype.subtract=function(e,t){return be("subtract")},n.prototype.multiply=function(e,t){return be("multiply")},n.prototype.realDivide=function(e,t){return be("realDivide")},n.prototype.floorDiv=function(e,t){return be("floorDiv")},n.prototype.sum=function(e,t){return be("sum")},n.prototype.prod=function(e,t){return be("prod")},n.prototype.unsortedSegmentSum=function(e,t,r){return be("unsortedSegmentSum")},n.prototype.argMin=function(e,t){return be("argMin")},n.prototype.argMax=function(e,t){return be("argMax")},n.prototype.equal=function(e,t){return be("equal")},n.prototype.notEqual=function(e,t){return be("notEqual")},n.prototype.less=function(e,t){return be("less")},n.prototype.lessEqual=function(e,t){return be("lessEqual")},n.prototype.greater=function(e,t){return be("greater")},n.prototype.greaterEqual=function(e,t){return be("greaterEqual")},n.prototype.logicalNot=function(e){return be("logicalNot")},n.prototype.logicalAnd=function(e,t){return be("logicalAnd")},n.prototype.logicalOr=function(e,t){return be("logicalOr")},n.prototype.where=function(e){return be("where")},n.prototype.select=function(e,t,r){return be("select")},n.prototype.topk=function(e,t,r){return be("topk")},n.prototype.min=function(e,t){return be("min")},n.prototype.minimum=function(e,t){return be("minimum")},n.prototype.mod=function(e,t){return be("mod")},n.prototype.max=function(e,t){return be("max")},n.prototype.maximum=function(e,t){return be("maximum")},n.prototype.all=function(e,t){return be("all")},n.prototype.any=function(e,t){return be("any")},n.prototype.squaredDifference=function(e,t){return be("squaredDifference")},n.prototype.ceil=function(e){return be("ceil")},n.prototype.floor=function(e){return be("floor")},n.prototype.round=function(e){return be("round")},n.prototype.sign=function(e){return be("sign")},n.prototype.isNaN=function(e){return be("isNaN")},n.prototype.isInf=function(e){return be("isInf")},n.prototype.isFinite=function(e){return be("isFinite")},n.prototype.pow=function(e,t){return be("pow")},n.prototype.exp=function(e){return be("exp")},n.prototype.expm1=function(e){return be("expm1")},n.prototype.softmax=function(e,t){return be("softmax")},n.prototype.log=function(e){return be("log")},n.prototype.log1p=function(e){return be("log1p")},n.prototype.sqrt=function(e){return be("sqrt")},n.prototype.rsqrt=function(e){return be("rsqrt")},n.prototype.square=function(e){return be("square")},n.prototype.reciprocal=function(e){return be("reciprocal")},n.prototype.relu=function(e){return be("relu")},n.prototype.relu6=function(e){return be("relu6")},n.prototype.prelu=function(e,t){return be("prelu")},n.prototype.elu=function(e){return be("elu")},n.prototype.eluDer=function(e,t){return be("eluDer")},n.prototype.selu=function(e){return be("selu")},n.prototype.int=function(e){return be("int")},n.prototype.clip=function(e,t,r){return be("clip")},n.prototype.abs=function(e){return be("abs")},n.prototype.complexAbs=function(e){return be("complexAbs")},n.prototype.sigmoid=function(e){return be("sigmoid")},n.prototype.softplus=function(e){return be("softplus")},n.prototype.sin=function(e){return be("sin")},n.prototype.cos=function(e){return be("cos")},n.prototype.tan=function(e){return be("tan")},n.prototype.asin=function(e){return be("asin")},n.prototype.acos=function(e){return be("acos")},n.prototype.atan=function(e){return be("atan")},n.prototype.atan2=function(e,t){return be("atan2")},n.prototype.sinh=function(e){return be("sinh")},n.prototype.cosh=function(e){return be("cosh")},n.prototype.tanh=function(e){return be("tanh")},n.prototype.asinh=function(e){return be("asinh")},n.prototype.acosh=function(e){return be("acosh")},n.prototype.atanh=function(e){return be("atanh")},n.prototype.erf=function(e){return be("erf")},n.prototype.step=function(e,t){return be("step")},n.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,be("fusedConv2d")},n.prototype.conv2d=function(e,t,r){return be("conv2d")},n.prototype.conv2dDerInput=function(e,t,r){return be("conv2dDerInput")},n.prototype.conv2dDerFilter=function(e,t,r){return be("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,be("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(e,t,r){return be("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){return be("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){return be("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(e,t,r){return be("conv3d")},n.prototype.conv3dDerInput=function(e,t,r){return be("conv3dDerInput")},n.prototype.conv3dDerFilter=function(e,t,r){return be("conv3dDerFilter")},n.prototype.maxPool=function(e,t){return be("maxPool")},n.prototype.maxPoolBackprop=function(e,t,r,s){return be("maxPoolBackprop")},n.prototype.avgPool=function(e,t){return be("avgPool")},n.prototype.avgPoolBackprop=function(e,t,r){return be("avgPoolBackprop")},n.prototype.avgPool3d=function(e,t){return be("avgPool3d")},n.prototype.avgPool3dBackprop=function(e,t,r){return be("avgPool3dBackprop")},n.prototype.maxPool3d=function(e,t){return be("maxPool3d")},n.prototype.maxPool3dBackprop=function(e,t,r,s){return be("maxPool3dBackprop")},n.prototype.reshape=function(e,t){return be("reshape")},n.prototype.cast=function(e,t){return be("cast")},n.prototype.tile=function(e,t){return be("tile")},n.prototype.pad=function(e,t,r){return be("pad")},n.prototype.transpose=function(e,t){return be("transpose")},n.prototype.gather=function(e,t,r){return be("gather")},n.prototype.gatherND=function(e,t){return be("gatherND")},n.prototype.scatterND=function(e,t,r){return be("scatterND")},n.prototype.batchToSpaceND=function(e,t,r){return be("batchToSpaceND")},n.prototype.spaceToBatchND=function(e,t,r){return be("spaceToBatchND")},n.prototype.resizeBilinear=function(e,t,r,s){return be("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(e,t,r){return be("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(e,t,r,s){return be("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){return be("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(e,t,r,s,a,o){return be("batchNormalization")},n.prototype.localResponseNormalization4D=function(e,t,r,s,a){return be("localResponseNormalization4D")},n.prototype.LRNGrad=function(e,t,r,s,a,o,i){return be("LRNGrad")},n.prototype.multinomial=function(e,t,r,s){return be("multinomial")},n.prototype.oneHot=function(e,t,r,s){return be("oneHot")},n.prototype.cumsum=function(e,t,r,s){return be("cumsum")},n.prototype.nonMaxSuppression=function(e,t,r,s,a){return be("nonMaxSuppression")},n.prototype.fft=function(e){return be("fft")},n.prototype.ifft=function(e){return be("ifft")},n.prototype.complex=function(e,t){return be("complex")},n.prototype.real=function(e){return be("real")},n.prototype.imag=function(e){return be("imag")},n.prototype.cropAndResize=function(e,t,r,s,a,o){return be("cropAndResize")},n.prototype.depthToSpace=function(e,t,r){return be("depthToSpace")},n.prototype.split=function(e,t,r){return be("split")},n.prototype.sparseToDense=function(e,t,r,s){return be("sparseToDense")},n.prototype.diag=function(e){return be("diag")},n.prototype.fill=function(e,t,r){return be("fill")},n.prototype.onesLike=function(e){return be("onesLike")},n.prototype.zerosLike=function(e){return be("zerosLike")},n.prototype.linspace=function(e,t,r){return be("linspace")},n.prototype.dispose=function(){return be("dispose")},n}();function be(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function bu(n,e){for(var t=n.length,r=[],s=0;s<t;s++){var a=t-1-s,o=n[a]||1;(e[e.length-1-s]||1)>1&&o===1&&r.unshift(a)}return r}function mr(n,e){for(var t=[],r=0;r<e.length;r++){var s=n[n.length-r-1],a=e.length-r-1,o=e[a];(s==null||s===1&&o>1)&&t.unshift(a)}return t}function Mt(n,e){for(var t=[],r=Math.max(n.length,e.length),s=0;s<r;s++){var a=n[n.length-s-1];a==null&&(a=1);var o=e[e.length-s-1];if(o==null&&(o=1),a===1)t.unshift(o);else if(o===1)t.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(a)}}return t}function cm(n,e,t,r,s,a,o){o===void 0&&(o="channelsLast");var i,u=s0(e),l=u[0],c=u[1];if(o==="channelsLast")i=[l,c,n[3],n[3]];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);i=[l,c,n[1],n[1]]}return Tc(n,i,t,r,s,a,!1,o)}function n0(n,e,t,r,s,a,o){o===void 0&&(o="NDHWC");var i,u,l=yN(e),c=l[0],d=l[1],p=l[2];if(o==="NDHWC")u="channelsLast",i=[c,d,p,n[4],n[4]];else{if(o!=="NCDHW")throw new Error("Unknown dataFormat "+o);u="channelsFirst",i=[c,d,p,n[1],n[1]]}return r0(n,i,t,r,s,!1,u,a)}function Tc(n,e,t,r,s,a,o,i){o===void 0&&(o=!1),i===void 0&&(i="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],d=u[2],p=u[3];if(i==="channelsLast")l=n[0],c=n[1],d=n[2],p=n[3];else{if(i!=="channelsFirst")throw new Error("Unknown dataFormat "+i);l=n[0],p=n[1],c=n[2],d=n[3]}var m,v=e[0],b=e[1],y=e[3],w=s0(t),S=w[0],N=w[1],C=s0(r),T=C[0],E=C[1],$=Oh(v,T),_=Oh(b,E),R=function(j,G,P,V,z,Y,L,K){var J,Z,le;if(typeof j=="number"){J={top:j,bottom:j,left:j,right:j,type:j===0?"VALID":"NUMBER"};var pe=function(Oe,Ve,Ze,lt,it){lt==null&&(lt=ZV(Oe,Ve,Ze));var ot=Oe[0],pt=Oe[1],_t=Pp((ot-Ve+2*lt)/Ze+1,it);X(Hn(_t),function(){return"The output # of rows ("+_t+") must be an integer. Change the stride and/or zero pad parameters"});var hn=Pp((pt-Ve+2*lt)/Ze+1,it);return X(Hn(hn),function(){return"The output # of columns ("+hn+") must be an integer. Change the stride and/or zero pad parameters"}),[_t,hn]}([G,P],Y,V,j,K);Z=pe[0],le=pe[1]}else if(j==="same"){Z=Math.ceil(G/V),le=Math.ceil(P/z);var ge=Math.max(0,(Z-1)*V+Y-G),Ce=Math.max(0,(le-1)*z+L-P),Ie=Math.floor(ge/2),$e=ge-Ie,Be=Math.floor(Ce/2);J={top:Ie,bottom:$e,left:Be,right:Ce-Be,type:"SAME"}}else{if(j!=="valid")throw Error("Unknown padding parameter: "+j);J={top:0,bottom:0,left:0,right:0,type:"VALID"},Z=Math.ceil((G-Y+1)/V),le=Math.ceil((P-L+1)/z)}return{padInfo:J,outHeight:Z,outWidth:le}}(s,c,d,S,N,$,_,a),D=R.padInfo,A=R.outHeight,M=R.outWidth,H=o?y*p:y;return i==="channelsFirst"?m=[l,H,A,M]:i==="channelsLast"&&(m=[l,A,M,H]),{batchSize:l,dataFormat:i,inHeight:c,inWidth:d,inChannels:p,outHeight:A,outWidth:M,outChannels:H,padInfo:D,strideHeight:S,strideWidth:N,filterHeight:v,filterWidth:b,effectiveFilterHeight:$,effectiveFilterWidth:_,dilationHeight:T,dilationWidth:E,inShape:n,outShape:m,filterShape:e}}function r0(n,e,t,r,s,a,o,i){a===void 0&&(a=!1),o===void 0&&(o="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],d=u[2],p=u[3],m=u[4];if(o==="channelsLast")l=n[0],c=n[1],d=n[2],p=n[3],m=n[4];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);l=n[0],m=n[1],c=n[2],d=n[3],p=n[4]}var v,b=e[0],y=e[1],w=e[2],S=e[4],N=yN(t),C=N[0],T=N[1],E=N[2],$=yN(r),_=$[0],R=$[1],D=$[2],A=Oh(b,_),M=Oh(y,R),H=Oh(w,D),j=function(L,K,J,Z,le,pe,ge,Ce,Ie,$e,Be){var Oe,Ve,Ze,lt;if(typeof L=="number"){Oe={top:L,bottom:L,left:L,right:L,front:L,back:L,type:L===0?"VALID":"NUMBER"};var it=function(Kn,Bn,xr,Xt,tn,kn){tn==null&&(tn=ZV(Kn,Bn,Xt));var tl=Kn[0],nl=Kn[1],xf=Kn[2],Us=Pp((tl-Bn+2*tn)/Xt+1,kn);X(Hn(Us),function(){return"The output # of depths ("+Us+") must be an integer. Change the stride and/or zero pad parameters"});var io=Pp((nl-Bn+2*tn)/Xt+1,kn);X(Hn(io),function(){return"The output # of rows ("+io+") must be an integer. Change the stride and/or zero pad parameters"});var Ws=Pp((xf-Bn+2*tn)/Xt+1,kn);return X(Hn(Ws),function(){return"The output # of columns ("+Ws+") must be an integer. Change the stride and/or zero pad parameters"}),[Us,io,Ws,xr]}([K,J,Z,1],Ce,1,le,L,Be);Ve=it[0],Ze=it[1],lt=it[2]}else if(L==="same"){Ve=Math.ceil(K/le),Ze=Math.ceil(J/pe),lt=Math.ceil(Z/ge);var ot=(Ve-1)*le+Ce-K,pt=(Ze-1)*pe+Ie-J,_t=(lt-1)*ge+$e-Z,hn=Math.floor(ot/2),en=ot-hn,Nn=Math.floor(pt/2),vn=pt-Nn,qn=Math.floor(_t/2);Oe={top:Nn,bottom:vn,left:qn,right:_t-qn,front:hn,back:en,type:"SAME"}}else{if(L!=="valid")throw Error("Unknown padding parameter: "+L);Oe={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ve=Math.ceil((K-Ce+1)/le),Ze=Math.ceil((J-Ie+1)/pe),lt=Math.ceil((Z-$e+1)/ge)}return{padInfo:Oe,outDepth:Ve,outHeight:Ze,outWidth:lt}}(s,c,d,p,C,T,E,A,M,H,i),G=j.padInfo,P=j.outDepth,V=j.outHeight,z=j.outWidth,Y=a?S*m:S;return o==="channelsFirst"?v=[l,Y,P,V,z]:o==="channelsLast"&&(v=[l,P,V,z,Y]),{batchSize:l,dataFormat:o,inDepth:c,inHeight:d,inWidth:p,inChannels:m,outDepth:P,outHeight:V,outWidth:z,outChannels:Y,padInfo:G,strideDepth:C,strideHeight:T,strideWidth:E,filterDepth:b,filterHeight:y,filterWidth:w,effectiveFilterDepth:A,effectiveFilterHeight:M,effectiveFilterWidth:H,dilationDepth:_,dilationHeight:R,dilationWidth:D,inShape:n,outShape:v,filterShape:e}}function ZV(n,e,t,r){r===void 0&&(r=1);var s=Oh(e,r);return Math.floor((n[0]*(t-1)-t+s)/2)}function s0(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function yN(n){return typeof n=="number"?[n,n,n]:n}function Oh(n,e){return e<=1?n:n+(n-1)*(e-1)}function Pp(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function rd(n){var e=s0(n),t=e[0],r=e[1],s=e[2];return t===1&&r===1&&s===1}function zs(n,e){return rd(n)||rd(e)}function OI(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function QV(n,e,t){if(e==="complex64"){if(n.dtype==="complex64")return n.clone();var r=pn(n.shape),s=n.toFloat(),a=t.complex(s,r);return r.dispose(),s.dispose(),a}if(!Lxe(n.dtype,e))return ue.makeTensorFromDataId(n.dataId,n.shape,e);if(n.dtype==="complex64"){var o=t.real(n);return a=o.cast(e),o.dispose(),a}if(e==="int32")return t.int(n);if(e==="bool"){var i=Le(0,n.dtype);return a=t.notEqual(n,i),i.dispose(),a}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function bN(n,e){return ue.makeTensorFromDataId(n.dataId,e,n.dtype)}function JV(n,e,t){var r=(e-n)/(t-1),s=nv(t,"float32");s[0]=n;for(var a=1;a<s.length;a++)s[a]=s[a-1]+r;return Zn(s,"float32")}function xN(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function GO(n,e){return{real:n[2*e],imag:n[2*e+1]}}function hwe(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function dwe(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function fwe(n,e,t){var r=function(a,o,i){return function(u,l,c){for(var d=0,p=u.length,m=0,v=!1;d<p;){var b=c(l,u[m=d+(p-d>>>1)]);b>0?d=m+1:(p=m,v=!b)}return v?d:-d-1}(a,o,i||pwe)}(n,e,t),s=r<0?-(r+1):r;n.splice(s,0,e)}function pwe(n,e){return n>e?1:n<e?-1:0}function FI(n,e,t,r,s){return eU(n,e,t,r,s,0).selectedIndices}function MI(n,e,t,r,s,a){var o=eU(n,e,t,r,s,a);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function eU(n,e,t,r,s,a,o,i){i===void 0&&(i=!1);for(var u=Array.from(e).map(function(C,T){return{score:C,boxIndex:T,suppressBeginIndex:0}}).filter(function(C){return C.score>s}).sort(HO),l=a>0?-.5/a:0,c=[],d=[];c.length<t&&u.length>0;){var p=u.pop(),m=p.score,v=p.boxIndex,b=p.suppressBeginIndex;if(m<s)break;for(var y=!1,w=c.length-1;w>=b;--w){var S=mwe(n,v,c[w]);if(S>=r){y=!0;break}if(p.score=p.score*gwe(r,l,S),p.score<=s)break}p.suppressBeginIndex=c.length,y||(p.score===m?(c.push(v),d.push(p.score)):p.score>s&&fwe(u,p,HO))}var N=c.length;return i&&(c.fill(0,N),d.fill(0,N)),{selectedIndices:Zn(c,"int32"),selectedScores:Zn(d,"float32"),numValidOutputs:Le(N,"int32")}}function mwe(n,e,t){var r=n.subarray(4*e,4*e+4),s=n.subarray(4*t,4*t+4),a=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),i=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(s[0],s[2]),c=Math.min(s[1],s[3]),d=Math.max(s[0],s[2]),p=Math.max(s[1],s[3]),m=(i-a)*(u-o),v=(d-l)*(p-c);if(m<=0||v<=0)return 0;var b=Math.max(a,l),y=Math.max(o,c),w=Math.min(i,d),S=Math.min(u,p),N=Math.max(w-b,0)*Math.max(S-y,0);return N/(m+v-N)}function gwe(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function HO(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function tU(n,e,t){var r=new Array(n.rank).fill(0),s=n.shape.slice();return e.map(function(a){s[t]=a;var o=n.slice(r,s);return r[t]+=a,o})}function nU(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var s=vt(t,n.dtype);for(r=0;r<s.values.length;++r){for(var a=s.indexToLoc(r),o=new Array(n.rank),i=0;i<o.length;i++)o[i]=a[i]%n.shape[i];var u=n.locToIndex(o);s.values[r]=n.values[u]}return s.toTensor()}function rU(n,e,t,r,s){for(var a=e[e.length-1],o=[n.length/a,a],i=o[0],u=o[1],l=im(t,i*r),c=im("int32",i*r),d=0;d<i;d++){for(var p=d*u,m=n.subarray(p,p+u),v=[],b=0;b<m.length;b++)v.push({value:m[b],index:b});v.sort(function(C,T){return T.value-C.value});var y=d*r,w=l.subarray(y,y+r),S=c.subarray(y,y+r);for(b=0;b<r;b++)w[b]=v[b].value,S[b]=v[b].index}var N=e.slice();return N[N.length-1]=r,[Ur(l,N,t),Ur(c,N,"int32")]}function LI(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var s=vt(n,"int32"),a=vt([t.length,n.length],"int32");for(r=0;r<t.length;r++){var o=s.indexToLoc(t[r]),i=r*n.length;a.values.set(o,i)}return a.toTensor()}var vwe=function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map(function(s,a){return"T"+a});var t=[];this.variableNames.forEach(function(s){t.push("float v"+s+" = get"+s+"AtOutCoords();")});var r=this.variableNames.map(function(s){return"v"+s}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},ywe=function(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map(function(s,a){return"T"+a});var t=[];this.variableNames.forEach(function(s){t.push("vec4 v"+s+" = get"+s+"AtOutCoords();")});var r=this.variableNames.map(function(s){return"v"+s}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},bwe=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,s=n.batchSize,a=n.inSize,o=Math.ceil(a/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[s,o];var i=e==="max"?">":"<",u=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+i+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function sU(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return n+"."+t})}function $s(n,e){return e===1?[n]:sU(n,e)}function rs(){var n,e,t,r,s,a,o,i,u,l;return Ne().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",s="texture",a="outputColor",o="out vec4 outputColor;",i=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",s="texture2D",a="gl_FragColor",o="",i=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:s,output:a,defineOutput:o,defineSpecialNaN:i,defineSpecialInf:u,defineRound:l}}function Ll(n,e,t){t===void 0&&(t="index");var r=Ao(e);return r.map(function(s,a){return"int "+n[a]+" = "+t+" / "+s+"; "+(a===r.length-1?"int "+n[a+1]+" = "+t+" - "+n[a]+" * "+s:"index -= "+n[a]+" * "+s)+";"}).join("")}function PI(n){var e=Ao(n).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var aU=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function xwe(n,e,t,r){var s=[];n.forEach(function(m){var v=Je(m.shapeInfo.logicalShape);m.shapeInfo.isUniform?s.push("uniform float "+m.name+(v>1?"["+v+"]":"")+";"):(s.push("uniform sampler2D "+m.name+";"),s.push("uniform int offset"+m.name+";"))});var a,o,i=s.join(`
`),u=n.map(function(m){return function(v,b,y){y===void 0&&(y=!1);var w="";w+=y?oU(v):Ch(v);var S=v.shapeInfo.logicalShape,N=b.logicalShape;return S.length<=N.length&&(w+=y?function(C,T){var E,$=C.name,_=$.charAt(0).toUpperCase()+$.slice(1),R="get"+_+"AtOutCoords",D=C.shapeInfo.logicalShape.length,A=T.logicalShape.length,M=bu(C.shapeInfo.logicalShape,T.logicalShape),H=fn(A),j=A-D,G=["x","y","z","w","u","v"];E=D===0?"":A<2&&M.length>=1?"coords = 0;":M.map(function(J){return"coords."+G[J+j]+" = 0;"}).join(`
`);var P="";P=A<2&&D>0?"coords":C.shapeInfo.logicalShape.map(function(J,Z){return"coords."+G[Z+j]}).join(", ");var V="return outputValue;",z=Je(C.shapeInfo.logicalShape)===1,Y=Je(T.logicalShape)===1;if(D!==1||z||Y){if(z&&!Y)V=A===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(M.length){var L=D-2,K=D-1;M.indexOf(L)>-1&&M.indexOf(K)>-1?V="return vec4(outputValue.x);":M.indexOf(L)>-1?V="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":M.indexOf(K)>-1&&(V="return vec4(outputValue.xx, outputValue.zz);")}}else V=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+R+`() {
      `+H+` coords = getOutputCoords();
      `+E+`
      vec4 outputValue = get`+_+"("+P+`);
      `+V+`
    }
  `}(v,b):function(C,T){var E=C.name,$=E.charAt(0).toUpperCase()+E.slice(1),_="get"+$+"AtOutCoords",R=T.texShape,D=C.shapeInfo.texShape,A=C.shapeInfo.logicalShape.length,M=T.logicalShape.length;if(!C.shapeInfo.isUniform&&A===M&&C.shapeInfo.flatOffset==null&&_r(D,R))return`
      float `+_+`() {
        return sampleTexture(`+E+`, resultUV);
      }
    `;var H,j=fn(M),G=bu(C.shapeInfo.logicalShape,T.logicalShape),P=M-A,V=["x","y","z","w","u","v"];H=A===0?"":M<2&&G.length>=1?"coords = 0;":G.map(function(Y){return"coords."+V[Y+P]+" = 0;"}).join(`
`);var z="";return z=M<2&&A>0?"coords":C.shapeInfo.logicalShape.map(function(Y,L){return"coords."+V[L+P]}).join(", "),`
    float `+_+`() {
      `+j+` coords = getOutputCoords();
      `+H+`
      return get`+$+"("+z+`);
    }
  `}(v,b)),w}(m,e,r)}).join(`
`),l=e.texShape,c=rs(),d=function(m){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+m.texture2D+`(textureSampler, uv).r;
    }
  `}(c),p=function(m){return m.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+m.varyingFs+` vec2 resultUV;
    `+m.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+m.defineSpecialNaN+`
    `+m.defineSpecialInf+`
    `+m.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+wwe+`
    `+Swe+`
    `+Cwe+`
  `}(c);return e.isPacked?(a=function(m,v){switch(m.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(C,T){var E=[Math.ceil(T[0]/2),Math.ceil(T[1]/2)];return E[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+E[1]+`.0);
      }
    `:E[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+E[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      return 2 * (resTexRC.x * `+E[1]+` + resTexRC.y);
    }
  `}(0,v);case 2:return function(C,T){var E=[Math.ceil(T[0]/2),Math.ceil(T[1]/2)];if(_r(C,T))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+E[0]+", "+E[1]+`));
      }
    `;var $=Math.ceil(C[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));

      int index = resTexRC.x * `+E[1]+` + resTexRC.y;
      int r = 2 * (index / `+$+`);
      int c = imod(index, `+$+`) * 2;

      return ivec2(r, c);
    }
  `}(m,v);case 3:return b=m,y=v,w=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)],S=Math.ceil(b[2]/2),N=S*Math.ceil(b[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;

      int b = index / `+N+`;
      index -= b * `+N+`;

      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(C,T){for(var E=[Math.ceil(T[0]/2),Math.ceil(T[1]/2)],$=Math.ceil(C[C.length-1]/2),_=$*Math.ceil(C[C.length-2]/2),R=_,D="",A="b, r, c",M=2;M<C.length-1;M++)R*=C[C.length-M-1],D=`
      int b`+M+" = index / "+R+`;
      index -= b`+M+" * "+R+`;
    `+D,A="b"+M+", "+A;return`
    ivec`+C.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      int index = resTexRC.x * `+E[1]+` + resTexRC.y;

      `+D+`

      int b = index / `+_+`;
      index -= b * `+_+`;

      int r = 2 * (index / `+$+`);
      int c = imod(index, `+$+`) * 2;

      return ivec`+C.length+"("+A+`);
    }
  `}(m,v)}var b,y,w,S,N}(e.logicalShape,l),o=function(m){return`
    void setOutput(vec4 val) {
      `+m.output+` = val;
    }
  `}(c)):(a=function(m,v){switch(m.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(w,S){return S[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+S[1]+`.0);
      }
    `:S[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+S[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+S[0]+", "+S[1]+`));
      return resTexRC.x * `+S[1]+` + resTexRC.y;
    }
  `}(0,v);case 2:return function(w,S){return _r(w,S)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+S[0]+", "+S[1]+`));
      }
    `:w[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+S[0]+", "+S[1]+`));
        int index = resTexRC.x * `+S[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:w[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+S[0]+", "+S[1]+`));
        int index = resTexRC.x * `+S[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+S[0]+", "+S[1]+`));
      int index = resTexRC.x * `+S[1]+` + resTexRC.y;
      int r = index / `+w[1]+`;
      int c = index - r * `+w[1]+`;
      return ivec2(r, c);
    }
  `}(m,v);case 3:return b=v,y=Ll(["r","c","d"],m),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;
      `+y+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(w,S){var N=Ll(["r","c","d","d2"],w);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+S[0]+", "+S[1]+`));
      int index = resTexRC.x * `+S[1]+` + resTexRC.y;
      `+N+`
      return ivec4(r, c, d, d2);
    }
  `}(m,v);case 5:return function(w,S){var N=Ll(["r","c","d","d2","d3"],w);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+S[0]+`,
                             `+S[1]+`));

      int index = resTexRC.x * `+S[1]+` + resTexRC.y;

      `+N+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(m,v);case 6:return function(w,S){var N=Ll(["r","c","d","d2","d3","d4"],w);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+S[0]+", "+S[1]+`));
      int index = resTexRC.x * `+S[1]+` + resTexRC.y;

      `+N+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(m,v);default:throw new Error(m.length+"-D output sampling is not yet supported")}var b,y}(e.logicalShape,l),o=function(m){return`
    void setOutput(float val) {
      `+m.output+` = vec4(val, 0, 0, 0);
    }
  `}(c)),r&&(p+=Nwe),[p,d,o,i,a,u,t].join(`
`)}function Ch(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+s+"() {return "+r+";}";var a=t.shapeInfo.texShape,o=a[0],i=a[1];if(o===1&&i===1)return`
      float `+s+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=t.shapeInfo.texShape,l=u[0],c=u[1],d=Nl(r);return`
    float `+s+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+d+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 1:return function(t){var r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+s+`(int index) {
        `+vh(t)+`
      }
    `;var a=t.shapeInfo.texShape,o=a[0],i=a[1];if(i===1&&o===1)return`
      float `+s+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=Nl(r);return i===1?`
      float `+s+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+o+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:o===1?`
      float `+s+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+i+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+s+`(int index) {
      vec2 uv = uvFromFlat(`+o+", "+i+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 2:return function(t){var r=t.shapeInfo.logicalShape,s=t.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t.shapeInfo.texShape;if(o!=null&&_r(r,o)){var i=o[0],u=o[1];return`
    float `+a+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+i+`.0);
      return sampleTexture(`+s+`, uv);
    }
  `}var l=Ol(r),c=l.newShape,d=l.keptDims,p=c;if(p.length<r.length){var m=Nh(t,p);return`
      `+Ch(m)+`
      float `+a+`(int row, int col) {
        return `+a+"("+kh(["row","col"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+vh(t)+`
      }
    `;var v=o[0],b=o[1],y=Nl(s);return b===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+v+`.0);
      return sampleTexture(`+s+`, uv);
    }
  `:v===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+b+`.0, 0.5);
      return sampleTexture(`+s+`, uv);
    }
  `:`
  float `+a+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+y+`;
    vec2 uv = uvFromFlat(`+v+", "+b+`, index);
    return sampleTexture(`+s+`, uv);
  }
`}(n);case 3:return function(t){var r=t.shapeInfo.logicalShape,s=t.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),o=r[1]*r[2],i=r[2],u=Ol(r),l=u.newShape,c=u.keptDims,d=l;if(d.length<r.length){var p=Nh(t,d);return`
        `+Ch(p)+`
        float `+a+`(int row, int col, int depth) {
          return `+a+"("+kh(["row","col","depth"],c)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+o+", "+i+`, 1)));
        `+vh(t)+`
      }
    `;var m=t.shapeInfo.texShape,v=m[0],b=m[1],y=t.shapeInfo.flatOffset;if(b===o&&y==null)return`
        float `+a+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+i+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+b+".0, "+v+`.0);
          return sampleTexture(`+s+`, uv);
        }
      `;if(b===i&&y==null)return`
    float `+a+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+b+".0, "+v+`.0);
      return sampleTexture(`+s+`, uv);
    }
  `;var w=Nl(s);return`
      float `+a+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+o+" + col * "+i+" + depth + "+w+`;
        vec2 uv = uvFromFlat(`+v+", "+b+`, index);
        return sampleTexture(`+s+`, uv);
      }
  `}(n);case 4:return function(t){var r=t.shapeInfo.logicalShape,s=t.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),o=r[3],i=r[2]*o,u=r[1]*i,l=Ol(r),c=l.newShape,d=l.keptDims;if(c.length<r.length){var p=Nh(t,c);return`
      `+Ch(p)+`
      float `+a+`(int row, int col, int depth, int depth2) {
        return `+a+"("+kh(["row","col","depth","depth2"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+i+", "+o+`, 1)));
        `+vh(t)+`
      }
    `;var m=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,b=v[0],y=v[1];if(y===u&&m==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+i+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+b+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;if(y===o&&m==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+b+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;var w=Nl(s);return`
    float `+a+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+i+` +
          depth * `+o+` + depth2;
      vec2 uv = uvFromFlat(`+b+", "+y+", index + "+w+`);
      return sampleTexture(`+s+`, uv);
    }
  `}(n);case 5:return function(t){var r=t.shapeInfo.logicalShape,s=t.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),o=r[4],i=r[3]*o,u=r[2]*i,l=r[1]*u,c=Ol(r),d=c.newShape,p=c.keptDims;if(d.length<r.length){var m=Nh(t,d);return`
      `+Ch(m)+`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        return `+a+"("+kh(["row","col","depth","depth2","depth3"],p)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+i+", "+o+`)) +
          depth3;
        `+vh(t)+`
      }
    `;var v=t.shapeInfo.flatOffset,b=t.shapeInfo.texShape,y=b[0],w=b[1];if(w===l&&v==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+i+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+w+".0, "+y+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;if(w===o&&v==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+w+".0, "+y+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;var S=Nl(s);return`
    float `+a+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+i+` +
          depth2 * `+o+" + depth3 + "+S+`;
      vec2 uv = uvFromFlat(`+y+", "+w+`, index);
      return sampleTexture(`+s+`, uv);
    }
  `}(n);case 6:return function(t){var r=t.shapeInfo.logicalShape,s=t.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),o=Ol(r),i=o.newShape,u=o.keptDims;if(i.length<r.length){var l=Nh(t,i);return`
      `+Ch(l)+`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+a+"("+kh(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],d=r[4]*c,p=r[3]*d,m=r[2]*p,v=r[1]*m;if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+v+", "+m+", "+p+", "+d+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+vh(t)+`
      }
    `;var b=t.shapeInfo.flatOffset,y=t.shapeInfo.texShape,w=y[0],S=y[1];if(S===v&&b==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+m+", "+p+", "+d+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+S+".0, "+w+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;if(S===c&&b==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+S+".0, "+w+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;var N=Nl(s);return`
    float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+v+" + col * "+m+" + depth * "+p+` +
          depth2 * `+d+" + depth3 * "+c+" + depth4 + "+N+`;
      vec2 uv = uvFromFlat(`+w+", "+S+`, index);
      return sampleTexture(`+s+`, uv);
    }
  `}(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function oU(n){var e,t,r;switch(n.shapeInfo.logicalShape.length){case 0:return e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=rs(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return function(s){var a=s.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),i=s.shapeInfo.texShape,u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=rs();return`
    vec4 `+o+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+a+`, uv);
    }
  `}(n);case 2:return function(s){var a=s.shapeInfo.logicalShape,o=s.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),u=s.shapeInfo.texShape,l=u[0],c=u[1],d=rs();if(u!=null&&_r(a,u))return`
      vec4 `+i+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+d.texture2D+"("+o+`, uv);
      }
    `;var p=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],m=Math.ceil(a[1]/2);return`
    vec4 `+i+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+m+", "+p[0]+", "+p[1]+`, row, col);
      return `+d.texture2D+"("+o+`, uv);
    }
  `}(n);case 3:return function(s){var a=s.shapeInfo.logicalShape,o=s.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),u=s.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(a[0]===1){var c=a.slice(1),d=Nh(s,c);return`
        `+oU(d)+`
        vec4 `+i+`(int b, int row, int col) {
          return `+i+"("+kh(["b","row","col"],[1,2])+`);
        }
      `}var p=l[0],m=l[1],v=Math.ceil(a[2]/2),b=v*Math.ceil(a[1]/2),y=rs();return`
    vec4 `+i+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+p+", "+m+", "+b+", "+v+`, b, row, col);
      return `+y.texture2D+"("+o+`, uv);
    }
  `}(n);default:return function(s){for(var a=s.shapeInfo.logicalShape,o=a.length,i=s.name,u="get"+i.charAt(0).toUpperCase()+i.slice(1),l=s.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],d=c[0],p=c[1],m=Math.ceil(a[o-1]/2),v=m*Math.ceil(a[o-2]/2),b="int b, int row, int col",y="b * "+v+" + (row / 2) * "+m+" + (col / 2)",w=2;w<o-1;w++)b="int b"+w+", "+b,v*=a[o-w-1],y="b"+w+" * "+v+" + "+y;var S=rs();return`
    vec4 `+u+"("+b+`) {
      int index = `+y+`;
      int texR = index / `+p+`;
      int texC = index - texR * `+p+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+p+", "+d+`);
      return `+S.texture2D+"("+i+`, uv);
    }
  `}(n)}}var wwe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Swe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Cwe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Nwe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Nl(n){return"offset"+n}function vh(n){var e=n.name,t=Je(n.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function fn(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function Nh(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function kh(n,e){return e.map(function(t){return n[t]}).join(", ")}var kwe=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,X(n.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var s=n[n.length-1],a=Math.ceil(s/e);this.outputShape=n.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var o,i,u=this.outputShape,l=u.length,c=fn(l),d=$s("coords",l);if(a===1){var p=fn(i=l+1);o=`
        `+p+" sourceLocR = "+p+"("+d.join()+`, 0);
        ++`+d[l-1]+`;
        `+p+" sourceLocG = "+p+"("+d.join()+`, 0);
        ++`+d[l-2]+`;
        `+p+" sourceLocA = "+p+"("+d.join()+`, 0);
        --`+d[l-1]+`;
        `+p+" sourceLocB = "+p+"("+d.join()+`, 0);
        --`+d[l-2]+";"}else i=l,o=`
        `+c+` sourceLocR = coords;
        ++`+d[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+d[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+d[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+d[l-2]+";";var m=["x","y","z","w","u","v"].slice(0,i),v="."+m[i-1],b=m.map(function(_){return"int "+_}),y=$s("sourceLocR",i-1).concat("inIdx.r"),w=$s("sourceLocG",i-1).concat("inIdx.g"),S=$s("sourceLocB",i-1).concat("inIdx.b"),N=$s("sourceLocA",i-1).concat("inIdx.a"),C=t==="max"?"greaterThan":"lessThan",T=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+w.join()+`),
                             getBestIndicesAChannel(`+S.join()+`),
                             getBestIndicesAChannel(`+N.join()+")));",E=`vec4(
            getAChannel(`+y.join()+`),
            hasNextCol ? getAChannel(`+w.join()+`) : 0.,
            hasNextRow ? getAChannel(`+S.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+N.join()+") : 0.)",$=r?"":`
      float getBestIndicesAChannel(`+b.join()+`) {
        return getChannel(getBestIndicesA(`+m.join()+`),
                                          vec2(`+m.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+b.join()+`) {
        return getChannel(getA(`+m.join()+`),
                               vec2(`+m.slice(-2).join()+`));
      }
      `+$+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+d[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+d[l-2]+" < "+(u[l-2]-1)+`;
        `+o+`
        ivec4 srcIdx = ivec4(sourceLocR`+v+", sourceLocG"+v+`,
          sourceLocB`+v+", sourceLocA"+v+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+E+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+T+`
          vec4 candidate = `+E+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+C+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},Twe=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,s=n.strideWidth,a=n.dilationHeight,o=n.dilationWidth,i=n.effectiveFilterHeight,u=n.effectiveFilterWidth,l=i-1-n.padInfo.top,c=u-1-n.padInfo.left,d=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+d+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
            wR += `+a+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+o+`) {
            float dyC = float(dyCCorner + wC) / `+s+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},Iwe=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,s=n.strideDepth,a=n.strideHeight,o=n.strideWidth,i=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,d=n.effectiveFilterHeight,p=n.effectiveFilterWidth,m=c-1-n.padInfo.front,v=d-1-n.padInfo.top,b=p-1-n.padInfo.left,y=1/(e*t*r);this.userCode=`
      const ivec3 pads = ivec3(`+m+", "+v+", "+b+`);
      const float avgMultiplier = float(`+y+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+s+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+d+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+p+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Ewe=function(n,e,t,r,s,a){this.outputShape=[],this.variableNames=["x","mean","variance"],Mt(n,e),Mt(n,t);var o="0.0";r!=null&&(Mt(n,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var i="1.0";s!=null&&(Mt(n,s),this.variableNames.push("scale"),i="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+o+`;
        float scale = `+i+`;
        float inv = scale * inversesqrt(variance + float(`+a+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},_we=function(n,e,t,r,s,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Mt(n,e),Mt(n,t);var o="vec4(0.0)";r!=null&&(Mt(n,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var i="vec4(1.0)";s!=null&&(Mt(n,s),this.variableNames.push("scale"),i="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+o+`;
        vec4 scale = `+i+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+a+`));

        setOutput((x - mean) * inv + offset);
      }
    `},Rwe="return areal * breal - aimag * bimag;",Awe="return areal * bimag + aimag * breal;",jO=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Mt(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},WS="return a + b;",GS="return a - b;",qO="return a * b;",iU="return (a < 0.) ? b * a : a;",$n=function(n,e,t){this.variableNames=["A","B"],this.outputShape=Mt(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},uU=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,li=function(n,e,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Mt(e,t);var s=this.outputShape.length,a="";if(r)if(s===0||Je(this.outputShape)===1)a=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(a=`
          `+fn(s)+` coords = getOutputCoords();
        `,s===1)a+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var o=$s("coords",s);a+=`
            bool nextRowOutOfBounds =
              (`+o[s-2]+" + 1) >= "+this.outputShape[s-2]+`;
            bool nextColOutOfBounds =
              (`+o[s-1]+" + 1) >= "+this.outputShape[s-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+a+`

        setOutput(result);
      }
    `},Dwe=function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(s,a){r.minLoc==null&&(r.minLoc=s.getUniformLocationNoThrow(a,"minVal"),r.maxLoc=s.getUniformLocationNoThrow(a,"maxVal")),s.gl.uniform1f(r.minLoc,e),s.gl.uniform1f(r.maxLoc,t)}},n}(),$we=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(s,a){r.minLoc==null&&(r.minLoc=s.getUniformLocationNoThrow(a,"minVal"),r.maxLoc=s.getUniformLocationNoThrow(a,"maxVal")),s.gl.uniform1f(r.minLoc,e),s.gl.uniform1f(r.maxLoc,t)}},n}(),Owe=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},Fwe=function(n){this.outputShape=[],this.outputShape=nd(n,1),this.variableNames=n.map(function(i,u){return"T"+u});var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var s=e[t-1];r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+s+"));")}var a=e.length,o=e[e.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+o+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},Mwe=function(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=nd(n,e);var t=this.outputShape,r=t.length,s=fn(r),a=$s("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(y,w){return"T"+w});var i=new Array(n.length-1);i[0]=n[0][e];for(var u=1;u<i.length;u++)i[u]=i[u-1]+n[u][e];var l=o[e],c=o.slice(-2),d=o.join(),p="if ("+l+" < "+i[0]+`) {
        return getChannel(
            getT0(`+d+"), vec2("+c.join()+`));
        }`;for(u=1;u<i.length;u++){var m=i[u-1];p+=`
        if (`+l+" < "+i[u]+"  && "+l+" >= "+i[u-1]+`) {
          return getChannel(
            getT`+u+"("+Gy(o,l,m)+`),
            vec2(`+Gy(c,l,m)+`));
        }`}var v=i.length,b=i[i.length-1];p+=`
        return getChannel(
          getT`+v+"("+Gy(o,l,b)+`),
          vec2(`+Gy(c,l,b)+"));",this.userCode=`
      float getValue(`+o.map(function(y){return"int "+y})+`) {
        `+p+`
      }

      void main() {
        `+s+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+a+`), 0., 0., 0.);

        `+a[r-1]+" = "+a[r-1]+` + 1;
        if (`+a[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+a+`);
        }

        `+a[r-2]+" = "+a[r-2]+` + 1;
        if (`+a[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+a+`);
        }

        `+a[r-1]+" = "+a[r-1]+` - 1;
        if (`+a[r-2]+" < "+t[r-2]+` &&
            `+a[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+a+`);
        }
        setOutput(result);
      }
    `};function Gy(n,e,t){var r=n.indexOf(e);return n.map(function(s,a){return a===r?s+" - "+t:s}).join()}var Lwe=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,s=n.padInfo.left,a=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+s+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              if (`+a+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},Pwe=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,s=n.strideWidth,a=n.dataFormat==="channelsLast",o=e-1-n.padInfo.top,i=t-1-n.padInfo.left,u=a?1:2,l=a?2:3,c=a?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+s+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {

              if (`+a+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},Bwe=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,s=n.padInfo.front,a=n.padInfo.top,o=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+s+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+a+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+o+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},zwe=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,s=n.strideDepth,a=n.strideHeight,o=n.strideWidth,i=e-1-n.padInfo.front,u=t-1-n.padInfo.top,l=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+i+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+s+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Vwe=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,s=n.padInfo.left,a=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+a+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+s+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},Uwe=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,s=n.strideWidth,a=e-1-n.padInfo.top,o=t-1-n.padInfo.left,i=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+s+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+i+`; dm++) {
              int d2 = d1 * `+i+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},KO=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var s=n.padInfo.top,a=n.padInfo.left,o=n.strideHeight,i=n.strideWidth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterHeight,d=n.filterWidth,p=4*Math.floor(n.inChannels/4),m=n.inChannels%4,v=n.dataFormat==="channelsLast",b=v?1:2,y=v?2:3,w=v?3:1,S="",N="";t&&(S=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,N="result = activation(result);");var C=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+S+`

      const ivec2 strides = ivec2(`+o+", "+i+`);
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+w+`];

        ivec2 xRCCorner =
            ivec2(coords[`+b+"], coords["+y+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+p+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+v+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(m===1)+`) {

              if (`+v+`) {
                dotProd +=
                    getX(batch, xR, xC, `+p+`) *
                    getW(wR, wC, `+p+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+p+`, xR, xC) *
                    getW(wR, wC, `+p+`, d2);
              }

            } else if (`+(m===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+p+`, d2),
                getW(wR, wC, `+p+` + 1, d2)
              );

              if (`+v+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+p+`),
                  getX(batch, xR, xC, `+p+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+p+`, xR, xC),
                  getX(batch, `+p+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(m===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+p+`, d2),
                getW(wR, wC, `+p+` + 1, d2),
                getW(wR, wC, `+p+` + 2, d2)
              );

              if (`+v+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+p+`),
                  getX(batch, xR, xC, `+p+` + 1),
                  getX(batch, xR, xC, `+p+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+p+`, xR, xC),
                  getX(batch, `+p+` + 1, xR, xC),
                  getX(batch, `+p+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+C+`
        `+N+`
        setOutput(result);
      }
    `},Wwe=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,s=n.strideDepth,a=n.strideHeight,o=n.strideWidth,i=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterDepth,d=n.filterHeight,p=n.filterWidth,m=4*Math.floor(n.inChannels/4),v=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+s+", "+a+", "+o+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+i+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+p+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+m+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(v===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+m+`) *
                  getW(wF, wR, wC, `+m+`, d2);
              } else if (`+(v===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+m+`),
                  getX(batch, xF, xR, xC, `+m+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+m+`, d2),
                  getW(wF, wR, wC, `+m+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(v===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+m+`),
                  getX(batch, xF, xR, xC, `+m+` + 1),
                  getX(batch, xF, xR, xC, `+m+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+m+`, d2),
                  getW(wF, wR, wC, `+m+` + 1, d2),
                  getW(wF, wR, wC, `+m+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},XO=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var s=n.inHeight,a=n.inWidth,o=n.padInfo.top,i=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,d=n.dilationWidth,p=n.filterHeight,m=n.filterWidth,v=n.outChannels/n.inChannels,b="",y="";t&&(b=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,y="result = activation(result);");var w=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+o+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+v+`;
        int q = d2 - d1 * `+v+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+p+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+s+`) {
            continue;
          }

          for (int wC = 0; wC < `+m+`; wC++) {
            int xC = xCCorner + wC * `+d+`;

            if (xC < 0 || xC >= `+a+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+w+`
        `+y+`
        setOutput(result);
      }
    `},YO=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var s=n.inHeight,a=n.inWidth,o=n.padInfo.top,i=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,d=n.dilationWidth,p=n.filterHeight,m=n.filterWidth,v=m,b="int xR; int xC; int xCOffset;",y=0;y<p;y++)for(var w=0;w<m;w++)b+=`
          vec4 xTexelR`+y+"C"+2*w+` = vec4(0.);
          vec4 wR`+y+"C"+w+` = vec4(0.);
          vec4 xR`+y+"C"+w+" = vec4(0.);";for(y=0;y<p;y++)for(var S=0;S<v;S++){if(b+=`
          xR = xRCorner + `+y*c+`;
          xC = xCCorner + `+(w=2*S)*d+`;
        `,l===1){if(w<m&&(b+=i%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+s+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  xTexelR`+y+"C"+w+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    xTexelR`+y+"C"+w+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+y+"C"+w+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+s+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+y+"C"+w+" = vec4(previous.zw, xTexelR"+y+"C"+w+`.xy);
                } else {
                  xR`+y+"C"+w+" = vec4(0, 0, xTexelR"+y+"C"+w+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+s+" && xC >= 0 && xC < "+a+`) {
                  xTexelR`+y+"C"+w+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+w+` = vec4(0.);
                }

                xR`+y+"C"+w+" = xTexelR"+y+"C"+w+`;
              `,w+1<m)){var N=i%2==0?TV(d):d;d%2==0&&i%2==1||d%2!=0&&i%2!=1?(b+=`
                  xCOffset = xC + `+i%2+" + "+N+`;

                  if(xR >= 0 && xR < `+s+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+y+"C"+(w+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,d>1&&(b+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+s+` &&
                      xCOffset >= 0 && xCOffset < `+a+`) {
                      xTexelR`+y+"C"+w+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+y+"C"+w+` = vec4(0.);
                    }
                  `),b+=`
                  xR`+y+"C"+(w+1)+` = vec4(
                    xTexelR`+y+"C"+w+".zw, xTexelR"+y+"C"+(w+2)+`.xy);
                `):b+=`
                  xCOffset = xC + `+N+`;

                  if(xR >= 0 && xR < `+s+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+y+"C"+(w+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+y+"C"+(w+1)+" = xTexelR"+y+"C"+(w+2)+`;
                `}}else w<m&&(b+=`
              if(xR >= 0 && xR < `+s+`) {
            `,i%2==1?(b+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+y+"C"+w+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+w+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+a+`) {
                  xTexelR`+y+"C"+(w+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+y+"C"+(w+2)+` = vec4(0.);
                }

                xR`+y+"C"+w+` = vec4(
                  xTexelR`+y+"C"+w+".zw, xTexelR"+y+"C"+(w+2)+`.zw);
              `,w+1<m&&(b+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+a+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+y+"C"+(w+1)+" = vec4(xTexelR"+y+"C"+(w+2)+`.xy, final.xy);
                `)):(b+=`
                if(xC >= 0 && xC < `+a+`) {
                  xTexelR`+y+"C"+w+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+w+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+y+"C"+(w+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+(w+2)+` = vec4(0.);
                }

                xR`+y+"C"+w+` = vec4(
                  xTexelR`+y+"C"+w+".xy, xTexelR"+y+"C"+(w+2)+`.xy);
              `,w+1<m&&(b+=`
                  xR`+y+"C"+(w+1)+` = vec4(
                    xTexelR`+y+"C"+w+".zw, xTexelR"+y+"C"+(w+2)+`.zw);
                `)),b+="}");w<m&&(b+=`
            vec4 wTexelR`+y+"C"+w+" = getW("+y+", "+w+`, d1, q);
            wR`+y+"C"+w+" = vec4(wTexelR"+y+"C"+w+".xz, wTexelR"+y+"C"+w+`.xz);
          `,w+1<m&&(b+=`
              vec4 wTexelR`+y+"C"+(w+1)+" = getW("+y+", "+(w+1)+`, d1, q);
              wR`+y+"C"+(w+1)+` =
                vec4(wTexelR`+y+"C"+(w+1)+".xz, wTexelR"+y+"C"+(w+1)+".xz);"))}for(y=0;y<p;y++)for(w=0;w<m;w++)b+="dotProd += xR"+y+"C"+w+" * wR"+y+"C"+w+";";var C="",T="";t&&(C=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,T="result = activation(result);");var E=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+C+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+o+", "+i+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+b+`

        vec4 result = dotProd;
        `+E+`
        `+T+`
        setOutput(result);
      }
    `},Gwe=function(n,e,t,r,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=n[0],o=n[1],i=n[2],u=n[3],l=e[0],c=t[0],d=t[1];this.outputShape=[l,c,d,u];var p=r==="bilinear"?1:0,m=[o-1+".0",i-1+".0"],v=m[0],b=m[1],y=c>1?[""+(o-1)/(c-1),"(y2-y1) * height_ratio","y1*"+v+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+v],w=y[0],S=y[1],N=y[2],C=d>1?[""+(i-1)/(d-1),"(x2-x1) * width_ratio","x1*"+b+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+b],T=C[0],E=C[1],$=C[2];this.userCode=`
      const float height_ratio = float(`+w+`);
      const float width_ratio = float(`+T+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+a+`) {
          return;
        }

        float height_scale = `+S+`;
        float width_scale = `+E+`;

        float in_y = `+N+`;
        if( in_y < 0.0 || in_y > `+v+` ) {
          setOutput(float(`+s+`));
          return;
        }
        float in_x = `+$+`;
        if( in_x < 0.0 || in_x > `+b+` ) {
          setOutput(float(`+s+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+p+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},Hwe=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,s=n[n.length-1],a=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+s+" -i - 1;":"return i;")+`
      }

      void main() {
        `+fn(r)+` coords = getOutputCoords();
        int end = `+ZO(r,"coords")+`;
        float val = 0.0;
        for (int i = `+s+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+a+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+ZO(r,"coords")+` = idx;
          val += getX(`+function(o,i){if(o===1)return""+i;if(o===2)return i+".x, "+i+".y";if(o===3)return i+".x, "+i+".y, "+i+".z";if(o===4)return i+".x, "+i+".y, "+i+".z, "+i+".w";throw Error("Cumulative sum for rank "+o+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function ZO(n,e){if(n===1)return""+e;if(n===2)return e+".y";if(n===3)return e+".z";if(n===4)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var jwe=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=lm.DENSE;var e=Lp(n),t=rs();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Ll(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},qwe=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=lm.DENSE;var e=Lp(n),t=rs();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Ll(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},Kwe=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),Xwe=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},Ywe=function(n){this.variableNames=["A"],this.outTexUsage=ra.DOWNLOAD;var e=rs();this.outputShape=n,this.userCode=`
      `+aU+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},Zwe=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ra.DOWNLOAD;var e=rs();this.outputShape=n,this.userCode=`
      `+aU+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},Qwe=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=rs(),s=e[0],a=e[1];this.outputShape=n;var o="result";t&&(o="floor(result * 255. + 0.5)"),this.userCode=`
      `+PI(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+a+`;
        int c = imod(flatIndex, `+a+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+s+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+o+`, 0., 0., 0.);
      }
    `},Jwe=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=rs(),s=e[0],a=e[1];this.outputShape=n;var o="",i="result";t&&(i="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;o+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+n[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+n[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+a+`;
              c = imod(flatIndex, `+a+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+s+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+PI(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+o+`

        `+r.output+" = "+i+`;
      }
    `},e2e="return real * expR - imag * expI;",t2e="return real * expI + imag * expR;",QO=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var s=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+s+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+a+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},n2e=function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,s){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(s,"value")),r.gl.uniform1f(t.valueLoc,e)}},n}(),r2e=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var s=fn(this.rank),a=function(o,i){var u=o.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],d=0;d<o.length;d++)d===i?c.push("int(getIndices("+l[d]+"))"):c.push(""+l[d]);return c.join()}(n,t);this.userCode=`
      void main() {
        `+s+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},s2e=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=fn(e.length),s=fn(t.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+s+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+a+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function a2e(n,e){var t=rs();return e1e(n,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function o2e(n,e){return a1e(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function i2e(n,e){return o1e(n,e,new Uint16Array([0,1,2,2,1,3]))}function sv(n,e,t,r,s,a,o){u1e(t,r);var i=i1e(n,e),u=n.TEXTURE_2D;return et(n,e,function(){return n.bindTexture(u,i)}),et(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),et(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),et(n,e,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),et(n,e,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),et(n,e,function(){return n.texImage2D(u,0,s,t,r,0,a,o,null)}),et(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)}),i}function u2e(n,e,t,r,s){var a=_1(t,r);return sv(n,e,a[0],a[1],s.internalFormatFloat,s.textureFormatFloat,n.FLOAT)}function l2e(n,e,t,r,s){var a=_1(t,r);return sv(n,e,a[0],a[1],s.internalFormatHalfFloat,s.textureFormatFloat,s.textureTypeHalfFloat)}function c2e(n,e,t,r,s){var a=_1(t,r);return sv(n,e,a[0],a[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function h2e(n,e,t,r,s){var a=rv(t,r);return sv(n,e,a[0],a[1],s.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function d2e(n,e,t,r,s){var a=rv(t,r);return sv(n,e,a[0],a[1],s.internalFormatPackedHalfFloat,n.RGBA,s.textureTypeHalfFloat)}function f2e(n,e,t,r){return et(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),BO(n,e,t,"clipSpacePos",r,3,20,0)&&BO(n,e,t,"uv",r,2,20,12)}function p2e(n,e,t,r,s,a,o){var i,u,l;et(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),a instanceof Uint8Array?(i=new Uint8Array(r*s*4),u=n.UNSIGNED_BYTE,l=n.RGBA):(i=new Float32Array(r*s*4),u=n.FLOAT,l=o.internalFormatPackedFloat),i.set(a),et(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,l,r,s,0,n.RGBA,u,i)}),et(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function m2e(n,e,t,r){et(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),r.data instanceof Uint8Array?et(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):et(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),et(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function g2e(n,e,t,r,s){var a=n.createBuffer();et(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,a)});var o=16*t*r;return et(n,e,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,o,n.STREAM_READ)}),et(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)}),et(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),a}function v2e(n,e,t){var r=n,s=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,s),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),s}function y2e(n,e,t,r,s){var a=_1(t,r),o=a[0],i=a[1],u=new Uint8Array(t*r*4);return et(n,e,function(){return n.readPixels(0,0,o,i,s.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function b2e(n,e,t,r,s,a,o,i){var u=n,l=new Float32Array(function(c,d){var p=rv(c,d);return p[0]*p[1]*4}(a,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function x2e(n,e,t,r){var s=new Float32Array(t*r*4);return et(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,s)}),s}var w2e=function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=Ne().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,Xxe(t,e)):this.gl=Uo(t);var r="WEBGL_color_buffer_float";if(Ne().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=zy(this.gl,this.debug,"OES_texture_float"),_a(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=zy(this.gl,this.debug,"OES_texture_half_float");else if(Ne().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),_a(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=zy(this.gl,this.debug,"EXT_color_buffer_half_float");else if(Ne().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",_a(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!_a(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=o2e(this.gl,this.debug),this.indexBuffer=i2e(this.gl,this.debug),this.framebuffer=l1e(this.gl,this.debug),this.textureConfig=EI(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return Ne().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;et(t,this.debug,function(){return t.finish()}),et(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),et(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),et(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),et(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),et(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),u2e(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),l2e(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),c2e(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),m2e(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,s){this.throwIfDisposed(),p2e(this.gl,this.debug,e,t,r,s,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),d2e(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),h2e(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(zO(this.gl,this.debug,this.framebuffer),this.outputTexture=null),et(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var s=this;return this.downloadMatrixDriver(e,function(){return y2e(s.gl,s.debug,t,r,s.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,s,a,o){return b2e(this.gl,e,0,0,0,a,o,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return v2e(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var s=g2e(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),s},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,s=this;if(Ne().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,o=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var i=a.clientWaitSync(o,0,0);return i===a.ALREADY_SIGNALED||i===a.CONDITION_SATISFIED},t=o}else Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return s.isQueryAvailable(t,Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var s=this;return this.downloadMatrixDriver(e,function(){return x2e(s.gl,s.debug,t,r)})},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=t1e(t,this.debug,e),s=a2e(t,this.debug),a=r1e(t,this.debug);return et(t,this.debug,function(){return t.attachShader(a,s)}),et(t,this.debug,function(){return t.attachShader(a,r)}),s1e(t,this.debug,a),this.debug&&BS(t,this.debug,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=f2e(t,this.debug,this.program,this.vertexBuffer)),a},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&et(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&BS(this.gl,this.debug,this.program),et(this.gl,this.debug,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?h1e(this.gl,this.debug,e,t):d1e(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),et(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),f1e(this.gl,this.debug,this.program,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var s=rv(t,r),a=s[0],o=s[1];this.setOutputMatrixTextureDriver(e,a,o)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,s){this.setOutputMatrixWriteRegionDriver(r,e,s,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,s){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&BS(this.gl,this.debug,this.program),Vy(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),et(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),et(this.gl,this.debug,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=zy(this.gl,this.debug,Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var s=this.getQueryTimerExtensionWebGL1(),a=s.createQueryEXT();return s.beginQueryEXT(s.TIME_ELAPSED_EXT,a),a},n.prototype.endQuery=function(){if(Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return Ke(this,void 0,void 0,function(){var t=this;return Xe(this,function(r){switch(r.label){case 0:return[4,$O(function(){return t.disposed||t.isQueryAvailable(e,Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,s=this.getQueryTimerExtensionWebGL2(),a=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),a&&!this.disjoint}return a=(s=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),a&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=function(r){for(var s=0;s<r.length&&r[s]();++s);return s-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||$O(function(){return r.pollItems(),r.itemsToPoll.length===0})},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),zS(this.gl,this.debug,e,this.framebuffer),this.debug&&Vy(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(zS(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Vy(this.gl)):zO(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var s=this.gl;zS(s,this.debug,e,this.framebuffer),this.debug&&Vy(s),this.outputTexture=e,et(s,this.debug,function(){return s.viewport(0,0,t,r)}),et(s,this.debug,function(){return s.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,s){var a=this;this.throwIfDisposed(),et(this.gl,this.debug,function(){return a.gl.scissor(e,t,r,s)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n}();function JO(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach(function(t,r){var s=t.logicalShape,a=e[r],o=a.shape;if(!_r(s,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+s+" and "+o+" must match");if(!t.isUniform||!a.isUniform){var i=t.texShape,u=a.isUniform?null:a.texData.texShape;if(!_r(i,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+i+" and "+u+" must match")}})}var S2e=function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r=t.filterWidth,s=t.inChannels,a=t.strideWidth,o=t.strideHeight,i=t.padInfo,u=t.outWidth,l=t.dilationWidth,c=t.dilationHeight,d=t.dataFormat,p=i.left,m=i.top,v=s*r,b=rs(),y=d==="channelsLast",w=y?0:1,S=y?1:2,N="",C=0;C<=1;C++)for(var T=0;T<=1;T++)N+=`
          blockIndex = rc.y + `+T+`;
          pos = rc.x + `+C+`;

          if(blockIndex < `+n[1]+" && pos < "+n[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+o+" - "+m+`;
            d0 = offsetY + `+c+" * (pos / "+v+`);

            if(d0 < `+e[w]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+a+". - "+p+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+v+".) / "+s+`.));

              if(d1 < `+e[S]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+s+`.));

                if (`+y+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*C+T)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*C+T)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+N+`

        `+b.output+` = result;
      }
    `},C2e=function(n,e,t,r,s){this.variableNames=["x"],this.outputShape=[];var a,o=e,i=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";a=s===.5?"inversesqrt("+u+")":s===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+s+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+o+"; j <= "+o+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+i+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+a+`;
        setOutput(val);
      }
    `},N2e=function(n,e,t,r,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=s,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+s+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+s+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},k2e=function(n,e,t,r,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,o=e,i=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";a=s===.5?"inversesqrt("+u+")":s===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+s+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+o+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+o+"; j <= "+o+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+i+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+a+`;
        setOutput(result);
      }
    `},T2e=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideHeight,t=n.strideWidth,r=n.dilationHeight,s=n.effectiveFilterHeight,a=n.effectiveFilterWidth,o=s-1-n.padInfo.top,i=a-1-n.padInfo.left,u=s*a-1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+a+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+a+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},I2e=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,s=n.dilationDepth,a=n.dilationHeight,o=n.dilationWidth,i=n.effectiveFilterDepth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=i-1-n.padInfo.front,d=u-1-n.padInfo.top,p=l-1-n.padInfo.left,m=i*u*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+d+", "+p+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+i+`;
           wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+o+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+m+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},HS=function(n,e,t,r,s,a,o){t===void 0&&(t=!1),r===void 0&&(r=!1),s===void 0&&(s=!1),a===void 0&&(a=null),o===void 0&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var i=t?n[1]:n[2],u=Math.ceil(i/2),l=t?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",d=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],m="",v="";a&&(m=o?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+a+`
        }`:`vec4 activation(vec4 x) {
          `+a+`
        }`,v="result = activation(result);");var b=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+m+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+d[0]+" * "+p[0]+`);
          result += (`+d[1]+" * "+p[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+b+`

        `+v+`

        setOutput(result);
      }
    `},E2e=function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,s){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(s,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n}(),_2e=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},R2e=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=$s("rc",e),r=fn(e),s=function(i,u,l){if(i===1)return"rc > "+u[0];for(var c="",d=i-2;d<i;d++)c+=l[d]+" >= "+u[d],d<i-1&&(c+="||");return c}(e,n,t),a=function(i,u,l,c){if(i===1)return"";var d=c.slice(-2);return`
    int r = `+d[0]+`;
    int c = `+d[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `}(e,n[n.length-1],n[n.length-2],t),o=function(i,u){var l=i.length,c=function(d,p){for(var m=[],v=0;v<=1;v++)for(var b=0;b<=1;b++){for(var y=(v===0?"r":"rp1")+", "+(b===0?"c":"cp1"),w=2;w<d;w++)y=p[p.length-1-w]+","+y;m.push(y)}return m}(l,u);return l===1?`getA(rc),
            rc + 1 >= `+i[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}(n,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+s+`) {
            setOutput(vec4(0));
          } else {
            `+a+`

            setOutput(vec4(`+o+`));
          }
        }
      `}},A2e=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map(function(u,l){return u[0]+n[l]+u[1]});var r=n.length,s=fn(r),a=e.map(function(u){return u[0]}).join(","),o=e.map(function(u,l){return u[0]+n[l]}).join(","),i=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+s+" start = "+s+"("+a+`);
      `+s+" end = "+s+"("+o+`);

      void main() {
        `+s+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+s+` coords = outC - start;
          setOutput(getX(`+i+`));
        }
      }
    `:`
        int start = `+a+`;
        int end = `+o+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},D2e=function(n,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(y,w){return y[0]+n[w]+y[1]});for(var r=n.length,s=fn(r),a=e.map(function(y){return y[0]}).join(","),o=e.map(function(y,w){return y[0]+n[w]}).join(","),i=$s("rc",r),u=$s("source",r),l=i[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",d=[s+" rc = outputLoc;",i[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+i[r-2]+` += 1;
       if(`+i[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+i[r-1]+` += 1;
         if(`+l+") {"],p=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="",v=0,b=r===1?2:4;v<b;v++)m+=`
        `+d[v]+`
        if (`+p+`) {
          result[`+v+"] = float("+t+`);
        } else {
          `+s+` source = rc - start;
          result[`+v+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;m+=r===1?"} ":"}}",this.userCode=`
      const `+s+" start = "+s+"("+a+`);
      const `+s+" end = "+s+"("+o+`);

      void main() {
        `+s+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+m+`
        setOutput(result);
      }
    `},jS=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,s=n.strideHeight,a=n.strideWidth,o=n.dilationHeight,i=n.dilationWidth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=n.padInfo.top,d=n.padInfo.left;this.outputShape=n.outShape;var p=e==="avg",m="0.0";if(p||(m="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+s+", "+a+`);
        const ivec2 pads = ivec2(`+c+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+o+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+i+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var v=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(v="avgValue / count");var b=4*Math.floor(r/4),y=r%4,w=`
      if (`+p+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+s+", "+a+`);
      const ivec2 pads = ivec2(`+c+", "+d+`);
      const float initializationValue = `+m+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+m+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+o+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+b+`; wC += 4) {
            int xC = xCCorner + wC * `+i+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+i+`, d),
              getValue(batch, xR, xC + 2 * `+i+`, d),
              getValue(batch, xR, xC + 3 * `+i+`, d)
            );

            `+w+`
          }

          int xC = xCCorner + `+b+`;
          if (`+(y===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+w+`
          } else if (`+(y===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+i+`, d),
              initializationValue,
              initializationValue
            );

            `+w+`
          } else if (`+(y===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+i+`, d),
              getValue(batch, xR, xC + 2 * `+i+`, d),
              initializationValue
            );

            `+w+`
          }
        }
        setOutput(`+v+`);
      }
    `}},qS=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,s=n.strideDepth,a=n.strideHeight,o=n.strideWidth,i=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,d=n.effectiveFilterHeight,p=n.effectiveFilterWidth,m=n.padInfo.front,v=n.padInfo.top,b=n.padInfo.left;this.outputShape=n.outShape;var y=e==="avg",w="0.0";if(y||(w="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+s+", "+a+", "+o+`);
        const ivec3 pads = ivec3(`+m+", "+v+", "+b+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+c+`;
              wD += `+i+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+n.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+p+`;
                  wC += `+l+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+d+" * "+p+` +
                      wR * `+p+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var S=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(S="avgValue / count");var N=4*Math.floor(r/4),C=r%4,T=`
      if (`+y+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+s+", "+a+", "+o+`);
      const ivec3 pads = ivec3(`+m+", "+v+", "+b+`);
      const float initializationValue = `+w+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+w+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+i+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+N+`; wC += 4) {
              int xC = xCCorner + wC * `+l+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+l+`, ch)
              );

              `+T+`
            }

            int xC = xCCorner + `+N+`;
            if (`+(C===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+T+`
            } else if (`+(C===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                initializationValue,
                initializationValue
              );

              `+T+`
            } else if (`+(C===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                initializationValue
              );

              `+T+`
            }
          }
          setOutput(`+S+`);
        }
      }
    `}},$2e=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,s=n.inSize,a=Math.ceil(s/t);this.outputShape=[r,a];var o="0.0",i="";e==="prod"?o="1.0":e==="min"?(o="1.0 / 1e-20",i="min"):e==="max"&&(o="-1.0 / 1e-20",i="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var l=4*Math.floor(t/4),c=t%4,d=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+i+`(values, minMaxValue);
      }
    `,p="vec4";e==="all"?(o="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):e==="any"&&(o="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");var m="";s%t>0&&(m=`
        if (inIdx < 0 || inIdx >= `+s+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+o+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+m+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+o+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+d+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(c===2)+`) {
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(c===3)+`) {
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+d+`
        }
        setOutput(`+u+`);
      }
    `},O2e=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var s="thisRC = rc;";r%2==1&&(s+="thisRC.z += 1;"),r>1&&(s+="thisRC.y += 1;"),t+=`
        `+s+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Ll(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+PI(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+t+`

        setOutput(result);
      }
    `},F2e=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,s=r[1],a=r[2],o=n.shape,i=o[1],u=o[2],l=[t&&i>1?s-1:s,t&&u>1?a-1:a],c=[t&&i>1?i-1:i,t&&u>1?u-1:u],d=l[0]/c[0],p=l[1]/c[1],m=1/d,v=1/p,b=2*Math.ceil(m)+2,y=2*Math.ceil(v)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+p+`);

        const float invHeightScale = float(`+m+`);
        const float invWidthScale = float(`+v+`);

        const int winHeight = int(`+b+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+i+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(s-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(a-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},M2e=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var s=n[0],a=n[1],o=n[2],i=n[3];this.outputShape=[s,e,t,i];var u=[r&&e>1?a-1:a,r&&t>1?o-1:o],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},L2e=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var s=n[0],a=n[1],o=n[2],i=n[3];this.outputShape=[s,e,t,i];var u=[r&&e>1?a-1:a,r&&t>1?o-1:o],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+a+".0, "+o+`.0,
                                     `+o+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(i-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},P2e=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,s=r[1],a=r[2],o=n.shape,i=o[1],u=o[2],l=[t&&i>1?s-1:s,t&&u>1?a-1:a],c=[t&&i>1?i-1:i,t&&u>1?u-1:u],d=l[0]/c[0],p=l[1]/c[1],m=1/d,v=1/p,b=2*Math.ceil(m)+2,y=2*Math.ceil(v)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+p+`);

        const float invHeightScale = float(`+m+`);
        const float invWidthScale = float(`+v+`);

        const int winHeight = int(`+b+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+i+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+s+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+a+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},B2e=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var s=n[0],a=n[1],o=n[2],i=n[3];this.outputShape=[s,e,t,i];var u=[r&&e>1?a-1:a,r&&t>1?o-1:o],l=[r&&e>1?e-1:e,r&&t>1?t-1:t],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},z2e=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,t!==1){var r=n.map(function(a,o){return function(i){return e.indexOf(i)!==-1&&n[i]!==1?n[i]+" - coords["+i+"] - 1":"coords["+i+"]"}(o)}).join(","),s=fn(t);this.userCode=`
      void main() {
        `+s+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `},V2e=function(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var r=$s("rc",t),s=r[t-1]+" + 1 < "+this.outputShape[t-1],a=r[t-2]+" + 1 < "+this.outputShape[t-2],o=fn(t);function i(u){var l=n.map(function(c,d){return function(p,m){return e.indexOf(p)!==-1&&n[p]!==1?n[p]+" - "+m[p]+" - 1":""+m[p]}(d,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+s+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+o+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return i(u)}(r.slice())+`;
          if(`+s+`){
            result.g = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",i(u)}(r.slice())+`;
          }
          if(`+a+`) {
            result.b = `+function(u){return u[t-2]="("+u[t-2]+" + 1)",i(u)}(r.slice())+`;
            if(`+s+`) {
              result.a = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",i(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},e3=function(n,e,t,r,s,a,o){this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var i=fn(s.length),u=fn(a.length),l="";t===1?l="i":t===2&&(l="i, j");var c="getIndices("+l+")",d="";r===1?d="i":r===2&&(d="i, coords[1]");var p="getUpdates("+d+")",m=e>1?"strides[j]":"strides";this.userCode=`
        `+i+" strides = "+i+"("+s+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+m+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+p+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},U2e=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,s=n.inSize,a=n.numSegments,o=a*Math.ceil(s/t);this.outputShape=[r,o];var i=4*Math.floor(t/4),u=t%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";s%t>0&&(c=`
        if (inIdx < 0 || inIdx >= `+s+`) {
          return initializationValue;
        }
      `);var d="";s%t>0&&(d=`
        if (inIdx < 0 || inIdx >= `+s+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+d+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+a+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+a+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+i+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+i+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},W2e=function(n,e,t){var r,s;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)s="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],i=[],u=0;u<e.length;u++)i.push(""+a[u]),u<n&&o.push(""+a[u]);r=o.join(),s=i.join()}var l=fn(t);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+s+`));
        } else {
          setOutput(getB(`+s+`));
        }
      }
    `},G2e=function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=fn(this.rank),s="uniform int start["+this.rank+"];",a=function(o){if(o===1)return"sourceLoc";if(o<=6)return KS.slice(0,o).map(function(i){return"sourceLoc."+i}).join(",");throw Error("Slicing for rank "+o+" is not yet supported")}(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map(function(o,i){return"sourceLoc."+KS[i]+" = start["+i+"] + coords."+KS[i]+";"}).join(`
`)+`
      `,this.userCode=`
      `+s+`
      void main() {
        `+t+`
        setOutput(getSource(`+a+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,s){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(s,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),KS=["x","y","z","w","u","v"],H2e=function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=fn(this.rank),r=$s("coords",this.rank),s=$s("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":"vec2("+s.slice(-2).join()+")",o="getChannel(getSource("+s.join()+"), "+a+")",i=`
      result.x = `+o+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+s[this.rank-1]+`;
        result.y = `+o+`;
        --`+s[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+s[this.rank-2]+`;
        result.z = `+o+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+s[this.rank-1]+`;
          result.w = `+o+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(c,d){return"start["+d+"]"}).join()+");":e.map(function(c,d){return s[d]+" = "+r[d]+" + start["+d+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+i+`
        `+u+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,s){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(s,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),j2e=function(n,e,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,s=fn(t.length),a=fn(t.length),o="";if(r===1)o="coords * strides + begin";else{var i=0;o=t.map(function(u,l){return i++,t.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(i-1)+"] * strides["+l+"] + begin["+l+"]"}).join(",")}this.userCode=`
      `+s+" begin = "+s+"("+n+`);
      `+s+" strides = "+s+"("+e+`);

      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+o+`));
      }
    `},q2e=function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var s,a=t3(t,r),o=n3(e,a,r);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var i=this.freeTextures[o].shift();return this.usedTextures[o].push(i),i}return this.numUsedTextures++,this.log(),a===Qs.PACKED_2X2_FLOAT32?s=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===Qs.PACKED_2X2_FLOAT16?s=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===Qs.UNPACKED_FLOAT32?s=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===Qs.UNPACKED_FLOAT16?s=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===Qs.PACKED_4X1_UNSIGNED_BYTE&&(s=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(s),s},n.prototype.releaseTexture=function(e,t,r,s){if(this.freeTextures!=null){var a=n3(t,t3(r,s),s);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(e),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[a],i=o.indexOf(e);if(i<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(i,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(s){e.gpgpu.deleteMatrixTexture(s)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function t3(n,e){if(n===ra.UPLOAD)return Qs.PACKED_2X2_FLOAT32;if(n===ra.RENDER||n==null)return function(t){return Ne().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Qs.PACKED_2X2_FLOAT32:Qs.UNPACKED_FLOAT32:t?Qs.PACKED_2X2_FLOAT16:Qs.UNPACKED_FLOAT16}(e);if(n===ra.DOWNLOAD||n===ra.PIXELS)return Qs.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function n3(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var K2e=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var s=fn(this.rank),a=function(o){var i=o.length;if(i>5)throw Error("Tile for rank "+i+" is not yet supported");if(i===1)return"imod(resRC, "+o[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<o.length;c++)l.push("imod("+u[c]+", "+o[c]+")");return l.join()}(n);this.userCode=`
      void main() {
        `+s+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},X2e=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var s=fn(this.rank),a=function(o){var i=o.length;if(i>6)throw Error("Transpose for rank "+i+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(i),c=0;c<o.length;c++)l[o[c]]=u[c];return l.join()}(e);this.userCode=`
    void main() {
      `+s+` resRC = getOutputCoords();
      setOutput(getA(`+a+`));
    }
    `},Y2e=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var s=fn(this.rank),a=sU("rc",this.rank),o=new Array(this.rank);for(r=0;r<e.length;r++)o[e[r]]=a[r];var i="vec2("+o.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+t[this.rank-1],l="getChannel(getA("+o.join()+"), "+i+")";this.userCode=`
    void main() {
      `+s+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+a[this.rank-1]+`;
      if(++`+a[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `},BI=1.7580993408473768,zI=1.0507009873554805,wt=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},oo="if (isnan(x)) return x;",Z2e="return x;",r3="return abs(x);",lU=oo+`
  return (x < 0.0) ? 0.0 : x;
`,cU=oo+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,hU="return (x >= 0.0) ? x : (exp(x) - 1.0);",Q2e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+BI+`;
  float scale = `+zI+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,s3="return -x;",a3="return ceil(x);",o3="return floor(x);",i3="return exp(x);",u3="return exp(x) - 1.0;",J2e=oo+`
  return sin(x);
`,eSe=oo+`
  return cos(x);
`,tSe=oo+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,nSe=oo+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,rSe=oo+`
  return atan(x);
`,sSe=oo+"return log(x + sqrt(x * x + 1.0));",aSe=oo+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,oSe=oo+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Hy="return x;",iSe="return x;",dU=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,fU=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,pU=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Ip=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},uSe=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var e=n.length,t=$s("rc",e),r=fn(e),s=function(i,u){if(i===1)return"rc";for(var l="",c=0;c<i;c++)l+=u[c],c<i-1&&(l+=",");return l}(e,t),a=t.slice(-2),o=e<=1?"rc":"vec2("+a.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+s+`);

        setOutput(getChannel(packedInput, `+o+`));
      }
    `},jy={};function qy(n,e){if(e===void 0&&(e=!1),n==="linear")return e?iSe:Z2e;if(n==="relu")return e?dU:lU;if(n==="elu")return e?pU:hU;if(n==="relu6")return e?fU:cU;if(n==="prelu")return e?uU:iU;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var lSe=600,cSe=function(n){function e(t){var r,s=n.call(this)||this;if(s.pendingRead=new WeakMap,s.pendingDisposal=new WeakSet,s.dataRefCount=new WeakMap,s.numBytesInGPU=0,s.uploadWaitMs=0,s.downloadWaitMs=0,s.warnedAboutMemory=!1,s.pendingDeletes=0,s.disposed=!1,!Ne().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var a=Uo(Ne().getNumber("WEBGL_VERSION"));s.binaryCache=((r=Ne().getNumber("WEBGL_VERSION"))in jy||(jy[r]={}),jy[r]),s.gpgpu=new w2e(a),s.canvas=a.canvas,s.gpgpuCreatedLocally=!0}else s.gpgpu=t,s.binaryCache={},s.gpgpuCreatedLocally=!1,s.canvas=t.gl.canvas;return s.textureManager=new q2e(s.gpgpu),s.numMBBeforeWarning=Ne().global.screen==null?1024:Ne().global.screen.height*Ne().global.screen.width*window.devicePixelRatio*lSe/1024/1024,s.texData=new XV(s,ue),s}return ao(e,n),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,r,s){if(Ne().getBool("DEBUG")&&this.checkNumericalProblems(t),s==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var a={};return this.texData.set(a,{shape:r,dtype:s,values:t,usage:ra.UPLOAD}),a},e.prototype.move=function(t,r,s,a){if(Ne().getBool("DEBUG")&&this.checkNumericalProblems(r),a==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:s,dtype:a,values:r,usage:ra.UPLOAD})},e.prototype.readSync=function(t){var r=this.texData.get(t),s=r.values,a=r.dtype,o=r.complexTensors,i=r.slice,u=r.shape,l=r.isPacked;if(i!=null){var c=void 0;c=l?new Ip(u,Hy):new wt(u,Hy);var d=this.runWebGLProgram(c,[{dataId:t,shape:u,dtype:a}],a),p=this.readSync(d.dataId);return this.disposeData(d.dataId),p}if(s!=null)return this.convertAndCacheOnCPU(t);if(a==="string")return s;var m,v,b=this.activeTimers!=null;return b&&(m=bo()),a==="complex64"?v=xN(o.real.dataSync(),o.imag.dataSync()):v=this.getValuesFromTexture(t),b&&(this.downloadWaitMs+=bo()-m),this.convertAndCacheOnCPU(t,v)},e.prototype.read=function(t){return Ke(this,void 0,void 0,function(){var r,s,a,o,i,u,l,c,d,p,m,v,b,y,w,S,N,C,T,E,$,_;return Xe(this,function(R){switch(R.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise(function(D){return r.push(D)})];if(s=this.texData.get(t),a=s.values,o=s.shape,i=s.slice,u=s.dtype,l=s.complexTensors,c=s.isPacked,i!=null)return d=void 0,d=c?new Ip(o,Hy):new wt(o,Hy),p=this.runWebGLProgram(d,[{dataId:t,shape:o,dtype:u}],u),m=this.read(p.dataId),this.disposeData(p.dataId),[2,m];if(a!=null)return[2,this.convertAndCacheOnCPU(t)];if(!Ne().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Ne().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return v=null,u!=="complex64"&&Ne().get("WEBGL_BUFFER_SUPPORTED")&&(b=this.decode(t),y=this.texData.get(b.dataId),v=(_=this.gpgpu).createBufferFromTexture.apply(_,[y.texture].concat(Lp(o)))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:R.sent(),R.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return S=R.sent(),N=S[0],C=S[1],w=xN(N,C),[3,5];case 4:v==null?w=this.getValuesFromTexture(t):(T=Je(o),w=this.gpgpu.downloadFloat32MatrixFromBuffer(v,T)),R.label=5;case 5:return b!=null&&this.disposeData(b.dataId),E=this.convertAndCacheOnCPU(t,w),$=this.pendingRead.get(t),this.pendingRead.delete(t),$.forEach(function(D){return D(E)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,E]}})})},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var s=t[r];if(!Qxe(s))throw Ne().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+s+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+s+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var r,s=this.texData.get(t),a=s.shape,o=s.dtype,i=s.isPacked,u=Je(a);if(Ne().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(t),c=this.texData.get(l.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(Lp(a))).subarray(0,u);return this.disposeData(l.dataId),d}var p=Ne().getBool("WEBGL_PACK")&&i===!0,m=p?VS(a):a,v=p?new Zwe(m):new Ywe(m),b=this.runWebGLProgram(v,[{shape:m,dtype:o,dataId:t}],"float32"),y=this.texData.get(b.dataId),w=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(y.texture,y.texShape[0],y.texShape[1]).subarray(0,u);return this.disposeData(b.dataId),w},e.prototype.time=function(t){return Ke(this,void 0,void 0,function(){var r,s,a,o,i,u,l;return Xe(this,function(c){switch(c.label){case 0:return r=this.activeTimers,s=[],a=!1,this.programTimersStack==null?(this.programTimersStack=s,a=!0):this.activeTimers.push(s),this.activeTimers=s,t(),o=ed(this.activeTimers.map(function(d){return d.query})).filter(function(d){return d!=null}),i=ed(this.activeTimers.map(function(d){return d.name})).filter(function(d){return d!=null}),this.activeTimers=r,a&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return l=c.sent(),u.kernelMs=Dxe(l),u.getExtraProfileInfo=function(){return l.map(function(d,p){return{name:i[p],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:bo(),endMs:null}},e.prototype.endTimer=function(t){return Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=bo(),t)},e.prototype.getQueryTime=function(t){return Ke(this,void 0,void 0,function(){var r;return Xe(this,function(s){return Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),s=r.texture,a=r.dtype,o=r.texShape,i=r.usage,u=r.isPacked,l=r.slice,c=l&&l.origDataId||t,d=this.dataRefCount.get(c);d>1?this.dataRefCount.set(c,d-1):(this.dataRefCount.delete(c),s!=null&&(this.numBytesInGPU-=this.computeBytes(o,a),this.textureManager.releaseTexture(s,o,i,u)));var p=this.texData.get(t);p.texture=null,p.texShape=null,p.isPacked=!1,p.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return Ne().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=ue.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,r){var s=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&t.every(function(a){return s.texData.get(a.dataId).texture==null&&a.size<r})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,r){var s=this.makeOutput(t.shape,"complex64");return this.texData.get(s.dataId).complexTensors={real:ue.keep(t.clone()),imag:ue.keep(r.clone())},s},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,s){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,s);if(Je(s)===0)return Ur([],s,t.dtype);var a=this.texData.get(t.dataId).isPacked,o=qV(t.shape,r,s);if(a||!o){var i=Ne().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new H2e(s):new G2e(s),u=i.getCustomSetupFunc(r);return this.compileAndRun(i,[t],null,u)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,s)},e.prototype.shallowSlice=function(t,r,s){var a=this.texData.get(t.dataId),o=this.makeOutput(s,t.dtype),i=this.texData.get(o.dataId);Object.assign(i,a),i.shape=s,i.dtype=t.dtype;var u=KV(r,t.strides);a.slice&&(u+=a.slice.flatOffset),i.slice={flatOffset:u,origDataId:a.slice&&a.slice.origDataId||t.dataId};var l=this.dataRefCount.get(i.slice.origDataId)||1;return this.dataRefCount.set(i.slice.origDataId,l+1),o},e.prototype.stridedSlice=function(t,r,s,a){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,s,a);var o=$I(r,s,a);if(o.some(function(u){return u===0}))return Ur([],o);var i=new j2e(r,a,o);return this.compileAndRun(i,[t])},e.prototype.reverse=function(t,r){var s=Ne().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new V2e(t.shape,r):new z2e(t.shape,r);return this.compileAndRun(s,[t])},e.prototype.concat=function(t,r){if(t[0].dtype==="complex64"){var s=t.map(function(m){return Ta(m)}),a=t.map(function(m){return wo(m)});return zr(this.concat(s,r),this.concat(a,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(t.length===1)return t[0];if(t.length>Ne().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(t.length/2),i=this.concat(t.slice(0,o),r),u=this.concat(t.slice(o),r);return this.concat([i,u],r)}if(Ne().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var l=new Mwe(t.map(function(m){return m.shape}),r);return this.compileAndRun(l,t)}var c=nd(t.map(function(m){return m.shape}),r),d=t.map(function(m){return m.as2D(-1,Je(m.shape.slice(r)))}),p=new Fwe(d.map(function(m){return m.shape}));return this.compileAndRun(p,d).reshape(c)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,s3,t.dtype);var r=new wt(t.shape,s3);return this.compileAndRun(r,[t])},e.prototype.batchMatMul=function(t,r,s,a){var o=s?t.shape[2]:t.shape[1],i=a?r.shape[1]:r.shape[2],u=s?t.shape[1]:t.shape[2],l=t.shape[0];if((o===1||i===1)&&u>1e3){s&&(t=t.transpose([0,2,1])),a&&(r=r.transpose([0,2,1]));var c=i===1?t:t.as3D(l,u,1),d=i===1?2:1,p=i===1?r.as3D(l,1,u):r;return this.multiply(c,p).sum(d,!0)}var m=Vr(t.dtype,r.dtype),v=new HS(t.shape,[l,o,i],s,a);return this.compileAndRun(v,[t,r],m)},e.prototype.fusedBatchMatMul=function(t){var r=t.a,s=t.b,a=t.transposeA,o=t.transposeB,i=t.bias,u=t.activation,l=t.preluActivationWeights,c=a?r.shape[2]:r.shape[1],d=o?s.shape[1]:s.shape[2],p=r.shape[0],m=Vr(r.dtype,s.dtype),v=i!=null,b=l!=null,y=u?qy(u,!0):null,w=new HS(r.shape,[p,c,d],a,o,v,y,b),S=[r,s];return i&&S.push(i),l&&S.push(l),this.compileAndRun(w,S,m)},e.prototype.multiply=function(t,r){if(t.dtype==="complex64"){var s=this.texData.get(t.dataId),a=this.texData.get(r.dataId),o=new jO(Rwe,t.shape,r.shape),i=new jO(Awe,t.shape,r.shape),u=[this.makeComplexComponentTensorInfo(t,s.complexTensors.real),this.makeComplexComponentTensorInfo(t,s.complexTensors.imag),this.makeComplexComponentTensorInfo(r,a.complexTensors.real),this.makeComplexComponentTensorInfo(r,a.complexTensors.imag)],l=this.compileAndRun(o,u),c=this.compileAndRun(i,u),d=this.complex(l,c);return l.dispose(),c.dispose(),d}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,qO,t.dtype);var p=new $n(qO,t.shape,r.shape);return this.compileAndRun(p,[t,r],t.dtype)},e.prototype.batchNormalization=function(t,r,s,a,o,i){var u=[t,r,s],l=null;i!=null&&(l=i.shape,u.push(i));var c=null;if(o!=null&&(c=o.shape,u.push(o)),Ne().getBool("WEBGL_PACK_NORMALIZATION")){var d=new _we(t.shape,r.shape,s.shape,l,c,a);return this.compileAndRun(d,u)}var p=new Ewe(t.shape,r.shape,s.shape,l,c,a);return this.compileAndRun(p,u)},e.prototype.localResponseNormalization4D=function(t,r,s,a,o){var i=Ne().getBool("WEBGL_PACK_NORMALIZATION")?new k2e(t.shape,r,s,a,o):new C2e(t.shape,r,s,a,o);return this.compileAndRun(i,[t])},e.prototype.LRNGrad=function(t,r,s,a,o,i,u){var l=new N2e(r.shape,a,o,i,u);return this.compileAndRun(l,[r,s,t])},e.prototype.tile=function(t,r){if(t.dtype==="string"){var s=this.readSync(t.dataId).map(function(o){return jb(o)});return nU(vt(t.shape,t.dtype,s),r)}var a=new K2e(t.shape,r);return this.compileAndRun(a,[t])},e.prototype.pad=function(t,r,s){var a=Ne().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new D2e(t.shape,r,s):new A2e(t.shape,r,s);return this.compileAndRun(a,[t])},e.prototype.transpose=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,r);var s=Ne().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Y2e(t.shape,r):new X2e(t.shape,r);return this.compileAndRun(s,[t])},e.prototype.gather=function(t,r,s){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,s);var a=new r2e(t.shape,r.size,s);return this.compileAndRun(a,[t,r])},e.prototype.batchToSpaceND=function(t,r,s){X(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var a=r.reduce(function(d,p){return d*p}),o=Qb(t.shape,r,a),i=Jb(o.length,r.length),u=e0(t.shape,r,a),l=WV(s,r.length),c=GV(u,s,r.length);return t.reshape(o).transpose(i).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(t,r,s){X(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var a=r.reduce(function(p,m){return p*m}),o=[[0,0]];o.push.apply(o,s);for(var i=1+r.length;i<t.shape.length;++i)o.push([0,0]);var u=t.pad(o),l=Qb(u.shape,r,a,!1),c=Jb(l.length,r.length,!1),d=e0(u.shape,r,a,!1);return u.reshape(l).transpose(c).reshape(d)},e.prototype.reduce=function(t,r,s){var a=t.shape[0],o=t.shape[1],i=US(o),u=new $2e({windowSize:i,inSize:o,batchSize:a},r),l=this.compileAndRun(u,[t],s);return l.shape[1]===1?l:this.reduce(l,r,s)},e.prototype.argReduce=function(t,r,s){s===void 0&&(s=null);var a=t.shape[0],o=t.shape[1];s!=null&&(a=s.shape[0],o=s.shape[1]);var i=US(o),u=new bwe({windowSize:i,inSize:o,batchSize:a},r,s==null),l=[t];s!=null&&l.push(s);var c=this.compileAndRun(u,l,"int32");return c.shape[1]===1?c:this.argReduce(t,r,c)},e.prototype.argReducePacked=function(t,r,s){s===void 0&&(s=null);var a=s!=null?s.shape:t.shape,o=US(a[a.length-1]),i=new kwe(a,o,r,s==null),u=s==null?[t]:[t,s],l=this.compileAndRun(i,u,"int32");return l.rank===t.rank?this.argReducePacked(t,r,l):l},e.prototype.sum=function(t,r){Zs("sum",r,t.rank);var s=Yr(t.shape,r),a=s[0],o=Je(s[1]),i=t.as2D(-1,o),u=OS(t.dtype);return this.reduce(i,"sum",u).reshape(a)},e.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var s=Yr(t.shape,r),a=s[0],o=Je(s[1]),i=t.as2D(-1,o),u=OS(t.dtype);return this.reduce(i,"prod",u).reshape(a)},e.prototype.unsortedSegmentSum=function(t,r,s){var a=0,o=Wo([a],t.rank),i=t;o!=null&&(i=t.transpose(o),a=Go(1,t.rank)[0]);var u=function(m,v,b){for(var y=[],w=m.length,S=0;S<w;S++)S!==v?y.push(m[S]):y.push(b);return y}(i.shape,a,s),l=Je([i.shape[a]]),c=i.as2D(-1,l),d=OS(t.dtype),p=this.segOpCompute(c,"unsortedSegmentSum",r,d,s).reshape(u);return o!=null&&(p=p.transpose(_I(o))),p},e.prototype.segOpCompute=function(t,r,s,a,o){var i=t.shape[0],u=t.shape[1],l=function(p,m){var v,b=!1;for(p<=jV?(v=p,b=!0):v=hN(p,Math.floor(Math.sqrt(p)));!b;)v>m||v===p?b=!0:v=hN(p,v+1);return v}(u,o),c=new U2e({windowSize:l,inSize:u,batchSize:i,numSegments:o}),d=this.compileAndRun(c,[t,s],a);return d.shape[1]===o?d:(s=Zb(0,o).tile([u/l]),this.segOpCompute(d,r,s,a,o))},e.prototype.argMinMaxReduce=function(t,r,s){var a=[r];if(Zs("arg"+s.charAt(0).toUpperCase()+s.slice(1),a,t.rank),!Ne().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var o=Yr(t.shape,a),i=o[0],u=Je(o[1]),l=t.as2D(-1,u);return this.argReduce(l,s).reshape(i)}return this.argReducePacked(t,s)},e.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},e.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},e.prototype.cumsum=function(t,r,s,a){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var o=new Hwe(t.shape,s,a);return this.compileAndRun(o,[t])},e.prototype.equal=function(t,r){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(equal(a, b));
`,"bool");var s=new $n("return float(a == b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.notEqual=function(t,r){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(notEqual(a, b));
`,"bool");var s=new $n("return float(a != b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThan(a, b));
`,"bool");var s=new $n("return float(a < b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.lessEqual=function(t,r){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var s=new $n("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThan(a, b));
`,"bool");var s=new $n("return float(a > b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.greaterEqual=function(t,r){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var s=new $n("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.logicalNot=function(t){var r=new wt(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},e.prototype.logicalAnd=function(t,r){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var s=new $n("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.logicalOr=function(t,r){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var s=new $n("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.select=function(t,r,s){var a=new W2e(t.rank,r.shape,r.rank);return this.compileAndRun(a,[t,r,s],Vr(r.dtype,s.dtype))},e.prototype.where=function(t){Xb("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return LI(t.shape,r)},e.prototype.topk=function(t,r,s){return rU(t.dataSync(),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Zs("min",r,t.rank);var s=Yr(t.shape,r),a=s[0],o=Je(s[1]),i=t.as2D(-1,o);return this.reduce(i,"min",i.dtype).reshape(a)},e.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var s=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new $n(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.mod=function(t,r){var s=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new $n(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);Zs("max",r,t.rank);var s=Yr(t.shape,r),a=s[0],o=Je(s[1]),i=t.as2D(-1,o);return this.reduce(i,"max",i.dtype).reshape(a)},e.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var s=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new $n(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.all=function(t,r){Zs("all",r,t.rank);var s=Yr(t.shape,r),a=s[0],o=Je(s[1]),i=t.as2D(-1,o);return this.reduce(i,"all",i.dtype).reshape(a)},e.prototype.any=function(t,r){Zs("any",r,t.rank);var s=Yr(t.shape,r),a=s[0],o=Je(s[1]),i=t.as2D(-1,o);return this.reduce(i,"any",i.dtype).reshape(a)},e.prototype.realDivide=function(t,r){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var s=new $n(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,r.shape);return this.compileAndRun(s,[t,r],"float32")},e.prototype.floorDiv=function(t,r){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var s=new $n(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,r.shape);return this.compileAndRun(s,[t,r],"int32")},e.prototype.add=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,WS);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var s=Vr(t.dtype,r.dtype);if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,WS,s);var a=new $n(WS,t.shape,r.shape);return this.compileAndRun(a,[t,r],s)},e.prototype.packedUnaryOp=function(t,r,s){var a=new Ip(t.shape,r);return this.compileAndRun(a,[t],s)},e.prototype.packedBinaryOp=function(t,r,s,a,o){o===void 0&&(o=!1);var i=new li(s,t.shape,r.shape,o);return this.compileAndRun(i,[t,r],a)},e.prototype.complexSeparableBinaryOp=function(t,r,s){var a=this,o=this.texData.get(t.dataId),i=this.texData.get(r.dataId),u=[[o.complexTensors.real,i.complexTensors.real],[o.complexTensors.imag,i.complexTensors.imag]].map(function(p){var m=p[0],v=p[1],b=a.makeComplexComponentTensorInfo(t,m),y=a.makeComplexComponentTensorInfo(r,v),w=new $n(s,t.shape,r.shape);return a.compileAndRun(w,[b,y],Vr(m.dtype,v.dtype))}),l=u[0],c=u[1],d=this.complex(l,c);return l.dispose(),c.dispose(),d},e.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>Ne().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),s=this.addN(t.slice(0,r)),a=this.addN(t.slice(r));return this.addN([s,a])}var o=t.map(function(l){return l.dtype}).reduce(function(l,c){return Vr(l,c)}),i=t.map(function(l){return l.shape}),u=Ne().getBool("WEBGL_PACK")?new ywe(t[0].shape,i):new vwe(t[0].shape,i);return this.compileAndRun(u,t,o)},e.prototype.subtract=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,GS);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var s=Vr(t.dtype,r.dtype);if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,GS,t.dtype);var a=new $n(GS,t.shape,r.shape);return this.compileAndRun(a,[t,r],s)},e.prototype.pow=function(t,r){var s=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new $n(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,r.shape),a=Vr(t.dtype,r.dtype);return this.compileAndRun(s,[t,r],a)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,a3,t.dtype);var r=new wt(t.shape,a3);return this.compileAndRun(r,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,o3,t.dtype);var r=new wt(t.shape,o3);return this.compileAndRun(r,[t])},e.prototype.sign=function(t){var r=new wt(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[t])},e.prototype.isNaN=function(t){var r=new wt(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isInf=function(t){var r=new wt(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isFinite=function(t){var r=new wt(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.round=function(t){var r=new wt(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,i3,t.dtype);var r=new wt(t.shape,i3);return this.compileAndRun(r,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,u3,t.dtype);var r=new wt(t.shape,u3);return this.compileAndRun(r,[t])},e.prototype.softmax=function(t,r){var s=br([r],t.shape),a=this.max(t,s),o=Bs(a.shape,s),i=this.subtract(t,a.reshape(o)),u=this.exp(i),l=this.sum(u,s).reshape(o);return this.realDivide(u,l)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var r=new wt(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[t])},e.prototype.log1p=function(t){var r=new wt(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},e.prototype.sqrt=function(t){var r=new wt(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new wt(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},e.prototype.reciprocal=function(t){var r=new wt(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},e.prototype.relu=function(t){var r;return r=Ne().getBool("WEBGL_PACK")?new Ip(t.shape,dU):new wt(t.shape,lU),this.compileAndRun(r,[t])},e.prototype.relu6=function(t){var r;return r=Ne().getBool("WEBGL_PACK")?new Ip(t.shape,fU):new wt(t.shape,cU),this.compileAndRun(r,[t])},e.prototype.prelu=function(t,r){var s=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(uU,t.shape,r.shape):new $n(iU,t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.elu=function(t){if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,pU,t.dtype);var r=new wt(t.shape,hU);return this.compileAndRun(r,[t])},e.prototype.eluDer=function(t,r){var s=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,r.shape):new $n("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.selu=function(t){var r=new wt(t.shape,Q2e);return this.compileAndRun(r,[t])},e.prototype.int=function(t){var r=new wt(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},e.prototype.clip=function(t,r,s){var a,o=(a=Ne().getBool("WEBGL_PACK_CLIP")?new $we(t.shape):new Dwe(t.shape)).getCustomSetupFunc(r,s);return this.compileAndRun(a,[t],null,o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,r3,t.dtype);var r=new wt(t.shape,r3);return this.compileAndRun(r,[t])},e.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),s=new Owe(t.shape),a=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(s,a)},e.prototype.sigmoid=function(t){var r=new wt(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},e.prototype.softplus=function(t){var r=new wt(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[t])},e.prototype.sin=function(t){var r=new wt(t.shape,J2e);return this.compileAndRun(r,[t])},e.prototype.cos=function(t){var r=new wt(t.shape,eSe);return this.compileAndRun(r,[t])},e.prototype.tan=function(t){var r=new wt(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},e.prototype.asin=function(t){var r=new wt(t.shape,tSe);return this.compileAndRun(r,[t])},e.prototype.acos=function(t){var r=new wt(t.shape,nSe);return this.compileAndRun(r,[t])},e.prototype.atan=function(t){var r=new wt(t.shape,rSe);return this.compileAndRun(r,[t])},e.prototype.atan2=function(t,r){var s=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new $n(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.sinh=function(t){var r=new wt(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.cosh=function(t){var r=new wt(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.tanh=function(t){var r=new wt(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[t])},e.prototype.asinh=function(t){var r=new wt(t.shape,sSe);return this.compileAndRun(r,[t])},e.prototype.acosh=function(t){var r=new wt(t.shape,aSe);return this.compileAndRun(r,[t])},e.prototype.atanh=function(t){var r=new wt(t.shape,oSe);return this.compileAndRun(r,[t])},e.prototype.erf=function(t){var r=new wt(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[t])},e.prototype.step=function(t,r){var s=new wt(t.shape,function(a){return a===void 0&&(a=0),oo+`
    return x > 0.0 ? 1.0 : float(`+a+`);
  `}(r));return this.compileAndRun(s,[t])},e.prototype.conv2dByMatMul=function(t,r,s,a,o,i){var u=t.shape,l=this.texData.get(t.dataId),c=s.inChannels,d=u[0]*u[1]*u[2],p=s.outChannels,m=s.dataFormat==="channelsLast",v=(d===1||p===1)&&c>1e3,b=u[2]%2!=0&&!!l.isPacked;if(v||!Ne().getBool("WEBGL_LAZILY_UNPACK")||!Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!b){var y=m?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],w=this.reshape(t,[1,y,s.inChannels]),S=this.reshape(r,[1,s.inChannels,s.outChannels]);return this.reshape(this.fusedBatchMatMul({a:w,b:S,transposeA:!1,transposeB:!1,bias:a,activation:o,preluActivationWeights:i}),s.outShape)}var N=m?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),C={dataId:t.dataId,shape:[1,N,s.inChannels],dtype:t.dtype},T=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,X(Wy(l.shape,C.shape),function(){return"packed reshape "+l.shape+" to "+C.shape+" isn't free"});var E=this.reshape(r,[1,s.inChannels,s.outChannels]),$=this.fusedBatchMatMul({a:C,b:E,transposeA:!1,transposeB:!1,bias:a,activation:o,preluActivationWeights:i}),_=this.texData.get($.dataId);return X(_.isPacked,function(){return"batchMatMul result is expected to be packed"}),l.shape=T,_.shape=s.outShape,ue.makeTensorFromDataId($.dataId,s.outShape,$.dtype)},e.prototype.conv2dWithIm2Row=function(t,r,s,a,o,i){var u=s.filterWidth,l=s.filterHeight,c=s.inChannels,d=s.outWidth,p=s.outHeight,m=s.dataFormat==="channelsLast",v=u*l*c,b=p*d,y=[v,b],w=t.squeeze([0]),S=r.reshape([1,v,-1]),N=new S2e(y,w.shape,s),C=this.compileAndRun(N,[w]).reshape([1,y[0],y[1]]),T=a!=null,E=i!=null,$=o?qy(o,!0):null,_=new HS(C.shape,[1,b,s.outChannels],!0,!1,T,$,E),R=[C,S];a&&R.push(a),E&&R.push(i);var D=this.compileAndRun(_,R);return m?D.reshape([1,p,d,s.outChannels]):D.reshape([1,s.outChannels,p,d])},e.prototype.fusedConv2d=function(t){var r=t.input,s=t.filter,a=t.convInfo,o=t.bias,i=t.activation,u=t.preluActivationWeights;if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(r,s,a,o,i,u);if(Ne().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,s,a,o,i,u);var l=o!=null,c=u!=null,d=i?qy(i,!1):null,p=new KO(a,l,d,c),m=[r,s];return o&&m.push(o),u&&m.push(u),this.compileAndRun(p,m)},e.prototype.conv2d=function(t,r,s){if(s.filterHeight===1&&s.filterWidth===1&&s.dilationHeight===1&&s.dilationWidth===1&&s.strideHeight===1&&s.strideWidth===1&&(s.padInfo.type==="SAME"||s.padInfo.type==="VALID"))return this.conv2dByMatMul(t,r,s);if(Ne().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,r,s);var a=new KO(s);return this.compileAndRun(a,[t,r])},e.prototype.conv2dDerInput=function(t,r,s){var a=new Pwe(s);return this.compileAndRun(a,[t,r])},e.prototype.conv2dDerFilter=function(t,r,s){var a=new Lwe(s);return this.compileAndRun(a,[t,r])},e.prototype.fusedDepthwiseConv2D=function(t){var r,s=t.input,a=t.filter,o=t.convInfo,i=t.bias,u=t.activation,l=t.preluActivationWeights,c=Ne().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,d=u?qy(u,c):null,p=[s,a],m=i!=null,v=l!=null;return m&&p.push(i),v&&p.push(l),c?(r=new YO(o,m,d,v),this.compileAndRun(r,p)):(r=new XO(o,m,d,v),this.compileAndRun(r,p))},e.prototype.depthwiseConv2D=function(t,r,s){var a;return Ne().getBool("WEBGL_PACK_DEPTHWISECONV")&&s.strideWidth<=2&&s.outChannels/s.inChannels==1?(a=new YO(s),this.compileAndRun(a,[t,r])):(a=new XO(s),this.compileAndRun(a,[t,r]))},e.prototype.depthwiseConv2DDerInput=function(t,r,s){var a=new Uwe(s);return this.compileAndRun(a,[t,r])},e.prototype.depthwiseConv2DDerFilter=function(t,r,s){var a=new Vwe(s);return this.compileAndRun(a,[t,r])},e.prototype.conv3d=function(t,r,s){var a=new Wwe(s);return this.compileAndRun(a,[t,r])},e.prototype.conv3dDerInput=function(t,r,s){var a=new zwe(s);return this.compileAndRun(a,[t,r])},e.prototype.conv3dDerFilter=function(t,r,s){var a=new Bwe(s);return this.compileAndRun(a,[t,r])},e.prototype.maxPool=function(t,r){var s=new jS(r,"max",!1);return this.compileAndRun(s,[t])},e.prototype.avgPool=function(t,r){var s=new jS(r,"avg",!1);return this.compileAndRun(s,[t],"float32")},e.prototype.maxPoolBackprop=function(t,r,s,a){var o=new jS(a,"max",!0),i=this.compileAndRun(o,[r]),u=new T2e(a),l=this.compileAndRun(u,[t,i],r.dtype);return i.dispose(),l},e.prototype.avgPoolBackprop=function(t,r,s){var a=new Twe(s);return this.compileAndRun(a,[t],r.dtype)},e.prototype.cast=function(t,r){return QV(t,r,this)},e.prototype.unstack=function(t,r){for(var s=t.shape[r],a=new Array(t.rank-1),o=0,i=0;i<t.rank;i++)i!==r&&(a[o++]=t.shape[i]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[r]=1;var c=new Array(s);for(i=0;i<c.length;i++)u[r]=i,c[i]=this.slice(t,u,l).reshape(a);return c},e.prototype.avgPool3d=function(t,r){var s=new qS(r,"avg",!1);return this.compileAndRun(s,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,r,s){var a=new Iwe(s);return this.compileAndRun(a,[t],r.dtype)},e.prototype.maxPool3d=function(t,r){var s=new qS(r,"max",!1);return this.compileAndRun(s,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,r,s,a){var o=new qS(a,"max",!0),i=this.compileAndRun(o,[r]),u=new I2e(a),l=this.compileAndRun(u,[t,i],r.dtype);return i.dispose(),l},e.prototype.reshape=function(t,r){var s=this.texData.get(t.dataId);if(s.isPacked&&!Wy(t.shape,r)&&(s.texture===null||!Wy(s.shape,r))){var a=this.packedReshape(t,r);return ue.makeTensorFromDataId(a.dataId,a.shape,a.dtype)}return bN(t,r)},e.prototype.resizeBilinear=function(t,r,s,a){var o=Ne().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new L2e(t.shape,r,s,a):new M2e(t.shape,r,s,a);return this.compileAndRun(o,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,r,s){var a=new F2e(t,r,s);return this.compileAndRun(a,[t])},e.prototype.resizeNearestNeighbor=function(t,r,s,a){var o=new B2e(t.shape,r,s,a);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,r,s){var a=new P2e(t,r,s);return this.compileAndRun(a,[t])},e.prototype.multinomial=function(t,r,s,a){var o=r?t:Oi(t),i=o.shape[0],u=o.shape[1],l=new E2e(i,u,s),c=l.getCustomSetupFunc(a);return this.compileAndRun(l,[o],"int32",c)},e.prototype.oneHot=function(t,r,s,a){var o=new _2e(t.size,r,s,a);return this.compileAndRun(o,[t])},e.prototype.diag=function(t){var r=new Xwe(t.size);return this.compileAndRun(r,[t])},e.prototype.nonMaxSuppression=function(t,r,s,a,o){return Xb("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),FI(t.dataSync(),r.dataSync(),s,a,o)},e.prototype.cropAndResize=function(t,r,s,a,o,i){var u=new Gwe(t.shape,r.shape,a,o,i);return this.compileAndRun(u,[t,r,s],"float32")},e.prototype.depthToSpace=function(t,r,s){X(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var a=t.shape[0],o=s==="NHWC"?t.shape[1]:t.shape[2],i=s==="NHWC"?t.shape[2]:t.shape[3],u=s==="NHWC"?t.shape[3]:t.shape[1],l=o*r,c=i*r,d=u/(r*r),p=new Kwe(s==="NHWC"?[a,l,c,d]:[a,d,l,c],r,s);return this.compileAndRun(p,[t])},e.prototype.split=function(t,r,s){return tU(t,r,s)},e.prototype.scatterND=function(t,r,s){var a=t0(0,t,s),o=a.sliceRank,i=a.numUpdates,u=a.sliceSize,l=a.strides,c=a.outputSize,d=[c/u,u],p=t.reshape([i,o]),m=r.reshape([i,u]);if(c===0)return bN(Ur([]),s);var v=Le(0),b=new e3(i,o,p.rank,m.rank,l,d);return this.compileAndRun(b,[m,p,v]).reshape(s)},e.prototype.sparseToDense=function(t,r,s,a){var o=t0(0,t,s),i=o.sliceRank,u=o.numUpdates,l=o.strides,c=o.outputSize,d=new e3(u,i,t.rank,r.rank,l,[c,1]);return this.compileAndRun(d,[r,t,a]).reshape(s)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,r){var s=this.texData.get(t.dataId),a=new QO(e2e,t.shape,r),o=new QO(t2e,t.shape,r),i=[this.makeComplexComponentTensorInfo(t,s.complexTensors.real),this.makeComplexComponentTensorInfo(t,s.complexTensors.imag)],u=this.compileAndRun(a,i),l=this.compileAndRun(o,i),c=this.complex(u,l).as2D(t.shape[0],t.shape[1]);return u.dispose(),l.dispose(),c},e.prototype.gatherND=function(t,r){var s=r.shape,a=s[s.length-1],o=HV(t,r),i=o[0],u=o[1],l=o[2],c=o[3],d=r.reshape([u,a]),p=t.reshape([t.size/l,l]),m=new s2e(a,c,[u,l]);return this.compileAndRun(m,[p,d]).reshape(i)},e.prototype.fill=function(t,r,s){if((s=s||tv(r))==="string"){var a=Hb(s,Je(t));return a.fill(r),ue.makeTensor(a,t,s,this)}var o=new n2e(t,r),i=o.getCustomSetupFunc(r);return this.compileAndRun(o,[],s,i)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,r,s){return JV(t,r,s)},e.prototype.makeTensorInfo=function(t,r){var s=this.write(null,t,r);return this.texData.get(s).usage=null,{dataId:s,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r){var s=this.makeTensorInfo(t,r).dataId;return ue.makeTensorFromDataId(s,t,r,this)},e.prototype.unpackTensor=function(t){var r=new uSe(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new R2e(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,r){var s=[qb(t.shape)].concat(Kb(t.shape)),a={dtype:t.dtype,shape:s,dataId:t.dataId},o=[qb(r)].concat(Kb(r)),i=new O2e(o,s),u=this.runWebGLProgram(i,[a],t.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},e.prototype.decode=function(t){var r,s=this.texData.get(t),a=s.isPacked,o=s.shape,i=s.dtype,u=VS(o);return r=a?new qwe(u):new jwe(u),{dtype:i,shape:o,dataId:this.runWebGLProgram(r,[{shape:u,dtype:i,dataId:t}],i,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,r,s,a,o){var i=this;o===void 0&&(o=!1);var u=this.makeTensorInfo(t.outputShape,s),l=this.texData.get(u.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===lm.DENSE){var c=Lp(t.outputShape);l.texShape=c.map(function(N){return 2*N})}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),Je(u.shape)===0)return l.values=im(u.dtype,0),u;var d=[],p=r.map(function(N){if(N.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var C=i.texData.get(N.dataId);if(C.texture==null){if(!t.packedInputs&&Je(N.shape)<=Ne().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:N.shape,texData:null,isUniform:!0,uniformValues:C.values};t.packedInputs&&(C.isPacked=!0,C.shape=N.shape)}else if(!!C.isPacked!=!!t.packedInputs)N=C.isPacked?i.unpackTensor(N):i.packTensor(N),d.push(N),C=i.texData.get(N.dataId);else if(C.isPacked&&!Wy(C.shape,N.shape)){var T=N,E=N.shape;N.shape=C.shape,N=i.packedReshape(N,E),d.push(N),C=i.texData.get(N.dataId),T.shape=E}return i.uploadToGPU(N.dataId),{shape:N.shape,texData:C,isUniform:!1}});this.uploadToGPU(u.dataId);var m,v={shape:u.shape,texData:l,isUniform:!1},b=function(N,C,T){var E="";C.concat(T).forEach(function(R){var D=R.texData!=null&&R.texData.slice!=null&&R.texData.slice.flatOffset>0,A=R.isUniform?"uniform":R.texData.texShape;E+=R.shape+"_"+A+"_"+D});var $=N.userCode,_=N.constructor.name;return _+="_"+E+"_"+$}(t,p,v),y=this.getAndSaveBinary(b,function(){return function(N,C,T,E){var $=C.userCode,_=T.map(function(z,Y){var L={logicalShape:z.shape,texShape:z.isUniform?null:z.texData.texShape,isUniform:z.isUniform,isPacked:!z.isUniform&&z.texData.isPacked,flatOffset:null};return z.texData!=null&&z.texData.slice!=null&&z.texData.slice.flatOffset>0&&(L.flatOffset=z.texData.slice.flatOffset),{name:C.variableNames[Y],shapeInfo:L}}),R=_.map(function(z){return z.shapeInfo}),D={logicalShape:E.shape,texShape:E.texData.texShape,isUniform:!1,isPacked:E.texData.isPacked,flatOffset:null},A=xwe(_,D,$,C.packedInputs),M=N.createProgram(A),H=null,j=N.getUniformLocation(M,"NAN",!1);Ne().getNumber("WEBGL_VERSION")===1&&(H=N.getUniformLocation(M,"INFINITY",!1));for(var G={},P=0;P<C.variableNames.length;P++){var V=C.variableNames[P];G[V]=N.getUniformLocation(M,V,!1),G["offset"+V]=N.getUniformLocation(M,"offset"+V,!1)}return{program:C,source:A,webGLProgram:M,uniformLocations:G,inShapeInfos:R,outShapeInfo:D,infLoc:H,nanLoc:j}}(i.gpgpu,t,p,v)}),w=this.activeTimers!=null;if(w&&(m=this.startTimer()),function(N,C,T,E,$){JO(C.inShapeInfos,T),JO([C.outShapeInfo],[E]);var _=E.texData.texture,R=E.texData.texShape;E.texData.isPacked?N.setOutputPackedMatrixTexture(_,R[0],R[1]):N.setOutputMatrixTexture(_,R[0],R[1]),N.setProgram(C.webGLProgram),Ne().getNumber("WEBGL_VERSION")===1&&C.infLoc!==null&&N.gl.uniform1f(C.infLoc,1/0),C.nanLoc!==null&&N.gl.uniform1f(C.nanLoc,NaN),T.forEach(function(D,A){var M=C.program.variableNames[A],H=C.uniformLocations[M],j=C.uniformLocations["offset"+M];if(H!=null)if(D.isUniform)if(Je(D.shape)<2)N.gl.uniform1f(H,D.uniformValues[0]);else{var G=D.uniformValues;G instanceof Float32Array||(G=new Float32Array(G)),N.gl.uniform1fv(H,G)}else D.texData.slice!=null&&j!=null&&N.gl.uniform1i(j,D.texData.slice.flatOffset),N.setInputMatrixTexture(D.texData.texture,H,A)}),$!=null&&$(N,C.webGLProgram),N.executeProgram()}(this.gpgpu,y,p,v,a),d.forEach(function(N){return i.disposeData(N.dataId)}),w&&(m=this.endTimer(m),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(m)})),!Ne().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){var S=this.unpackTensor(u);return this.disposeData(u.dataId),S}return u},e.prototype.compileAndRun=function(t,r,s,a,o){o===void 0&&(o=!1),s=s||r[0].dtype;var i=this.runWebGLProgram(t,r,s,a,o);return ue.makeTensorFromDataId(i.dataId,i.shape,i.dtype)},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(Ne().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Ue(function(){if(!Ne().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=Ne().getBool("DEBUG");Ne().set("DEBUG",!1);var s=t.abs(Le(1e-8)).dataSync()[0];if(Ne().set("DEBUG",r),s>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var r,s=this.texData.get(t),a=s.shape,o=s.dtype,i=s.values,u=s.texture,l=s.usage,c=s.isPacked;if(u==null){var d,p=this.activeTimers!=null;p&&(d=bo());var m=s.texShape;if(m==null&&(m=g1e(a,c),s.texShape=m),i!=null){var v=VS(a),b=void 0,y=m[1],w=m[0],S=i instanceof Uint8Array;c?(y=(r=rv(m[0],m[1]))[0],w=r[1],b=new Jwe(v,[w,y],S)):b=new Qwe(v,[w,y],S);var N=this.makeTensorInfo([w,y],o);this.texData.get(N.dataId).usage=S?ra.PIXELS:ra.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(N.dataId),y,w,i);var C=this.runWebGLProgram(b,[N],o,null,!0),T=this.texData.get(C.dataId);s.texture=T.texture,s.texShape=T.texShape,s.isPacked=T.isPacked,s.usage=T.usage,this.disposeData(N.dataId),this.texData.delete(C.dataId),s.values=null,p&&(this.uploadWaitMs+=bo()-d)}else{var E=this.acquireTexture(m,l,o,c);s.texture=E}}},e.prototype.convertAndCacheOnCPU=function(t,r){var s=this.texData.get(t),a=s.dtype;return this.releaseGPUData(t),r!=null&&(s.values=function(o,i){if(i==="float32"||i==="complex64")return o;if(i==="int32"||i==="bool"){for(var u=i==="int32"?new Int32Array(o.length):new Uint8Array(o.length),l=0;l<u.length;++l)u[l]=Math.round(o[l]);return u}throw new Error("Unknown dtype "+i)}(r,a)),s.values},e.prototype.acquireTexture=function(t,r,s,a){if(this.numBytesInGPU+=this.computeBytes(t,s),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,a)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*IV(r)},e}(YV);OV()&&ue.registerBackend("webgl",function(){return new cSe},2);var hSe=se({square_:function(n){var e=q(n,"x","square"),t=[e];return ue.runKernelFunc(function(r,s){return s([e]),r.square(e)},{x:e},null,"Square",{},t,[])}}),hm="SquaredDifference",mU=se({squaredDifference_:function(n,e){var t,r=q(n,"a","squaredDifference"),s=q(e,"b","squaredDifference");t=Rn(r,s),r=t[0],s=t[1],Mt(r.shape,s.shape);var a={a:r,b:s},o=[r,s];return ue.runKernelFunc(function(i,u){var l=i.squaredDifference(r,s);return u([r,s]),l},a,function(i,u){var l=u[0],c=u[1],d=Le(2);return{a:function(){return i.mul(l.sub(c).mul(d))},b:function(){return i.mul(c.sub(l).mul(d))}}},hm,{},o,[])}}),dSe=se({abs_:function(n){var e=q(n,"x","abs");return e.dtype==="complex64"?ue.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):ue.runKernelFunc(function(t,r){var s=t.abs(e);return r([e]),s},{x:e},function(t,r){var s=r[0];return{x:function(){return t.mul(s.toFloat().step(-1))}}},"Abs")}}),fSe=se({acos_:function(n){var e=q(n,"x","acos");return ue.runKernelFunc(function(t,r){var s=t.acos(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.divStrict(Le(1).sub(s.toFloat().square()).sqrt()).neg()}}})}}),pSe=se({acosh_:function(n){var e=q(n,"x","acosh");return ue.runKernelFunc(function(t,r){var s=t.acosh(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.divStrict(s.toFloat().square().sub(1).sqrt())}}})}}),mSe=se({asin_:function(n){var e=q(n,"x","asin");return ue.runKernelFunc(function(t,r){var s=t.asin(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.divStrict(Le(1).sub(s.toFloat().square()).sqrt())}}})}}),gSe=se({asinh_:function(n){var e=q(n,"x","asinh");return ue.runKernelFunc(function(t,r){var s=t.asinh(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.divStrict(Le(1).add(s.toFloat().square()).sqrt())}}})}}),vSe=se({atan_:function(n){var e=q(n,"x","atan");return ue.runKernelFunc(function(t,r){var s=t.atan(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.div(s.toFloat().square().add(1))}}})}}),ySe=se({atanh_:function(n){var e=q(n,"x","atanh");return ue.runKernelFunc(function(t,r){var s=t.atanh(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.div(Le(1).sub(s.toFloat().square()))}}})}}),bSe=se({ceil_:function(n){var e=q(n,"x","ceil");return ue.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return zt(t)}}})}}),VI=se({clipByValue_:function(n,e,t){var r=q(n,"x","clipByValue");X(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."});var s=[r],a={min:e,max:t};return ue.runKernelFunc(function(o,i){var u=o.clip(r,e,t);return i([r]),u},{x:r},function(o,i){var u=i[0];return{x:function(){return o.where(u.greaterEqual(e).logicalAnd(u.lessEqual(t)),zt(o))}}},"ClipByValue",a,s)}}),xSe=se({cos_:function(n){var e=q(n,"x","cos"),t=[e];return ue.runKernelFunc(function(r,s){var a=r.cos(e);return s([e]),a},{x:e},function(r,s){var a=s[0];return{x:function(){return a.toFloat().sin().neg().mul(r)}}},"Cos",{},t)}}),wSe=se({cosh_:function(n){var e=q(n,"x","cosh");return ue.runKernelFunc(function(t,r){var s=t.cosh(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return s.toFloat().sinh().mulStrict(t)}}})}}),SSe=se({erf_:function(n){var e=q(n,"x","erf");return X(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),ue.runKernelFunc(function(t,r){var s=t.erf(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.mul(s.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),wN=se({exp_:function(n){var e=q(n,"x","exp");return ue.runKernelFunc(function(t,r){var s=t.exp(e);return r([s]),s},{x:e},function(t,r){return{x:function(){return t.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),CSe=se({expm1_:function(n){var e=q(n,"x","expm1");return ue.runKernelFunc(function(t,r){var s=t.expm1(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.mul(s.exp())}}})}}),NSe=se({floor_:function(n){var e=q(n,"x","floor");return ue.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return zt(t)}}})}}),kSe=se({log_:function(n){var e=q(n,"x","log"),t=[e];return ue.runKernelFunc(function(r,s){var a=r.log(e);return s([e]),a},{x:e},function(r,s){var a=s[0];return{x:function(){return r.div(a.toFloat())}}},"Log",{},t)}}),TSe=se({log1p_:function(n){var e=q(n,"x","log1p");return ue.runKernelFunc(function(t,r){var s=t.log1p(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.div(s.add(1))}}})}}),ISe=se({logSigmoid_:function(n){var e=q(n,"x","logSigmoid");return ue.runKernelFunc(function(t,r){var s=t.softplus(e.neg()).neg();return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.mul(s.neg().sigmoid())}}})}}),a0=se({neg_:function(n){var e=q(n,"x","neg"),t=[e];return ue.runKernelFunc(function(r){return r.neg(e)},{x:e},function(r){return{x:function(){return r.neg()}}},"Neg",{},t)}}),ESe=se({reciprocal_:function(n){var e=q(n,"x","reciprocal");return ue.runKernelFunc(function(t,r){var s=t.reciprocal(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.div(s.square().neg())}}})}}),_Se=se({round_:function(n){var e=q(n,"x","round");return ue.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return zt(t)}}})}}),gU=se({rsqrt_:function(n){var e=q(n,"x","rsqrt"),t=[e];return ue.runKernelFunc(function(r,s){var a=r.rsqrt(e);return s([e]),a},{x:e},function(r,s){var a=s[0];return{x:function(){return r.div(a.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},t)}}),vU=se({sigmoid_:function(n){var e=q(n,"x","sigmoid");return ue.runKernelFunc(function(t,r){var s=t.sigmoid(e);return r([s]),s},{x:e},function(t,r){var s=r[0];return{x:function(){return t.mul(s.mul(Le(1).sub(s)))}}},"Sigmoid")}}),RSe=se({sign_:function(n){var e=q(n,"x","sign");return ue.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return zt(t)}}})}}),ASe=se({isNaN_:function(n){var e=q(n,"x","isNaN");return ue.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return zt(t)}}})}}),DSe=se({isInf_:function(n){var e=q(n,"x","isInf");return ue.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return zt(t)}}})}}),$Se=se({isFinite_:function(n){var e=q(n,"x","isFinite");return ue.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return zt(t)}}})}}),OSe=se({sin_:function(n){var e=q(n,"x","sin"),t=[e];return ue.runKernelFunc(function(r,s){var a=r.sin(e);return s([e]),a},{x:e},function(r,s){var a=s[0];return{x:function(){return a.toFloat().cos().mul(r)}}},"Sin",{},t)}}),FSe=se({sinh_:function(n){var e=q(n,"x","sinh");return ue.runKernelFunc(function(t,r){var s=t.sinh(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return s.toFloat().cosh().mulStrict(t)}}})}}),MSe=se({softplus_:function(n){var e=q(n,"x","softplus");return ue.runKernelFunc(function(t,r){var s=t.softplus(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.mul(s.sigmoid())}}})}}),LSe=se({sqrt_:function(n){var e=q(n,"x","sqrt");return ue.runKernelFunc(function(t,r){var s=t.sqrt(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.div(s.toFloat().sqrt().mul(2))}}})}}),PSe=se({step_:function(n,e){e===void 0&&(e=0);var t=q(n,"x","step");return ue.runKernelFunc(function(r){return r.step(t,e)},{$x:t},function(r){return{$x:function(){return zt(r)}}})}}),BSe=se({tan_:function(n){var e=q(n,"x","tan");return ue.runKernelFunc(function(t,r){var s=t.tan(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.div(s.cos().square())}}})}}),zSe=se({tanh_:function(n){var e=q(n,"x","tanh");return ue.runKernelFunc(function(t,r){var s=t.tanh(e);return r([s]),s},{x:e},function(t,r){var s=r[0];return{x:function(){return Le(1).sub(s.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}});function yU(n,e,t,r,s,a){var o,i,u=q(n,"x","batchNorm"),l=q(e,"mean","batchNorm"),c=q(t,"variance","batchNorm");return s!=null&&(o=q(s,"scale","batchNorm")),r!=null&&(i=q(r,"offset","batchNorm")),X(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),X(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),X(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),o!=null&&X(o.rank===2||o.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."}),i!=null&&X(i.rank===2||i.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+i.rank+"."}),av(u,l,c,i,o,a)}function bU(n,e,t,r,s,a){var o,i,u=q(n,"x","batchNorm"),l=q(e,"mean","batchNorm"),c=q(t,"variance","batchNorm");return s!=null&&(o=q(s,"scale","batchNorm")),r!=null&&(i=q(r,"offset","batchNorm")),X(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),X(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),X(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),o!=null&&X(o.rank===3||o.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."}),i!=null&&X(i.rank===3||i.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+i.rank+"."}),av(u,l,c,i,o,a)}function xU(n,e,t,r,s,a){var o,i,u=q(n,"x","batchNorm"),l=q(e,"mean","batchNorm"),c=q(t,"variance","batchNorm");return s!=null&&(o=q(s,"scale","batchNorm")),r!=null&&(i=q(r,"offset","batchNorm")),X(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),X(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),X(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),o!=null&&X(o.rank===4||o.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."}),i!=null&&X(i.rank===4||i.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+i.rank+"."}),av(u,l,c,i,o,a)}function av(n,e,t,r,s,a){a==null&&(a=.001);var o,i,u,l=q(n,"x","batchNorm"),c=q(e,"mean","batchNorm"),d=q(t,"variance","batchNorm");s!=null&&(o=q(s,"scale","batchNorm")),r!=null&&(i=q(r,"offset","batchNorm")),X(c.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),X(i==null||c.rank===i.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),X(o==null||c.rank===o.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l;var p=[l,c,d,o];return ue.runKernelFunc(function(m,v){var b=m.batchNormalization(u,Ky(c),Ky(d),a,Ky(o),Ky(i));return v([l,c,d,o]),b},{x:l,mean:c,variance:d,scale:o,offset:i},function(m,v){var b=v,y=b[0],w=b[1],S=b[2],N=b[3],C=N??Le(1),T=mr(w.shape,u.shape),E=[];if(w.rank===1){for(var $=0;$<u.shape.length-1;++$)E.push(u.shape[$]);E.push(1)}var _=y.sub(w),R=m.mul(C),D=gU(S.add(Le(a))),A=D.mul(D).mul(D).mul(Le(-.5));return{x:function(){return w.rank===1?m.mul($h(D.as4D(1,1,1,w.shape[0]),E)).mul(C).reshape(y.shape):m.mul(D).mul(C).reshape(y.shape)},mean:function(){var M=D.mul(Le(-1)).mul(R);return w.rank===1&&(M=M.sum(T)),M.reshape(w.shape)},variance:function(){var M=A.mul(_).mul(R);return w.rank===1&&(M=M.sum(T)),M.reshape(w.shape)},scale:function(){var M=_.mul(D),H=m.mul(M);return w.rank===1&&(H=H.sum(T)),H.reshape(w.shape)},offset:function(){var M=m;return w.rank===1&&(M=M.sum(T)),M.reshape(w.shape)}}},"BatchNormalization",{varianceEpsilon:a},p).reshape(l.shape)}function Ky(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function D1(){FV("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var VSe=se({batchNormalization2d_:function(n,e,t,r,s,a){return r===void 0&&(r=.001),D1(),yU(n,e,t,a,s,r)}}),USe=se({batchNormalization3d_:function(n,e,t,r,s,a){return r===void 0&&(r=.001),D1(),bU(n,e,t,a,s,r)}}),WSe=se({batchNormalization4d_:function(n,e,t,r,s,a){return r===void 0&&(r=.001),D1(),xU(n,e,t,a,s,r)}}),GSe=se({batchNormalization_:function(n,e,t,r,s,a){return r===void 0&&(r=.001),D1(),av(n,e,t,a,s,r)}}),wU=se({batchNorm_:av}),HSe=se({batchNorm2d_:yU}),jSe=se({batchNorm3d_:bU}),qSe=se({batchNorm4d_:xU}),$1=se({logicalAnd_:function(n,e){var t=q(n,"a","logicalAnd","bool"),r=q(e,"b","logicalAnd","bool");return Mt(t.shape,r.shape),ue.runKernelFunc(function(s){return s.logicalAnd(t,r)},{a:t,b:r},null,"LogicalAnd")}}),KSe=se({logicalNot_:function(n){var e=q(n,"x","logicalNot","bool");return ue.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),SU=se({logicalOr_:function(n,e){var t=q(n,"a","logicalOr","bool"),r=q(e,"b","logicalOr","bool");return Mt(t.shape,r.shape),ue.runKernelFunc(function(s){return s.logicalOr(t,r)},{$a:t,$b:r})}}),XSe=se({logicalXor_:function(n,e){var t=q(n,"a","logicalXor","bool"),r=q(e,"b","logicalXor","bool");return Mt(t.shape,r.shape),SU(n,e).logicalAnd($1(n,e).logicalNot())}}),ic=se({where_:function(n,e,t){var r=q(e,"a","where"),s=q(t,"b","where"),a=q(n,"condition","where","bool");return qt(r.shape,s.shape,"Error in where: "),a.rank===1?X(a.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):qt(a.shape,s.shape,"Error in where: "),ue.runKernelFunc(function(o,i){var u=o.select(a,r,s);return i([a]),u},{$condition:a,$a:r,$b:s},function(o,i){var u=i[0];return{$condition:function(){return zt(u).toFloat()},$a:function(){return o.mul(u.cast(o.dtype))},$b:function(){return o.mul(u.logicalNot().cast(o.dtype))}}})}}),CU=function(n){return Ke(this,void 0,void 0,function(){var e,t,r;return Xe(this,function(s){switch(s.label){case 0:return[4,(e=q(n,"condition","whereAsync","bool")).data()];case 1:return t=s.sent(),r=LI(e.shape,t),n!==e&&e.dispose(),[2,r]}})})},At=se({add_:function(n,e){var t,r=q(n,"a","add"),s=q(e,"b","add");t=Rn(r,s),r=t[0],s=t[1];var a=Mt(r.shape,s.shape);return ue.runKernelFunc(function(o){return o.add(r,s)},{a:r,b:s},function(o){return{a:function(){var i=o,u=mr(r.shape,a);return u.length>0&&(i=i.sum(u)),i.reshape(r.shape)},b:function(){var i=o,u=mr(s.shape,a);return u.length>0&&(i=i.sum(u)),i.reshape(s.shape)}}},"Add")}}),YSe=se({addN_:function(n){X(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),X(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var e=n.map(function(s,a){return q(s,"tensors"+a,"addN")}),t=e[0];e.forEach(function(s){if(s.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(s){if(!_r(s.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return ue.runKernelFunc(function(s){return s.addN(e)},r,function(s){var a={};return e.forEach(function(o,i){a[i]=function(){return s.clone()}}),a},"AddN")}}),ZSe=se({addStrict_:function(n,e){var t=q(n,"a","addStrict"),r=q(e,"b","addStrict");return qt(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),QSe=se({atan2_:function(n,e){var t,r=q(n,"a","atan2"),s=q(e,"b","atan2");t=Rn(r,s),r=t[0],s=t[1];var a=Mt(r.shape,s.shape);return ue.runKernelFunc(function(o,i){var u=o.atan2(r,s);return i([r,s]),u},{$a:r,$b:s},function(o,i){var u=i[0],l=i[1];return{$a:function(){var c=At(u.square(),l.square()),d=o.mul(l.div(c)),p=mr(u.shape,a);return p.length>0&&(d=d.sum(p)),d.reshape(u.shape)},$b:function(){var c=At(u.square(),l.square()),d=a0(o.mul(u.div(c))),p=mr(l.shape,a);return p.length>0&&(d=d.sum(p)),d.reshape(l.shape)}}})}}),Ga=se({div_:function(n,e){var t,r=q(n,"a","div"),s=q(e,"b","div");if(t=Rn(r,s),r=t[0],s=t[1],r.dtype==="int32"&&s.dtype==="int32")return NU(r,s);var a=Mt(r.shape,s.shape);return ue.runKernelFunc(function(o,i){var u=o.realDivide(r,s);return i([r,s]),u},{a:r,b:s},function(o,i){var u=i[0],l=i[1];return{a:function(){var c=o.div(l.toFloat()),d=mr(u.shape,a);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=o.mul(u.toFloat()),d=mr(l.shape,a);d.length>0&&(c=c.sum(d).reshape(l.shape));var p=l.square();return c.div(p.toFloat()).neg()}}},"Div")}}),JSe=se({divNoNan_:function(n,e){var t,r=q(n,"a","div"),s=q(e,"b","div");r=(t=Rn(r,s))[0],s=t[1];var a=Ga(r,s),o=zt(a),i=s.equal(o);return ic(i,o,a)}}),eCe=se({divStrict_:function(n,e){var t=q(n,"a","div"),r=q(e,"b","div");return qt(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),NU=se({floorDiv_:function(n,e){var t,r=q(n,"a","floorDiv"),s=q(e,"b","floorDiv");t=Rn(r,s),r=t[0],s=t[1];var a=Mt(r.shape,s.shape);return ue.runKernelFunc(function(o,i){var u=o.floorDiv(r,s);return i([r,s]),u},{a:r,b:s},function(o,i){var u=i[0],l=i[1];return{a:function(){var c=o.div(l.toFloat()),d=mr(u.shape,a);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=o.mul(u.toFloat()),d=mr(l.shape,a);d.length>0&&(c=c.sum(d).reshape(l.shape));var p=l.square();return c.div(p.toFloat()).neg()}}},"FloorDiv")}}),UI=se({maximum_:function(n,e){var t,r=q(n,"a","maximum"),s=q(e,"b","maximum");return t=Rn(r,s),r=t[0],s=t[1],r.dtype==="bool"&&(r=r.toInt(),s=s.toInt()),Mt(r.shape,s.shape),ue.runKernelFunc(function(a,o){var i=a.maximum(r,s);return o([r,s]),i},{a:r,b:s},function(a,o){var i=o[0],u=o[1];return{a:function(){return a.mul(i.greaterEqual(u).toFloat())},b:function(){return a.mul(i.less(u).toFloat())}}},"Maximum")}}),tCe=se({maximumStrict_:function(n,e){var t=q(n,"a","maximumStrict"),r=q(e,"b","maximumStrict");return qt(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),kU=se({minimum_:function(n,e){var t,r=q(n,"a","minimum"),s=q(e,"b","minimum");return t=Rn(r,s),r=t[0],s=t[1],r.dtype==="bool"&&(r=r.toInt(),s=s.toInt()),Mt(r.shape,s.shape),ue.runKernelFunc(function(a,o){var i=a.minimum(r,s);return o([r,s]),i},{a:r,b:s},function(a,o){var i=o[0],u=o[1];return{a:function(){return a.mul(i.lessEqual(u).toFloat())},b:function(){return a.mul(i.greater(u).toFloat())}}},"Minimum")}}),nCe=se({minimumStrict_:function(n,e){var t=q(n,"a","minimumStrict"),r=q(e,"b","minimumStrict");return qt(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),rCe=se({mod_:function(n,e){var t,r=q(n,"a","mod"),s=q(e,"b","mod");t=Rn(r,s),r=t[0],s=t[1];var a=Mt(r.shape,s.shape);return ue.runKernelFunc(function(o,i){var u=o.mod(r,s);return i([r,s]),u},{$a:r,$b:s},function(o,i){var u=i[0],l=i[1];return{$a:function(){var c=mr(u.shape,a);return c.length>0?o.sum(c).reshape(u.shape):o},$b:function(){var c=o.mul(u.div(l).floor().neg()),d=mr(l.shape,a);return d.length>0?c.sum(d).reshape(l.shape):c}}})}}),sCe=se({modStrict_:function(n,e){var t=q(n,"a","modStrict"),r=q(e,"b","modStrict");return qt(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),as=se({mul_:function(n,e){var t,r=q(n,"a","mul"),s=q(e,"b","mul");t=Rn(r,s),r=t[0],s=t[1];var a=Mt(r.shape,s.shape);return ue.runKernelFunc(function(o,i){var u=o.multiply(r,s);return i([r,s]),u},{a:r,b:s},function(o,i){var u=i[0],l=i[1];return{a:function(){var c=o.mul(l.toFloat()),d=mr(u.shape,a);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=o.mul(u.toFloat()),d=mr(l.shape,a);return d.length>0?c.sum(d).reshape(l.shape):c}}},"Mul")}}),aCe=se({mulStrict_:function(n,e){var t=q(n,"a","mul"),r=q(e,"b","mul");return qt(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),o0=se({pow_:function(n,e){var t,r=q(n,"base","pow"),s=q(e,"exp","pow");t=Rn(r,s),r=t[0],s=t[1];var a=Mt(r.shape,s.shape),o=[r,s];return ue.runKernelFunc(function(i,u){var l=i.pow(r,s);return u([r,s,l]),l},{a:r,b:s},function(i,u){var l=u[0],c=u[1],d=u[2];return{a:function(){var p=c.toFloat(),m=i.mul(p.mul(l.pow(p.sub(Le(1))))),v=mr(l.shape,a);return v.length>0&&(m=m.sum(v)),m.reshape(l.shape)},b:function(){var p=l.greater(0),m=l.log().where(p,zt(l)),v=i.mul(d.mul(m)),b=mr(c.shape,a);return b.length>0&&(v=v.sum(b)),v.reshape(c.shape)}}},"Pow",{},o,[!0])}}),oCe=se({powStrict_:function(n,e){return qt(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),iCe=se({squaredDifferenceStrict_:function(n,e){var t=q(n,"a","squaredDifferenceStrict"),r=q(e,"b","squaredDifferenceStrict");return qt(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),gr=se({sub_:function(n,e){var t,r=q(n,"a","sub"),s=q(e,"b","sub");t=Rn(r,s),r=t[0],s=t[1];var a=Mt(r.shape,s.shape);return ue.runKernelFunc(function(o){return o.subtract(r,s)},{a:r,b:s},function(o){return{a:function(){var i=o,u=mr(r.shape,a);return u.length>0&&(i=i.sum(u)),i.reshape(r.shape)},b:function(){var i=o,u=mr(s.shape,a);return u.length>0&&(i=i.sum(u)),i.neg().reshape(s.shape)}}},"Sub")}}),uCe=se({subStrict_:function(n,e){var t=q(n,"a","subStrict"),r=q(e,"b","subStrict");return qt(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),TU=se({equal_:function(n,e){var t,r=q(n,"a","equal"),s=q(e,"b","equal");return t=Rn(r,s),r=t[0],s=t[1],Mt(r.shape,s.shape),ue.runKernelFunc(function(a){return a.equal(r,s)},{$a:r,$b:s})}}),lCe=se({equalStrict_:function(n,e){var t=q(n,"a","equalStrict"),r=q(e,"b","equalStrict");return qt(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),cCe=se({greater_:function(n,e){var t,r=q(n,"a","greater"),s=q(e,"b","greater");return t=Rn(r,s),r=t[0],s=t[1],Mt(r.shape,s.shape),ue.runKernelFunc(function(a){return a.greater(r,s)},{a:r,b:s},null,"Greater")}}),IU=se({greaterEqual_:function(n,e){var t,r=q(n,"a","greaterEqual"),s=q(e,"b","greaterEqual");return t=Rn(r,s),r=t[0],s=t[1],Mt(r.shape,s.shape),ue.runKernelFunc(function(a,o){var i=a.greaterEqual(r,s);return o([r,s]),i},{a:r,b:s},function(a,o){var i=o[0],u=o[1];return{a:function(){return zt(i)},b:function(){return zt(u)}}},"GreaterEqual")}}),hCe=se({greaterEqualStrict_:function(n,e){var t=q(n,"a","greaterEqualStrict"),r=q(e,"b","greaterEqualStrict");return qt(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),dCe=se({greaterStrict_:function(n,e){var t=q(n,"a","greaterStrict"),r=q(e,"b","greaterStrict");return qt(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),fCe=se({less_:function(n,e){var t,r=q(n,"a","less"),s=q(e,"b","less");return t=Rn(r,s),r=t[0],s=t[1],Mt(r.shape,s.shape),ue.runKernelFunc(function(a){return a.less(r,s)},{a:r,b:s},null,"Less")}}),pCe=se({lessEqual_:function(n,e){var t,r=q(n,"a","lessEqual"),s=q(e,"b","lessEqual");return t=Rn(r,s),r=t[0],s=t[1],Mt(r.shape,s.shape),ue.runKernelFunc(function(a,o){var i=a.lessEqual(r,s);return o([r,s]),i},{a:r,b:s},null,"LessEqual")}}),mCe=se({lessEqualStrict_:function(n,e){var t=q(n,"a","lessEqualStrict"),r=q(e,"b","lessEqualStrict");return qt(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),gCe=se({lessStrict_:function(n,e){var t=q(n,"a","lessStrict"),r=q(e,"b","lessStrict");return qt(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),vCe=se({notEqual_:function(n,e){var t,r=q(n,"a","notEqual"),s=q(e,"b","notEqual");return t=Rn(r,s),r=t[0],s=t[1],Mt(r.shape,s.shape),ue.runKernelFunc(function(a){return a.notEqual(r,s)},{a:r,b:s},null,"NotEqual")}}),yCe=se({notEqualStrict_:function(n,e){var t=q(n,"a","notEqualStrict"),r=q(e,"b","notEqualStrict");return qt(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function l3(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function c3(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var WI=se({gather_:function(n,e,t){t===void 0&&(t=0);var r=q(n,"x","gather"),s=q(e,"indices","gather","int32");t=br(t,r.shape)[0];var a=function(o,i,u){for(var l=o.shape[u],c=[],d=1,p=1,m=0;m<u;m++)c.push(o.shape[m]),d*=o.shape[m];for(m=0;m<i.rank;m++)c.push(i.shape[m]);for(m=u+1;m<o.rank;m++)c.push(o.shape[m]),p*=o.shape[m];return{batchSize:d,sliceSize:p,dimSize:l,outputShape:c}}(r,s,t);return ue.runKernelFunc(function(o,i){var u=o.gather(r,s.flatten(),t);return i([s]),u},{x:r,indices:s},function(o,i){var u=i[0];return{x:function(){var l=r.shape,c=u.size,d=l.slice(0,t),p=d.length,m=l.slice(t,l.length).slice(1),v=m.length,b=l3(0,p),y=l3(p+1,p+1+v),w=c3([d,[c],m]),S=o.reshape(w),N=u.reshape([c]),C=c3([[p],b,y]),T=S.transpose(C),E=EU(T,N,r.shape[t]),$=_I(C);return E=E.transpose($)},indices:function(){return u}}},"Gather",{axis:t}).reshape(a.outputShape)}}),EU=se({unsortedSegmentSum_:function(n,e,t){var r=q(n,"x","unsortedSegmentSum"),s=q(e,"segmentIds","unsortedSegmentSum","int32");return X(Hn(t),function(){return"numSegments must be of dtype int"}),ue.runKernelFunc(function(a,o){var i=a.unsortedSegmentSum(r,s,t);return o([s]),i},{$x:r},function(a,o){var i=o[0];return{$x:function(){return function(u,l){for(var c=UI(l,zt(l)),d=WI(u,c),p=IU(l,Le(0,"int32")),m=d.rank-p.rank,v=0;v<m;++v)p=ka(p,v+1);p=$1(p,bf(d.shape,"bool"));var b=zt(d);return ic(p,d,b)}(a,i)}}})}}),bCe=function(n,e,t){return Ke(this,void 0,void 0,function(){var r,s,a,o,i,u,l,c,d,p,m,v,b;return Xe(this,function(y){switch(y.label){case 0:for(r=q(n,"tensor","boolMask"),s=q(e,"mask","boolMask","bool"),a=t??0,o=s.rank,i=r.shape,X(o>0,function(){return"mask cannot be scalar"}),qt(i.slice(a,a+o),s.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=a;l<a+o;l++)u*=i[l];return c=i.slice(0,a).concat([u],i.slice(a+o)),d=r.reshape(c),p=s.reshape([-1]),[4,CU(p)];case 1:return m=y.sent(),v=m.squeeze([1]),b=WI(d,v,a),n!==r&&r.dispose(),e!==s&&s.dispose(),v.dispose(),d.dispose(),p.dispose(),m.dispose(),[2,b]}})})};function _U(n,e,t,r,s,a,o){a===void 0&&(a="NHWC"),X(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var i=n,u=e,l=!1;e.rank===3&&(l=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),i=[1,n[0],n[1],n[2]]),X(i.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+i.length+"."}),X(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),X(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var c=a==="NHWC"?i[3]:i[1],d=a==="NHWC"?u.shape[3]:u.shape[1];X(c===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[2]+"."}),X(d===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+t.shape[3]+"."}),o!=null&&X(Hn(s),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+s+"."});var p=OI(a),m=Tc(i,t.shape,r,1,s,o,!1,p),v=ue.runKernelFunc(function(b,y){var w=b.conv2dDerInput(u,t,m);return y([t,u]),w},{dy4D:u,filter:t},function(b,y){var w=y[0],S=y[1];return{dy4D:function(){return Fa(b,w,r,s,a,1,o)},filter:function(){return GI(b,S,w.shape,r,s,a,o)}}});return l?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}function XS(n){var e=function(a){return typeof a=="number"?[a,a,a]:a.length===2?[a[0],a[1],1]:a}(n),t=e[0],r=e[1],s=e[2];return t===1&&r===1&&s===1}function RU(n,e,t,r,s){X(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var a=n,o=e,i=!1;e.rank===4&&(i=!0,o=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),a=[1,n[0],n[1],n[2],n[3]]);var u=a[4],l=o.shape[4];X(a.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),X(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank}),X(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),X(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[3]+"."}),X(l===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+t.shape[4]+"."});var c=r0(a,t.shape,r,1,s),d=ue.runKernelFunc(function(p){return p.conv3dDerInput(o,t,c)},{dy5D:o});return i?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var xCe=se({conv1d_:function(n,e,t,r,s,a,o){s===void 0&&(s="NWC"),a===void 0&&(a=1);var i=q(n,"x","conv1d"),u=q(e,"filter","conv1d"),l=i,c=!1;i.rank===2&&(c=!0,l=i.as3D(1,i.shape[0],i.shape[1])),X(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),X(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),o!=null&&X(Hn(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}),X(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),X(zs(t,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+a+"'"}),X(s==="NWC",function(){return"Error in conv1d: got dataFormat of "+s+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),p=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),m=Fa(p,d,[1,t],r,"NHWC",[1,a],o);return c?m.as2D(m.shape[2],m.shape[3]):m.as3D(m.shape[0],m.shape[2],m.shape[3])}}),Fa=se({conv2d_:function(n,e,t,r,s,a,o){s===void 0&&(s="NHWC"),a===void 0&&(a=[1,1]);var i=q(n,"x","conv2d"),u=q(e,"filter","conv2d"),l=i,c=!1;i.rank===3&&(c=!0,l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),X(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),X(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),o!=null&&X(Hn(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var d=s==="NHWC"?l.shape[3]:l.shape[1];X(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),X(zs(t,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"});var p=OI(s),m=Tc(l.shape,u.shape,t,a,r,o,!1,p),v=[u,l],b=ue.runKernelFunc(function(y,w){var S=y.conv2d(l,u,m);return w([u,l]),S},{x:l,filter:u},function(y,w){var S=w,N=S[0],C=S[1];return X(rd(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return AU(C.shape,y,N,t,r,s)},filter:function(){return GI(C,y,N.shape,t,r,s)}}},"Conv2D",m,v);return c?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),wCe=se({conv3d_:function(n,e,t,r,s,a){s===void 0&&(s="NDHWC"),a===void 0&&(a=[1,1,1]);var o=q(n,"x","conv3d"),i=q(e,"filter","conv3d"),u=o,l=!1;o.rank===4&&(l=!0,u=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),X(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),X(i.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+i.rank+"."}),X(u.shape[4]===i.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+i.shape[3]+"."}),X(function(p,m){return XS(p)||XS(m)}(t,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),X(s==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+s+" but only NDHWC is currently supported."});var c=r0(u.shape,i.shape,t,a,r),d=ue.runKernelFunc(function(p,m){var v=p.conv3d(u,i,c);return m([u,i]),v},{x:u,$filter:i},function(p,m){X(XS(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var v=m[0],b=m[1];return{x:function(){return RU(v.shape,p,b,t,r)},$filter:function(){return function(y,w,S,N,C){var T=y;y.rank===4&&(T=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]));var E=w;E.rank===4&&(E=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3])),X(T.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+T.shape+"."}),X(E.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+E.shape+"."}),X(S.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+S+"."}),X(T.shape[4]===S[3],function(){return"Error in conv3dDerFilter: depth of input "+T.shape[4]+") must match input depth in filter ("+S[3]+"."}),X(E.shape[4]===S[4],function(){return"Error in conv3dDerFilter: depth of dy ("+E.shape[4]+") must match output depth for filter ("+S[4]+")."});var $=r0(T.shape,S,N,1,C);return ue.runKernelFunc(function(_){return _.conv3dDerFilter(T,E,$)},{x5D:T,dy5D:E})}(v,p,b.shape,t,r)}}});return l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),GI=se({conv2dDerFilter_:function(n,e,t,r,s,a,o){a===void 0&&(a="NHWC");var i=n;n.rank===3&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var u=e;u.rank===3&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),X(i.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+i.shape+"."}),X(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),X(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var l=a==="NHWC"?i.shape[3]:i.shape[1],c=a==="NHWC"?u.shape[3]:u.shape[1];X(l===t[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+t[2]+"."}),X(c===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+t[3]+")."}),o!=null&&X(Hn(s),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+s+"."});var d=OI(a),p=Tc(i.shape,t,r,1,s,o,!1,d);return ue.runKernelFunc(function(m){return m.conv2dDerFilter(i,u,p)},{x4D:i,dy4D:u})}}),AU=se({conv2dDerInput_:_U}),O1=se({depthwiseConv2d_:function(n,e,t,r,s,a,o){a===void 0&&(a=[1,1]);var i=q(n,"x","depthwiseConv2d"),u=q(e,"filter","depthwiseConv2d"),l=i,c=!1;i.rank===3&&(c=!0,l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),X(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),X(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),X(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),a==null&&(a=[1,1]),X(zs(t,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),o!=null&&X(Hn(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var d=Tc(l.shape,u.shape,t,a,r,o,!0),p=[l,u],m=ue.runKernelFunc(function(v,b){var y=v.depthwiseConv2D(l,u,d);return b([l,u]),y},{x:l,filter:u},function(v,b){X(rd(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var y=b[0],w=b[1];return{x:function(){return DU(y.shape,v,w,d)},filter:function(){return $U(y,v,w.shape,d)}}},"DepthwiseConv2dNative",d,p);return c?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),DU=se({depthwiseConv2dDerInput_:function(n,e,t,r){var s=e,a=!1;e.rank===3&&(a=!0,s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var o=ue.runKernelFunc(function(i){return i.depthwiseConv2DDerInput(s,t,r)},{dy4D:s});return a?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),$U=se({depthwiseConv2dDerFilter_:function(n,e,t,r){var s=n;n.rank===3&&(s=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=e;return a.rank===3&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),ue.runKernelFunc(function(o){return o.depthwiseConv2DDerFilter(s,a,r)},{x4D:s,dy4D:a})}}),HI=se({separableConv2d_:function(n,e,t,r,s,a,o){a===void 0&&(a=[1,1]),o===void 0&&(o="NHWC");var i=q(n,"x","separableConv2d"),u=q(e,"depthwiseFilter","separableConv2d"),l=q(t,"pointwiseFilter","separableConv2d"),c=i,d=!1;if(i.rank===3&&(d=!0,c=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");X(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),X(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),X(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),X(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),X(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var p=u.shape[2],m=u.shape[3];X(l.shape[2]===p*m,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+p*m+", but got "+l.shape[2]+"."});var v=O1(c,u,r,s,o,a),b=Fa(v,l,1,"valid",o);return d?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),SCe=se({conv2dTranspose_:function(n,e,t,r,s,a){return _U(t,q(n,"x","conv2dTranspose"),q(e,"filter","conv2dTranspose"),r,s,"NHWC",a)}}),CCe=se({conv3dTranspose_:function(n,e,t,r,s){return RU(t,q(n,"x","conv3dTranspose"),q(e,"filter","conv3dTranspose"),r,s)}}),F1=se({matMul_:function(n,e,t,r){var s;t===void 0&&(t=!1),r===void 0&&(r=!1);var a=q(n,"a","matMul"),o=q(e,"b","matMul");s=Rn(a,o),a=s[0],o=s[1];var i=t?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?o.shape[o.rank-1]:o.shape[o.rank-2],l=t?a.shape[a.rank-1]:a.shape[a.rank-2],c=r?o.shape[o.rank-2]:o.shape[o.rank-1],d=a.shape.slice(0,-2),p=o.shape.slice(0,-2),m=Je(d),v=Je(p);X(a.rank>=2&&o.rank>=2&&a.rank===o.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+o.rank+"."}),X(_r(d,p),function(){return"Error in matMul: outer dimensions ("+d+") and ("+p+") of Tensors with shapes "+a.shape+" and "+o.shape+" must match."}),X(i===u,function(){return"Error in matMul: inner shapes ("+i+") and ("+u+") of Tensors with shapes "+a.shape+" and "+o.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var b=a.shape.slice(0,-2).concat([l,c]),y=t?a.as3D(m,i,l):a.as3D(m,l,i),w=r?o.as3D(v,c,u):o.as3D(v,u,c),S={transposeA:t,transposeB:r};return ue.runKernelFunc(function(N,C){var T=N.batchMatMul(y,w,t,r);return C([y,w]),T},{a:y,b:w},function(N,C){var T=C,E=T[0],$=T[1];return t||r?!t&&r?{a:function(){return N.matMul($,!1,!1)},b:function(){return N.matMul(E,!0,!1)}}:t&&!r?{a:function(){return $.matMul(N,!1,!0)},b:function(){return E.matMul(N,!1,!1)}}:{a:function(){return $.matMul(N,!0,!0)},b:function(){return N.matMul(E,!0,!0)}}:{a:function(){return N.matMul($,!1,!0)},b:function(){return E.matMul(N,!0,!1)}}},"BatchMatMul",S).reshape(b)}}),NCe=se({dot_:function(n,e){var t=q(n,"t1","dot"),r=q(e,"t2","dot");X(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."});var s=t.rank===1?t.size:t.shape[1],a=r.rank===1?r.size:r.shape[0];return X(s===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+s+" and "+a+"."}),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),kCe=se({outerProduct_:function(n,e){var t=q(n,"v1","outerProduct"),r=q(e,"v2","outerProduct");return X(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."}),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),ov=se({reverse_:function(n,e){var t=q(n,"x","reverse");if(t.rank===0)return t.clone();var r=br(e,t.shape);return ue.runKernelFunc(function(s){return s.reverse(t,r)},{$x:t},function(s){return{$x:function(){return s.reverse(r)}}}).reshapeAs(t)}}),TCe=se({reverse1d_:function(n){var e=q(n,"x","reverse");return X(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),ov(e,0)}}),ICe=se({reverse2d_:function(n,e){var t=q(n,"x","reverse");return X(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),ov(t,e)}}),ECe=se({reverse3d_:function(n,e){var t=q(n,"x","reverse");return X(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),ov(t,e)}}),_Ce=se({reverse4d_:function(n,e){var t=q(n,"x","reverse");return X(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),ov(t,e)}});function OU(n,e,t,r,s,a){var o=q(n,"x","maxPool"),i=o,u=!1;o.rank===3&&(u=!0,i=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),X(i.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+i.rank+"."}),X(zs(t,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}),a!=null&&X(Hn(s),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+s+"."});var l=cm(i.shape,e,t,r,s,a);if(l.filterWidth===1&&l.filterHeight===1&&_r(l.inShape,l.outShape))return o.clone();var c=[i],d=ue.runKernelFunc(function(p,m){var v=p.maxPool(i,l);return m([i,v]),v},{x:i},function(p,m){var v=m[0],b=m[1];return{x:function(){return function(y,w,S,N,C,T,E,$){var _=q(y,"dy","maxPoolBackprop"),R=q(w,"input","maxPoolBackprop"),D=q(S,"output","maxPoolBackprop");X(R.rank===_.rank,function(){return"Rank of input ("+R.rank+") does not match rank of dy ("+_.rank+")"}),X(zs(C,T),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+C+" and dilations '"+T+"'"}),X(_.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+_.rank+"."}),X(R.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+R.rank+"."});var A=cm(R.shape,N,C,T,E,$);return ue.runKernelFunc(function(M){return M.maxPoolBackprop(_,R,D,A)},{$dy:_,$input:R})}(p,v,b,e,t,r,s)}}},"MaxPool",l,c);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function FU(n,e,t,r,s,a){var o=q(n,"x","avgPool","float32");X(zs(t,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"});var i=o,u=!1;o.rank===3&&(u=!0,i=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),X(i.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+i.rank+"."}),a!=null&&X(Hn(s),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+s+"."});var l=cm(i.shape,e,t,r,s,a);if(l.filterWidth===1&&l.filterHeight===1&&_r(l.inShape,l.outShape))return o.clone();var c=ue.runKernelFunc(function(d){return d.avgPool(i,l)},{x:i},function(d){return{x:function(){return function(p,m,v,b,y,w){var S=q(p,"dy","avgPoolBackprop"),N=q(m,"input","avgPoolBackprop");X(N.rank===S.rank,function(){return"Rank of input ("+N.rank+") does not match rank of dy ("+S.rank+")"}),X(zs(b,y),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+y+"'"});var C=N,T=S,E=!1;N.rank===3&&(E=!0,C=N.as4D(1,N.shape[0],N.shape[1],N.shape[2]),T=S.as4D(1,S.shape[0],S.shape[1],S.shape[2])),X(T.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+T.rank+"."}),X(C.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+C.rank+"."});var $=cm(C.shape,v,b,y,w),_=ue.runKernelFunc(function(R){return R.avgPoolBackprop(T,C,$)},{dy4D:T,input4D:C});return E?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}(d,i,e,t,r,s)}}},"AvgPool",l);return c=c.cast(o.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var kr=se({maxPool_:function(n,e,t,r,s){return OU(n,e,t,1,r,s)}}),iv=se({avgPool_:function(n,e,t,r,s){return FU(n,e,t,1,r,s)}}),RCe=se({pool_:function(n,e,t,r,s,a){s==null&&(s=[1,1]),a==null&&(a=1),r===0&&(r="valid");var o=q(n,"x","maxPool"),i=o,u=!1;o.rank===3&&(u=!0,i=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),X(zs(a,s),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+s+"'"});var l,c=cm(i.shape,e,a,s,r),d=[c.dilationHeight,c.dilationWidth];l=r==="same"?function(C,T){var E=C.map(function(R,D){return R+(R-1)*(T[D]-1)}).map(function(R){return R-1}),$=E.map(function(R){return Math.floor(R/2)}),_=E.map(function(R,D){return R-$[D]});return E.map(function(R,D){return[$[D],_[D]]})}([c.filterHeight,c.filterWidth],d):[[0,0],[0,0]];var p=d[0]===1&&d[1]===1,m=function(C,T,E){var $=E.map(function(j){return j[0]}),_=E.map(function(j){return j[1]}),R=C.concat($,_),D=T.map(function(j,G){return(j-R[G]%j)%j}),A=_.map(function(j,G){return j+D[G]}),M=T.map(function(j,G){return[$[G],A[G]]}),H=T.map(function(j,G){return[0,D[G]]});return[M,H]}([c.inHeight,c.inWidth],d,l),v=m[0],b=m[1],y=p?r:"valid",w=p?i:VV(i,d,v),S=(t==="avg"?function(){return FU(w,e,a,1,y)}:function(){return OU(w,e,a,1,y)})(),N=p?S:PV(S,d,b);return u?N.as3D(N.shape[1],N.shape[2],N.shape[3]):N}}),ACe=se({maxPool3d_:function(n,e,t,r,s,a,o){a===void 0&&(a="NDHWC");var i=q(n,"x","maxPool3d"),u=i,l=!1;i.rank===4&&(l=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),o==null&&(o=[1,1,1]),X(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),X(a==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),X(zs(t,o),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),s!=null&&X(Hn(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var c=n0(u.shape,e,t,o,r,s,a),d=ue.runKernelFunc(function(p,m){var v=p.maxPool3d(u,c);return m([u,v]),v},{x:u},function(p,m){var v=m[0],b=m[1];return{x:function(){return function(y,w,S,N,C,T,E,$){var _=q(y,"dy","maxPool3dBackprop"),R=q(w,"input","maxPool3dBackprop"),D=q(S,"output","maxPool3dBackprop"),A=_,M=R,H=D,j=!1;R.rank===4&&(j=!0,A=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3]),M=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3]),H=D.as5D(1,D.shape[0],D.shape[1],D.shape[2],D.shape[3])),X(A.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+A.rank+"."}),X(M.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+M.rank+"."}),X(H.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+H.rank+"."}),T==null&&(T=[1,1,1]),X(zs(C,T),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+C+" and dilations '"+T+"'"}),$!=null&&X(Hn(E),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+$+" but got pad "+E+"."});var G=n0(M.shape,N,C,T,E,$),P=ue.runKernelFunc(function(V){return V.maxPool3dBackprop(A,M,H,G)},{dy5D:A,input5D:M});return j?P.as4D(P.shape[1],P.shape[2],P.shape[3],P.shape[4]):P}(p,v,b,e,t,o,r,s)}}});return l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),DCe=se({avgPool3d_:function(n,e,t,r,s,a,o){a===void 0&&(a="NDHWC");var i=q(n,"x","avgPool3d","float32"),u=i,l=!1;i.rank===4&&(l=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),o==null&&(o=[1,1,1]),X(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),X(a==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),X(zs(t,o),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),s!=null&&X(Hn(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var c=n0(u.shape,e,t,o,r,s,a),d=ue.runKernelFunc(function(p){return p.avgPool3d(u,c)},{x:u},function(p){return{x:function(){return function(m,v,b,y,w,S,N){var C=q(m,"dy","avgPool3dBackprop"),T=q(v,"input","avgPool3dBackprop"),E=C,$=T,_=!1;T.rank===4&&(_=!0,E=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3]),$=T.as5D(1,T.shape[0],T.shape[1],T.shape[2],T.shape[3])),X(E.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+E.rank+"."}),X($.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+$.rank+"."}),w==null&&(w=[1,1,1]),X(zs(y,w),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+w+"'"}),N!=null&&X(Hn(S),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+N+" but got pad "+S+"."});var R=n0($.shape,b,y,w,S,N),D=ue.runKernelFunc(function(A){return A.avgPool3dBackprop(E,$,R)},{dy5D:E,input5D:$});return _?D.as4D(D.shape[1],D.shape[2],D.shape[3],D.shape[4]):D}(p,u,e,t,o,r,s)}}});return d=d.cast(u.dtype),l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Bo=se({slice_:function(n,e,t){var r,s,a=q(n,"x","slice");if(a.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof e=="number"?[e].concat(new Array(a.rank-1).fill(0)):e.length<a.rank?e.concat(new Array(a.rank-e.length).fill(0)):e.slice()).forEach(function(u){X(u!==-1,function(){return"slice() does not support negative begin indexing."})}),s=(s=t==null?new Array(a.rank).fill(-1):typeof t=="number"?[t].concat(new Array(a.rank-1).fill(-1)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(-1)):t).map(function(u,l){return u>=0?u:(X(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."}),a.shape[l]-r[l])}),owe(a,r,s);var o=a.shape,i={begin:r,size:s};return ue.runKernelFunc(function(u){return u.slice(a,r,s)},{x:a},function(u){for(var l=[],c=0;c<u.rank;c++)l.push([r[c],o[c]-r[c]-s[c]]);return{x:function(){return u.pad(l)}}},"Slice",i)}}),$Ce=se({slice1d_:function(n,e,t){var r=q(n,"x","slice1d");return X(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Bo(r,[e],[t])}}),OCe=se({slice2d_:function(n,e,t){var r=q(n,"x","slice2d");return X(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Bo(r,e,t)}}),MU=se({slice3d_:function(n,e,t){var r=q(n,"x","slice3d");return X(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Bo(r,e,t)}}),FCe=se({slice4d_:function(n,e,t){var r=q(n,"x","slice4d");return X(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Bo(r,e,t)}});function LU(n,e,t,r,s){return e.rank<t.rank&&(e=e.reshape(Bs(e.shape,r))),n.rank<t.rank&&(n=n.reshape(Bs(n.shape,r))),{x:function(){var a=n.mul(t.equal(e).cast(n.dtype));return s==null?a:a.transpose(s)}}}var MCe=se({all_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=q(n,"x","all","bool"),s=br(e,r.shape),a=s,o=Wo(a,r.rank);o!=null&&(r=r.transpose(o),a=Go(a.length,r.rank));var i=ue.runKernelFunc(function(l){return l.all(r,a)},{$x:r});if(t){var u=Bs(i.shape,s);return i.reshape(u)}return i}}),LCe=se({any_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=q(n,"x","any","bool"),s=br(e,r.shape),a=s,o=Wo(a,r.rank);o!=null&&(r=r.transpose(o),a=Go(a.length,r.rank));var i=ue.runKernelFunc(function(l){return l.any(r,a)},{$x:r});if(t){var u=Bs(i.shape,s);return i.reshape(u)}return i}}),PCe=se({argMax_:function(n,e){e===void 0&&(e=0);var t=q(n,"x","argMax");e==null&&(e=0);var r=br(e,t.shape),s=Wo(r,t.rank);s!=null&&(t=t.transpose(s),r=Go(r.length,t.rank));var a={axis:r[0]},o=[t];return ue.runKernelFunc(function(i,u){var l=i.argMax(t,r[0]);return u([t]),l},{x:t},function(i,u){var l=u[0];return{x:function(){return zt(l)}}},"ArgMax",a,o)}}),BCe=se({argMin_:function(n,e){e===void 0&&(e=0);var t=q(n,"x","argMin");e==null&&(e=0);var r=br(e,t.shape),s=Wo(r,t.rank);return s!=null&&(t=t.transpose(s),r=Go(r.length,t.rank)),ue.runKernelFunc(function(a,o){var i=a.argMin(t,r[0]);return o([t]),i},{$x:t},function(a,o){var i=o[0];return{$x:function(){return zt(i)}}})}}),zCe=se({logSumExp_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=q(n,"x","logSumExp"),s=br(e,r.shape),a=r.max(s,!0),o=r.sub(a).exp().sum(s).log(),i=a.reshape(o.shape).add(o);if(t){var u=Bs(i.shape,s);return i.reshape(u)}return i}}),M1=se({max_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=q(n,"x","max"),s=r,a=br(e,r.shape),o=a,i=Wo(o,r.rank);i!=null&&(r=r.transpose(i),o=Go(o.length,r.rank));var u=[r],l=ue.runKernelFunc(function(d,p){var m=d.max(r,o);return p([s,m]),m},{x:r},function(d,p){return LU(d,p[1],p[0],a,i)},"Max",{axes:o},u,[!0]);if(t){var c=Bs(l.shape,a);l=l.reshape(c)}return l}}),VCe=se({mean_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=q(n,"x","mean"),s=br(e,r.shape),a=Je(Yr(r.shape,s)[1]);return A1(function(o){var i=Le(a);return{value:(i.dtype===o.dtype?o:o.cast(i.dtype)).div(i).sum(e,t),gradFunc:function(u){var l=o.shape.slice();return s.forEach(function(c){l[c]=1}),u.reshape(l).mul(bf(o.shape,"float32")).div(a)}}})(r)}}),UCe=se({min_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=q(n,"x","min"),s=r,a=br(e,r.shape),o=a,i=Wo(o,r.rank);i!=null&&(r=r.transpose(i),o=Go(o.length,r.rank));var u=[r],l=ue.runKernelFunc(function(d,p){var m=d.min(r,o);return p([s,m]),m},{x:r},function(d,p){return LU(d,p[1],p[0],a,i)},"Min",{axes:o},u,[!0]);if(t){var c=Bs(l.shape,a);l=l.reshape(c)}return l}}),WCe=se({moments_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=br(e,(n=q(n,"x","moments")).shape),s=n.mean(r,t),a=s.shape;t||(a=Bs(s.shape,r));var o=n.toFloat().sub(s.reshape(a)).square();return{mean:s,variance:o.mean(r,t)}}}),PU=se({sum_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=q(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var s=br(e,r.shape);return A1(function(a){var o=Wo(s,a.rank),i=s,u=a;o!=null&&(u=a.transpose(o),i=Go(i.length,a.rank));var l=function(m){var v=a.shape.slice();return s.forEach(function(b){v[b]=1}),m.reshape(v).mul(bf(a.shape,"float32"))},c={axes:i},d=ue.runKernelFunc(function(m){return m.sum(u,i)},{x:u},function(m){return{x:function(){return l(m)}}},"Sum",c);if(t){var p=Bs(d.shape,s);d=d.reshape(p)}return{value:d,gradFunc:l}})(r)}}),GCe=se({prod_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=q(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var s=br(e,r.shape),a=Wo(s,r.rank),o=s,i=r;a!=null&&(i=r.transpose(a),o=Go(o.length,r.rank));var u=ue.runKernelFunc(function(c){return c.prod(i,o)},{permutedX:i});if(t){var l=Bs(u.shape,s);u=u.reshape(l)}return u}}),BU=se({elu_:function(n){var e=q(n,"x","elu");return ue.runKernelFunc(function(t,r){var s=t.elu(e);return r([s]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return ue.runKernelFunc(function(a){return a.eluDer(t,s)},{dy:t,y:s})}}})}}),HCe=se({leakyRelu_:function(n,e){e===void 0&&(e=.2);var t=q(n,"x","leakyRelu");return UI(Le(e).mul(t),t)}}),zU=se({prelu_:function(n,e){var t=q(n,"x","prelu"),r=q(e,"alpha","prelu");return ue.runKernelFunc(function(s,a){var o=s.prelu(t,r);return a([t,r]),o},{x:t,alpha:r},function(s,a){var o=a[0],i=a[1],u=o.greater(0);return{x:function(){return ic(u,s,s.mul(i))},alpha:function(){var l=ic(u,zt(s),s.mul(o)),c=mr(i.shape,s.shape);return c.length>0&&(l=l.sum(c)),l.reshape(i.shape)}}},"Prelu")}}),_n=se({relu_:function(n){var e=q(n,"x","relu");return e.dtype==="bool"?e.toInt():ue.runKernelFunc(function(t,r){var s=t.relu(e);return r([e]),s},{x:e},function(t,r){var s=r[0];return{x:function(){return t.mulStrict(s.step().toFloat())}}},"Relu")}}),VU=se({relu6_:function(n){var e=q(n,"x","relu6");return e.dtype==="bool"?e.toInt():ue.runKernelFunc(function(t,r){var s=t.relu6(e);return r([e]),s},{x:e},function(t,r){var s=r[0],a=s.lessEqual(6).mul(s.step());return{x:function(){return t.mulStrict(a.toFloat())}}},"Relu6")}}),jCe=se({selu_:function(n){var e=q(n,"x","selu");return ue.runKernelFunc(function(t,r){var s=t.selu(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){var a=s.greater(Le(0)),o=Le(BI),i=Le(zI),u=t.mul(i),l=t.mul(o).mul(s.toFloat().exp());return ic(a,u,l)}}})}}),Bu=se({transpose_:function(n,e){var t=q(n,"x","transpose");if(e==null&&(e=t.shape.map(function(s,a){return a}).reverse()),X(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(s){X(s>=0&&s<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1)return t.clone();var r={perm:e};return ue.runKernelFunc(function(s){return s.transpose(t,e)},{x:t},function(s){var a=_I(e);return{x:function(){return s.transpose(a)}}},"Transpose",r)}}),qCe=se({localResponseNormalization_:function(n,e,t,r,s){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),s===void 0&&(s=.5);var a=q(n,"x","localResponseNormalization");X(a.rank===4||a.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+a.rank+"."}),X(Hn(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var o=a,i=!1;a.rank===3&&(i=!0,o=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=ue.runKernelFunc(function(l,c){var d=l.localResponseNormalization4D(o,e,t,r,s);return c([o,d]),d},{x4D:o},function(l,c){var d=c[0],p=c[1];return{x4D:function(){return ue.runKernelFunc(function(m){return m.LRNGrad(l,d,p,e,t,r,s)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),UU=se({norm_:function(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var s=function i(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return i(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(Le(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)}(n=q(n,"x","norm"),e,t),a=s.shape;if(r){var o=br(t,n.shape);a=Bs(s.shape,o)}return s.reshape(a)}}),KCe=se({basicLSTMCell_:function(n,e,t,r,s,a){var o=q(n,"forgetBias","basicLSTMCell"),i=q(e,"lstmKernel","basicLSTMCell"),u=q(t,"lstmBias","basicLSTMCell"),l=q(r,"data","basicLSTMCell"),c=q(s,"c","basicLSTMCell"),d=q(a,"h","basicLSTMCell"),p=l.concat(d,1).matMul(i).add(u),m=p.shape[0],v=p.shape[1]/4,b=[m,v],y=p.slice([0,0],b),w=p.slice([0,v],b),S=p.slice([0,2*v],b),N=p.slice([0,3*v],b),C=y.sigmoid().mulStrict(w.tanh()).addStrict(c.mulStrict(o.add(S).sigmoid())),T=C.tanh().mulStrict(N.sigmoid());return[C,T]}}),XCe=se({multiRNNCell_:function(n,e,t,r){for(var s=q(e,"data","multiRNNCell"),a=Yb(t,"c","multiRNNCell"),o=Yb(r,"h","multiRNNCell"),i=s,u=[],l=0;l<n.length;l++){var c=n[l](i,a[l],o[l]);u.push(c[0]),u.push(c[1]),i=c[1]}var d=[],p=[];for(l=0;l<u.length;l+=2)d.push(u[l]),p.push(u[l+1]);return[d,p]}}),YCe=se({movingAverage_:function(n,e,t,r,s){s===void 0&&(s=!0);var a=q(n,"v","movingAverage"),o=q(e,"x","movingAverage"),i=q(t,"decay","movingAverage");qxe(a,o),X(_r(a.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=Le(1),l=u.sub(i),c=o.sub(a).mul(l);if(s){X(r!=null,function(){return"When using zeroDebias: true, step is required."});var d=q(r,"step","movingAverage");c=c.div(u.sub(o0(i,d)))}return a.add(c)}}),ZCe=se({stridedSlice_:function(n,e,t,r,s,a,o,i,u){if(s===void 0&&(s=0),a===void 0&&(a=0),o===void 0&&(o=0),i===void 0&&(i=0),u===void 0&&(u=0),r==null&&(r=new Array(e.length)),o!==0)throw new Error("ellipsis mask is not yet supported");var l=q(n,"x","stridedSlice"),c=WO(i),d=l.shape.slice();c.forEach(function(y){e[y]=0,t[y]=1,d.splice(y,0,1)}),l=l.reshape(d);for(var p=0;p<l.rank;p++)e[p]=iwe(s,e,r,l.shape,p),t[p]=uwe(a,t,r,l.shape,p),r[p]=r[p]||1;var m=WO(u);m.forEach(function(y){t[y]=e[y]+1,r[y]=1});var v=$I(e,t,r),b=v.filter(function(y,w){return m.indexOf(w)===-1});return r.every(function(y){return y===1})?Bo(l,e,v).reshape(b):ue.runKernelFunc(function(y){return y.stridedSlice(l,e,t,r)},{$x:l}).reshape(b)}}),QCe=se({topk_:function(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=q(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var s=r.shape[r.shape.length-1];if(e>s)throw new Error("'k' passed to topk() must be <= the last dimension ("+s+") but got "+e);var a=ue.runKernelFunc(function(o){return o.topk(r,e,t)},{$x:r});return{values:a[0],indices:a[1]}}}),JCe=se({scatterND_:function(n,e,t){var r=q(n,"indices","scatterND","int32"),s=q(e,"updates","scatterND");return awe(s,r,t),ue.runKernelFunc(function(a){return a.scatterND(r,s,t)},{indices:r,updates:s},null,"ScatterNd",{shape:t})}}),jI=se({fft_:function(n){X(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return ue.runKernelFunc(function(s){return s.fft(r)},{input:n}).reshape(n.shape)}}),i0=se({ifft_:function(n){X(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return ue.runKernelFunc(function(s){return s.ifft(r)},{input:n}).reshape(n.shape)}}),qI=se({rfft_:function(n,e){X(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+n.dtype});var t,r=n.shape[n.shape.length-1],s=n.size/r;if(e!=null&&e<r){var a=n.shape.map(function(w){return 0}),o=n.shape.map(function(w){return w});o[n.shape.length-1]=e,t=n.slice(a,o),r=e}else if(e!=null&&e>r){var i=n.shape.map(function(w){return w});i[n.shape.length-1]=e-r,t=n.concat(pn(i),n.shape.length-1),r=e}else t=n;var u=t.zerosLike(),l=zr(t,u).as2D(s,r),c=jI(l),d=Math.floor(r/2)+1,p=Ta(c),m=wo(c),v=p.split([d,r-d],p.shape.length-1),b=m.split([d,r-d],m.shape.length-1),y=t.shape.slice();return y[t.shape.length-1]=d,zr(v[0],b[0]).reshape(y)}}),WU=se({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),s=i0(r);return Ta(s)}var a=[t,2*(e-1)],o=Ta(n).as2D(t,e),i=wo(n).as2D(t,e),u=o.slice([0,1],[t,e-2]).reverse(1),l=i.slice([0,1],[t,e-2]).reverse(1).mul(Le(-1)),c=o.concat(u,1),d=i.concat(l,1);return r=zr(c,d).as2D(a[0],a[1]),s=i0(r),Ta(s)}}),eNe=Object.freeze({fft:jI,ifft:i0,rfft:qI,irfft:WU}),tNe=se({sparseToDense_:function(n,e,t,r){r===void 0&&(r=0);var s=q(n,"sparseIndices","sparseToDense","int32"),a=q(e,"sparseValues","sparseToDense"),o=q(r,"defaultValue","sparseToDense",a.dtype);return function(i,u,l,c){if(i.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+i.dtype+".");if(i.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+i.shape+".");var d=i.rank>0?i.shape[0]:1,p=i.rank>1?i.shape[1]:1;if(l.length!==p)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+p+".");var m=u.size;if(u.rank!==0&&(u.rank!==1||m!==d))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+d+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(s,a,t,o),ue.runKernelFunc(function(i){return i.sparseToDense(s,a,t,o)},{$sparseIndices:s,$sparseValues:a,$defaultValue:o})}}),nNe=se({gatherND_:function(n,e){var t=q(e,"indices","gatherND","int32"),r=q(n,"x","gatherND");return ue.runKernelFunc(function(s){return s.gatherND(r,t)},{x:r,indices:t},null,"GatherNd")}}),rNe=se({diag_:function(n){var e=q(n,"x","diag").flatten(),t=n.shape.concat(n.shape);return ue.runKernelFunc(function(r){return r.diag(e)},{$x:e}).reshape(t)}}),sNe=se({dropout_:function(n,e,t,r){var s=q(n,"x","dropout");if(X(s.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+s.dtype+" tensor instead."}),X(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return n instanceof In?s.clone():s;var a=function(u,l){if(l==null)return u.shape.slice();if(_r(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],d=0;d<u.shape.length;d++)l[d]==null&&u.shape[d]!=null?c.push(u.shape[d]):c.push(l[d]);return c}return l}(s,t),o=1-e,i=zV(a,0,1,"float32",r).add(o).floor().div(o);return s.mul(i)}});function GU(n,e,t){for(var r=1-n%2,s=new Float32Array(n),a=0;a<n;++a){var o=2*Math.PI*a/(n+r-1);s[a]=e-t*Math.cos(o)}return Zn(s,"float32")}var KI=se({hannWindow_:function(n){return GU(n,.5,.5)}}),HU=se({hammingWindow_:function(n){return GU(n,.54,.46)}}),XI=se({frame_:function(n,e,t,r,s){r===void 0&&(r=!1),s===void 0&&(s=0);for(var a=0,o=[];a+e<=n.size;)o.push(Bo(n,a,e)),a+=t;if(r)for(;a<n.size;){var i=a+e-n.size,u=hr([Bo(n,a,e-i),Do([i],s)]);o.push(u),a+=t}return o.length===0?Nu([],[0,e]):hr(o).as2D(o.length,e)}}),jU=se({stft_:function(n,e,t,r,s){var a;s===void 0&&(s=KI),r==null&&(a=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var o=XI(n,e,t),i=as(o,s(e)),u=[],l=0;l<o.shape[0];l++)u.push(qI(i.slice([l,0],[1,e]),r));return hr(u)}}),aNe=Object.freeze({hannWindow:KI,hammingWindow:HU,frame:XI,stft:jU}),ss,oNe=function(n,e,t){return t===void 0&&(t=1),Ke(this,void 0,void 0,function(){var r,s,a,o,i,u,l,c,d,p,m,v,b,y;return Xe(this,function(w){switch(w.label){case 0:return r=q(n,"predictions","inTopK"),s=q(e,"targets","inTopK"),X(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),X(r.rank-1===s.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+s.rank}),qt(r.shape.slice(0,r.shape.length-1),s.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],X(t>0&&t<=a,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+t}),[4,r.data()];case 1:return o=w.sent(),[4,s.data()];case 2:for(i=w.sent(),u=[o.length/a,a],c=u[1],d=im("bool",l=u[0]),p=0;p<l;p++){for(m=p*c,v=o.subarray(m,m+c),b=[],y=0;y<v.length;y++)b.push({value:v[y],index:y});for(b.sort(function(S,N){return N.value-S.value}),d[p]=0,y=0;y<t;y++)if(b[y].index===i[p]){d[p]=1;break}}return n!==r&&r.dispose(),e!==s&&s.dispose(),[2,Ur(d,s.shape,"bool")]}})})};(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(ss||(ss={}));var iNe=se({absoluteDifference_:function(n,e,t,r){r===void 0&&(r=ss.SUM_BY_NONZERO_WEIGHTS);var s=q(n,"labels","absoluteDifference"),a=q(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=q(t,"weights","absoluteDifference")),qt(s.shape,a.shape,"Error in absoluteDifference: ");var i=s.sub(a).abs();return Fi(i,o,r)}}),Fi=se({computeWeightedLoss_:function(n,e,t){t===void 0&&(t=ss.SUM_BY_NONZERO_WEIGHTS);var r=q(n,"losses","computeWeightedLoss"),s=null;e!=null&&(s=q(e,"weights","computeWeightedLoss"));var a=s==null?r:r.mul(s);if(t===ss.NONE)return a;if(t===ss.SUM)return a.sum();if(t===ss.MEAN){if(s==null)return a.mean();var o=r.size/s.size,i=a.sum().div(s.sum());return o>1?i.div(Le(o)):i}if(t===ss.SUM_BY_NONZERO_WEIGHTS){if(s==null)return a.sum().div(Le(r.size));var u=s.mul(bf(r.shape)).notEqual(Le(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+t)}}),uNe=se({cosineDistance_:function(n,e,t,r,s){s===void 0&&(s=ss.SUM_BY_NONZERO_WEIGHTS);var a=q(n,"labels","cosineDistance"),o=q(e,"predictions","cosineDistance"),i=null;r!=null&&(i=q(r,"weights","cosineDistance")),qt(a.shape,o.shape,"Error in cosineDistance: ");var u=Le(1).sub(a.mul(o).sum(t,!0));return Fi(u,i,s)}}),lNe=se({hingeLoss_:function(n,e,t,r){r===void 0&&(r=ss.SUM_BY_NONZERO_WEIGHTS);var s=q(n,"labels","hingeLoss"),a=q(e,"predictions","hingeLoss"),o=null;t!=null&&(o=q(t,"weights","hingeLoss")),qt(s.shape,a.shape,"Error in hingeLoss: ");var i=Le(1);s=Le(2).mul(s).sub(i);var u=i.sub(s.mul(a)).relu();return Fi(u,o,r)}}),cNe=se({huberLoss_:function(n,e,t,r,s){r===void 0&&(r=1),s===void 0&&(s=ss.SUM_BY_NONZERO_WEIGHTS);var a=q(n,"labels","huberLoss"),o=q(e,"predictions","huberLoss"),i=null;t!=null&&(i=q(t,"weights","huberLoss")),qt(a.shape,o.shape,"Error in huberLoss: ");var u=Le(r),l=o.sub(a).abs(),c=kU(l,u),d=l.sub(c),p=Le(.5).mul(c.square()).add(u.mul(d));return Fi(p,i,s)}}),hNe=se({logLoss_:function(n,e,t,r,s){r===void 0&&(r=1e-7),s===void 0&&(s=ss.SUM_BY_NONZERO_WEIGHTS);var a=q(n,"labels","logLoss"),o=q(e,"predictions","logLoss"),i=null;t!=null&&(i=q(t,"weights","logLoss")),qt(a.shape,o.shape,"Error in logLoss: ");var u=Le(1),l=Le(r),c=a.mul(o.add(l).log()).neg().sub(u.sub(a).mul(u.sub(o).add(l).log()));return Fi(c,i,s)}}),dNe=se({meanSquaredError_:function(n,e,t,r){r===void 0&&(r=ss.SUM_BY_NONZERO_WEIGHTS);var s=q(n,"labels","meanSquaredError"),a=q(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=q(t,"weights","meanSquaredError")),qt(s.shape,a.shape,"Error in meanSquaredError: ");var i=s.squaredDifference(a);return Fi(i,o,r)}}),fNe=se({sigmoidCrossEntropy_:function(n,e,t,r,s){r===void 0&&(r=0),s===void 0&&(s=ss.SUM_BY_NONZERO_WEIGHTS);var a=q(n,"multiClassLabels","sigmoidCrossEntropy"),o=q(e,"logits","sigmoidCrossEntropy"),i=null;if(t!=null&&(i=q(t,"weights","sigmoidCrossEntropy")),qt(a.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Le(r),l=Le(1),c=Le(.5);a=a.mul(l.sub(u)).add(c.mul(u))}var d=function(p,m){var v=q(p,"labels","sigmoidCrossEntropyWithLogits"),b=q(m,"logits","sigmoidCrossEntropyWithLogits");qt(v.shape,b.shape,"Error in sigmoidCrossEntropyWithLogits: ");var y=b.relu(),w=b.mul(v),S=b.abs().neg().exp().log1p();return y.sub(w).add(S)}(a,o);return Fi(d,i,s)}}),pNe=se({softmaxCrossEntropy_:function(n,e,t,r,s){r===void 0&&(r=0),s===void 0&&(s=ss.SUM_BY_NONZERO_WEIGHTS);var a=q(n,"onehotLabels","softmaxCrossEntropy"),o=q(e,"logits","softmaxCrossEntropy"),i=null;if(t!=null&&(i=q(t,"weights","softmaxCrossEntropy")),qt(a.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Le(r),l=Le(1),c=Le(a.shape[1]);a=a.mul(l.sub(u)).add(u.div(c))}var d=function(p,m,v){if(v===void 0&&(v=-1),v===-1&&(v=m.rank-1),v!==m.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+m.rank+" and dim was "+v);return A1(function(b,y,w){var S=y.logSumExp([v],!0),N=y.toFloat().sub(S);return w([b,N]),{value:N.mul(b).neg().sum([v]),gradFunc:function(C,T){var E=T[0],$=T[1],_=Bs(C.shape,[v]);return[C.reshape(_).mul(E.toFloat().sub($.exp())),C.reshape(_).mul($.exp().sub(E.toFloat()))]}}})(p,m)}(a,o);return Fi(d,i,s)}}),mNe=Object.freeze({get Reduction(){return ss},absoluteDifference:iNe,computeWeightedLoss:Fi,cosineDistance:uNe,hingeLoss:lNe,huberLoss:cNe,logLoss:hNe,meanSquaredError:dNe,sigmoidCrossEntropy:fNe,softmaxCrossEntropy:pNe});function h3(n,e){return e===void 0&&(e=!1),ue.tidy(function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],s=BV(t),a=n.clone(),o=Nu([[1]],[1,1]),i=o.clone(),u=t>=r?r:t,l=function(d){var p,m=a,v=i,b=s;p=ue.tidy(function(){var y=a.slice([d,d],[t-d,1]),w=y.norm(),S=a.slice([d,d],[1,1]),N=Nu([[-1]]).where(S.greater(0),Nu([[1]])),C=S.sub(N.mul(w)),T=y.div(C);i=T.shape[0]===1?o.clone():o.concat(T.slice([1,0],[T.shape[0]-1,T.shape[1]]),0);var E=N.matMul(C).div(w).neg(),$=a.slice([d,0],[t-d,r]),_=E.mul(i);if(d===0)a=$.sub(_.matMul(i.transpose().matMul($)));else{var R=$.sub(_.matMul(i.transpose().matMul($)));a=a.slice([0,0],[d,r]).concat(R,0)}var D=s.slice([0,d],[t,s.shape[1]-d]);if(d===0)s=D.sub(D.matMul(i).matMul(_.transpose()));else{var A=D.sub(D.matMul(i).matMul(_.transpose()));s=s.slice([0,0],[t,d]).concat(A,1)}return[i,a,s]}),i=p[0],a=p[1],s=p[2],Os([m,v,b])},c=0;c<u;++c)l(c);return!e&&t>r&&(s=s.slice([0,0],[t,r]),a=a.slice([0,0],[r,r])),[s,a]})}var gNe=se({bandPart_:function(n,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=q(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var s=r.shape,a=r.shape.slice(-2),o=a[0],i=a[1];if(!(e<=o))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+o+").");if(!(t<=i))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+i+").");e<0&&(e=o),t<0&&(t=i);var u=Zb(0,o,1,"int32").reshape([-1,1]),l=Zb(0,i,1,"int32"),c=gr(u,l),d=$1(c.lessEqual(Le(+e,"int32")),c.greaterEqual(Le(-t,"int32"))),p=pn([o,i],r.dtype);return ua(dr(r.reshape([-1,o,i])).map(function(m){return ic(d,m,p)})).reshape(s)}}),vNe=se({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,X(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){X(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+t+")"})},s=1;s<n.length;++s)r(s)}else e=!0,n=AI(n,n.shape[0],0).map(function(u){return UV(u,[0])});X(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var a=[],o=n,i=function(u){a.push(ue.tidy(function(){var l=o[u];if(u>0)for(var c=0;c<u;++c){var d=PU(a[c].mulStrict(l)).mul(a[c]);l=l.sub(d)}return l.div(UU(l,"euclidean"))}))};for(s=0;s<n.length;++s)i(s);return e?ua(a,0):a}}),yNe=se({qr_:function(n,e){if(e===void 0&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return h3(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(o,i){return o*i}),r=dr(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),s=[],a=[];return r.forEach(function(o){var i=h3(o,e),u=i[0],l=i[1];s.push(u),a.push(l)}),[ua(s,0).reshape(n.shape),ua(a,0).reshape(n.shape)]}}),bNe=Object.freeze({bandPart:gNe,gramSchmidt:vNe,qr:yNe});function L1(n,e,t,r,s,a){r==null&&(r=.5),s==null&&(s=Number.NEGATIVE_INFINITY),a==null&&(a=0);var o=n.shape[0];return t=Math.min(t,o),X(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),X(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),X(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),X(e.rank===1,function(){return"scores must be a 1D tensor"}),X(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+e.shape[0]}),X(0<=a&&a<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:a}}var xNe=se({resizeBilinear_:function(n,e,t){t===void 0&&(t=!1);var r=q(n,"images","resizeBilinear");X(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),X(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var s=r,a=!1;r.rank===3&&(a=!0,s=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=e[0],i=e[1],u=ue.runKernelFunc(function(l,c){return c([s]),l.resizeBilinear(s,o,i,t)},{x:s},function(l,c){return{x:function(){return ue.runKernelFunc(function(d){return d.resizeBilinearBackprop(l,c[0],t)},{})}}},"ResizeBilinear",{alignCorners:t,newHeight:o,newWidth:i});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),wNe=se({resizeNearestNeighbor_:function(n,e,t){t===void 0&&(t=!1);var r=q(n,"images","resizeNearestNeighbor");X(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),X(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),X(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var s=r,a=!1;r.rank===3&&(a=!0,s=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=e[0],i=e[1],u=ue.runKernelFunc(function(l,c){return c([s]),l.resizeNearestNeighbor(s,o,i,t)},{batchImages:s},function(l,c){return{batchImages:function(){return ue.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(l,c[0],t)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),SNe=se({nonMaxSuppression_:function(n,e,t,r,s){r===void 0&&(r=.5),s===void 0&&(s=Number.NEGATIVE_INFINITY);var a=q(n,"boxes","nonMaxSuppression"),o=q(e,"scores","nonMaxSuppression"),i=L1(a,o,t,r,s);t=i.maxOutputSize,r=i.iouThreshold,s=i.scoreThreshold;var u={maxOutputSize:t,iouThreshold:r,scoreThreshold:s};return ue.runKernelFunc(function(l){return l.nonMaxSuppression(a,o,t,r,s)},{boxes:a,scores:o},null,"NonMaxSuppressionV3",u)}}),CNe=function(n,e,t,r,s){return r===void 0&&(r=.5),s===void 0&&(s=Number.NEGATIVE_INFINITY),Ke(this,void 0,void 0,function(){var a,o,i,u,l,c,d;return Xe(this,function(p){switch(p.label){case 0:return a=q(n,"boxes","nonMaxSuppressionAsync"),o=q(e,"scores","nonMaxSuppressionAsync"),i=L1(a,o,t,r,s),t=i.maxOutputSize,r=i.iouThreshold,s=i.scoreThreshold,[4,Promise.all([a.data(),o.data()])];case 1:return u=p.sent(),l=u[0],c=u[1],d=FI(l,c,t,r,s),a!==n&&a.dispose(),o!==e&&o.dispose(),[2,d]}})})},NNe=se({nonMaxSuppressionWithScore_:function(n,e,t,r,s,a){r===void 0&&(r=.5),s===void 0&&(s=Number.NEGATIVE_INFINITY),a===void 0&&(a=0);var o=q(n,"boxes","nonMaxSuppression"),i=q(e,"scores","nonMaxSuppression"),u=L1(o,i,t,r,s,a),l={maxOutputSize:t=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:s=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},c=ue.runKernel("NonMaxSuppressionV5",{boxes:o,scores:i},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),kNe=function(n,e,t,r,s,a){return r===void 0&&(r=.5),s===void 0&&(s=Number.NEGATIVE_INFINITY),a===void 0&&(a=0),Ke(this,void 0,void 0,function(){var o,i,u,l,c,d,p;return Xe(this,function(m){switch(m.label){case 0:return o=q(n,"boxes","nonMaxSuppressionAsync"),i=q(e,"scores","nonMaxSuppressionAsync"),u=L1(o,i,t,r,s,a),t=u.maxOutputSize,r=u.iouThreshold,s=u.scoreThreshold,a=u.softNmsSigma,[4,Promise.all([o.data(),i.data()])];case 1:return l=m.sent(),c=l[0],d=l[1],p=MI(c,d,t,r,s,a),o!==n&&o.dispose(),i!==e&&i.dispose(),[2,p]}})})},TNe=se({cropAndResize_:function(n,e,t,r,s,a){var o=q(n,"image","cropAndResize"),i=q(e,"boxes","cropAndResize","float32"),u=q(t,"boxInd","cropAndResize","int32");s=s||"bilinear",a=a||0;var l=i.shape[0];return X(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."}),X(i.rank===2&&i.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+i.shape+"."}),X(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+i.shape+"."}),X(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),X(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),X(s==="bilinear"||s==="nearest",function(){return"method must be bilinear or nearest, but was "+s}),ue.runKernelFunc(function(c,d){return c.cropAndResize(o,i,u,r,s,a)},{images:o,boxes:i,boxInd:u},null,"CropAndResize",{method:s,extrapolationValue:a,cropSize:r})}}),YI=Object.freeze({resizeBilinear:xNe,resizeNearestNeighbor:wNe,nonMaxSuppression:SNe,nonMaxSuppressionAsync:CNe,nonMaxSuppressionWithScore:NNe,nonMaxSuppressionWithScoreAsync:kNe,cropAndResize:TNe}),ZI=function(n,e){return!(n>0)||e==="linear"},QI=function(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return n.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},JI=function(n,e){var t=e,r=mr(n.shape,e.shape);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},eE=function(n,e,t){if(e==="linear")return n;if(e==="relu")return _n(n);if(e==="elu")return BU(n);if(e==="relu6")return VU(n);if(e==="prelu")return zU(n,t);throw new Error("Unknown fused activation "+e+".")},INe=se({fusedMatMul_:function(n){var e,t=n.a,r=n.b,s=n.transposeA,a=s!==void 0&&s,o=n.transposeB,i=o!==void 0&&o,u=n.bias,l=n.activation,c=l===void 0?"linear":l,d=n.preluActivationWeights;if(ZI(ue.state.gradientDepth,c)===!1){var p=F1(t,r,a,i);return u!=null&&(p=At(p,u)),eE(p,c,d)}var m=q(t,"a","fused matMul"),v=q(r,"b","fused matMul");e=Rn(m,v),m=e[0],v=e[1];var b=a?m.shape[m.rank-2]:m.shape[m.rank-1],y=i?v.shape[v.rank-1]:v.shape[v.rank-2],w=a?m.shape[m.rank-1]:m.shape[m.rank-2],S=i?v.shape[v.rank-2]:v.shape[v.rank-1],N=m.shape.slice(0,-2),C=v.shape.slice(0,-2),T=Je(N),E=Je(C);X(m.rank>=2&&v.rank>=2&&m.rank===v.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+m.rank+" and "+v.rank+"."}),X(_r(N,C),function(){return"Error in fused matMul: outer dimensions ("+N+") and ("+C+") of Tensors with shapes "+m.shape+" and "+v.shape+" must match."}),X(b===y,function(){return"Error in fused matMul: inner shapes ("+b+") and ("+y+") of Tensors with shapes "+m.shape+" and "+v.shape+" and transposeA="+a+" and transposeB="+i+" must match."});var $,_,R=m.shape.slice(0,-2).concat([w,S]),D=a?m.as3D(T,b,w):m.as3D(T,w,b),A=i?v.as3D(E,S,y):v.as3D(E,y,S);u!=null&&Mt(R,($=Rn($=q(u,"bias","fused matMul"),m)[0]).shape),d!=null&&(_=q(d,"prelu weights","fused matMul"));var M={a:D,b:A};u!=null&&(M.bias=$),d!=null&&(M.preluActivationWeights=_);var H=[D,A];return ue.runKernelFunc(function(j,G){var P=j.fusedBatchMatMul({a:D,b:A,transposeA:a,transposeB:i,bias:$,activation:c,preluActivationWeights:_});return G([D,A,P]),P},M,function(j,G){var P=G[0],V=G[1],z=G[2],Y=QI(j,z,c),L={};return u!=null&&(L={bias:function(){return JI($,Y)}}),Object.assign(a||i?!a&&i?{a:function(){return Y.matMul(V,!1,!1)},b:function(){return Y.matMul(P,!0,!1)}}:a&&!i?{a:function(){return V.matMul(Y,!1,!0)},b:function(){return P.matMul(Y,!1,!1)}}:{a:function(){return V.matMul(Y,!0,!0)},b:function(){return Y.matMul(P,!0,!0)}}:{a:function(){return Y.matMul(V,!1,!0)},b:function(){return P.matMul(Y,!0,!1)}},L)},"_FusedMatMul",{transposeA:a,transposeB:i,activation:c},H,[!0]).reshape(R)}}),ENe=se({fusedConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,s=n.pad,a=n.dataFormat,o=a===void 0?"NHWC":a,i=n.dilations,u=i===void 0?[1,1]:i,l=n.dimRoundingMode,c=n.bias,d=n.activation,p=d===void 0?"linear":d,m=n.preluActivationWeights;if(p=p||"linear",ZI(ue.state.gradientDepth,p)===!1){var v=Fa(e,t,r,s,o,u,l);return c!=null&&(v=At(v,c)),eE(v,p,m)}var b=q(e,"x","conv2d"),y=q(t,"filter","conv2d"),w=b,S=!1;b.rank===3&&(S=!0,w=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),X(w.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+w.rank+"."}),X(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+y.rank+"."}),l!=null&&X(Hn(s),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+s+"."}),X(w.shape[3]===y.shape[2],function(){return"Error in conv2d: depth of input ("+w.shape[3]+") must match input depth for filter "+y.shape[2]+"."}),X(zs(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),X(o==="NHWC",function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var N,C,T=Tc(w.shape,y.shape,r,u,s,l);c!=null&&(N=Rn(N=q(c,"bias","fused conv2d"),b)[0],Mt(T.outShape,N.shape)),m!=null&&(C=q(m,"prelu weights","fused conv2d"));var E={x:w,filter:y};c!=null&&(E.bias=N),m!=null&&(E.preluActivationWeights=C);var $=[y,w],_=ue.runKernelFunc(function(R,D){var A=R.fusedConv2d({input:w,filter:y,convInfo:T,bias:N,activation:p,preluActivationWeights:C});return D([y,w,A]),A},E,function(R,D){var A=D,M=A[0],H=A[1],j=A[2],G=QI(R,j,p);X(rd(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var P={};return c!=null&&(P={bias:function(){return JI(N,G)}}),Object.assign({x:function(){return AU(H.shape,G,M,r,s)},filter:function(){return GI(H,G,M.shape,r,s)}},P)},"FusedConv2D",{convInfo:T,activation:p},$,[!0]);return S?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}}),_Ne=se({fusedDepthwiseConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,s=n.pad,a=n.dataFormat,o=a===void 0?"NHWC":a,i=n.dilations,u=i===void 0?[1,1]:i,l=n.dimRoundingMode,c=n.bias,d=n.activation,p=d===void 0?"linear":d,m=n.preluActivationWeights;if(ZI(ue.state.gradientDepth,p)===!1){var v=O1(e,t,r,s,o,u,l);return c!=null&&(v=At(v,c)),eE(v,p,m)}var b=q(e,"x","depthwiseConv2d"),y=q(t,"filter","depthwiseConv2d"),w=b,S=!1;b.rank===3&&(S=!0,w=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),X(w.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+w.rank+"."}),X(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+y.rank+"."}),X(w.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+w.shape[3]+") must match the inChannels dimension in filter "+y.shape[2]+"."}),u==null&&(u=[1,1]),X(zs(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),l!=null&&X(Hn(s),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+s+"."});var N,C,T=Tc(w.shape,y.shape,r,u,s,l,!0);c!=null&&(N=Rn(N=q(c,"bias","fused conv2d"),b)[0],Mt(T.outShape,N.shape)),m!=null&&(C=q(m,"prelu weights","fused depthwiseConv2d"));var E={x:w,filter:y};c!=null&&(E.bias=N),m!=null&&(E.preluActivationWeights=C);var $=[y,w],_=ue.runKernelFunc(function(R,D){var A=R.fusedDepthwiseConv2D({input:w,filter:y,convInfo:T,bias:N,activation:p,preluActivationWeights:C});return D([y,w,A]),A},E,function(R,D){X(rd(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var A=D[0],M=D[1],H=D[2],j=QI(R,H,p),G={};return c!=null&&(G={bias:function(){return JI(N,j)}}),Object.assign({x:function(){return DU(M.shape,j,A,T)},filter:function(){return $U(M,j,A.shape,T)}},G)},"FusedDepthwiseConv2D",{convInfo:T,activation:p},$,[!0]);return S?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}}),RNe=Object.freeze({matMul:INe,conv2d:ENe,depthwiseConv2d:_Ne}),ANe=Object.freeze({image:YI,linalg:bNe,losses:mNe,spectral:eNe,fused:RNe,signal:aNe,square:hSe,squaredDifference:mU,conv1d:xCe,conv2d:Fa,conv3d:wCe,depthwiseConv2d:O1,separableConv2d:HI,conv2dTranspose:SCe,conv3dTranspose:CCe,op:se,batchNormalization2d:VSe,batchNormalization3d:USe,batchNormalization4d:WSe,batchNormalization:GSe,batchNorm:wU,batchNorm2d:HSe,batchNorm3d:jSe,batchNorm4d:qSe,booleanMaskAsync:bCe,complex:zr,real:Ta,imag:wo,concat:hr,concat1d:R1e,concat2d:A1e,concat3d:D1e,concat4d:$1e,split:AI,matMul:F1,dot:NCe,outerProduct:kCe,reverse:ov,reverse1d:TCe,reverse2d:ICe,reverse3d:ECe,reverse4d:_Ce,maxPool:kr,avgPool:iv,pool:RCe,maxPool3d:ACe,avgPool3d:DCe,slice:Bo,slice1d:$Ce,slice2d:OCe,slice3d:MU,slice4d:FCe,abs:dSe,acos:fSe,acosh:pSe,asin:mSe,asinh:gSe,atan:vSe,atanh:ySe,ceil:bSe,clipByValue:VI,cos:xSe,cosh:wSe,erf:SSe,exp:wN,expm1:CSe,floor:NSe,log:kSe,log1p:TSe,logSigmoid:ISe,neg:a0,reciprocal:ESe,round:_Se,rsqrt:gU,sigmoid:vU,sign:RSe,isNaN:ASe,isInf:DSe,isFinite:$Se,sin:OSe,sinh:FSe,softplus:MSe,sqrt:LSe,step:PSe,tan:BSe,tanh:zSe,all:MCe,any:LCe,argMax:PCe,argMin:BCe,logSumExp:zCe,max:M1,mean:VCe,min:UCe,moments:WCe,sum:PU,prod:GCe,equal:TU,equalStrict:lCe,greater:cCe,greaterEqual:IU,greaterEqualStrict:hCe,greaterStrict:dCe,less:fCe,lessEqual:pCe,lessEqualStrict:mCe,lessStrict:gCe,notEqual:vCe,notEqualStrict:yCe,add:At,addN:YSe,addStrict:ZSe,atan2:QSe,div:Ga,divNoNan:JSe,divStrict:eCe,floorDiv:NU,maximum:UI,maximumStrict:tCe,minimum:kU,minimumStrict:nCe,mod:rCe,modStrict:sCe,mul:as,mulStrict:aCe,pow:o0,powStrict:oCe,squaredDifferenceStrict:iCe,sub:gr,subStrict:uCe,elu:BU,leakyRelu:HCe,prelu:zU,relu:_n,relu6:VU,selu:jCe,logicalAnd:$1,logicalNot:KSe,logicalOr:SU,logicalXor:XSe,where:ic,whereAsync:CU,buffer:vt,print:U1e,batchToSpaceND:PV,broadcastTo:W1e,cast:G1e,clone:H1e,cumsum:j1e,depthToSpace:q1e,expandDims:ka,eye:BV,multinomial:K1e,oneHot:vN,pad:kc,pad1d:X1e,pad2d:Y1e,pad3d:Z1e,pad4d:Q1e,rand:J1e,randomNormal:ewe,randomGamma:twe,randomUniform:zV,reshape:ja,spaceToBatchND:VV,squeeze:UV,stack:ua,tile:$h,truncatedNormal:nwe,unstack:dr,setdiff1dAsync:rwe,fill:Do,linspace:_1e,ones:bf,range:Zb,scalar:Le,tensor:Ur,tensor1d:Zn,tensor2d:Nu,tensor3d:RI,tensor4d:As,tensor5d:T1e,tensor6d:I1e,variable:E1e,zeros:pn,onesLike:LV,zerosLike:zt,transpose:Bu,softmax:Oi,logSoftmax:cwe,localResponseNormalization:qCe,norm:UU,gather:WI,unsortedSegmentSum:EU,basicLSTMCell:KCe,multiRNNCell:XCe,movingAverage:YCe,stridedSlice:ZCe,topk:QCe,scatterND:JCe,fft:jI,ifft:i0,rfft:qI,irfft:WU,sparseToDense:tNe,gatherND:nNe,diag:rNe,dropout:sNe,hannWindow:KI,hammingWindow:HU,frame:XI,stft:jU,inTopKAsync:oNe});function Ae(n,e){Array.isArray(n)||(n=[n]),n.forEach(function(t){t!=null&&X(t.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})}function YS(n,e,t,r){if(t==="linear")return n.linear(e);if(t==="relu")return n.relu(e);if(t==="elu")return n.elu(e);if(t==="relu6")return n.relu6(e);if(t==="prelu")return n.prelu(e,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var DNe=function(n){function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new XV(t,ue),t}return ao(e,n),e.prototype.write=function(t,r,s){this.firstUse&&(this.firstUse=!1,Ne().get("IS_NODE")&&Xb(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var a={};return this.data.set(a,{values:t,dtype:s}),a},e.prototype.move=function(t,r,s,a){this.data.set(t,{values:r,dtype:a})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return Ke(this,void 0,void 0,function(){return Xe(this,function(r){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var r=this.data.get(t),s=r.dtype,a=r.complexTensors;return s==="complex64"?xN(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),s=r;if(t.dtype==="string")try{s=r.map(function(a){return jb(a)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return vt(t.shape,t.dtype,s)},e.prototype.makeOutput=function(t,r,s){var a=this.write(t,r,s);return ue.makeTensorFromDataId(a,r,s,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return Ke(this,void 0,void 0,function(){var r;return Xe(this,function(s){return r=bo(),t(),[2,{kernelMs:bo()-r}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,r){var s=this.makeOutput(null,t.shape,"complex64");return this.data.get(s.dataId).complexTensors={real:ue.keep(t.clone()),imag:ue.keep(r.clone())},s},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,s){if(Ae(t,"slice"),qV(t.shape,r,s)){var a=KV(r,t.strides),o=Je(s);return Ur(this.readSync(t.dataId).subarray(a,a+o),s,t.dtype)}for(var i=vt(s,t.dtype),u=this.bufferSync(t),l=0;l<i.size;++l){var c=i.indexToLoc(l).map(function(d,p){return d+r[p]});i.values[l]=u.get.apply(u,c)}return i.toTensor()},e.prototype.stridedSlice=function(t,r,s,a){Ae(t,"stridedSlice");var o=$I(r,s,a);if(o.some(function(m){return m===0}))return Ur([],o);for(var i=vt(o,t.dtype),u=this.bufferSync(t),l=0;l<i.size;l++){for(var c=i.indexToLoc(l),d=new Array(c.length),p=0;p<d.length;p++)d[p]=c[p]*a[p]+r[p];i.set.apply(i,[u.get.apply(u,d)].concat(c))}return i.toTensor()},e.prototype.diag=function(t){for(var r=this.readSync(t.dataId),s=vt([t.size,t.size],t.dtype),a=s.values,o=0;o<r.length;o++)a[o*t.size+o]=r[o];return s.toTensor()},e.prototype.unstack=function(t,r){for(var s=t.shape[r],a=new Array(t.rank-1),o=0,i=0;i<t.rank;i++)i!==r&&(a[o++]=t.shape[i]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[r]=1;var c=new Array(s);for(i=0;i<c.length;i++)u[r]=i,c[i]=this.slice(t,u,l).reshape(a);return c},e.prototype.reverse=function(t,r){Ae(t,"reverse");for(var s=vt(t.shape,t.dtype),a=this.bufferSync(t),o=function(u){var l=s.indexToLoc(u),c=l.slice();r.forEach(function(d){return c[d]=t.shape[d]-1-c[d]}),s.set.apply(s,[a.get.apply(a,c)].concat(l))},i=0;i<s.size;i++)o(i);return s.toTensor()},e.prototype.concat=function(t,r){var s=this;if(t[0].dtype==="complex64"){var a=t.map(function(m){return Ta(m)}),o=t.map(function(m){return wo(m)});return zr(this.concat(a,r),this.concat(o,r))}var i=t.map(function(m){var v=Je(m.shape.slice(r));return m.as2D(-1,v)}),u=nd(i.map(function(m){return m.shape}),1),l=vt(u,t[0].dtype).values;if(i[0].shape[0]===1){var c=0;i.forEach(function(m){l.set(s.readSync(m.dataId),c),c+=m.size})}else{var d=0;i.forEach(function(m){for(var v=s.readSync(m.dataId),b=0,y=0;y<m.shape[0];++y)for(var w=y*u[1]+d,S=0;S<m.shape[1];++S)l[w+S]=v[b++];d+=m.shape[1]})}var p=nd(t.map(function(m){return m.shape}),r);return Ur(l,p,t[0].dtype)},e.prototype.neg=function(t){return Ae(t,"neg"),this.multiply(Le(-1),t)},e.prototype.add=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(s,a,o,i){return{real:s+o,imag:a+i}}):this.broadcastedBinaryOp(t,r,Vr(t.dtype,r.dtype),function(s,a){return s+a})},e.prototype.addN=function(t){var r=this;Ae(t,"addN");for(var s=t.map(function(c){return r.readSync(c.dataId)}),a=vt(t[0].shape,t[0].dtype),o=a.values,i=0;i<t.length;i++)for(var u=s[i],l=0;l<o.length;l++)o[l]+=u[l];return a.toTensor()},e.prototype.softmax=function(t,r){var s=br([r],t.shape),a=this.max(t,s),o=Bs(a.shape,s),i=this.subtract(t,a.reshape(o)),u=this.exp(i),l=this.sum(u,s).reshape(o);return this.realDivide(u,l)},e.prototype.subtract=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(s,a,o,i){return{real:s-o,imag:a-i}}):this.broadcastedBinaryOp(t,r,Vr(t.dtype,r.dtype),function(s,a){return s-a})},e.prototype.pow=function(t,r){return Ae([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,function(s,a){return Math.pow(s,a)})},e.prototype.batchMatMul=function(t,r,s,a){Ae([t,r],"matMul");for(var o=s?t.shape[1]:t.shape[2],i=s?t.shape[2]:t.shape[1],u=a?r.shape[1]:r.shape[2],l=t.shape[0],c=this.readSync(t.dataId),d=this.readSync(r.dataId),p=s?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],m=p[0],v=p[1],b=p[2],y=a?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],w=y[0],S=y[1],N=y[2],C=i*u,T=vt([l,i,u],t.dtype),E=T.values,$=this.blockSize,_=0;_<l;_++)for(var R=0;R<i;R+=$)for(var D=0;D<u;D+=$)for(var A=0;A<o;A+=$)for(var M=Math.min(R+$,i),H=Math.min(D+$,u),j=Math.min(A+$,o),G=R;G<M;G++)for(var P=D;P<H;P++){for(var V=0,z=A;z<j;z++)V+=c[_*m+G*v+z*b]*d[z*w+P*S+_*N];E[_*C+(G*u+P)]+=V}return T.toTensor()},e.prototype.fusedBatchMatMul=function(t){var r=t.a,s=t.b,a=t.transposeA,o=t.transposeB,i=t.bias,u=t.activation,l=t.preluActivationWeights,c=this.batchMatMul(r,s,a,o);return i&&(c=this.add(c,i)),u&&(c=YS(this,c,u,l)),c},e.prototype.multiply=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(s,a,o,i){return{real:s*o-a*i,imag:s*i+a*o}}):this.broadcastedBinaryOp(t,r,Vr(t.dtype,r.dtype),function(s,a){return s*a})},e.prototype.realDivide=function(t,r){return Ae([t,r],"realDivide"),this.broadcastedBinaryOp(t,r,"float32",function(s,a){return s/a})},e.prototype.floorDiv=function(t,r){return Ae([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",function(s,a){return Math.floor(s/a)})},e.prototype.sum=function(t,r){Ae(t,"sum"),Zs("sum",r,t.rank);for(var s=Yr(t.shape,r),a=s[0],o=s[1],i=pn(a,Vr(t.dtype,"int32")),u=Je(o),l=this.readSync(i.dataId),c=this.readSync(t.dataId),d=0;d<l.length;++d){for(var p=d*u,m=0,v=0;v<u;++v)m+=c[p+v];l[d]=m}return i},e.prototype.prod=function(t,r){Ae(t,"sum");for(var s=Yr(t.shape,r),a=s[0],o=s[1],i=pn(a,Vr(t.dtype,"int32")),u=Je(o),l=this.readSync(i.dataId),c=this.readSync(t.dataId),d=0;d<l.length;++d){for(var p=d*u,m=1,v=0;v<u;++v)m*=c[p+v];l[d]=m}return i},e.prototype.unsortedSegmentSum=function(t,r,s){Ae(t,"unsortedSegmentSum");for(var a=[],o=t.rank-r.rank,i=0;i<o;++i)r=r.expandDims(i+1);for(i=0;i<s;++i){var u=Le(i,"int32"),l=TU(u,r).asType("float32").mul(t).sum(0);a.push(l)}return ua(a)},e.prototype.argMin=function(t,r){Ae(t,"argMin");var s=[r];Zs("argMin",s,t.rank);for(var a=Yr(t.shape,s),o=a[0],i=a[1],u=pn(o,"int32"),l=Je(i),c=this.readSync(u.dataId),d=this.readSync(t.dataId),p=0;p<c.length;++p){for(var m=p*l,v=d[m],b=0,y=0;y<l;++y){var w=d[m+y];w<v&&(v=w,b=y)}c[p]=b}return u},e.prototype.argMax=function(t,r){Ae(t,"argMax");var s=[r];Zs("argMax",s,t.rank);for(var a=Yr(t.shape,s),o=a[0],i=a[1],u=pn(o,"int32"),l=Je(i),c=this.readSync(u.dataId),d=this.readSync(t.dataId),p=0;p<c.length;++p){for(var m=p*l,v=d[m],b=0,y=0;y<l;++y){var w=d[m+y];w>v&&(v=w,b=y)}c[p]=b}return u},e.prototype.cumsum=function(t,r,s,a){if(Ae(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var o=Vr(t.dtype,"int32"),i=pn(t.shape,o),u=this.readSync(i.dataId),l=this.readSync(t.dataId),c=t.shape[t.rank-1],d=a?function(y,w){return y+c-w-1}:function(y,w){return y+w},p=0;p<l.length;p+=c)for(var m=0;m<c;m++){var v=d(p,m);if(m===0)u[v]=s?0:l[v];else{var b=d(p,m-1);u[v]=s?l[b]+u[b]:l[v]+u[b]}}return i},e.prototype.equal=function(t,r){return Ae([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",function(s,a){return s===a?1:0})},e.prototype.notEqual=function(t,r){return Ae([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",function(s,a){return s!==a?1:0})},e.prototype.less=function(t,r){return Ae([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",function(s,a){return s<a?1:0})},e.prototype.lessEqual=function(t,r){return Ae([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",function(s,a){return s<=a?1:0})},e.prototype.greater=function(t,r){return Ae([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",function(s,a){return s>a?1:0})},e.prototype.greaterEqual=function(t,r){return Ae([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",function(s,a){return s>=a?1:0})},e.prototype.logicalNot=function(t){Ae(t,"logicalNot");for(var r=this.readSync(t.dataId),s=new Uint8Array(r.length),a=0;a<r.length;++a)s[a]=r[a]?0:1;return this.makeOutput(s,t.shape,"bool")},e.prototype.logicalAnd=function(t,r){return Ae([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",function(s,a){return s&&a})},e.prototype.logicalOr=function(t,r){return Ae([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",function(s,a){return s||a})},e.prototype.select=function(t,r,s){Ae([t,r,s],"select");for(var a=this.readSync(t.dataId),o=this.readSync(r.dataId),i=this.readSync(s.dataId),u=pn(r.shape,Vr(r.dtype,s.dtype)),l=this.readSync(u.dataId),c=0,d=t.rank===0||t.rank>1||r.rank===1?1:Je(r.shape.slice(1)),p=0;p<a.length;p++)for(var m=0;m<d;m++)a[p]===1?l[c++]=o[p]:l[c++]=i[p];return u},e.prototype.where=function(t){Ae([t],"where");var r=this.readSync(t.dataId);return LI(t.shape,r)},e.prototype.topk=function(t,r,s){return Ae(t,"topk"),rU(this.readSync(t.dataId),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Ae(t,"min"),Zs("min",r,t.rank);for(var s=Yr(t.shape,r),a=s[0],o=s[1],i=pn(a,t.dtype),u=Je(o),l=this.readSync(i.dataId),c=this.readSync(t.dataId),d=0;d<l.length;++d){for(var p=d*u,m=c[p],v=0;v<u;++v){var b=c[p+v];b<m&&(m=b)}l[d]=m}return i},e.prototype.minimum=function(t,r){return Ae([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,function(s,a){return Math.min(s,a)})},e.prototype.mod=function(t,r){return Ae([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,function(s,a){var o=s%a;return s<0&&a<0||s>=0&&a>=0?o:(o+a)%a})},e.prototype.max=function(t,r){Ae(t,"max"),Zs("max",r,t.rank);for(var s=Yr(t.shape,r),a=s[0],o=s[1],i=pn(a,t.dtype),u=Je(o),l=this.readSync(i.dataId),c=this.readSync(t.dataId),d=0;d<l.length;++d){for(var p=d*u,m=c[p],v=0;v<u;++v){var b=c[p+v];b>m&&(m=b)}l[d]=m}return i},e.prototype.maximum=function(t,r){return Ae([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,function(s,a){return Math.max(s,a)})},e.prototype.all=function(t,r){Ae(t,"all"),Zs("all",r,t.rank);for(var s=Yr(t.shape,r),a=s[0],o=s[1],i=pn(a,t.dtype),u=Je(o),l=this.readSync(i.dataId),c=this.readSync(t.dataId),d=0;d<l.length;++d){for(var p=d*u,m=c[p],v=0;v<u;++v){var b=c[p+v];m=m&&b}l[d]=m}return i},e.prototype.any=function(t,r){Ae(t,"any"),Zs("any",r,t.rank);for(var s=Yr(t.shape,r),a=s[0],o=s[1],i=pn(a,t.dtype),u=Je(o),l=this.readSync(i.dataId),c=this.readSync(t.dataId),d=0;d<l.length;++d){for(var p=d*u,m=c[p],v=0;v<u;++v){var b=c[p+v];m=m||b}l[d]=m}return i},e.prototype.squaredDifference=function(t,r){return Ae([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,function(s,a){var o=s-a;return o*o})},e.prototype.ceil=function(t){Ae(t,"ceil");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),a=0;a<r.length;++a)s[a]=Math.ceil(r[a]);return this.makeOutput(s,t.shape,"float32")},e.prototype.floor=function(t){Ae(t,"floor");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),a=0;a<r.length;++a)s[a]=Math.floor(r[a]);return this.makeOutput(s,t.shape,"float32")},e.prototype.sign=function(t){Ae(t,"x");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),a=0;a<r.length;++a)r[a]<0?s[a]=-1:r[a]>0?s[a]=1:s[a]=0;return this.makeOutput(s,t.shape,"float32")},e.prototype.isNaN=function(t){Ae(t,"x");for(var r=this.readSync(t.dataId),s=new Uint8Array(r.length),a=0;a<r.length;++a)Number.isNaN(r[a])&&(s[a]=1);return this.makeOutput(s,t.shape,"bool")},e.prototype.isInf=function(t){Ae(t,"x");for(var r=this.readSync(t.dataId),s=new Uint8Array(r.length),a=0;a<r.length;++a)Math.abs(r[a])===1/0&&(s[a]=1);return this.makeOutput(s,t.shape,"bool")},e.prototype.isFinite=function(t){Ae(t,"x");for(var r=this.readSync(t.dataId),s=new Uint8Array(r.length),a=0;a<r.length;++a)Number.isFinite(r[a])&&(s[a]=1);return this.makeOutput(s,t.shape,"bool")},e.prototype.round=function(t){Ae(t,"round");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),a=0;a<r.length;++a){var o=Math.floor(r[a]);r[a]-o<.5?s[a]=Math.floor(r[a]):r[a]-o>.5?s[a]=Math.ceil(r[a]):s[a]=o%2==0?o:o+1}return this.makeOutput(s,t.shape,"float32")},e.prototype.exp=function(t){Ae(t,"exp");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),a=0;a<r.length;++a)s[a]=Math.exp(r[a]);return this.makeOutput(s,t.shape,"float32")},e.prototype.expm1=function(t){Ae(t,"expm1");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),a=0;a<r.length;++a)s[a]=Math.expm1(r[a]);return this.makeOutput(s,t.shape,"float32")},e.prototype.log=function(t){Ae(t,"log");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),a=0;a<r.length;++a){var o=r[a];s[a]=Math.log(o)}return this.makeOutput(s,t.shape,"float32")},e.prototype.log1p=function(t){Ae(t,"log1p");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),a=0;a<r.length;++a){var o=r[a];s[a]=Math.log1p(o)}return this.makeOutput(s,t.shape,"float32")},e.prototype.sqrt=function(t){Ae(t,"sqrt");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),a=0;a<r.length;++a){var o=r[a];s[a]=Math.sqrt(o)}return this.makeOutput(s,t.shape,"float32")},e.prototype.rsqrt=function(t){Ae(t,"rsqrt");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),a=0;a<r.length;++a){var o=r[a];s[a]=1/Math.sqrt(o)}return this.makeOutput(s,t.shape,"float32")},e.prototype.reciprocal=function(t){Ae(t,"reciprocal");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),a=0;a<r.length;++a)s[a]=1/r[a];return this.makeOutput(s,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Ae(t,"relu");for(var r=pn(t.shape,t.dtype),s=this.readSync(r.dataId),a=this.readSync(t.dataId),o=0;o<a.length;++o)s[o]=Math.max(0,a[o]);return r},e.prototype.relu6=function(t){Ae(t,"relu");for(var r=pn(t.shape,t.dtype),s=this.readSync(r.dataId),a=this.readSync(t.dataId),o=0;o<a.length;++o)s[o]=Math.min(Math.max(0,a[o]),6);return r},e.prototype.prelu=function(t,r){return Ae([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,function(s,a){return s<0?a*s:s})},e.prototype.elu=function(t){Ae(t,"elu");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a){var o=s[a];r[a]=o>=0?o:Math.exp(o)-1}return this.makeOutput(r,t.shape,"float32")},e.prototype.eluDer=function(t,r){Ae([t,r],"eluDer");for(var s=new Float32Array(r.size),a=this.readSync(r.dataId),o=this.readSync(t.dataId),i=0;i<a.length;++i){var u=a[i];s[i]=u>=1?o[i]:o[i]*(u+1)}return this.makeOutput(s,r.shape,"float32")},e.prototype.selu=function(t){Ae(t,"selu");for(var r=BI,s=zI,a=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var u=o[i];a[i]=u>=0?s*u:r*(Math.exp(u)-1)}return this.makeOutput(a,t.shape,"float32")},e.prototype.clip=function(t,r,s){Ae(t,"clip");for(var a=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var u=o[i];a[i]=u>s?s:u<r?r:u}return this.makeOutput(a,t.shape,"float32")},e.prototype.abs=function(t){for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a)r[a]=Math.abs(s[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<t.size;++a){var o=s[2*a],i=s[2*a+1];r[a]=Math.hypot(o,i)}return this.makeOutput(r,t.shape,"float32")},e.prototype.int=function(t){Ae(t,"int");for(var r=new Int32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a)r[a]=s[a];return this.makeOutput(r,t.shape,"int32")},e.prototype.sigmoid=function(t){Ae(t,"sigmoid");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a)r[a]=1/(1+Math.exp(-s[a]));return this.makeOutput(r,t.shape,"float32")},e.prototype.softplus=function(t){Ae(t,"softplus");for(var r=Math.log(11920928955078125e-23)+2,s=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o){var i=a[o]>-r,u=a[o]<r,l=Math.exp(a[o]),c=void 0;c=u?l:i?a[o]:Math.log(1+l),s[o]=c}return this.makeOutput(s,t.shape,"float32")},e.prototype.sin=function(t){Ae(t,"sin");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a)r[a]=Math.sin(s[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cos=function(t){Ae(t,"cos");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a)r[a]=Math.cos(s[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tan=function(t){Ae(t,"tan");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a)r[a]=Math.tan(s[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asin=function(t){Ae(t,"asin");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a)r[a]=Math.asin(s[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acos=function(t){Ae(t,"acos");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a)r[a]=Math.acos(s[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan=function(t){Ae(t,"atan");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a)r[a]=Math.atan(s[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan2=function(t,r){return Ae([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,function(s,a){return Math.atan2(s,a)})},e.prototype.sinh=function(t){Ae(t,"sinh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a)r[a]=Math.sinh(s[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cosh=function(t){Ae(t,"cosh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a)r[a]=Math.cosh(s[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tanh=function(t){Ae(t,"tanh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a)r[a]=$xe(s[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asinh=function(t){Ae(t,"asinh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a)r[a]=Math.asinh(s[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acosh=function(t){Ae(t,"acosh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a)r[a]=Math.acosh(s[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atanh=function(t){Ae(t,"atanh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a)r[a]=Math.atanh(s[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.erf=function(t){Ae(t,"erf");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a){var o=Math.sign(s[a]),i=Math.abs(s[a]),u=1/(1+.3275911*i);r[a]=o*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-i*i))}return this.makeOutput(r,t.shape,"float32")},e.prototype.step=function(t,r){r===void 0&&(r=0),Ae(t,"step");for(var s=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o){var i=a[o];isNaN(i)?s[o]=NaN:s[o]=i>0?1:r}return this.makeOutput(s,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var r=t.input,s=t.filter,a=t.convInfo,o=t.bias,i=t.activation,u=t.preluActivationWeights,l=this.conv2d(r,s,a);return o&&(l=this.add(l,o)),i&&(l=YS(this,l,i,u)),l},e.prototype.conv2d=function(t,r,s){Ae([t,r],"conv2d");for(var a=s.filterHeight,o=s.filterWidth,i=s.dilationHeight,u=s.dilationWidth,l=s.padInfo.left,c=s.padInfo.top,d=s.dataFormat==="channelsLast",p=vt(s.outShape,t.dtype),m=t.strides[0],v=d?t.strides[1]:t.strides[2],b=d?t.strides[2]:1,y=d?1:t.strides[1],w=p.strides[0],S=d?p.strides[1]:p.strides[2],N=d?p.strides[2]:1,C=d?1:p.strides[1],T=this.readSync(t.dataId),E=this.readSync(r.dataId),$=p.values,_=0;_<s.batchSize;++_)for(var R=_*m,D=_*w,A=0;A<s.outHeight;++A)for(var M=D+A*S,H=A*s.strideHeight-c,j=0;j<a;j++){var G=H+j*i;if(!(G<0||G>=s.inHeight))for(var P=j*r.strides[0],V=R+G*v,z=0;z<s.outWidth;++z)for(var Y=M+z*N,L=z*s.strideWidth-l,K=0;K<o;K++){var J=L+K*u;if(!(J<0||J>=s.inWidth))for(var Z=V+J*b,le=P+K*r.strides[1],pe=0;pe<s.inChannels;++pe){for(var ge=T[Z+pe*y],Ce=0;Ce<s.outChannels;++Ce)$[Y+Ce*C]+=ge*E[le+Ce];le+=s.outChannels}}}return p.toTensor()},e.prototype.conv3d=function(t,r,s){for(var a=s.filterDepth,o=s.filterHeight,i=s.filterWidth,u=s.dilationDepth,l=s.dilationHeight,c=s.dilationWidth,d=s.padInfo.front,p=s.padInfo.left,m=s.padInfo.top,v=vt(s.outShape,t.dtype),b=this.readSync(t.dataId),y=this.readSync(r.dataId),w=v.values,S=0;S<s.batchSize;++S)for(var N=S*t.strides[0],C=S*v.strides[0],T=0;T<s.outDepth;++T)for(var E=C+T*v.strides[1],$=T*s.strideDepth-d,_=0;_<a;_++){var R=$+_*u;if(!(R<0||R>=s.inDepth))for(var D=_*r.strides[0],A=N+R*t.strides[1],M=0;M<s.outHeight;++M)for(var H=E+M*v.strides[2],j=M*s.strideHeight-m,G=0;G<o;G++){var P=j+G*l;if(!(P<0||P>=s.inHeight))for(var V=D+G*r.strides[1],z=A+P*t.strides[2],Y=0;Y<s.outWidth;++Y)for(var L=H+Y*s.outChannels,K=Y*s.strideWidth-p,J=0;J<i;J++){var Z=K+J*c;if(!(Z<0||Z>=s.inWidth))for(var le=V+J*r.strides[2],pe=z+Z*s.inChannels,ge=le,Ce=0;Ce<s.inChannels;++Ce){for(var Ie=b[pe+Ce],$e=0;$e<s.outChannels;++$e)w[L+$e]+=Ie*y[ge+$e];ge+=s.outChannels}}}}return v.toTensor()},e.prototype.conv2dDerInput=function(t,r,s){Ae([t,r],"conv2dDerInput");for(var a=vt(s.inShape,"float32"),o=a.values,i=this.readSync(t.dataId),u=this.readSync(r.dataId),l=r.strides,c=l[0],d=l[1],p=l[2],m=s.batchSize,v=s.filterHeight,b=s.filterWidth,y=s.inChannels,w=s.inHeight,S=s.inWidth,N=s.outChannels,C=s.outHeight,T=s.outWidth,E=s.strideHeight,$=s.strideWidth,_=s.dataFormat,R=v-1-s.padInfo.top,D=b-1-s.padInfo.left,A=_==="channelsLast",M=a.strides[0],H=A?a.strides[1]:a.strides[2],j=A?a.strides[2]:1,G=A?1:a.strides[1],P=t.strides[0],V=A?t.strides[1]:t.strides[2],z=A?t.strides[2]:1,Y=A?1:t.strides[1],L=0;L<m;++L)for(var K=0;K<y;++K)for(var J=0;J<w;++J)for(var Z=J-R,le=Math.max(0,Math.ceil(Z/E)),pe=Math.min(C,(v+Z)/E),ge=0;ge<S;++ge){for(var Ce=ge-D,Ie=Math.max(0,Math.ceil(Ce/$)),$e=Math.min(T,(b+Ce)/$),Be=0,Oe=le;Oe<pe;++Oe)for(var Ve=Oe*E-Z,Ze=Ie;Ze<$e;++Ze)for(var lt=P*L+V*Oe+z*Ze,it=c*(v-1-Ve)+d*(b-1-(Ze*$-Ce))+p*K,ot=0;ot<N;++ot)Be+=i[lt+Y*ot]*u[it+ot];o[M*L+H*J+j*ge+G*K]=Be}return a.toTensor()},e.prototype.conv3dDerInput=function(t,r,s){for(var a=vt(s.inShape,"float32"),o=a.values,i=a.strides,u=i[0],l=i[1],c=i[2],d=i[3],p=this.readSync(t.dataId),m=t.strides,v=m[0],b=m[1],y=m[2],w=m[3],S=this.readSync(r.dataId),N=r.strides,C=N[0],T=N[1],E=N[2],$=N[3],_=s.batchSize,R=s.filterDepth,D=s.filterHeight,A=s.filterWidth,M=s.inChannels,H=s.inDepth,j=s.inHeight,G=s.inWidth,P=s.outChannels,V=s.outDepth,z=s.outHeight,Y=s.outWidth,L=s.strideDepth,K=s.strideHeight,J=s.strideWidth,Z=R-1-s.padInfo.front,le=D-1-s.padInfo.top,pe=A-1-s.padInfo.left,ge=0;ge<_;++ge)for(var Ce=0;Ce<M;++Ce)for(var Ie=0;Ie<H;++Ie)for(var $e=Ie-Z,Be=Math.max(0,Math.ceil($e/L)),Oe=Math.min(V,(R+$e)/L),Ve=0;Ve<j;++Ve)for(var Ze=Ve-le,lt=Math.max(0,Math.ceil(Ze/K)),it=Math.min(z,(D+Ze)/K),ot=0;ot<G;++ot){for(var pt=ot-pe,_t=Math.max(0,Math.ceil(pt/J)),hn=Math.min(Y,(A+pt)/J),en=0,Nn=Be;Nn<Oe;++Nn)for(var vn=Nn*L-$e,qn=lt;qn<it;++qn)for(var Kn=qn*K-Ze,Bn=_t;Bn<hn;++Bn)for(var xr=v*ge+b*Nn+y*qn+w*Bn,Xt=C*(R-1-vn)+T*(D-1-Kn)+E*(A-1-(Bn*J-pt))+$*Ce,tn=0;tn<P;++tn)en+=p[xr+tn]*S[Xt+tn];o[u*ge+l*Ie+c*Ve+d*ot+Ce]=en}return a.toTensor()},e.prototype.conv2dDerFilter=function(t,r,s){Ae([t,r],"conv2dDerFilter");for(var a=s.strideHeight,o=s.strideWidth,i=s.filterHeight,u=s.filterWidth,l=s.dataFormat==="channelsLast",c=vt(s.filterShape,"float32"),d=s.padInfo.left,p=s.padInfo.top,m=this.bufferSync(t),v=this.bufferSync(r),b=0;b<i;++b)for(var y=Math.max(0,Math.ceil((p-b)/a)),w=Math.min(s.outHeight,(s.inHeight+p-b)/a),S=0;S<u;++S)for(var N=Math.max(0,Math.ceil((d-S)/o)),C=Math.min(s.outWidth,(s.inWidth+d-S)/o),T=0;T<s.inChannels;++T)for(var E=0;E<s.outChannels;++E){for(var $=0,_=0;_<s.batchSize;++_)for(var R=y;R<w;++R)for(var D=b+R*a-p,A=N;A<C;++A){var M=S+A*o-d;$+=l?m.get(_,D,M,T)*v.get(_,R,A,E):m.get(_,T,D,M)*v.get(_,E,R,A)}c.set($,b,S,T,E)}return c.toTensor()},e.prototype.conv3dDerFilter=function(t,r,s){for(var a=s.strideDepth,o=s.strideHeight,i=s.strideWidth,u=s.filterDepth,l=s.filterHeight,c=s.filterWidth,d=vt(s.filterShape,"float32"),p=d.values,m=d.strides,v=m[0],b=m[1],y=m[2],w=m[3],S=this.readSync(r.dataId),N=r.strides,C=N[0],T=N[1],E=N[2],$=N[3],_=this.readSync(t.dataId),R=t.strides,D=R[0],A=R[1],M=R[2],H=R[3],j=s.padInfo.front,G=s.padInfo.left,P=s.padInfo.top,V=0;V<u;++V)for(var z=Math.max(0,Math.ceil((j-V)/a)),Y=Math.min(s.outDepth,(s.inDepth+j-V)/a),L=V*v,K=0;K<l;++K)for(var J=Math.max(0,Math.ceil((P-K)/o)),Z=Math.min(s.outHeight,(s.inHeight+P-K)/o),le=K*b+L,pe=0;pe<c;++pe)for(var ge=Math.max(0,Math.ceil((G-pe)/i)),Ce=Math.min(s.outWidth,(s.inWidth+G-pe)/i),Ie=pe*y+le,$e=0;$e<s.inChannels;++$e)for(var Be=$e*w+Ie,Oe=0;Oe<s.outChannels;++Oe){for(var Ve=0,Ze=0;Ze<s.batchSize;++Ze)for(var lt=Ze*D,it=Ze*C,ot=z;ot<Y;++ot)for(var pt=(V+ot*a-j)*A+lt,_t=ot*T+it,hn=J;hn<Z;++hn)for(var en=(K+hn*o-P)*M+pt,Nn=hn*E+_t,vn=ge;vn<Ce;++vn){var qn=vn*$+Nn;Ve+=_[(pe+vn*i-G)*H+en+$e]*S[qn+Oe]}p[Be+Oe]=Ve}return d.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var r=t.input,s=t.filter,a=t.convInfo,o=t.bias,i=t.activation,u=t.preluActivationWeights,l=this.depthwiseConv2D(r,s,a);return o&&(l=this.add(l,o)),i&&(l=YS(this,l,i,u)),l},e.prototype.depthwiseConv2D=function(t,r,s){Ae([t,r],"depthwiseConv2D");for(var a=s.filterHeight,o=s.filterWidth,i=s.dilationHeight,u=s.dilationWidth,l=s.padInfo.left,c=s.padInfo.top,d=s.outChannels/s.inChannels,p=vt(s.outShape,t.dtype),m=this.readSync(t.dataId),v=this.readSync(r.dataId),b=p.values,y=0;y<s.batchSize;++y)for(var w=y*t.strides[0],S=y*p.strides[0],N=0;N<s.outHeight;++N)for(var C=S+N*p.strides[1],T=N*s.strideHeight-l,E=0;E<a;++E){var $=T+E*i;if(!($<0||$>=s.inHeight))for(var _=E*r.strides[0],R=w+$*t.strides[1],D=0;D<s.outWidth;++D)for(var A=C+D*p.strides[2],M=D*s.strideWidth-c,H=0;H<o;++H){var j=M+H*u;if(!(j<0||j>=s.inWidth))for(var G=_+H*r.strides[1],P=R+j*s.inChannels,V=A,z=G,Y=0;Y<s.inChannels;++Y){for(var L=m[P+Y],K=0;K<d;++K)b[V+K]+=L*v[z+K];V+=d,z+=d}}}return p.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,r,s){Ae([t,r],"depthwiseConv2DDerInput");for(var a=vt(s.inShape,"float32"),o=a.values,i=a.strides,u=i[0],l=i[1],c=i[2],d=this.readSync(t.dataId),p=t.strides,m=p[0],v=p[1],b=p[2],y=this.readSync(r.dataId),w=r.strides,S=w[0],N=w[1],C=w[2],T=s.batchSize,E=s.filterHeight,$=s.filterWidth,_=s.inChannels,R=s.inHeight,D=s.inWidth,A=s.outChannels,M=s.outHeight,H=s.outWidth,j=s.strideHeight,G=s.strideWidth,P=E-1-s.padInfo.top,V=$-1-s.padInfo.left,z=A/_,Y=0;Y<T;++Y)for(var L=0;L<_;++L)for(var K=0;K<R;++K)for(var J=K-P,Z=Math.max(0,Math.ceil(J/j)),le=Math.min(M,(E+J)/j),pe=0;pe<D;++pe){for(var ge=pe-V,Ce=Math.max(0,Math.ceil(ge/G)),Ie=Math.min(H,($+ge)/G),$e=0,Be=Z;Be<le;++Be)for(var Oe=Be*j-J,Ve=Ce;Ve<Ie;++Ve)for(var Ze=m*Y+v*Be+b*Ve,lt=S*(E-1-Oe)+N*($-1-(Ve*G-ge))+C*L,it=0;it<z;++it)$e+=d[Ze+(L*z+it)]*y[lt+it];o[u*Y+l*K+c*pe+L]=$e}return a.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,r,s){Ae([t,r],"depthwiseConv2DDerFilter");for(var a=s.strideHeight,o=s.strideWidth,i=s.filterHeight,u=s.filterWidth,l=vt(s.filterShape,"float32"),c=s.padInfo.left,d=s.padInfo.top,p=s.outChannels/s.inChannels,m=this.bufferSync(t),v=this.bufferSync(r),b=0;b<i;++b)for(var y=Math.max(0,Math.ceil((d-b)/a)),w=Math.min(s.outHeight,(s.inHeight+d-b)/a),S=0;S<u;++S)for(var N=Math.max(0,Math.ceil((c-S)/o)),C=Math.min(s.outWidth,(s.inWidth+c-S)/o),T=0;T<s.outChannels;++T){for(var E=Math.trunc(T/p),$=T%p,_=0,R=0;R<s.batchSize;++R)for(var D=y;D<w;++D)for(var A=b+D*a-d,M=N;M<C;++M){var H=S+M*o-c;_+=m.get(R,A,H,E)*v.get(R,D,M,T)}l.set(_,b,S,E,$)}return l.toTensor()},e.prototype.tile=function(t,r){return Ae(t,"tile"),nU(this.bufferSync(t),r)},e.prototype.pad=function(t,r,s){Ae(t,"pad");var a=r.map(function(p,m){return p[0]+t.shape[m]+p[1]}),o=r.map(function(p){return p[0]}),i=this.bufferSync(t),u=vt(a,t.dtype);s!==0&&u.values.fill(s);for(var l=0;l<t.size;l++){var c=i.indexToLoc(l),d=c.map(function(p,m){return p+o[m]});u.set.apply(u,[i.get.apply(i,c)].concat(d))}return u.toTensor()},e.prototype.transpose=function(t,r){Ae(t,"transpose");for(var s=new Array(t.rank),a=0;a<s.length;a++)s[a]=t.shape[r[a]];var o=this.readSync(t.dataId),i=vt(s,t.dtype),u=this.bufferSync(t);for(a=0;a<t.size;++a){for(var l=u.indexToLoc(a),c=new Array(l.length),d=0;d<c.length;d++)c[d]=l[r[d]];var p=i.locToIndex(c);i.values[p]=o[a]}return i.toTensor()},e.prototype.gather=function(t,r,s){Ae([t,r],"gather");var a=t.shape.slice(),o=this.readSync(r.dataId);a[s]=o.length;for(var i=vt(a,t.dtype),u=this.bufferSync(t),l=0;l<i.size;++l){var c=i.indexToLoc(l),d=c.slice();d[s]=o[c[s]];var p=u.locToIndex(d);i.values[l]=u.values[p]}return i.toTensor()},e.prototype.batchToSpaceND=function(t,r,s){Ae([t],"batchToSpaceND");var a=r.reduce(function(d,p){return d*p}),o=Qb(t.shape,r,a),i=Jb(o.length,r.length),u=e0(t.shape,r,a),l=WV(s,r.length),c=GV(u,s,r.length);return t.reshape(o).transpose(i).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(t,r,s){Ae([t],"spaceToBatchND");var a=r.reduce(function(p,m){return p*m}),o=[[0,0]];o.push.apply(o,s);for(var i=1+r.length;i<t.shape.length;++i)o.push([0,0]);var u=t.pad(o),l=Qb(u.shape,r,a,!1),c=Jb(l.length,r.length,!1),d=e0(u.shape,r,a,!1);return u.reshape(l).transpose(c).reshape(d)},e.prototype.pool=function(t,r,s){Ae(t,"pool");for(var a=r.strideHeight,o=r.strideWidth,i=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,m=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=this.readSync(t.dataId),b=vt(r.outShape,t.dtype),y=b.values,w=r.outShape[1]*r.outShape[2]*r.outShape[3],S=r.outShape[2]*r.outShape[3],N=r.outShape[3],C=0;C<r.batchSize;++C)for(var T=C*w,E=C*t.strides[0],$=0;$<r.inChannels;++$)for(var _=0;_<r.outHeight;++_)for(var R=_*a-d,D=Math.max(0,R),A=Math.min(r.inHeight,l+R),M=T+_*S,H=0;H<r.outWidth;++H){for(var j=H*o-p,G=Math.max(0,j),P=Math.min(r.inWidth,c+j),V=m,z=0,Y=0,L=D;L<A;L+=i){for(var K=E+L*t.strides[1],J=G;J<P;J+=u){var Z=v[K+J*t.strides[2]+$];s==="max"&&Z>V?V=Z:s==="avg"&&(z+=Z,Y++)}if(isNaN(V))break}y[M+H*N+$]=s==="avg"?z/Y:V}return b.toTensor()},e.prototype.maxPool=function(t,r){return this.pool(t,r,"max")},e.prototype.maxPoolPositions=function(t,r){for(var s=vt(r.outShape,"int32"),a=r.strideHeight,o=r.strideWidth,i=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,m=this.bufferSync(t),v=0;v<r.batchSize;++v)for(var b=0;b<r.inChannels;++b)for(var y=0;y<r.outHeight;++y){for(var w=y*a-d,S=w;S<0;)S+=i;for(var N=Math.min(r.inHeight,l+w),C=0;C<r.outWidth;++C){for(var T=C*o-p,E=T;E<0;)E+=u;for(var $=Math.min(r.inWidth,c+T),_=Number.NEGATIVE_INFINITY,R=-1,D=S;D<N;D+=i)for(var A=D-w,M=E;M<$;M+=u){var H=M-T,j=m.get(v,D,M,b);j>_&&(_=j,R=A*c+H)}s.set(R,v,y,C,b)}}return s.toTensor()},e.prototype.maxPoolBackprop=function(t,r,s,a){Ae([r,s],"maxPoolBackprop");for(var o=this.maxPoolPositions(r,a),i=a.strideHeight,u=a.strideWidth,l=a.dilationHeight,c=a.dilationWidth,d=a.effectiveFilterHeight,p=a.effectiveFilterWidth,m=p-1-a.padInfo.left,v=d-1-a.padInfo.top,b=vt(r.shape,"float32"),y=this.bufferSync(o),w=this.bufferSync(t),S=0;S<a.batchSize;++S)for(var N=0;N<a.inChannels;++N)for(var C=0;C<a.inHeight;++C)for(var T=0;T<a.inWidth;++T){for(var E=C-v,$=T-m,_=0,R=0;R<d;R+=l){var D=(E+R)/i;if(!(D<0||D>=a.outHeight||Math.floor(D)!==D))for(var A=0;A<p;A+=c){var M=($+A)/u;if(!(M<0||M>=a.outWidth||Math.floor(M)!==M)){var H=d*p-1-y.get(S,D,M,N)===R*p+A?1:0;H!==0&&(_+=w.get(S,D,M,N)*H)}}}b.set(_,S,C,T,N)}return b.toTensor()},e.prototype.avgPoolBackprop=function(t,r,s){Ae([t,r],"avgPoolBackprop");for(var a=s.strideHeight,o=s.strideWidth,i=s.filterHeight,u=s.filterWidth,l=s.dilationHeight,c=s.dilationWidth,d=s.effectiveFilterHeight,p=s.effectiveFilterWidth,m=p-1-s.padInfo.left,v=d-1-s.padInfo.top,b=vt(r.shape,"float32"),y=1/(i*u),w=this.bufferSync(t),S=0;S<s.batchSize;++S)for(var N=0;N<s.inChannels;++N)for(var C=0;C<s.inHeight;++C)for(var T=0;T<s.inWidth;++T){for(var E=C-v,$=T-m,_=0,R=0;R<d;R+=l){var D=(E+R)/a;if(!(D<0||D>=s.outHeight||Math.floor(D)!==D))for(var A=0;A<p;A+=c){var M=($+A)/o;M<0||M>=s.outWidth||Math.floor(M)!==M||(_+=w.get(S,D,M,N))}}b.set(_*y,S,C,T,N)}return b.toTensor()},e.prototype.pool3d=function(t,r,s){Ae(t,"pool3d");for(var a=r.strideDepth,o=r.strideHeight,i=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,p=r.effectiveFilterHeight,m=r.effectiveFilterWidth,v=r.padInfo.front,b=r.padInfo.top,y=r.padInfo.left,w=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,S=this.readSync(t.dataId),N=vt(r.outShape,t.dtype),C=N.values,T=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],E=r.outShape[2]*r.outShape[3]*r.outShape[4],$=r.outShape[3]*r.outShape[4],_=r.outShape[4],R=0;R<r.batchSize;++R)for(var D=R*T,A=R*t.strides[0],M=0;M<r.inChannels;++M)for(var H=0;H<r.outDepth;++H){for(var j=H*a-v,G=j;G<0;)G+=u;for(var P=Math.min(r.inDepth,d+j),V=D+H*E,z=0;z<r.outHeight;++z){for(var Y=z*o-b,L=Y;L<0;)L+=l;for(var K=Math.min(r.inHeight,p+Y),J=V+z*$,Z=0;Z<r.outWidth;++Z){for(var le=Z*i-y,pe=le;pe<0;)pe+=c;for(var ge=Math.min(r.inWidth,m+le),Ce=J+Z*_,Ie=w,$e=0,Be=0,Oe=G;Oe<P;Oe+=u){for(var Ve=A+Oe*t.strides[1],Ze=L;Ze<K;Ze+=l){for(var lt=Ve+Ze*t.strides[2],it=pe;it<ge;it+=c){var ot=S[lt+it*t.strides[3]+M];if(s==="max"&&ot>Ie?Ie=ot:s==="avg"&&($e+=ot,Be++),isNaN(Ie))break}if(isNaN(Ie))break}if(isNaN(Ie))break}C[Ce+M]=s==="avg"?$e/Be:Ie}}}return N.toTensor()},e.prototype.avgPool3d=function(t,r){return Ae(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,r,s){Ae([t,r],"avgPool3dBackprop");for(var a=s.strideDepth,o=s.strideHeight,i=s.strideWidth,u=s.filterDepth,l=s.filterHeight,c=s.filterWidth,d=s.dilationDepth,p=s.dilationHeight,m=s.dilationWidth,v=s.effectiveFilterDepth,b=s.effectiveFilterHeight,y=s.effectiveFilterWidth,w=v-1-s.padInfo.front,S=y-1-s.padInfo.left,N=b-1-s.padInfo.top,C=vt(r.shape,"float32"),T=1/(u*l*c),E=this.bufferSync(t),$=0;$<s.batchSize;++$)for(var _=0;_<s.inChannels;++_)for(var R=0;R<s.inDepth;++R)for(var D=0;D<s.inHeight;++D)for(var A=0;A<s.inWidth;++A){for(var M=R-w,H=D-N,j=A-S,G=0,P=0;P<v;P+=d){var V=(M+P)/a;if(!(V<0||V>=s.outDepth||Math.floor(V)!==V))for(var z=0;z<b;z+=p){var Y=(H+z)/o;if(!(Y<0||Y>=s.outHeight||Math.floor(Y)!==Y))for(var L=0;L<y;L+=m){var K=(j+L)/i;K<0||K>=s.outWidth||Math.floor(K)!==K||(G+=E.get($,V,Y,K,_))}}}C.set(G*T,$,R,D,A,_)}return C.toTensor()},e.prototype.maxPool3d=function(t,r){return Ae(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,r){for(var s=vt(r.outShape,"int32"),a=r.strideDepth,o=r.strideHeight,i=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,p=r.effectiveFilterHeight,m=r.effectiveFilterWidth,v=r.padInfo.front,b=r.padInfo.top,y=r.padInfo.left,w=this.bufferSync(t),S=0;S<r.batchSize;++S)for(var N=0;N<r.inChannels;++N)for(var C=0;C<r.outDepth;++C){for(var T=C*a-v,E=T;E<0;)E+=u;for(var $=Math.min(r.inDepth,d+T),_=0;_<r.outHeight;++_){for(var R=_*o-b,D=R;D<0;)D+=l;for(var A=Math.min(r.inHeight,p+R),M=0;M<r.outWidth;++M){for(var H=M*i-y,j=H;j<0;)j+=c;for(var G=Math.min(r.inWidth,m+H),P=Number.NEGATIVE_INFINITY,V=-1,z=E;z<$;z+=u)for(var Y=z-T,L=D;L<A;L+=l)for(var K=L-R,J=j;J<G;J+=c){var Z=J-H,le=w.get(S,z,L,J,N);le>=P&&(P=le,V=Y*p*m+K*p+Z)}s.set(V,S,C,_,M,N)}}}return s.toTensor()},e.prototype.maxPool3dBackprop=function(t,r,s,a){Ae([r,s],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(r,a),i=a.strideDepth,u=a.strideHeight,l=a.strideWidth,c=a.dilationDepth,d=a.dilationHeight,p=a.dilationWidth,m=a.effectiveFilterDepth,v=a.effectiveFilterHeight,b=a.effectiveFilterWidth,y=m-1-a.padInfo.front,w=b-1-a.padInfo.left,S=v-1-a.padInfo.top,N=vt(r.shape,"float32"),C=this.bufferSync(o),T=this.bufferSync(t),E=0;E<a.batchSize;++E)for(var $=0;$<a.inChannels;++$)for(var _=0;_<a.inDepth;++_)for(var R=0;R<a.inHeight;++R)for(var D=0;D<a.inWidth;++D){for(var A=_-y,M=R-S,H=D-w,j=0,G=0;G<m;G+=c){var P=(A+G)/i;if(!(P<0||P>=a.outDepth||Math.floor(P)!==P))for(var V=0;V<v;V+=d){var z=(M+V)/u;if(!(z<0||z>=a.outHeight||Math.floor(z)!==z))for(var Y=0;Y<b;Y+=p){var L=(H+Y)/l;if(!(L<0||L>=a.outWidth||Math.floor(L)!==L)){var K=m*v*b-1-C.get(E,P,z,L,$)===G*v*b+V*b+Y?1:0;K!==0&&(j+=T.get(E,P,z,L,$)*K)}}}}N.set(j,E,_,R,D,$)}return N.toTensor()},e.prototype.cast=function(t,r){return QV(t,r,this)},e.prototype.reshape=function(t,r){return bN(t,r)},e.prototype.avgPool=function(t,r){return Ae(t,"avgPool"),this.pool(t,r,"avg").toFloat()},e.prototype.resizeBilinear=function(t,r,s,a){Ae(t,"resizeBilinear");for(var o=t.shape,i=o[0],u=o[1],l=o[2],c=o[3],d=this.readSync(t.dataId),p=new Float32Array(Je([i,r,s,c])),m=[a&&r>1?u-1:u,a&&s>1?l-1:l],v=[a&&r>1?r-1:r,a&&s>1?s-1:s],b=0,y=m[0]/v[0],w=m[1]/v[1],S=0;S<i;S++)for(var N=0;N<r;N++)for(var C=y*N,T=Math.floor(C),E=C-T,$=Math.min(u-1,Math.ceil(C)),_=S*t.strides[0]+T*t.strides[1],R=S*t.strides[0]+$*t.strides[1],D=0;D<s;D++)for(var A=w*D,M=Math.floor(A),H=A-M,j=Math.min(l-1,Math.ceil(A)),G=_+M*t.strides[2],P=R+M*t.strides[2],V=_+j*t.strides[2],z=R+j*t.strides[2],Y=0;Y<c;Y++){var L=d[G+Y],K=d[P+Y],J=L+(d[V+Y]-L)*H,Z=J+(K+(d[z+Y]-K)*H-J)*E;p[b++]=Z}return Ur(p,[i,r,s,c])},e.prototype.resizeBilinearBackprop=function(t,r,s){Ae([t,r],"resizeBilinearBackprop");for(var a=r.shape,o=a[0],i=a[1],u=a[2],l=a[3],c=t.shape,d=c[1],p=c[2],m=new Float32Array(o*i*u*l),v=[s&&d>1?i-1:i,s&&p>1?u-1:u],b=[s&&d>1?d-1:d,s&&p>1?p-1:p],y=v[0]/b[0],w=v[1]/b[1],S=this.readSync(t.dataId),N=0,C=0;C<o;C++)for(var T=C*r.strides[0],E=0;E<d;E++)for(var $=E*y,_=Math.floor($),R=Math.min(Math.ceil($),i-1),D=T+_*r.strides[1],A=T+R*r.strides[1],M=$-_,H=1-M,j=0;j<p;j++)for(var G=j*w,P=Math.floor(G),V=Math.min(Math.ceil(G),u-1),z=G-P,Y=1-z,L=D+P*r.strides[2],K=D+V*r.strides[2],J=A+P*r.strides[2],Z=A+V*r.strides[2],le=H*Y,pe=H*z,ge=M*Y,Ce=M*z,Ie=0;Ie<l;Ie++){var $e=S[N++];m[L+Ie]+=$e*le,m[K+Ie]+=$e*pe,m[J+Ie]+=$e*ge,m[Z+Ie]+=$e*Ce}return As(m,[o,u,i,l],r.dtype)},e.prototype.resizeNearestNeighbor=function(t,r,s,a){Ae(t,"resizeNearestNeighbor");for(var o=t.shape,i=o[0],u=o[1],l=o[2],c=o[3],d=this.readSync(t.dataId),p=new Float32Array(i*r*s*c),m=[a&&r>1?u-1:u,a&&s>1?l-1:l],v=[a&&r>1?r-1:r,a&&s>1?s-1:s],b=m[0]/v[0],y=m[1]/v[1],w=0,S=0;S<i;S++)for(var N=S*t.strides[0],C=0;C<r;C++)for(var T=b*C,E=N+Math.min(u-1,a?Math.round(T):Math.floor(T))*t.strides[1],$=0;$<s;$++)for(var _=y*$,R=E+Math.min(l-1,a?Math.round(_):Math.floor(_))*t.strides[2],D=0;D<c;D++){var A=d[R+D];p[w++]=A}return Ur(p,[i,r,s,c],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,r,s){Ae([t,r],"resizeNearestNeighborBackprop");for(var a=r.shape,o=a[0],i=a[1],u=a[2],l=a[3],c=t.shape,d=c[1],p=c[2],m=new Float32Array(o*i*u*l),v=this.readSync(t.dataId),b=[s&&d>1?i-1:i,s&&p>1?u-1:u],y=[s&&d>1?d-1:d,s&&p>1?p-1:p],w=b[0]/y[0],S=b[1]/y[1],N=1/w,C=1/S,T=2*Math.ceil(N)+2,E=2*Math.ceil(C)+2,$=0;$<o;$++)for(var _=$*r.strides[0],R=0;R<i;R++)for(var D=_+R*r.strides[1],A=Math.floor(R*N),M=Math.floor(A-T/2),H=0;H<u;H++)for(var j=D+H*r.strides[2],G=Math.floor(H*C),P=Math.floor(G-E/2),V=0;V<l;V++){for(var z=0,Y=0;Y<T;Y++){var L=Y+M;if(!(L<0||L>=d)){var K=_+L*t.strides[1],J=L*w;if(R===Math.min(i-1,s?Math.round(J):Math.floor(J)))for(var Z=0;Z<E;Z++){var le=Z+P;if(!(le<0||le>=p)){var pe=K+le*t.strides[2],ge=le*S;H===Math.min(u-1,s?Math.round(ge):Math.floor(ge))&&(z+=v[pe+V])}}}}m[j+V]=z}return As(m,r.shape,r.dtype)},e.prototype.batchNormalization=function(t,r,s,a,o,i){Ae([t,r,s,o,i],"batchNorm");for(var u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=this.readSync(s.dataId),d=o?this.readSync(o.dataId):new Float32Array([1]),p=i?this.readSync(i.dataId):new Float32Array([0]),m=new Float32Array(u.length),v=p.length,b=d.length,y=c.length,w=l.length,S=0,N=0,C=0,T=0,E=0;E<u.length;++E)m[E]=p[S++]+(u[E]-l[N++])*d[C++]/Math.sqrt(c[T++]+a),S>=v&&(S=0),N>=w&&(N=0),C>=b&&(C=0),T>=y&&(T=0);return As(m,t.shape)},e.prototype.localResponseNormalization4D=function(t,r,s,a,o){Ae(t,"localResponseNormalization4D");var i=t.shape[3],u=i-1,l=this.readSync(t.dataId),c=t.size,d=new Float32Array(c);function p(y){for(var w=y%i,S=y-w+Math.max(0,w-r),N=y-w+Math.min(w+r,u),C=0;S<=N;S++){var T=l[S];C+=T*T}return C}for(var m=0;m<c;m++){var v=p(m),b=l[m]*Math.pow(s+a*v,-o);d[m]=b}return As(d,t.shape)},e.prototype.LRNGrad=function(t,r,s,a,o,i,u){Ae(t,"LRNGrad");for(var l=t.shape[3],c=this.readSync(t.dataId),d=this.readSync(r.dataId),p=this.readSync(s.dataId),m=new Float32Array(t.size),v=t.size,b=0;b<v;b++){for(var y=b%l,w=b-y+Math.max(0,y-a),S=b-y+Math.min(l,y+a+1),N=0,C=w;C<S;C++)N+=Math.pow(d[C],2);for(N=i*N+o,C=w;C<S;C++){var T=-2*i*u*d[C]*p[b]/N;b===C&&(T+=Math.pow(N,-u)),T*=c[b],m[C]+=T}}return As(m,t.shape)},e.prototype.multinomial=function(t,r,s,a){Ae(t,"multinomial");for(var o=r?t:Oi(t),i=o.shape[0],u=o.shape[1],l=pn([i,s],"int32"),c=this.readSync(l.dataId),d=this.readSync(o.dataId),p=0;p<i;++p){var m=p*u,v=new Float32Array(u-1);v[0]=d[m];for(var b=1;b<v.length;++b)v[b]=v[b-1]+d[m+b];for(var y=R1(a.toString()),w=p*s,S=0;S<s;++S){var N=y();c[w+S]=v.length;for(var C=0;C<v.length;C++)if(N<v[C]){c[w+S]=C;break}}}return l},e.prototype.oneHot=function(t,r,s,a){Ae(t,"oneHot");var o=new Float32Array(t.size*r);o.fill(a);for(var i=this.readSync(t.dataId),u=0;u<t.size;++u)i[u]>=0&&i[u]<r&&(o[u*r+i[u]]=s);return Nu(o,[t.size,r],"int32")},e.prototype.nonMaxSuppression=function(t,r,s,a,o){return Ae(t,"nonMaxSuppression"),FI(this.readSync(t.dataId),this.readSync(r.dataId),s,a,o)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,r){for(var s=t.shape[0],a=t.shape[1],o=vt(t.shape,"float32"),i=vt(t.shape,"float32"),u=Ta(t).as2D(s,a),l=wo(t).as2D(s,a),c=0;c<s;c++)for(var d=u.slice([c,0],[1,a]),p=l.slice([c,0],[1,a]),m=zr(d,p),v=this.readSync(this.fftImpl(m,r).dataId),b=0;b<a;b++){var y=GO(v,b);o.values[c*a+b]=y.real,i.values[c*a+b]=y.imag}return zr(o.toTensor(),i.toTensor()).as2D(s,a)},e.prototype.fftImpl=function(t,r){var s=t.as1D(),a=s.size;if(this.isExponentOf2(a)){var o=this.fftRadix2(s,a,r).as2D(t.shape[0],t.shape[1]);return r&&(o=zr(Ta(o).div(Le(a)),wo(o).div(Le(a)))),o}var i=this.readSync(t.dataId),u=function(l){for(var c=new Float32Array(l.length/2),d=new Float32Array(l.length/2),p=0;p<l.length;p+=2)c[p/2]=l[p],d[p/2]=l[p+1];return{real:c,imag:d}}(this.fourierTransformByMatmul(i,a,r));return zr(u.real,u.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,r,s){if(r===1)return t;var a=this.readSync(t.dataId),o=r/2,i=function(w){for(var S=Math.ceil(w.length/4),N=new Float32Array(S),C=new Float32Array(S),T=0;T<w.length;T+=4)N[Math.floor(T/4)]=w[T],C[Math.floor(T/4)]=w[T+1];return{real:N,imag:C}}(a),u=zr(i.real,i.imag).as1D(),l=function(w){for(var S=Math.floor(w.length/4),N=new Float32Array(S),C=new Float32Array(S),T=2;T<w.length;T+=4)N[Math.floor(T/4)]=w[T],C[Math.floor(T/4)]=w[T+1];return{real:N,imag:C}}(a),c=zr(l.real,l.imag).as1D();u=this.fftRadix2(u,o,s),c=this.fftRadix2(c,o,s);var d=function(w,S){for(var N=new Float32Array(w/2),C=new Float32Array(w/2),T=0;T<Math.ceil(w/2);T++){var E=(S?2:-2)*Math.PI*(T/w);N[T]=Math.cos(E),C[T]=Math.sin(E)}return{real:N,imag:C}}(r,s),p=zr(d.real,d.imag).mul(c),m=u.add(p),v=u.sub(p),b=Ta(m).concat(Ta(v)),y=wo(m).concat(wo(v));return zr(b,y).as1D()},e.prototype.fourierTransformByMatmul=function(t,r,s){for(var a=new Float32Array(2*r),o=0;o<r;o++){for(var i=0,u=0,l=0;l<r;l++){var c=dwe(o*l,r,s),d=GO(t,l);i+=d.real*c.real-d.imag*c.imag,u+=d.real*c.imag+d.imag*c.real}s&&(i/=r,u/=r),hwe(a,i,u,o)}return a},e.prototype.depthToSpace=function(t,r,s){X(s==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+s}),X(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var a=t.shape[0],o=t.shape[1],i=t.shape[2],u=t.shape[3],l=o*r,c=i*r,d=u/(r*r),p=this.readSync(t.dataId),m=new Float32Array(a*l*c*d),v=0,b=0;b<a;++b)for(var y=0;y<l;++y)for(var w=Math.floor(y/r),S=y%r,N=0;N<c;++N)for(var C=Math.floor(N/r),T=(S*r+N%r)*d,E=0;E<d;++E){var $=E+T+u*(C+i*(w+o*b));m[v++]=p[$]}return As(m,[a,l,c,d])},e.prototype.broadcastedBinaryOp=function(t,r,s,a){var o=Mt(t.shape,r.shape),i=vt(o,s),u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=bu(t.shape,o),d=bu(r.shape,o),p=i.values;if(c.length+d.length===0)for(var m=0;m<p.length;++m)p[m]=a(u[m%u.length],l[m%l.length]);else{var v=this.bufferSync(t),b=this.bufferSync(r),y=function(w){var S=i.indexToLoc(w),N=S.slice(-t.rank);c.forEach(function($){return N[$]=0});var C=v.locToIndex(N),T=S.slice(-r.rank);d.forEach(function($){return T[$]=0});var E=b.locToIndex(T);p[w]=a(u[C],l[E])};for(m=0;m<p.length;++m)y(m)}return i.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,r,s){var a=Mt(t.shape,r.shape),o=vt(a,"float32"),i=vt(a,"float32"),u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=bu(t.shape,a),d=bu(r.shape,a),p=o.values,m=i.values;if(c.length+d.length===0)for(var v=0;v<p.length;v++){var b=v%u.length,y=v%l.length,w=s(u[2*b],u[2*b+1],l[2*y],l[2*y+1]);p[v]=w.real,m[v]=w.imag}else{var S=this.bufferSync(this.data.get(t.dataId).complexTensors.real),N=this.bufferSync(this.data.get(r.dataId).complexTensors.real),C=function(T){var E=o.indexToLoc(T),$=E.slice(-t.rank);c.forEach(function(M){return $[M]=0});var _=S.locToIndex($),R=E.slice(-r.rank);d.forEach(function(M){return R[M]=0});var D=N.locToIndex(R),A=s(u[2*_],u[2*_+1],l[2*D],l[2*D+1]);p[T]=A.real,m[T]=A.imag};for(v=0;v<p.length;v++)C(v)}return this.complex(o.toTensor(),i.toTensor())},e.prototype.split=function(t,r,s){return tU(t,r,s)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,r,s,a,o,i){for(var u=t.shape,l=u[0],c=u[1],d=u[2],p=u[3],m=r.shape[0],v=a[0],b=a[1],y=vt([m,v,b,p],"float32"),w=this.readSync(r.dataId),S=this.readSync(s.dataId),N=this.readSync(t.dataId),C=t.strides,T=y.strides,E=0;E<m;E++){var $=4*E,_=w[$],R=w[$+1],D=w[$+2],A=w[$+3],M=S[E];if(!(M>=l))for(var H=v>1?(D-_)*(c-1)/(v-1):0,j=b>1?(A-R)*(d-1)/(b-1):0,G=0;G<v;G++){var P=v>1?_*(c-1)+G*H:.5*(_+D)*(c-1);if(P<0||P>c-1)for(var V=0;V<b;V++)for(var z=0;z<p;z++){var Y=z+V*T[2]+G*T[1]+E*T[0];y.values[Y]=i}else if(o==="bilinear"){var L=Math.floor(P),K=Math.ceil(P),J=P-L;for(V=0;V<b;V++)if((Oe=b>1?R*(d-1)+V*j:.5*(R+A)*(d-1))<0||Oe>d-1)for(z=0;z<p;z++)Y=z+V*T[2]+G*T[1]+E*T[0],y.values[Y]=i;else{var Z=Math.floor(Oe),le=Math.ceil(Oe),pe=Oe-Z;for(z=0;z<p;z++){var ge=N[Y=z+Z*C[2]+L*C[1]+M*C[0]],Ce=N[Y=z+le*C[2]+L*C[1]+M*C[0]],Ie=N[Y=z+Z*C[2]+K*C[1]+M*C[0]],$e=ge+(Ce-ge)*pe,Be=Ie+(N[Y=z+le*C[2]+K*C[1]+M*C[0]]-Ie)*pe;Y=z+V*T[2]+G*T[1]+E*T[0],y.values[Y]=$e+(Be-$e)*J}}}else for(V=0;V<b;++V){var Oe;if((Oe=b>1?R*(d-1)+V*j:.5*(R+A)*(d-1))<0||Oe>d-1)for(z=0;z<p;z++)Y=z+V*T[2]+G*T[1]+E*T[0],y.values[Y]=i;else{var Ve=Math.round(Oe),Ze=Math.round(P);for(z=0;z<p;z++){var lt=z+Ve*C[2]+Ze*C[1]+M*C[0],it=z+V*T[2]+G*T[1]+E*T[0];y.values[it]=N[lt]}}}}}return y.toTensor()},e.prototype.sparseToDense=function(t,r,s,a){var o=t0(0,t,s),i=o.sliceRank,u=o.numUpdates,l=o.sliceSize,c=o.strides,d=o.outputSize;return this.scatter(t,r,s,d,l,u,i,c,a,!1)},e.prototype.gatherND=function(t,r){var s=r.shape,a=s[s.length-1],o=HV(t,r),i=o[0],u=o[1],l=o[2],c=o[3];if(u===0)return Ur([],i,t.dtype);for(var d=new um([u,l],t.dtype),p=this.readSync(r.dataId),m=this.readSync(t.dataId),v=0;v<u;v++){for(var b=[],y=0,w=0;w<a;w++){var S=p[v*a+w];y+=S*c[w],b.push(S)}if(y<0||y>=t.size/l)throw new Error("Invalid indices: "+b+" does not index into "+t.shape);for(var N=0;N<l;N++)d.values[v*l+N]=m[y*l+N]}return d.toTensor().reshape(i)},e.prototype.scatterND=function(t,r,s){var a=t0(0,t,s),o=a.sliceRank,i=a.numUpdates,u=a.sliceSize,l=a.strides,c=a.outputSize,d=Le(0);return this.scatter(t,r,s,c,u,i,o,l,d,!0)},e.prototype.fill=function(t,r,s){var a=Hb(s=s||tv(r),Je(t));return a.fill(r),ue.makeTensor(a,t,s,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var r=Hb(t.dtype,Je(t.shape));return this.makeOutput(r,t.shape,t.dtype)},e.prototype.linspace=function(t,r,s){return JV(t,r,s)},e.prototype.scatter=function(t,r,s,a,o,i,u,l,c,d){var p=[a/o,o],m=this.readSync(t.dataId),v=this.readSync(r.dataId);if(a===0)return Ur([],s,r.dtype);var b=new um(p,r.dtype);b.values.fill(this.readSync(c.dataId)[0]);for(var y=0;y<i;y++){for(var w=[],S=0,N=0;N<u;N++){var C=m[y*u+N];w.push(C),S+=C*l[N]}if(S<0||S>=a/o)throw new Error("Invalid indices: "+w+" does not index into "+s);for(var T=0;T<o;T++)d?b.values[S*o+T]+=v[y*o+T]:b.values[S*o+T]=r.rank===0?v[0]:v[y*o+T]}return b.toTensor().reshape(s)},e}(YV);ue.registerBackend("cpu",function(){return new DNe},1);for(var ZS=0,d3=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,s=e,a=s.boxes,o=s.scores,i=r,u=i.maxOutputSize,l=i.iouThreshold,c=i.scoreThreshold,d=i.softNmsSigma,p=t;Ae(a,"NonMaxSuppressionWithScore");var m=MI(p.data.get(a.dataId).values,p.data.get(o.dataId).values,u,l,c,d);return[m.selectedIndices,m.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,s=t;Ae(r,"square");for(var a=s.data.get(r.dataId).values,o=new Float32Array(a.length),i=0;i<a.length;++i){var u=a[i];o[i]=u*u}return{dataId:s.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:hm,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,s=r.a,a=r.b,o=t;Ae([s,a],hm);var i=o.data.get(s.dataId).values,u=o.data.get(a.dataId).values,l=function(p,m,v,b,y,w){var S=Mt(p,m),N=S.length,C=Ao(S),T=im(y,Je(S)),E=p.length,$=m.length,_=Ao(p),R=Ao(m),D=bu(p,S),A=bu(m,S);if(D.length+A.length===0)for(var M=0;M<T.length;++M)T[M]=w(v[M%v.length],b[M%b.length]);else{var H=function(j){var G=Uxe(j,N,C),P=G.slice(-E);D.forEach(function(L){return P[L]=0});var V=FO(P,E,_),z=G.slice(-$);A.forEach(function(L){return z[L]=0});var Y=FO(z,$,R);T[j]=w(v[V],b[Y])};for(M=0;M<T.length;++M)H(M)}return[T,S]}(s.shape,a.shape,i,u,s.dtype,function(p,m){var v=p-m;return v*v}),c=l[0],d=l[1];return{dataId:o.write(c,d,s.dtype),shape:d,dtype:s.dtype}}}];ZS<d3.length;ZS++)NV(d3[ZS]);var yh,$Ne=function(n){this.variableNames=["A"];var e=rs(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},ONe=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=rs(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(var QS=0,f3=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,s=e.pixels,a=r.numChannels,o=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement,i=typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement,u=o?[s.videoWidth,s.videoHeight]:[s.width,s.height],l=u[0],c=u[1],d=[c,l],p=[c,l,a];(i||o)&&(yh==null&&(yh=document.createElement("canvas").getContext("2d")),yh.canvas.width=l,yh.canvas.height=c,yh.drawImage(s,0,0,l,c),s=yh.canvas);var m=t.makeTensorInfo(d,"int32");t.texData.get(m.dataId).usage=ra.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(m.dataId),s);var v=Ne().getBool("WEBGL_PACK")?new ONe(p):new $Ne(p),b=t.runWebGLProgram(v,[m],"int32");return t.disposeData(m.dataId),b}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs;Xb("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var s=e,a=s.boxes,o=s.scores,i=r,u=i.maxOutputSize,l=i.iouThreshold,c=i.scoreThreshold,d=i.softNmsSigma,p=t,m=MI(p.readSync(a.dataId),p.readSync(o.dataId),u,l,c,d);return[m.selectedIndices,m.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,s=t,a=new wt(r.shape,"return x * x;");return s.runWebGLProgram(a,[r],r.dtype)}},{kernelName:hm,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,s=r.a,a=r.b,o=t,i=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li("return (a - b) * (a - b);",s.shape,a.shape):new $n("return (a - b) * (a - b);",s.shape,a.shape);return o.compileAndRun(i,[s,a])}}];QS<f3.length;QS++)NV(f3[QS]);for(var JS=0,p3=[{kernelName:"Square",gradFunc:function(n,e){var t=e[0];return{x:function(){return n.mul(t.toFloat().mul(2))}}}},{kernelName:hm,gradFunc:function(n,e){var t=e[0],r=e[1],s=Le(2);return{a:function(){return as(n,as(s,gr(t,r)))},b:function(){return as(n,as(s,gr(r,t)))}}}}];JS<p3.length;JS++)Axe(p3[JS]);var FNe=function(){function n(){}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n}();Ne().get("IS_BROWSER")&&Ne().setPlatform("browser",new FNe);var eC,MNe=function(){return require("node-fetch")},LNe=function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return Ne().global.fetch!=null?Ne().global.fetch(e,t):(eC==null&&(eC=MNe()),eC(e,t))},n.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},n}();Ne().get("IS_NODE")&&Ne().setPlatform("node",new LNe);var SN={float32:4,int32:4,uint16:2,uint8:1,bool:1},u0=4;function qU(n,e){for(var t={},r=0,s=function(i){var u=i.name,l=i.dtype,c=i.shape,d=Je(c),p=void 0;if("quantization"in i){var m=i.quantization;if(m.dtype!=="uint8"&&m.dtype!=="uint16")throw new Error("Weight "+i.name+" has unknown quantization dtype "+m.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var v=SN[m.dtype],b=n.slice(r,r+d*v),y=m.dtype==="uint8"?new Uint8Array(b):new Uint16Array(b);if(l==="float32")p=Float32Array.from(y,function(E){return E*m.scale+m.min});else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+l);p=Int32Array.from(y,function(E){return Math.round(E*m.scale+m.min)})}r+=d*v}else if(l==="string"){var w=Je(i.shape);p=[];for(var S=0;S<w;S++){var N=new Uint32Array(n.slice(r,r+u0))[0];r+=u0;var C=new Uint8Array(n.slice(r,r+N));p.push(C),r+=N}}else{var T=SN[l];if(b=n.slice(r,r+d*T),l==="float32")p=new Float32Array(b);else if(l==="int32")p=new Int32Array(b);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+l);p=new Uint8Array(b)}r+=d*T}t[u]=Ur(p,c,l)},a=0,o=e;a<o.length;a++)s(o[a]);return t}function PNe(n){if(n===null)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach(function(a){if(e+=a.byteLength,t.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+a.constructor.name)});var r=new Uint8Array(e),s=0;return t.forEach(function(a){r.set(new Uint8Array(a.buffer),s),s+=a.byteLength}),r.buffer}var CN=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function m3(n){return CN?Buffer.byteLength(n):new Blob([n]).size}function tE(n){var e=0;n.forEach(function(s){e+=s.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(s){t.set(new Uint8Array(s),r),r+=s.byteLength}),t.buffer}function g3(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function uv(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:m3(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:m3(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var sa=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var s=[];return(t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(a){var o=a(e,r);o!==null&&s.push(o)}),s},n}(),Fh="://",ku=function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){X(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(Fh)&&(e=e.slice(0,e.indexOf(Fh))),X(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();X(r.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function hb(n){if(n.indexOf(Fh)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+ku.getSchemes().join(","));return{scheme:n.split(Fh)[0],path:n.split(Fh)[1]}}function v3(n,e,t){return t===void 0&&(t=!1),Ke(this,void 0,void 0,function(){var r,s,a,o,i,u,l,c,d;return Xe(this,function(p){switch(p.label){case 0:return X(n!==e,function(){return"Old path and new path are the same: '"+n+"'"}),X((r=sa.getLoadHandlers(n)).length>0,function(){return"Copying failed because no load handler is found for source URL "+n+"."}),X(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."}),s=r[0],X((a=sa.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),X(a.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),o=a[0],i=hb(n).scheme,u=hb(n).path,l=i===hb(n).scheme,[4,s.load()];case 1:return c=p.sent(),t&&l?[4,ku.getManager(i).removeModel(u)]:[3,3];case 2:p.sent(),p.label=3;case 3:return[4,o.save(c)];case 4:return d=p.sent(),!t||l?[3,6]:[4,ku.getManager(i).removeModel(u)];case 5:p.sent(),p.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var Pl="models_store",xu="model_info_store";function KU(){if(!Ne().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function NN(n){var e=n.result;e.createObjectStore(Pl,{keyPath:"modelPath"}),e.createObjectStore(xu,{keyPath:"modelPath"})}var Mh=function(){function n(e){if(this.indexedDB=KU(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return Ke(this,void 0,void 0,function(){return Xe(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return Ke(this,void 0,void 0,function(){return Xe(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(s,a){var o=r.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return NN(o)},o.onsuccess=function(){var i=o.result;if(t==null){var u=i.transaction(Pl,"readonly"),l=u.objectStore(Pl).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return i.close(),a(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));s(l.result.modelArtifacts)},l.onerror=function(b){return i.close(),a(l.error)},u.oncomplete=function(){return i.close()}}else{var c,d=uv(t),p=i.transaction(xu,"readwrite"),m=p.objectStore(xu),v=m.put({modelPath:r.modelPath,modelArtifactsInfo:d});v.onsuccess=function(){var b=(c=i.transaction(Pl,"readwrite")).objectStore(Pl).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:d});b.onsuccess=function(){return s({modelArtifactsInfo:d})},b.onerror=function(y){var w=(m=p.objectStore(xu)).delete(r.modelPath);w.onsuccess=function(){return i.close(),a(b.error)},w.onerror=function(S){return i.close(),a(b.error)}}},v.onerror=function(b){return i.close(),a(v.error)},p.oncomplete=function(){c==null?i.close():c.oncomplete=function(){return i.close()}}}},o.onerror=function(i){return a(o.error)}})},n.URL_SCHEME="indexeddb://",n}(),y3=function(n){return Ne().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Mh.URL_SCHEME)?(e=n.slice(Mh.URL_SCHEME.length),new Mh(e)):null;var e};sa.registerSaveRouter(y3),sa.registerLoadRouter(y3);var BNe=function(){function n(){this.indexedDB=KU()}return n.prototype.listModels=function(){return Ke(this,void 0,void 0,function(){var e=this;return Xe(this,function(t){return[2,new Promise(function(r,s){var a=e.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return NN(a)},a.onsuccess=function(){var o=a.result,i=o.transaction(xu,"readonly"),u=i.objectStore(xu).getAll();u.onsuccess=function(){for(var l={},c=0,d=u.result;c<d.length;c++){var p=d[c];l[p.modelPath]=p.modelArtifactsInfo}r(l)},u.onerror=function(l){return o.close(),s(u.error)},i.oncomplete=function(){return o.close()}},a.onerror=function(o){return s(a.error)}})]})})},n.prototype.removeModel=function(e){return Ke(this,void 0,void 0,function(){var t=this;return Xe(this,function(r){var s;return e=(s=e).startsWith(Mh.URL_SCHEME)?s.slice(Mh.URL_SCHEME.length):s,[2,new Promise(function(a,o){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return NN(i)},i.onsuccess=function(){var u,l=i.result,c=l.transaction(xu,"readwrite"),d=c.objectStore(xu),p=d.get(e);p.onsuccess=function(){if(p.result==null)return l.close(),o(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var m=d.delete(e),v=function(){var b=(u=l.transaction(Pl,"readwrite")).objectStore(Pl).delete(e);b.onsuccess=function(){return a(p.result.modelArtifactsInfo)},b.onerror=function(y){return o(p.error)}};m.onsuccess=v,m.onerror=function(b){return v(),l.close(),o(p.error)}},p.onerror=function(m){return l.close(),o(p.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},i.onerror=function(u){return o(i.error)}})]})})},n}();if(Ne().getBool("IS_BROWSER"))try{ku.registerManager(Mh.URL_SCHEME,new BNe)}catch{}var gi="/",Th="tensorflowjs_models",XU="info",zNe="model_topology",VNe="weight_specs",UNe="weight_data",WNe="model_metadata";function YU(n){return{info:[Th,n,XU].join(gi),topology:[Th,n,zNe].join(gi),weightSpecs:[Th,n,VNe].join(gi),weightData:[Th,n,UNe].join(gi),modelMetadata:[Th,n,WNe].join(gi)}}function GNe(n){var e=n.split(gi);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(gi)}var Lh=function(){function n(e){if(!Ne().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=YU(this.modelPath)}return n.prototype.save=function(e){return Ke(this,void 0,void 0,function(){var t,r,s;return Xe(this,function(a){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),s=uv(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(s)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(o){if(CN)return Buffer.from(o).toString("base64");for(var i=new Uint8Array(o),u="",l=0,c=i.length;l<c;l++)u+=String.fromCharCode(i[l]);return btoa(u)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:s}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+s.modelTopologyBytes+", weightSpecsBytes="+s.weightSpecsBytes+", weightDataBytes="+s.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return Ke(this,void 0,void 0,function(){var e,t,r,s,a,o,i;return Xe(this,function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(s=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=s,(a=this.LS.getItem(this.keys.modelMetadata))!=null&&(o=JSON.parse(a),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,t.userDefinedMetadata=o.userDefinedMetadata),(i=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(l){if(CN){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var d=atob(l),p=new Uint8Array(d.length),m=0;m<d.length;++m)p.set([d.charCodeAt(m)],m);return p.buffer}(i),[2,t]})})},n.URL_SCHEME="localstorage://",n}(),b3=function(n){return Ne().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Lh.URL_SCHEME)?(e=n.slice(Lh.URL_SCHEME.length),new Lh(e)):null;var e};sa.registerSaveRouter(b3),sa.registerLoadRouter(b3);var HNe=function(){function n(){X(Ne().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),X(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return Ke(this,void 0,void 0,function(){var e,t,r,s,a,o;return Xe(this,function(i){for(e={},t=Th+gi,r=gi+XU,s=0;s<this.LS.length;++s)(a=this.LS.key(s)).startsWith(t)&&a.endsWith(r)&&(o=GNe(a),e[o]=JSON.parse(this.LS.getItem(a)));return[2,e]})})},n.prototype.removeModel=function(e){return Ke(this,void 0,void 0,function(){var t,r;return Xe(this,function(s){var a;if(e=(a=e).startsWith(Lh.URL_SCHEME)?a.slice(Lh.URL_SCHEME.length):a,t=YU(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]})})},n}();if(Ne().getBool("IS_BROWSER"))try{ku.registerManager(Lh.URL_SCHEME,new HNe)}catch{}var jNe="model",qNe=".json",KNe=".weights.bin";function x3(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var tC=function(){function n(e){if(!Ne().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),e!=null&&e.length!==0||(e=jNe),this.modelTopologyFileName=e+qNe,this.weightDataFileName=e+KNe}return n.prototype.save=function(e){return Ke(this,void 0,void 0,function(){var t,r,s,a,o,i;return Xe(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],s={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},a=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),(o=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=a,[4,x3(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:((i=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=t,[4,x3(function(){return i.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:uv(e)}]}})})},n.URL_SCHEME="downloads://",n}(),XNe=function(){function n(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return Ke(this,void 0,void 0,function(){var e,t,r=this;return Xe(this,function(s){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(a,o){var i=new FileReader;i.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(c!=null){t.length===0&&a({modelTopology:c});var d=l.weightsManifest;if(d!=null){var p;try{p=r.checkManifestAndWeightFiles(d,t)}catch(y){return void o(y)}var m=[],v=[],b=[];d.forEach(function(y){y.paths.forEach(function(w){v.push(w),b.push(null)}),m.push.apply(m,y.weights)}),d.forEach(function(y){y.paths.forEach(function(w){var S=new FileReader;S.onload=function(N){var C=N.target.result,T=v.indexOf(w);b[T]=C,b.indexOf(null)===-1&&a({modelTopology:c,weightSpecs:m,weightData:tE(b),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},S.onerror=function(N){return o("Failed to weights data from file of path '"+w+"'.")},S.readAsArrayBuffer(p[w])})})}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},i.onerror=function(u){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},i.readAsText(e)})]})})},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],s=t.map(function(u){return g3(u.name)}),a={},o=0,i=e;o<i.length;o++)i[o].paths.forEach(function(u){var l=g3(u);if(r.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(r.push(l),s.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");a[u]=t[s.indexOf(l)]});if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return a},n}();function w3(n,e,t,r){(function(a){X(a!=null&&Array.isArray(a)&&a.length>0,function(){return"promises must be a none empty array"})})(n),function(a,o){X(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+a}),X(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+o}),X(o>=a,function(){return"startFraction must be no more than endFraction, but got startFraction "+a+" and endFraction "+o})}(t=t??0,r=r??1);var s=0;return Promise.all(n.map(function(a){return a.then(function(o){var i=t+ ++s/n.length*(r-t);return e(i),o}),a}))}function ZU(n,e){return Ke(this,void 0,void 0,function(){var t,r,s,a,o,i,u,l,c;return Xe(this,function(d){switch(d.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?Ne().platform.fetch:e.fetchFunc,r=n.map(function(p){return t(p,e.requestInit,{isBinary:!0})}),s=0,a=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return o=d.sent(),[3,4];case 2:return[4,w3(r,e.onProgress,s,a)];case 3:o=d.sent(),d.label=4;case 4:return i=o.map(function(p){return p.arrayBuffer()}),u=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(i)];case 5:return c=d.sent(),[3,8];case 6:return[4,w3(i,e.onProgress,u,l)];case 7:c=d.sent(),d.label=8;case 8:return[2,c]}})})}function S3(n){var e=this;return function(t,r,s){return r===void 0&&(r=""),Ke(e,void 0,void 0,function(){var a,o,i,u,l,c,d,p,m,v;return Xe(this,function(b){switch(b.label){case 0:if(a=t.map(function(){return!1}),o={},i=s!=null?s.map(function(){return!1}):[],u=[],t.forEach(function(y,w){var S=0;y.weights.forEach(function(N){var C="quantization"in N?N.quantization.dtype:N.dtype,T=SN[C]*Je(N.shape),E=function(){a[w]=!0,o[w]==null&&(o[w]=[]),o[w].push({manifestEntry:N,groupOffset:S,sizeBytes:T})};s!=null?s.forEach(function($,_){$===N.name&&(E(),i[_]=!0)}):E(),u.push(N.name),S+=T})}),!i.every(function(y){return y}))throw l=s.filter(function(y,w){return!i[w]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return c=a.reduce(function(y,w,S){return w&&y.push(S),y},[]),d=[],c.forEach(function(y){t[y].paths.forEach(function(w){var S=r+(r.endsWith("/")?"":"/")+w;d.push(S)})}),[4,n(d)];case 1:return p=b.sent(),m={},v=0,c.forEach(function(y){for(var w=t[y].paths.length,S=0,N=0;N<w;N++)S+=p[v+N].byteLength;for(var C=new ArrayBuffer(S),T=new Uint8Array(C),E=0,$=0;$<w;$++){var _=new Uint8Array(p[v+$]);T.set(_,E),E+=_.byteLength}o[y].forEach(function(R){var D=qU(C.slice(R.groupOffset,R.groupOffset+R.sizeBytes),[R.manifestEntry]);for(var A in D)m[A]=D[A]}),v+=w}),[2,m]}})})}}sa.registerSaveRouter(function(n){return Ne().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(tC.URL_SCHEME)?function(e){return e===void 0&&(e="model"),new tC(e)}(n.slice(tC.URL_SCHEME.length)):null});var QU=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(X(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=Ne().platform.fetch,X(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&X(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return Ke(this,void 0,void 0,function(){var t,r,s,a;return Xe(this,function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],s={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(s)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((a=o.sent()).ok)return[2,{modelArtifactsInfo:uv(e),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}})})},n.prototype.load=function(){return Ke(this,void 0,void 0,function(){var e,t,r,s,a,o,i,u,l,c,d,p;return Xe(this,function(m){switch(m.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=m.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");m.label=2;case 2:return m.trys.push([2,4,,5]),[4,e.json()];case 3:return t=m.sent(),[3,5];case 4:throw m.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(s=t.modelTopology,a=t.weightsManifest,o=t.generatedBy,i=t.convertedBy,u=t.format,l=t.userDefinedMetadata,s==null&&a==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return a==null?[3,7]:[4,this.loadWeights(a)];case 6:p=m.sent(),c=p[0],d=p[1],m.label=7;case 7:return[2,{modelTopology:s,weightSpecs:c,weightData:d,userDefinedMetadata:l,generatedBy:o,convertedBy:i,format:u}]}})})},n.prototype.loadWeights=function(e){return Ke(this,void 0,void 0,function(){var t,r,s,a,o,i,u,l,c,d,p;return Xe(this,function(m){switch(m.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=function(v){var b=v.lastIndexOf("/"),y=v.lastIndexOf("?"),w=v.substring(0,b),S=y>b?v.substring(y):"";return[w+"/",S]}(t),s=r[0],a=r[1],o=this.weightPathPrefix||s,i=[],u=0,l=e;u<l.length;u++)c=l[u],i.push.apply(i,c.weights);return d=[],e.forEach(function(v){v.paths.forEach(function(b){d.push(o+b+a)})}),[4,ZU(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return p=m.sent(),[2,[i,tE(p)]]}})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function kN(n){return n.match(QU.URL_SCHEME_REGEX)!=null}var C3=function(n,e){return typeof fetch>"u"?null:(Array.isArray(n)?n.every(function(t){return kN(t)}):kN(n))?TN(n,{onProgress:e}):null};function TN(n,e){return new QU(n,e)}sa.registerSaveRouter(C3),sa.registerLoadRouter(C3);var nC=function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return Ke(this,void 0,void 0,function(){return Xe(this,function(e){return[2,this.modelArtifacts]})})},n}(),YNe=function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return Ke(this,void 0,void 0,function(){return Xe(this,function(t){return[2,this.saveHandler(e)]})})},n}(),JU=Object.freeze({browserFiles:function(n){return new XNe(n)},browserHTTPRequest:function(n,e){return TN(n,e)},concatenateArrayBuffers:tE,decodeWeights:qU,encodeWeights:function(n,e){return Ke(this,void 0,void 0,function(){var t,r,s,a,o,i=this;return Xe(this,function(u){switch(u.label){case 0:for(t=[],r=[],s=Array.isArray(n)?n.map(function(l){return l.name}):Object.keys(n),a=function(l){var c=s[l],d=Array.isArray(n)?n[l].tensor:n[c];if(d.dtype!=="float32"&&d.dtype!=="int32"&&d.dtype!=="bool"&&d.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+d.dtype);var p={name:c,shape:d.shape,dtype:d.dtype};if(d.dtype==="string"){var m=new Promise(function(v){return Ke(i,void 0,void 0,function(){var b,y,w,S,N,C,T;return Xe(this,function(E){switch(E.label){case 0:return[4,d.bytes()];case 1:for(b=E.sent(),y=b.reduce(function($,_){return $+_.length},0)+u0*b.length,w=new Uint8Array(y),S=0,N=0;N<b.length;N++)C=b[N],T=new Uint8Array(new Uint32Array([C.length]).buffer),w.set(T,S),S+=u0,w.set(C,S),S+=C.length;return v(w),[2]}})})});r.push(m)}else r.push(d.data());e!=null&&(p.group=e),t.push(p)},o=0;o<s.length;++o)a(o);return[4,Promise.all(r)];case 1:return[2,{data:PNe(u.sent()),specs:t}]}})})},fromMemory:function(n,e,t,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new nC(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new nC({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new nC({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))},getLoadHandlers:function(n,e){return sa.getLoadHandlers(n,e)},getModelArtifactsInfoForJSON:uv,getSaveHandlers:function(n){return sa.getSaveHandlers(n)},http:TN,isHTTPScheme:kN,loadWeights:function(n,e,t,r){return e===void 0&&(e=""),Ke(this,void 0,void 0,function(){return Xe(this,function(s){return[2,S3(function(a){return ZU(a,{requestInit:r})})(n,e,t)]})})},registerLoadRouter:function(n){return sa.registerLoadRouter(n)},registerSaveRouter:function(n){return sa.registerSaveRouter(n)},weightsLoaderFactory:S3,withSaveHandler:function(n){return new YNe(n)},copyModel:function(n,e){return Ke(this,void 0,void 0,function(){return Xe(this,function(t){return[2,v3(n,e,!1)]})})},listModels:function(){return Ke(this,void 0,void 0,function(){var n,e,t,r,s,a,o;return Xe(this,function(i){switch(i.label){case 0:n=ku.getSchemes(),e={},t=0,r=n,i.label=1;case 1:return t<r.length?(s=r[t],[4,ku.getManager(s).listModels()]):[3,4];case 2:for(o in a=i.sent())e[s+Fh+o]=a[o];i.label=3;case 3:return t++,[3,1];case 4:return[2,e]}})})},moveModel:function(n,e){return Ke(this,void 0,void 0,function(){return Xe(this,function(t){return[2,v3(n,e,!0)]})})},removeModel:function(n){return Ke(this,void 0,void 0,function(){var e;return Xe(this,function(t){return e=hb(n),[2,ku.getManager(e.scheme).removeModel(e.path)]})})}}),bh;se({confusionMatrix_:function(n,e,t){var r=q(n,"labels","confusionMatrix"),s=q(e,"predictions","confusionMatrix");X(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),X(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),X(s.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+s.rank}),X(r.shape[0]===s.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+s.shape[0]+". Labels and predictions should have the same number of elements."}),X(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var a=vN(r.asType("int32"),t),o=vN(s.asType("int32"),t);return a.transpose().matMul(o).asType("int32")}});var ZNe=se({fromPixels_:function(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,s=!1,a=!1,o=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)s=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)a=!0;else{if(n.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);o=!0}if(s&&s&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(CV("FromPixels",ue.backendName)!=null)return ue.runKernel("FromPixels",{pixels:n},{numChannels:e});var i,u,l=s?[n.videoWidth,n.videoHeight]:[n.width,n.height],c=l[0],d=l[1];if(o?i=n.getContext("2d").getImageData(0,0,c,d).data:r||t?i=n.data:(a||s)&&(bh==null&&(bh=document.createElement("canvas").getContext("2d")),bh.canvas.width=c,bh.canvas.height=d,bh.drawImage(n,0,0,c,d),i=bh.getImageData(0,0,c,d).data),e===4)u=new Int32Array(i);else{var p=c*d;u=new Int32Array(p*e);for(var m=0;m<p;m++)for(var v=0;v<e;++v)u[m*e+v]=i[4*m+v]}return RI(u,[d,c,e],"int32")}}),nE=Object.freeze({toPixels:function(n,e){return Ke(this,void 0,void 0,function(){var t,r,s,a,o,i,u,l,c,d,p,m,v,b,y,w,S,N,C,T,E,$,_;return Xe(this,function(R){switch(R.label){case 0:if(t=q(n,"img","toPixels"),n instanceof In||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),s=r[0],a=r[1],(o=t.rank===2?1:t.shape[2])>4||o===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,t.data()];case 1:return i=R.sent(),u=t.min(),l=t.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=R.sent(),d=c[0],p=c[1],m=d[0],v=p[0],u.dispose(),l.dispose(),t.dtype==="float32"){if(m<0||v>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+m+" - "+v+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(m<0||v>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+m+" - "+v+"].")}for(b=t.dtype==="float32"?255:1,y=new Uint8ClampedArray(a*s*4),w=0;w<s*a;++w)S=void 0,N=void 0,C=void 0,T=void 0,o===1?(S=i[w]*b,N=i[w]*b,C=i[w]*b,T=255):o===3?(S=i[3*w]*b,N=i[3*w+1]*b,C=i[3*w+2]*b,T=255):o===4&&(S=i[4*w]*b,N=i[4*w+1]*b,C=i[4*w+2]*b,T=i[4*w+3]*b),y[(E=4*w)+0]=Math.round(S),y[E+1]=Math.round(N),y[E+2]=Math.round(C),y[E+3]=Math.round(T);return e!=null&&(e.width=a,e.height=s,$=e.getContext("2d"),_=new ImageData(y,a,s),$.putImageData(_,0,0)),t!==n&&t.dispose(),[2,y]}})})},fromPixels:ZNe}),QNe=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}(),JNe=function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n}();function Ic(n){X(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),X(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),X(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),JNe.register(n)}var Ec=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return ao(e,n),e.prototype.minimize=function(t,r,s){r===void 0&&(r=!1);var a=this.computeGradients(t,s),o=a.value,i=a.grads;if(s!=null){var u=s.map(function(l){return{name:l.name,tensor:i[l.name]}});this.applyGradients(u)}else this.applyGradients(i);return Os(i),r?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return lwe(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&Os(this.iterations_)},e.prototype.saveIterations=function(){return Ke(this,void 0,void 0,function(){return Xe(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Le(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){return Xe(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){return Xe(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return Ke(this,void 0,void 0,function(){var r;return Xe(this,function(s){switch(s.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=s.sent()[0],[2,t.slice(1)]}})})},e}(QNe);Object.defineProperty(Ec,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var eke=function(n){function e(t,r,s){s===void 0&&(s=null);var a=n.call(this)||this;return a.learningRate=t,a.rho=r,a.epsilon=s,a.accumulatedGrads=[],a.accumulatedUpdates=[],s==null&&(a.epsilon=ue.backend.epsilon()),a}return ao(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(s){return s.name}):Object.keys(t)).forEach(function(s,a){var o=ue.registeredVariables[s];r.accumulatedGrads[a]==null&&(r.accumulatedGrads[a]={originalName:s+"/accum_grad",variable:Ue(function(){return zt(o).variable(!1)})}),r.accumulatedUpdates[a]==null&&(r.accumulatedUpdates[a]={originalName:s+"/accum_var",variable:Ue(function(){return zt(o).variable(!1)})});var i=Array.isArray(t)?t[a].tensor:t[s];if(i!=null){var u=r.accumulatedGrads[a].variable,l=r.accumulatedUpdates[a].variable;Ue(function(){var c=u.mul(r.rho).add(i.square().mul(1-r.rho)),d=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(i),p=l.mul(r.rho).add(d.square().mul(1-r.rho));u.assign(c),l.assign(p);var m=d.mul(-r.learningRate).add(o);o.assign(m)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Os(this.accumulatedGrads.map(function(t){return t.variable})),Os(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){var t;return Xe(this,function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(s){return{name:s.originalName,tensor:s.variable}}))]}})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){var r;return Xe(this,function(s){switch(s.label){case 0:return[4,this.extractIterations(t)];case 1:return t=s.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e}(Ec);Ic(eke);var tke=function(n){function e(t,r){r===void 0&&(r=.1);var s=n.call(this)||this;return s.learningRate=t,s.initialAccumulatorValue=r,s.accumulatedGrads=[],s}return ao(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(s){return s.name}):Object.keys(t)).forEach(function(s,a){var o=ue.registeredVariables[s];r.accumulatedGrads[a]==null&&(r.accumulatedGrads[a]={originalName:s+"/accumulator",variable:Ue(function(){return Do(o.shape,r.initialAccumulatorValue).variable(!1)})});var i=Array.isArray(t)?t[a].tensor:t[s];if(i!=null){var u=r.accumulatedGrads[a].variable;Ue(function(){var l=u.add(i.square());u.assign(l);var c=i.div(l.add(ue.backend.epsilon()).sqrt()).mul(-r.learningRate).add(o);o.assign(c)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Os(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){return Xe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e}(Ec);Ic(tke);var nke=function(n){function e(t,r,s,a){a===void 0&&(a=null);var o=n.call(this)||this;return o.learningRate=t,o.beta1=r,o.beta2=s,o.epsilon=a,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Ue(function(){o.accBeta1=Le(r).variable(),o.accBeta2=Le(s).variable()}),a==null&&(o.epsilon=ue.backend.epsilon()),o}return ao(e,n),e.prototype.applyGradients=function(t){var r=this,s=Array.isArray(t)?t.map(function(a){return a.name}):Object.keys(t);Ue(function(){var a=gr(1,r.accBeta1),o=gr(1,r.accBeta2);s.forEach(function(i,u){var l=ue.registeredVariables[i];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:i+"/m",variable:Ue(function(){return zt(l).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:i+"/v",variable:Ue(function(){return zt(l).variable(!1)})});var c=Array.isArray(t)?t[u].tensor:t[i];if(c!=null){var d=r.accumulatedFirstMoment[u].variable,p=r.accumulatedSecondMoment[u].variable,m=d.mul(r.beta1).add(c.mul(1-r.beta1)),v=p.mul(r.beta2).add(c.square().mul(1-r.beta2)),b=m.div(a),y=v.div(o);d.assign(m),p.assign(v);var w=b.div(y.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(w)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Os(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Os(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){var t;return Xe(this,function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(s){return{name:s.originalName,tensor:s.variable}}))]}})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){var r,s=this;return Xe(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),Ue(function(){s.accBeta1.assign(o0(s.beta1,s.iterations_+1)),s.accBeta2.assign(o0(s.beta2,s.iterations_+1))}),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e}(Ec);Ic(nke);var rke=function(n){function e(t,r,s,a,o){a===void 0&&(a=null),o===void 0&&(o=0);var i=n.call(this)||this;return i.learningRate=t,i.beta1=r,i.beta2=s,i.epsilon=a,i.decay=o,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],Ue(function(){i.iteration=Le(0).variable(),i.accBeta1=Le(r).variable()}),a==null&&(i.epsilon=ue.backend.epsilon()),i}return ao(e,n),e.prototype.applyGradients=function(t){var r=this,s=Array.isArray(t)?t.map(function(a){return a.name}):Object.keys(t);Ue(function(){var a=gr(1,r.accBeta1),o=Ga(-r.learningRate,r.iteration.mul(r.decay).add(1));s.forEach(function(i,u){var l=ue.registeredVariables[i];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:i+"/m",variable:zt(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:i+"/v",variable:zt(l).variable(!1)});var c=Array.isArray(t)?t[u].tensor:t[i];if(c!=null){var d=r.accumulatedFirstMoment[u].variable,p=r.accumulatedWeightedInfNorm[u].variable,m=d.mul(r.beta1).add(c.mul(1-r.beta1)),v=p.mul(r.beta2),b=c.abs(),y=v.maximum(b);d.assign(m),p.assign(y);var w=o.div(a).mul(m.div(y.add(r.epsilon))).add(l);l.assign(w)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Os(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Os(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){return Xe(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){return Xe(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e}(Ec);Ic(rke);var eW=function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return ao(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(s){return s.name}):Object.keys(t)).forEach(function(s,a){var o=Array.isArray(t)?t[a].tensor:t[s];if(o!=null){var i=ue.registeredVariables[s];Ue(function(){var u=r.c.mul(o).add(i);i.assign(u)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=C1e(Le(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){return Xe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e}(Ec);Ic(eW);var ske=function(n){function e(t,r,s){s===void 0&&(s=!1);var a=n.call(this,t)||this;return a.learningRate=t,a.momentum=r,a.useNesterov=s,a.accumulations=[],a.m=Le(a.momentum),a}return ao(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(s){return s.name}):Object.keys(t)).forEach(function(s,a){var o=ue.registeredVariables[s];r.accumulations[a]==null&&(r.accumulations[a]={originalName:s+"/momentum",variable:Ue(function(){return zt(o).variable(!1)})});var i=r.accumulations[a].variable,u=Array.isArray(t)?t[a].tensor:t[s];u!=null&&Ue(function(){var l,c=r.m.mul(i).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(o):r.c.mul(c).add(o),i.assign(c),o.assign(l)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Os(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){return Xe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e}(eW);Ic(ske);var ake=function(n){function e(t,r,s,a,o){r===void 0&&(r=.9),s===void 0&&(s=0),a===void 0&&(a=null),o===void 0&&(o=!1);var i=n.call(this)||this;if(i.learningRate=t,i.decay=r,i.momentum=s,i.epsilon=a,i.accumulatedMeanSquares=[],i.accumulatedMoments=[],i.accumulatedMeanGrads=[],i.centered=o,a==null&&(i.epsilon=ue.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return i}return ao(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(s){return s.name}):Object.keys(t)).forEach(function(s,a){var o=ue.registeredVariables[s];r.accumulatedMeanSquares[a]==null&&(r.accumulatedMeanSquares[a]={originalName:s+"/rms",variable:Ue(function(){return zt(o).variable(!1)})}),r.accumulatedMoments[a]==null&&(r.accumulatedMoments[a]={originalName:s+"/momentum",variable:Ue(function(){return zt(o).variable(!1)})}),r.accumulatedMeanGrads[a]==null&&r.centered&&(r.accumulatedMeanGrads[a]={originalName:s+"/mg",variable:Ue(function(){return zt(o).variable(!1)})});var i=Array.isArray(t)?t[a].tensor:t[s];if(i!=null){var u=r.accumulatedMeanSquares[a].variable,l=r.accumulatedMoments[a].variable;Ue(function(){var c=u.mul(r.decay).add(i.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[a].variable,p=d.mul(r.decay).add(i.mul(1-r.decay)),m=l.mul(r.momentum).add(i.mul(r.learningRate).div(c.sub(p.square().add(r.epsilon)).sqrt()));u.assign(c),d.assign(p),l.assign(m);var v=o.sub(m);o.assign(v)}else{var b=u.mul(r.decay).add(i.square().mul(1-r.decay));m=l.mul(r.momentum).add(i.mul(r.learningRate).div(b.add(r.epsilon).sqrt())),u.assign(b),l.assign(m),v=o.sub(m),o.assign(v)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Os(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Os(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Os(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){var t;return Xe(this,function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(s){return{name:s.originalName,tensor:s.variable}}))]}})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){var r;return Xe(this,function(s){switch(s.label){case 0:return[4,this.extractIterations(t)];case 1:return t=s.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e}(Ec);Ic(ake);In.prototype.squaredDifference=function(n){return mU(this,n)},we=ANe;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var IN=function(n,e){return IN=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var s in r)r.hasOwnProperty(s)&&(t[s]=r[s])},IN(n,e)};function gt(n,e){IN(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var es=function(){return es=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},es.apply(this,arguments)};function tt(n,e,t,r){function s(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function i(c){try{l(r.next(c))}catch(d){o(d)}}function u(c){try{l(r.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):s(c.value).then(i,u)}l((r=r.apply(n,[])).next())})}function nt(n,e){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,s,a,o;return o={next:i(0),throw:i(1),return:i(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function i(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,s&&(a=l[0]&2?s.return:l[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,l[1])).done)return a;switch(s=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){t.label=l[1];break}if(l[0]===6&&t.label<a[1]){t.label=a[1],a=l;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(l);break}a[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(c){l=[6,c],s=0}finally{r=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Bp(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),s=0,e=0;e<t;e++)for(var a=arguments[e],o=0,i=a.length;o<i;o++,s++)r[s]=a[o];return r}var Ph=function(){function n(e,t){if(!Hl(e)||!Hl(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n}();function P1(n,e){return n instanceof In&&n.shape.length===e}function oke(n){return P1(n,2)}function B1(n){return P1(n,3)}function Tu(n){return P1(n,4)}function ike(n){return n%1!==0}function N3(n){return n%2===0}function uke(n,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(n*t)/t}function k3(n){return n&&n.width&&n.height}function lke(n,e){var t=n.width,r=n.height,s=e/Math.max(r,t);return new Ph(Math.round(t*s),Math.round(r*s))}function rE(n){return n.reduce(function(e,t){return e.add(t)},new Ht(0,0)).div(new Ht(n.length,n.length))}function dm(n,e,t){return Array(n).fill(0).map(function(r,s){return e+s*t})}function Hl(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||n===0}function T3(n){return Hl(n)&&0<=n&&n<=1}var Ht=function(){function n(e,t){this._x=e,this._y=t}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)},n.prototype.sub=function(e){return new n(this.x-e.x,this.y-e.y)},n.prototype.mul=function(e){return new n(this.x*e.x,this.y*e.y)},n.prototype.div=function(e){return new n(this.x/e.x,this.y/e.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n}(),zu=function(){function n(e,t){t===void 0&&(t=!0);var r=e||{},s=[r.left,r.top,r.right,r.bottom].every(Hl),a=[r.x,r.y,r.width,r.height].every(Hl);if(!a&&!s)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var o=a?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],i=o[0],u=o[1],l=o[2],c=o[3];n.assertIsValidBox({x:i,y:u,width:l,height:c},"Box.constructor",t),this._x=i,this._y=u,this._width=l,this._height=c}return n.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(Hl)},n.assertIsValidBox=function(e,t,r){if(r===void 0&&(r=!1),!n.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new Ht(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new Ht(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new Ht(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new Ht(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(o){return Math.round(o)}),t=e[0],r=e[1],s=e[2],a=e[3];return new n({x:t,y:r,width:s,height:a})},n.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(o){return Math.floor(o)}),t=e[0],r=e[1],s=e[2],a=e[3];return new n({x:t,y:r,width:s,height:a})},n.prototype.toSquare=function(){var e=this,t=e.x,r=e.y,s=e.width,a=e.height,o=Math.abs(s-a);return s<a&&(t-=o/2,s+=o),a<s&&(r-=o/2,a+=o),new n({x:t,y:r,width:s,height:a})},n.prototype.rescale=function(e){var t=k3(e)?e.width:e,r=k3(e)?e.height:e;return new n({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},n.prototype.pad=function(e,t){var r=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],s=r[0],a=r[1],o=r[2],i=r[3];return new n({x:s,y:a,width:o,height:i})},n.prototype.clipAtImageBorders=function(e,t){var r=this,s=r.x,a=r.y,o=r.right,i=r.bottom,u=Math.max(s,0),l=Math.max(a,0),c=o-u,d=i-l,p=Math.min(c,e-u),m=Math.min(d,t-l);return new n({x:u,y:l,width:p,height:m}).floor()},n.prototype.shift=function(e,t){var r=this,s=r.width,a=r.height,o=this.x+e,i=this.y+t;return new n({x:o,y:i,width:s,height:a})},n.prototype.padAtBorders=function(e,t){var r=this.width+1,s=this.height+1,a=1,o=1,i=r,u=s,l=this.left,c=this.top,d=this.right,p=this.bottom;return d>t&&(i=-d+t+r,d=t),p>e&&(u=-p+e+s,p=e),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:o,edy:u,dx:a,edx:i,y:c,ey:p,x:l,ex:d,w:r,h:s}},n.prototype.calibrate=function(e){return new n({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},n}(),z1=function(n){gt(e,n);function e(t,r,s,a,o){return o===void 0&&(o=!1),n.call(this,{left:t,top:r,right:s,bottom:a},o)||this}return e}(zu),tW=function(){function n(e,t,r,s,a){this._imageDims=new Ph(a.width,a.height),this._score=e,this._classScore=t,this._className=r,this._box=new zu(s).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new zu(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},n}(),Ho=function(n){gt(e,n);function e(t,r,s){return n.call(this,t,t,"",r,s)||this}return e.prototype.forSize=function(t,r){var s=n.prototype.forSize.call(this,t,r),a=s.score,o=s.relativeBox,i=s.imageDims;return new e(a,o,i)},e}(tW);function cke(n,e,t){t===void 0&&(t=!0);var r=Math.max(0,Math.min(n.right,e.right)-Math.max(n.left,e.left)),s=Math.max(0,Math.min(n.bottom,e.bottom)-Math.max(n.top,e.top)),a=r*s;return t?a/(n.area+e.area-a):a/Math.min(n.area,e.area)}function hke(n){var e=n.map(function(i){return i.x}),t=n.map(function(i){return i.y}),r=e.reduce(function(i,u){return u<i?u:i},1/0),s=t.reduce(function(i,u){return u<i?u:i},1/0),a=e.reduce(function(i,u){return i<u?u:i},0),o=t.reduce(function(i,u){return i<u?u:i},0);return new z1(r,s,a,o)}function fm(n,e,t,r){r===void 0&&(r=!0);for(var s=e.map(function(i,u){return{score:i,boxIndex:u}}).sort(function(i,u){return i.score-u.score}).map(function(i){return i.boxIndex}),a=[],o=function(){var i=s.pop();a.push(i);for(var u=s,l=[],c=0;c<u.length;c++){var d=u[c],p=n[i],m=n[d];l.push(cke(p,m,r))}s=s.filter(function(v,b){return l[b]<=t})};s.length>0;)o();return a}function lv(n,e){return Ue(function(){var t=e[0],r=e[1],s=e[2],a=Do(Bp(n.shape.slice(0,3),[1]),t),o=Do(Bp(n.shape.slice(0,3),[1]),r),i=Do(Bp(n.shape.slice(0,3),[1]),s),u=hr([a,o,i],3);return gr(n,u)})}function dke(n,e){return e===void 0&&(e=!1),Ue(function(){var t=n.shape.slice(1),r=t[0],s=t[1];if(r===s)return n;var a=Math.abs(r-s),o=Math.round(a*(e?.5:1)),i=r>s?2:1,u=function(m){var v=n.shape.slice();return v[i]=m,Do(v,0)},l=u(o),c=a-l.shape[i],d=e&&c?u(c):null,p=[d,n,l].filter(function(m){return!!m}).map(function(m){return m.toFloat()});return hr(p,i)})}function rC(n){return 1/(1+Math.exp(-n))}var sE=function(n){gt(e,n);function e(t,r,s,a,o){return o===void 0&&(o=!1),n.call(this,{x:t,y:r,width:s,height:a},o)||this}return e}(zu),fke=.5,pke=.43,mke=.45,l0=function(){function n(e,t,r){r===void 0&&(r=new Ht(0,0));var s=t.width,a=t.height;this._imgDims=new Ph(s,a),this._shift=r,this._positions=e.map(function(o){return o.mul(new Ht(s,a)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new Ht(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new Ht(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},n.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Ht(e,t))},n.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},n.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var r=e instanceof Ho?e.box.floor():new zu(e);return this.shiftBy(r.x,r.y).align(null,t)}var s=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),a=s.useDlibAlignment,o=s.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(o)},n.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],r=e[1],s=e[2],a=function(d){return s.sub(d).magnitude()},o=(a(t)+a(r))/2,i=Math.floor(o/mke),u=rE(e),l=Math.floor(Math.max(0,u.x-fke*i)),c=Math.floor(Math.max(0,u.y-pke*i));return new sE(l,c,Math.min(i,this.imageWidth+l),Math.min(i,this.imageHeight+c))},n.prototype.alignMinBbox=function(e){var t=hke(this.positions);return t.pad(t.width*e,t.height*e)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n}(),gke=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],rE([t[3],t[4]])]},e}(l0),vke=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(rE)},e}(l0),I3=function(){function n(e,t){this._label=e,this._distance=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+uke(this.distance)+")":"")},n}(),E3=function(n){gt(e,n);function e(t,r){var s=n.call(this,t)||this;return s._label=r,s}return e.assertIsValidLabeledBox=function(t,r){if(zu.assertIsValidBox(t,r),!Hl(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(zu),Bl=function(){function n(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},n.fromJSON=function(e){var t=e.descriptors.map(function(r){return new Float32Array(r)});return new n(e.label,t)},n}();(function(n){gt(e,n);function e(t,r,s,a){var o=n.call(this,t,r)||this;return o._score=s,o._classScore=a,o}return e.assertIsValidPredictedBox=function(t,r){if(E3.assertIsValidLabeledBox(t,r),!T3(t.score)||!T3(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(E3);function yke(n){return n.detection instanceof Ho}function aE(n,e){var t={detection:e};return Object.assign({},n,t)}function nW(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:e}}function rW(n){var e="";if(!n)try{n=require("fs")}catch(r){e=r.toString()}var t=n?function(r){return new Promise(function(s,a){n.readFile(r,function(o,i){return o?a(o):s(i)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function sW(){var n=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},s=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},a=rW();return es({Canvas:n||function(){function o(){}return o}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function o(){}return o}(),Image:e||function(){function o(){}return o}(),ImageData:global.ImageData||function(){function o(){}return o}(),Video:global.HTMLVideoElement||function(){function o(){}return o}(),createCanvasElement:t,createImageElement:r,fetch:s},a)}function aW(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function oW(){return typeof global=="object"&&typeof require=="function"&&typeof BW<"u"&&typeof process<"u"&&!!process.version}var ir;function bke(){if(!ir)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return ir}function EN(n){ir=n}function oE(){aW()&&EN(nW()),oW()&&EN(sW())}function xke(n){if(ir||oE(),!ir)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=n.Canvas,t=e===void 0?ir.Canvas:e,r=n.Image,s=r===void 0?ir.Image:r;ir.Canvas=t,ir.Image=s,ir.createCanvasElement=n.createCanvasElement||function(){return new t},ir.createImageElement=n.createImageElement||function(){return new s},ir.ImageData=n.ImageData||ir.ImageData,ir.Video=n.Video||ir.Video,ir.fetch=n.fetch||ir.fetch,ir.readFile=n.readFile||ir.readFile}var is={getEnv:bke,setEnv:EN,initialize:oE,createBrowserEnv:nW,createFileSystem:rW,createNodejsEnv:sW,monkeyPatch:xke,isBrowser:aW,isNodejs:oW};oE();function iW(n){return!is.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function uc(n){var e=is.getEnv(),t=e.Canvas,r=e.CanvasRenderingContext2D;if(n instanceof r)return n;var s=iW(n);if(!(s instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=s.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}var _3;(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"})(_3||(_3={}));function uW(n){var e=is.getEnv(),t=e.Image,r=e.Video;return n instanceof t&&n.complete||n instanceof r&&n.readyState>=3}function wke(n){return new Promise(function(e,t){if(n instanceof is.getEnv().Canvas||uW(n))return e();function r(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",r),a.currentTarget.removeEventListener("error",s),e(a))}function s(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",r),a.currentTarget.removeEventListener("error",s),t(a))}n.addEventListener("load",r),n.addEventListener("error",s)})}function lW(n){var e=is.getEnv(),t=e.Image,r=e.Video;return n instanceof t?new Ph(n.naturalWidth,n.naturalHeight):n instanceof r?new Ph(n.videoWidth,n.videoHeight):new Ph(n.width,n.height)}function V1(n){var e=n.width,t=n.height,r=is.getEnv().createCanvasElement,s=r();return s.width=e,s.height=t,s}function iE(n,e){var t=is.getEnv().ImageData;if(!(n instanceof t)&&!uW(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=lW(n),s=r.width,a=r.height,o=V1({width:s,height:a});return n instanceof t?uc(o).putImageData(n,0,0):uc(o).drawImage(n,0,0,s,a),o}function Ske(n,e){return tt(this,void 0,void 0,function(){var t,r,s,a,o,i;return nt(this,function(u){switch(u.label){case 0:return t=is.getEnv().createCanvasElement(),r=n.shape.slice(Tu(n)?1:0),s=r[0],a=r[1],o=r[2],i=Ue(function(){return n.as3D(s,a,o).toInt()}),[4,nE.toPixels(i,t)];case 1:return u.sent(),i.dispose(),[2,t]}})})}function R3(n){var e=is.getEnv(),t=e.Image,r=e.Canvas,s=e.Video;return n instanceof t||n instanceof r||n instanceof s}function Cke(n,e,t){t===void 0&&(t=!1);var r=is.getEnv(),s=r.Image,a=r.Canvas;if(!(n instanceof s||n instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=lW(n),i=e/Math.max(o.height,o.width),u=i*o.width,l=i*o.height,c=V1({width:e,height:e}),d=n instanceof a?n:iE(n),p=Math.abs(u-l)/2,m=t&&u<l?p:0,v=t&&l<u?p:0;return uc(c).drawImage(d,m,v,u,l),c}var c0=function(){function n(e,t){var r=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(s,a){if(B1(s)){r._imageTensors[a]=s,r._inputDimensions[a]=s.shape;return}if(Tu(s)){var o=s.shape[0];if(o!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+o+" passed, but not supported in input array");r._imageTensors[a]=s,r._inputDimensions[a]=s.shape.slice(1);return}var i=s instanceof is.getEnv().Canvas?s:iE(s);r._canvases[a]=i,r._inputDimensions[a]=[i.height,i.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var e=this;return dm(this.batchSize,0,1).map(function(t,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},n.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},n.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},n.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},n.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),r=this.getInputHeight(e);return lke({width:t,height:r},this.inputSize)},n.prototype.toBatchTensor=function(e,t){var r=this;return t===void 0&&(t=!0),this._inputSize=e,Ue(function(){var s=dm(r.batchSize,0,1).map(function(o){var i=r.getInput(o);if(i instanceof In){var u=Tu(i)?i:i.expandDims();return u=dke(u,t),(u.shape[1]!==e||u.shape[2]!==e)&&(u=YI.resizeBilinear(u,[e,e])),u.as3D(e,e,3)}if(i instanceof is.getEnv().Canvas)return nE.fromPixels(Cke(i,e,t));throw new Error("toBatchTensor - at batchIdx "+o+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+i)}),a=ua(s.map(function(o){return o.toFloat()})).as4D(r.batchSize,e,e,3);return a})},n}();function Ar(n){return tt(this,void 0,void 0,function(){var e,t,r;return nt(this,function(s){switch(s.label){case 0:if(n instanceof c0)return[2,n];if(e=Array.isArray(n)?n:[n],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(a){return Array.isArray(n)?" at input index "+a+":":""},r=e.map(iW),r.forEach(function(a,o){if(!R3(a)&&!B1(a)&&!Tu(a))throw typeof e[o]=="string"?new Error("toNetInput -"+t(o)+" string passed, but could not resolve HTMLElement for element id "+e[o]):new Error("toNetInput -"+t(o)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Tu(a)){var i=a.shape[0];if(i!==1)throw new Error("toNetInput -"+t(o)+" tf.Tensor4D with batchSize "+i+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(a){return R3(a)&&wke(a)}))];case 1:return s.sent(),[2,new c0(r,Array.isArray(n))]}})})}function uE(n,e){return tt(this,void 0,void 0,function(){var t,r,s,a,o,i,u;return nt(this,function(l){switch(l.label){case 0:return t=is.getEnv().Canvas,r=n,n instanceof t?[3,5]:[4,Ar(n)];case 1:if(s=l.sent(),s.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return a=s.getInput(0),a instanceof t?(o=a,[3,4]):[3,2];case 2:return[4,Ske(a)];case 3:o=l.sent(),l.label=4;case 4:r=o,l.label=5;case 5:return i=uc(r),u=e.map(function(c){return c instanceof Ho?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(c){var d=c.x,p=c.y,m=c.width,v=c.height,b=V1({width:m,height:v});return uc(b).putImageData(i.getImageData(d,p,m,v),0,0),b})]}})})}function lE(n,e){return tt(this,void 0,void 0,function(){return nt(this,function(t){if(!B1(n)&&!Tu(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Tu(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Ue(function(){var r=n.shape.slice(Tu(n)?1:0),s=r[0],a=r[1],o=r[2],i=e.map(function(l){return l instanceof Ho?l.forSize(a,s).box:l}).map(function(l){return l.clipAtImageBorders(a,s)}),u=i.map(function(l){var c=l.x,d=l.y,p=l.width,m=l.height;return MU(n.as3D(s,a,o),[d,c,0],[m,p,o])});return u})]})})}function Nke(n,e){return tt(this,void 0,void 0,function(){var t,r;return nt(this,function(s){switch(s.label){case 0:return t=is.getEnv().fetch,[4,t(n,e)];case 1:if(r=s.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function kke(n){return tt(this,void 0,void 0,function(){return nt(this,function(e){switch(e.label){case 0:return[4,Nke(n)];case 1:return[2,e.sent().json()]}})})}function cW(n,e){var t=e+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:t};if(n==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");var s=n.split("/").filter(function(i){return i}),a=n.endsWith(".json")?s[s.length-1]:t,o=r+(n.endsWith(".json")?s.slice(0,s.length-1):s).join("/");return o=n.startsWith("/")?"/"+o:o,{modelBaseUri:o,manifestUri:o==="/"?"/"+a:o+"/"+a}}function Tke(n,e){return tt(this,void 0,void 0,function(){var t,r,s,a;return nt(this,function(o){switch(o.label){case 0:return t=cW(n,e),r=t.manifestUri,s=t.modelBaseUri,[4,kke(r)];case 1:return a=o.sent(),[2,JU.loadWeights(a,s)]}})})}var Mi=function(){function n(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),r=t.obj,s=t.objProp;return r[s]},n.prototype.reassignParamFromPath=function(e,t){var r=this.traversePropertyPath(e),s=r.obj,a=r.objProp;s[a].dispose(),s[a]=t},n.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof td})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof td)})},n.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var r=t.path,s=t.tensor;e.reassignParamFromPath(r,s.variable())})},n.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var r=t.path,s=t.tensor,a=Ur(s.dataSync());s.dispose(),e.reassignParamFromPath(r,a)})},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},n.prototype.load=function(e){return tt(this,void 0,void 0,function(){return nt(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},n.prototype.loadFromUri=function(e){return tt(this,void 0,void 0,function(){var t;return nt(this,function(r){switch(r.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,Tke(e,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},n.prototype.loadFromDisk=function(e){return tt(this,void 0,void 0,function(){var t,r,s,a,o,i,u,l,c,d;return nt(this,function(p){switch(p.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=is.getEnv().readFile,r=cW(e,this.getDefaultModelName()),s=r.manifestUri,a=r.modelBaseUri,o=function(m){return Promise.all(m.map(function(v){return t(v).then(function(b){return b.buffer})}))},i=JU.weightsLoaderFactory(o),c=(l=JSON).parse,[4,t(s)];case 1:return u=c.apply(l,[p.sent().toString()]),[4,i(u,a)];case 2:return d=p.sent(),this.loadFromWeightMap(d),[2]}})})},n.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),r=t.paramMappings,s=t.params;this._paramMappings=r,this._params=s},n.prototype.extractWeights=function(e){var t=this.extractParams(e),r=t.paramMappings,s=t.params;this._paramMappings=r,this._params=s},n.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(a,o){if(!a.nextObj.hasOwnProperty(o))throw new Error("traversePropertyPath - object does not have property "+o+", for path "+e);return{obj:a.nextObj,objProp:o,nextObj:a.nextObj[o]}},{nextObj:this.params}),r=t.obj,s=t.objProp;if(!r||!s||!(r[s]instanceof In))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:s}},n}();function aa(n,e,t){return Ue(function(){var r=HI(n,e.depthwise_filter,e.pointwise_filter,t,"same");return r=At(r,e.bias),r})}function sC(n,e,t){return t===void 0&&(t=!1),Ue(function(){var r=_n(t?At(Fa(n,e.conv0.filters,[2,2],"same"),e.conv0.bias):aa(n,e.conv0,[2,2])),s=aa(r,e.conv1,[1,1]),a=_n(At(r,s)),o=aa(a,e.conv2,[1,1]);return _n(At(r,At(s,o)))})}function Xy(n,e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),Ue(function(){var s=_n(t?At(Fa(n,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):aa(n,e.conv0,r?[2,2]:[1,1])),a=aa(s,e.conv1,[1,1]),o=_n(At(s,a)),i=aa(o,e.conv2,[1,1]),u=_n(At(s,At(a,i))),l=aa(u,e.conv3,[1,1]);return _n(At(s,At(a,At(i,l))))})}function Ya(n,e,t,r){return t===void 0&&(t="same"),r===void 0&&(r=!1),Ue(function(){var s=At(Fa(n,e.filters,[1,1],t),e.bias);return r?_n(s):s})}function Li(n,e){Object.keys(n).forEach(function(t){e.some(function(r){return r.originalPath===t})||n[t].dispose()})}function U1(n,e){return function(t,r,s,a){var o=As(n(t*r*s*s),[s,s,t,r]),i=Zn(n(r));return e.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:o,bias:i}}}function cE(n,e){return function(t,r,s){var a=Nu(n(t*r),[t,r]),o=Zn(n(r));return e.push({paramPath:s+"/weights"},{paramPath:s+"/bias"}),{weights:a,bias:o}}}var hW=function(){function n(e,t,r){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=r}return n}();function hE(n,e){return function(t,r,s){var a=As(n(9*t),[3,3,t,1]),o=As(n(t*r),[1,1,t,r]),i=Zn(n(r));return e.push({paramPath:s+"/depthwise_filter"},{paramPath:s+"/pointwise_filter"},{paramPath:s+"/bias"}),new hW(a,o,i)}}function dE(n){return function(e){var t=n(e+"/depthwise_filter",4),r=n(e+"/pointwise_filter",4),s=n(e+"/bias",1);return new hW(t,r,s)}}function el(n,e){return function(t,r,s){var a=n[t];if(!P1(a,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+a);return e.push({originalPath:t,paramPath:s||t}),a}}function Pi(n){var e=n;function t(s){var a=e.slice(0,s);return e=e.slice(s),a}function r(){return e}return{extractWeights:t,getRemainingWeights:r}}function dW(n,e){var t=U1(n,e),r=hE(n,e);function s(o,i,u,l){l===void 0&&(l=!1);var c=l?t(o,i,3,u+"/conv0"):r(o,i,u+"/conv0"),d=r(i,i,u+"/conv1"),p=r(i,i,u+"/conv2");return{conv0:c,conv1:d,conv2:p}}function a(o,i,u,l){l===void 0&&(l=!1);var c=s(o,i,u,l),d=c.conv0,p=c.conv1,m=c.conv2,v=r(i,i,u+"/conv3");return{conv0:d,conv1:p,conv2:m,conv3:v}}return{extractDenseBlock3Params:s,extractDenseBlock4Params:a}}function Ike(n){var e=[],t=Pi(n),r=t.extractWeights,s=t.getRemainingWeights,a=dW(r,e).extractDenseBlock4Params,o=a(3,32,"dense0",!0),i=a(32,64,"dense1"),u=a(64,128,"dense2"),l=a(128,256,"dense3");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:e,params:{dense0:o,dense1:i,dense2:u,dense3:l}}}function fW(n){return function(e){var t=n(e+"/filters",4),r=n(e+"/bias",1);return{filters:t,bias:r}}}function pW(n,e){var t=el(n,e),r=fW(t),s=dE(t);function a(i,u){u===void 0&&(u=!1);var l=u?r(i+"/conv0"):s(i+"/conv0"),c=s(i+"/conv1"),d=s(i+"/conv2");return{conv0:l,conv1:c,conv2:d}}function o(i,u){u===void 0&&(u=!1);var l=u?r(i+"/conv0"):s(i+"/conv0"),c=s(i+"/conv1"),d=s(i+"/conv2"),p=s(i+"/conv3");return{conv0:l,conv1:c,conv2:d,conv3:p}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:o}}function Eke(n){var e=[],t=pW(n,e).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return Li(n,e),{params:r,paramMappings:e}}var mW=function(n){gt(e,n);function e(){return n.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return Ue(function(){var s=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],o=lv(s,a).div(Le(255)),i=Xy(o,r.dense0,!0);return i=Xy(i,r.dense1),i=Xy(i,r.dense2),i=Xy(i,r.dense3),i=iv(i,[7,7],[2,2],"valid"),i})},e.prototype.forward=function(t){return tt(this,void 0,void 0,function(){var r;return nt(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Ar(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Eke(t)},e.prototype.extractParams=function(t){return Ike(t)},e}(Mi);function No(n,e){return Ue(function(){return At(F1(n,e.weights),e.bias)})}function _ke(n,e,t){var r=[],s=Pi(n),a=s.extractWeights,o=s.getRemainingWeights,i=cE(a,r),u=i(e,t,"fc");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:r,params:{fc:u}}}function Rke(n){var e=[],t=el(n,e);function r(a){var o=t(a+"/weights",2),i=t(a+"/bias",1);return{weights:o,bias:i}}var s={fc:r("fc")};return Li(n,e),{params:s,paramMappings:e}}function gW(n){var e={},t={};return Object.keys(n).forEach(function(r){var s=r.startsWith("fc")?t:e;s[r]=n[r]}),{featureExtractorMap:e,classifierMap:t}}var vW=function(n){gt(e,n);function e(t,r){var s=n.call(this,t)||this;return s._faceFeatureExtractor=r,s}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,s=this.params;if(!s)throw new Error(this._name+" - load model before inference");return Ue(function(){var a=t instanceof c0?r.faceFeatureExtractor.forwardInput(t):t;return No(a.as2D(a.shape[0],-1),s.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),s=r.params,a=r.paramMappings;this._params=s,this._paramMappings=a},e.prototype.extractClassifierParams=function(t){return _ke(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var r=gW(t),s=r.featureExtractorMap,a=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(s),Rke(a)},e.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),s=this.getClassifierChannelsOut(),a=s*r+s,o=t.slice(0,t.length-a),i=t.slice(t.length-a);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},e}(Mi),A3=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Ake=function(){function n(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);A3.forEach(function(r,s){t[r]=e[s]})}return n.prototype.asSortedArray=function(){var e=this;return A3.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,r){return r.probability-t.probability})},n}(),Dke=function(n){gt(e,n);function e(t){return t===void 0&&(t=new mW),n.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var r=this;return Ue(function(){return Oi(r.runNet(t))})},e.prototype.forward=function(t){return tt(this,void 0,void 0,function(){var r;return nt(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Ar(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.predictExpressions=function(t){return tt(this,void 0,void 0,function(){var r,s,a,o,i=this;return nt(this,function(u){switch(u.label){case 0:return[4,Ar(t)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return s=u.sent(),[4,Promise.all(dr(s).map(function(l){return tt(i,void 0,void 0,function(){var c;return nt(this,function(d){switch(d.label){case 0:return[4,l.data()];case 1:return c=d.sent(),l.dispose(),[2,c]}})})}))];case 3:return a=u.sent(),s.dispose(),o=a.map(function(l){return new Ake(l)}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(vW);function yW(n,e){var t={expressions:e};return Object.assign({},n,t)}function $ke(n){return yke(n)&&n.landmarks instanceof l0&&n.unshiftedLandmarks instanceof l0&&n.alignedRect instanceof Ho}function fE(n,e){var t=n.detection.box,r=e.shiftBy(t.x,t.y),s=r.align(),a=n.detection.imageDims,o=new Ho(n.detection.score,s.rescale(a.reverse()),a),i={landmarks:r,unshiftedLandmarks:e,alignedRect:o};return Object.assign({},n,i)}function Oke(n,e){var t=U1(n,e),r=hE(n,e);function s(o,i,u){var l=r(o,i,u+"/separable_conv0"),c=r(i,i,u+"/separable_conv1"),d=t(o,i,1,u+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:d}}function a(o,i){var u=r(o,o,i+"/separable_conv0"),l=r(o,o,i+"/separable_conv1"),c=r(o,o,i+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:s,extractMainBlockParams:a}}function Fke(n,e){var t=[],r=Pi(n),s=r.extractWeights,a=r.getRemainingWeights,o=Oke(s,t),i=o.extractConvParams,u=o.extractSeparableConvParams,l=o.extractReductionBlockParams,c=o.extractMainBlockParams,d=i(3,32,3,"entry_flow/conv_in"),p=l(32,64,"entry_flow/reduction_block_0"),m=l(64,128,"entry_flow/reduction_block_1"),v={conv_in:d,reduction_block_0:p,reduction_block_1:m},b={};dm(e,0,1).forEach(function(N){b["main_block_"+N]=c(128,"middle_flow/main_block_"+N)});var y=l(128,256,"exit_flow/reduction_block"),w=u(256,512,"exit_flow/separable_conv"),S={reduction_block:y,separable_conv:w};if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{entry_flow:v,middle_flow:b,exit_flow:S}}}function Mke(n,e){var t=el(n,e),r=fW(t),s=dE(t);function a(i){var u=s(i+"/separable_conv0"),l=s(i+"/separable_conv1"),c=r(i+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:c}}function o(i){var u=s(i+"/separable_conv0"),l=s(i+"/separable_conv1"),c=s(i+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:s,extractReductionBlockParams:a,extractMainBlockParams:o}}function Lke(n,e){var t=[],r=Mke(n,t),s=r.extractConvParams,a=r.extractSeparableConvParams,o=r.extractReductionBlockParams,i=r.extractMainBlockParams,u=s("entry_flow/conv_in"),l=o("entry_flow/reduction_block_0"),c=o("entry_flow/reduction_block_1"),d={conv_in:u,reduction_block_0:l,reduction_block_1:c},p={};dm(e,0,1).forEach(function(y){p["main_block_"+y]=i("middle_flow/main_block_"+y)});var m=o("exit_flow/reduction_block"),v=a("exit_flow/separable_conv"),b={reduction_block:m,separable_conv:v};return Li(n,t),{params:{entry_flow:d,middle_flow:p,exit_flow:b},paramMappings:t}}function bW(n,e,t){return At(Fa(n,e.filters,t,"same"),e.bias)}function aC(n,e,t){t===void 0&&(t=!0);var r=t?_n(n):n;return r=aa(r,e.separable_conv0,[1,1]),r=aa(_n(r),e.separable_conv1,[1,1]),r=kr(r,[3,3],[2,2],"same"),r=At(r,bW(n,e.expansion_conv,[2,2])),r}function Pke(n,e){var t=aa(_n(n),e.separable_conv0,[1,1]);return t=aa(_n(t),e.separable_conv1,[1,1]),t=aa(_n(t),e.separable_conv2,[1,1]),t=At(t,n),t}var Bke=function(n){gt(e,n);function e(t){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return e.prototype.forwardInput=function(t){var r=this,s=this.params;if(!s)throw new Error("TinyXception - load model before inference");return Ue(function(){var a=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],i=lv(a,o).div(Le(256)),u=_n(bW(i,s.entry_flow.conv_in,[2,2]));return u=aC(u,s.entry_flow.reduction_block_0,!1),u=aC(u,s.entry_flow.reduction_block_1),dm(r._numMainBlocks,0,1).forEach(function(l){u=Pke(u,s.middle_flow["main_block_"+l])}),u=aC(u,s.exit_flow.reduction_block),u=_n(aa(u,s.exit_flow.separable_conv,[1,1])),u})},e.prototype.forward=function(t){return tt(this,void 0,void 0,function(){var r;return nt(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Ar(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Lke(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return Fke(t,this._numMainBlocks)},e}(Mi);function zke(n){var e=[],t=Pi(n),r=t.extractWeights,s=t.getRemainingWeights,a=cE(r,e),o=a(512,1,"fc/age"),i=a(512,2,"fc/gender");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:e,params:{fc:{age:o,gender:i}}}}function Vke(n){var e=[],t=el(n,e);function r(a){var o=t(a+"/weights",2),i=t(a+"/bias",1);return{weights:o,bias:i}}var s={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Li(n,e),{params:s,paramMappings:e}}var h0;(function(n){n.FEMALE="female",n.MALE="male"})(h0||(h0={}));var Uke=function(n){gt(e,n);function e(t){t===void 0&&(t=new Bke(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,s=this.params;if(!s)throw new Error(this._name+" - load model before inference");return Ue(function(){var a=t instanceof c0?r.faceFeatureExtractor.forwardInput(t):t,o=iv(a,[7,7],[2,2],"valid").as2D(a.shape[0],-1),i=No(o,s.fc.age).as1D(),u=No(o,s.fc.gender);return{age:i,gender:u}})},e.prototype.forwardInput=function(t){var r=this;return Ue(function(){var s=r.runNet(t),a=s.age,o=s.gender;return{age:a,gender:Oi(o)}})},e.prototype.forward=function(t){return tt(this,void 0,void 0,function(){var r;return nt(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Ar(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return tt(this,void 0,void 0,function(){var r,s,a,o,i,u,l=this;return nt(this,function(c){switch(c.label){case 0:return[4,Ar(t)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return s=c.sent(),a=dr(s.age),o=dr(s.gender),i=a.map(function(d,p){return{ageTensor:d,genderTensor:o[p]}}),[4,Promise.all(i.map(function(d){var p=d.ageTensor,m=d.genderTensor;return tt(l,void 0,void 0,function(){var v,b,y,w,S;return nt(this,function(N){switch(N.label){case 0:return[4,p.data()];case 1:return v=N.sent()[0],[4,m.data()];case 2:return b=N.sent()[0],y=b>.5,w=y?h0.MALE:h0.FEMALE,S=y?b:1-b,p.dispose(),m.dispose(),[2,{age:v,gender:w,genderProbability:S}]}})})}))];case 3:return u=c.sent(),s.age.dispose(),s.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),s=r.params,a=r.paramMappings;this._params=s,this._paramMappings=a},e.prototype.extractClassifierParams=function(t){return zke(t)},e.prototype.extractParamsFromWeigthMap=function(t){var r=gW(t),s=r.featureExtractorMap,a=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(s),Vke(a)},e.prototype.extractParams=function(t){var r=1539,s=t.slice(0,t.length-r),a=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(s),this.extractClassifierParams(a)},e}(Mi),xW=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.postProcess=function(t,r,s){var a=s.map(function(i){var u=i.width,l=i.height,c=r/Math.max(l,u);return{width:u*c,height:l*c}}),o=a.length;return Ue(function(){var i=function(p,m){return ua([Do([68],p),Do([68],m)],1).as2D(1,136).as1D()},u=function(p,m){var v=a[p],b=v.width,y=v.height;return m(b,y)?Math.abs(b-y)/2:0},l=function(p){return u(p,function(m,v){return m<v})},c=function(p){return u(p,function(m,v){return v<m})},d=t.mul(Do([o,136],r)).sub(ua(Array.from(Array(o),function(p,m){return i(l(m),c(m))}))).div(ua(Array.from(Array(o),function(p,m){return i(a[m].width,a[m].height)})));return d})},e.prototype.forwardInput=function(t){var r=this;return Ue(function(){var s=r.runNet(t);return r.postProcess(s,t.inputSize,t.inputDimensions.map(function(a){var o=a[0],i=a[1];return{height:o,width:i}}))})},e.prototype.forward=function(t){return tt(this,void 0,void 0,function(){var r;return nt(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Ar(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.detectLandmarks=function(t){return tt(this,void 0,void 0,function(){var r,s,a,o=this;return nt(this,function(i){switch(i.label){case 0:return[4,Ar(t)];case 1:return r=i.sent(),s=Ue(function(){return dr(o.forwardInput(r))}),[4,Promise.all(s.map(function(u,l){return tt(o,void 0,void 0,function(){var c,d,p,m,v;return nt(this,function(b){switch(b.label){case 0:return p=(d=Array).from,[4,u.data()];case 1:return c=p.apply(d,[b.sent()]),m=c.filter(function(y,w){return N3(w)}),v=c.filter(function(y,w){return!N3(w)}),[2,new vke(Array(68).fill(0).map(function(y,w){return new Ht(m[w],v[w])}),{height:r.getInputHeight(l),width:r.getInputWidth(l)})]}})})}))];case 2:return a=i.sent(),s.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?a:a[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(vW),wW=function(n){gt(e,n);function e(t){return t===void 0&&(t=new mW),n.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(xW);function Wke(n){var e=[],t=pW(n,e).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return Li(n,e),{params:r,paramMappings:e}}function Gke(n){var e=[],t=Pi(n),r=t.extractWeights,s=t.getRemainingWeights,a=dW(r,e).extractDenseBlock3Params,o=a(3,32,"dense0",!0),i=a(32,64,"dense1"),u=a(64,128,"dense2");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:e,params:{dense0:o,dense1:i,dense2:u}}}var Hke=function(n){gt(e,n);function e(){return n.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Ue(function(){var s=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],o=lv(s,a).div(Le(255)),i=sC(o,r.dense0,!0);return i=sC(i,r.dense1),i=sC(i,r.dense2),i=iv(i,[14,14],[2,2],"valid"),i})},e.prototype.forward=function(t){return tt(this,void 0,void 0,function(){var r;return nt(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Ar(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Wke(t)},e.prototype.extractParams=function(t){return Gke(t)},e}(Mi),jke=function(n){gt(e,n);function e(t){return t===void 0&&(t=new Hke),n.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(xW);(function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(wW);function qke(n,e){return At(as(n,e.weights),e.biases)}function pE(n,e,t,r,s){s===void 0&&(s="same");var a=e.conv,o=a.filters,i=a.bias,u=Fa(n,o,t,s);return u=At(u,i),u=qke(u,e.scale),r?_n(u):u}function Kke(n,e){return pE(n,e,[1,1],!0)}function SW(n,e){return pE(n,e,[1,1],!1)}function CW(n,e){return pE(n,e,[2,2],!0,"valid")}function Xke(n,e){function t(i,u,l){var c=n(i),d=c.length/(u*l*l);if(ike(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return Ue(function(){return Bu(As(c,[u,d,l,l]),[2,3,1,0])})}function r(i,u,l,c){var d=t(i,u,l),p=Zn(n(u));return e.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:d,bias:p}}function s(i,u){var l=Zn(n(i)),c=Zn(n(i));return e.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}function a(i,u,l,c){var d=r(i,u,l,c+"/conv"),p=s(u,c+"/scale");return{conv:d,scale:p}}function o(i,u,l,c,d){d===void 0&&(d=!1);var p=a((d?.5:1)*i,u,l,c+"/conv1"),m=a(i,u,l,c+"/conv2");return{conv1:p,conv2:m}}return{extractConvLayerParams:a,extractResidualLayerParams:o}}function Yke(n){var e=Pi(n),t=e.extractWeights,r=e.getRemainingWeights,s=[],a=Xke(t,s),o=a.extractConvLayerParams,i=a.extractResidualLayerParams,u=o(4704,32,7,"conv32_down"),l=i(9216,32,3,"conv32_1"),c=i(9216,32,3,"conv32_2"),d=i(9216,32,3,"conv32_3"),p=i(36864,64,3,"conv64_down",!0),m=i(36864,64,3,"conv64_1"),v=i(36864,64,3,"conv64_2"),b=i(36864,64,3,"conv64_3"),y=i(147456,128,3,"conv128_down",!0),w=i(147456,128,3,"conv128_1"),S=i(147456,128,3,"conv128_2"),N=i(589824,256,3,"conv256_down",!0),C=i(589824,256,3,"conv256_1"),T=i(589824,256,3,"conv256_2"),E=i(589824,256,3,"conv256_down_out"),$=Ue(function(){return Bu(Nu(t(256*128),[128,256]),[1,0])});if(s.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var _={conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:d,conv64_down:p,conv64_1:m,conv64_2:v,conv64_3:b,conv128_down:y,conv128_1:w,conv128_2:S,conv256_down:N,conv256_1:C,conv256_2:T,conv256_down_out:E,fc:$};return{params:_,paramMappings:s}}function Zke(n,e){var t=el(n,e);function r(o){var i=t(o+"/scale/weights",1),u=t(o+"/scale/biases",1);return{weights:i,biases:u}}function s(o){var i=t(o+"/conv/filters",4),u=t(o+"/conv/bias",1),l=r(o);return{conv:{filters:i,bias:u},scale:l}}function a(o){return{conv1:s(o+"/conv1"),conv2:s(o+"/conv2")}}return{extractConvLayerParams:s,extractResidualLayerParams:a}}function Qke(n){var e=[],t=Zke(n,e),r=t.extractConvLayerParams,s=t.extractResidualLayerParams,a=r("conv32_down"),o=s("conv32_1"),i=s("conv32_2"),u=s("conv32_3"),l=s("conv64_down"),c=s("conv64_1"),d=s("conv64_2"),p=s("conv64_3"),m=s("conv128_down"),v=s("conv128_1"),b=s("conv128_2"),y=s("conv256_down"),w=s("conv256_1"),S=s("conv256_2"),N=s("conv256_down_out"),C=n.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!oke(C))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+C);var T={conv32_down:a,conv32_1:o,conv32_2:i,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:d,conv64_3:p,conv128_down:m,conv128_1:v,conv128_2:b,conv256_down:y,conv256_1:w,conv256_2:S,conv256_down_out:N,fc:C};return Li(n,e),{params:T,paramMappings:e}}function po(n,e){var t=Kke(n,e.conv1);return t=SW(t,e.conv2),t=At(t,n),t=_n(t),t}function Yy(n,e){var t=CW(n,e.conv1);t=SW(t,e.conv2);var r=iv(n,2,2,"valid"),s=pn(r.shape),a=r.shape[3]!==t.shape[3],o=r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2];if(o){var i=Bp(t.shape);i[1]=1;var u=pn(i);t=hr([t,u],1);var l=Bp(t.shape);l[2]=1;var c=pn(l);t=hr([t,c],2)}return r=a?hr([r,s],3):r,t=At(r,t),t=_n(t),t}var Jke=function(n){gt(e,n);function e(){return n.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return Ue(function(){var s=t.toBatchTensor(150,!0).toFloat(),a=[122.782,117.001,104.298],o=lv(s,a).div(Le(256)),i=CW(o,r.conv32_down);i=kr(i,3,2,"valid"),i=po(i,r.conv32_1),i=po(i,r.conv32_2),i=po(i,r.conv32_3),i=Yy(i,r.conv64_down),i=po(i,r.conv64_1),i=po(i,r.conv64_2),i=po(i,r.conv64_3),i=Yy(i,r.conv128_down),i=po(i,r.conv128_1),i=po(i,r.conv128_2),i=Yy(i,r.conv256_down),i=po(i,r.conv256_1),i=po(i,r.conv256_2),i=Yy(i,r.conv256_down_out);var u=i.mean([1,2]),l=F1(u,r.fc);return l})},e.prototype.forward=function(t){return tt(this,void 0,void 0,function(){var r;return nt(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Ar(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return tt(this,void 0,void 0,function(){var r,s,a,o=this;return nt(this,function(i){switch(i.label){case 0:return[4,Ar(t)];case 1:return r=i.sent(),s=Ue(function(){return dr(o.forwardInput(r))}),[4,Promise.all(s.map(function(u){return u.data()}))];case 2:return a=i.sent(),s.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Qke(t)},e.prototype.extractParams=function(t){return Yke(t)},e}(Mi);function NW(n,e){var t={descriptor:e};return Object.assign({},n,t)}function kW(n,e){var t={age:e};return Object.assign({},n,t)}function TW(n,e,t){var r={gender:e,genderProbability:t};return Object.assign({},n,r)}var IW=function(){function n(e){var t=e===void 0?{}:e,r=t.minFaceSize,s=t.scaleFactor,a=t.maxNumScales,o=t.scoreThresholds,i=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=s||.709,this._maxNumScales=a||10,this._scoreThresholds=o||[.6,.7,.7],this._scaleSteps=i,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n}();function eTe(n,e){function t(u,l){var c=As(n(9*u),[3,3,u,1]),d=Zn(n(u)),p=Zn(n(u)),m=Zn(n(u)),v=Zn(n(u));return e.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:d,batch_norm_offset:p,batch_norm_mean:m,batch_norm_variance:v}}function r(u,l,c,d,p){var m=As(n(u*l*c*c),[c,c,u,l]),v=Zn(n(l));return e.push({paramPath:d+"/filters"},{paramPath:d+"/"+(p?"batch_norm_offset":"bias")}),{filters:m,bias:v}}function s(u,l,c,d){var p=r(u,l,c,d,!0),m=p.filters,v=p.bias;return{filters:m,batch_norm_offset:v}}function a(u,l,c){var d=t(u,c+"/depthwise_conv"),p=s(u,l,1,c+"/pointwise_conv");return{depthwise_conv:d,pointwise_conv:p}}function o(){var u=s(3,32,3,"mobilenetv1/conv_0"),l=a(32,64,"mobilenetv1/conv_1"),c=a(64,128,"mobilenetv1/conv_2"),d=a(128,128,"mobilenetv1/conv_3"),p=a(128,256,"mobilenetv1/conv_4"),m=a(256,256,"mobilenetv1/conv_5"),v=a(256,512,"mobilenetv1/conv_6"),b=a(512,512,"mobilenetv1/conv_7"),y=a(512,512,"mobilenetv1/conv_8"),w=a(512,512,"mobilenetv1/conv_9"),S=a(512,512,"mobilenetv1/conv_10"),N=a(512,512,"mobilenetv1/conv_11"),C=a(512,1024,"mobilenetv1/conv_12"),T=a(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:l,conv_2:c,conv_3:d,conv_4:p,conv_5:m,conv_6:v,conv_7:b,conv_8:y,conv_9:w,conv_10:S,conv_11:N,conv_12:C,conv_13:T}}function i(){var u=s(1024,256,1,"prediction_layer/conv_0"),l=s(256,512,3,"prediction_layer/conv_1"),c=s(512,128,1,"prediction_layer/conv_2"),d=s(128,256,3,"prediction_layer/conv_3"),p=s(256,128,1,"prediction_layer/conv_4"),m=s(128,256,3,"prediction_layer/conv_5"),v=s(256,64,1,"prediction_layer/conv_6"),b=s(64,128,3,"prediction_layer/conv_7"),y=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),w=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),S=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),N=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),C=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),T=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),E=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),$=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),_=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),R=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),D=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),A=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),M={box_encoding_predictor:y,class_predictor:w},H={box_encoding_predictor:S,class_predictor:N},j={box_encoding_predictor:C,class_predictor:T},G={box_encoding_predictor:E,class_predictor:$},P={box_encoding_predictor:_,class_predictor:R},V={box_encoding_predictor:D,class_predictor:A};return{conv_0:u,conv_1:l,conv_2:c,conv_3:d,conv_4:p,conv_5:m,conv_6:v,conv_7:b,box_predictor_0:M,box_predictor_1:H,box_predictor_2:j,box_predictor_3:G,box_predictor_4:P,box_predictor_5:V}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:i}}function tTe(n){var e=[],t=Pi(n),r=t.extractWeights,s=t.getRemainingWeights,a=eTe(r,e),o=a.extractMobilenetV1Params,i=a.extractPredictionLayerParams,u=o(),l=i(),c=RI(r(5118*4),[1,5118,4]),d={extra_dim:c};if(e.push({paramPath:"output_layer/extra_dim"}),s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:d},paramMappings:e}}function nTe(n,e){var t=el(n,e);function r(l,c,d){var p=t(l+"/Conv2d_"+c+"_pointwise/weights",4,d+"/filters"),m=t(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset");return{filters:p,batch_norm_offset:m}}function s(l){var c="mobilenetv1/conv_"+l,d="MobilenetV1/Conv2d_"+l+"_depthwise",p=c+"/depthwise_conv",m=c+"/pointwise_conv",v=t(d+"/depthwise_weights",4,p+"/filters"),b=t(d+"/BatchNorm/gamma",1,p+"/batch_norm_scale"),y=t(d+"/BatchNorm/beta",1,p+"/batch_norm_offset"),w=t(d+"/BatchNorm/moving_mean",1,p+"/batch_norm_mean"),S=t(d+"/BatchNorm/moving_variance",1,p+"/batch_norm_variance");return{depthwise_conv:{filters:v,batch_norm_scale:b,batch_norm_offset:y,batch_norm_mean:w,batch_norm_variance:S},pointwise_conv:r("MobilenetV1",l,m)}}function a(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:s(1),conv_2:s(2),conv_3:s(3),conv_4:s(4),conv_5:s(5),conv_6:s(6),conv_7:s(7),conv_8:s(8),conv_9:s(9),conv_10:s(10),conv_11:s(11),conv_12:s(12),conv_13:s(13)}}function o(l,c){var d=t(l+"/weights",4,c+"/filters"),p=t(l+"/biases",1,c+"/bias");return{filters:d,bias:p}}function i(l){var c=o("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),d=o("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:c,class_predictor:d}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:i(0),box_predictor_1:i(1),box_predictor_2:i(2),box_predictor_3:i(3),box_predictor_4:i(4),box_predictor_5:i(5)}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:u}}function rTe(n){var e=[],t=nTe(n,e),r=t.extractMobilenetV1Params,s=t.extractPredictionLayerParams,a=n["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!B1(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var o={mobilenetv1:r(),prediction_layer:s(),output_layer:{extra_dim:a}};return Li(n,e),{params:o,paramMappings:e}}function mo(n,e,t){return Ue(function(){var r=Fa(n,e.filters,t,"same");return r=At(r,e.batch_norm_offset),VI(r,0,6)})}var sTe=.0010000000474974513;function aTe(n,e,t){return Ue(function(){var r=O1(n,e.filters,t,"same");return r=wU(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,sTe),VI(r,0,6)})}function oTe(n){return[2,4,6,12].some(function(e){return e===n})?[2,2]:[1,1]}function iTe(n,e){return Ue(function(){var t=null,r=mo(n,e.conv_0,[2,2]),s=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(s.forEach(function(a,o){var i=o+1,u=oTe(i);r=aTe(r,a.depthwise_conv,u),r=mo(r,a.pointwise_conv,[1,1]),i===11&&(t=r)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}function uTe(n,e,t,r,s){var a=n.shape[0],o=Math.min(t,a),i=e.map(function(c,d){return{score:c,boxIndex:d}}).filter(function(c){return c.score>s}).sort(function(c,d){return d.score-c.score}),u=function(c){return c<=r?1:0},l=[];return i.forEach(function(c){if(!(l.length>=o)){for(var d=c.score,p=l.length-1;p>=0;--p){var m=lTe(n,c.boxIndex,l[p]);if(m!==0&&(c.score*=u(m),c.score<=s))break}d===c.score&&l.push(c.boxIndex)}}),l}function lTe(n,e,t){var r=n.arraySync(),s=Math.min(r[e][0],r[e][2]),a=Math.min(r[e][1],r[e][3]),o=Math.max(r[e][0],r[e][2]),i=Math.max(r[e][1],r[e][3]),u=Math.min(r[t][0],r[t][2]),l=Math.min(r[t][1],r[t][3]),c=Math.max(r[t][0],r[t][2]),d=Math.max(r[t][1],r[t][3]),p=(o-s)*(i-a),m=(c-u)*(d-l);if(p<=0||m<=0)return 0;var v=Math.max(s,u),b=Math.max(a,l),y=Math.min(o,c),w=Math.min(i,d),S=Math.max(y-v,0)*Math.max(w-b,0);return S/(p+m-S)}function cTe(n){var e=dr(Bu(n,[1,0])),t=[gr(e[2],e[0]),gr(e[3],e[1])],r=[At(e[0],Ga(t[0],Le(2))),At(e[1],Ga(t[1],Le(2)))];return{sizes:t,centers:r}}function hTe(n,e){var t=cTe(n),r=t.sizes,s=t.centers,a=dr(Bu(e,[1,0])),o=Ga(as(wN(Ga(a[2],Le(5))),r[0]),Le(2)),i=At(as(Ga(a[0],Le(10)),r[0]),s[0]),u=Ga(as(wN(Ga(a[3],Le(5))),r[1]),Le(2)),l=At(as(Ga(a[1],Le(10)),r[1]),s[1]);return Bu(ua([gr(i,o),gr(l,u),At(i,o),At(l,u)]),[1,0])}function dTe(n,e,t){return Ue(function(){var r=n.shape[0],s=hTe(ja($h(t.extra_dim,[r,1,1]),[-1,4]),ja(n,[-1,4]));s=ja(s,[r,s.shape[0]/r,4]);var a=vU(Bo(e,[0,0,1],[-1,-1,-1])),o=Bo(a,[0,0,0],[-1,-1,1]);o=ja(o,[r,o.shape[1]]);var i=dr(s),u=dr(o);return{boxes:i,scores:u}})}function xh(n,e){return Ue(function(){var t=n.shape[0],r=ja(Ya(n,e.box_encoding_predictor),[t,-1,1,4]),s=ja(Ya(n,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:r,classPrediction:s}})}function fTe(n,e,t){return Ue(function(){var r=mo(n,t.conv_0,[1,1]),s=mo(r,t.conv_1,[2,2]),a=mo(s,t.conv_2,[1,1]),o=mo(a,t.conv_3,[2,2]),i=mo(o,t.conv_4,[1,1]),u=mo(i,t.conv_5,[2,2]),l=mo(u,t.conv_6,[1,1]),c=mo(l,t.conv_7,[2,2]),d=xh(e,t.box_predictor_0),p=xh(n,t.box_predictor_1),m=xh(s,t.box_predictor_2),v=xh(o,t.box_predictor_3),b=xh(u,t.box_predictor_4),y=xh(c,t.box_predictor_5),w=hr([d.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,v.boxPredictionEncoding,b.boxPredictionEncoding,y.boxPredictionEncoding],1),S=hr([d.classPrediction,p.classPrediction,m.classPrediction,v.classPrediction,b.classPrediction,y.classPrediction],1);return{boxPredictions:w,classPredictions:S}})}var W1=function(){function n(e){var t=e===void 0?{}:e,r=t.minConfidence,s=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=s||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n}(),EW=function(n){gt(e,n);function e(){return n.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return Ue(function(){var s=t.toBatchTensor(512,!1).toFloat(),a=gr(as(s,Le(.007843137718737125)),Le(1)),o=iTe(a,r.mobilenetv1),i=fTe(o.out,o.conv11,r.prediction_layer),u=i.boxPredictions,l=i.classPredictions;return dTe(u,l,r.output_layer)})},e.prototype.forward=function(t){return tt(this,void 0,void 0,function(){var r;return nt(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Ar(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.locateFaces=function(t,r){return r===void 0&&(r={}),tt(this,void 0,void 0,function(){var s,a,o,i,u,l,c,d,p,m,v,b,y,w,S,N,C,T,E,$,_;return nt(this,function(R){switch(R.label){case 0:return s=new W1(r),a=s.maxResults,o=s.minConfidence,[4,Ar(t)];case 1:for(i=R.sent(),u=this.forwardInput(i),l=u.boxes,c=u.scores,d=l[0],p=c[0],m=1;m<l.length;m++)l[m].dispose(),c[m].dispose();return y=(b=Array).from,[4,p.data()];case 2:return v=y.apply(b,[R.sent()]),w=.5,S=uTe(d,v,a,w,o),N=i.getReshapedInputDimensions(0),C=i.inputSize,T=C/N.width,E=C/N.height,$=d.arraySync(),_=S.map(function(D){var A=[Math.max(0,$[D][0]),Math.min(1,$[D][2])].map(function(V){return V*E}),M=A[0],H=A[1],j=[Math.max(0,$[D][1]),Math.min(1,$[D][3])].map(function(V){return V*T}),G=j[0],P=j[1];return new Ho(v[D],new sE(G,M,P-G,H-M),{height:i.getInputHeight(0),width:i.getInputWidth(0)})}),d.dispose(),p.dispose(),[2,_]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return rTe(t)},e.prototype.extractParams=function(t){return tTe(t)},e}(Mi);(function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(EW);var pTe=.4,mTe=[new Ht(.738768,.874946),new Ht(2.42204,2.65704),new Ht(4.30971,7.04493),new Ht(10.246,4.59428),new Ht(12.6868,11.8741)],gTe=[new Ht(1.603231,2.094468),new Ht(6.041143,7.080126),new Ht(2.882459,3.518061),new Ht(4.266906,5.178857),new Ht(9.041765,10.66308)],vTe=[117.001,114.697,97.404],yTe="tiny_yolov2_model",bTe="tiny_yolov2_separable_conv_model",Zy=function(n){return typeof n=="number"};function xTe(n){if(!n)throw new Error("invalid config: "+n);if(typeof n.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!Zy(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(e){return e||{}}).every(function(e){return Zy(e.x)&&Zy(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every(Zy)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}function mE(n){return Ue(function(){var e=as(n,Le(.10000000149011612));return At(_n(gr(n,e)),e)})}function lu(n,e){return Ue(function(){var t=kc(n,[[0,0],[1,1],[1,1],[0,0]]);return t=Fa(t,e.conv.filters,[1,1],"valid"),t=gr(t,e.bn.sub),t=as(t,e.bn.truediv),t=At(t,e.conv.bias),mE(t)})}function cu(n,e){return Ue(function(){var t=kc(n,[[0,0],[1,1],[1,1],[0,0]]);return t=HI(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=At(t,e.bias),mE(t)})}function wTe(n,e){var t=U1(n,e);function r(o,i){var u=Zn(n(o)),l=Zn(n(o));return e.push({paramPath:i+"/sub"},{paramPath:i+"/truediv"}),{sub:u,truediv:l}}function s(o,i,u){var l=t(o,i,3,u+"/conv"),c=r(i,u+"/bn");return{conv:l,bn:c}}var a=hE(n,e);return{extractConvParams:t,extractConvWithBatchNormParams:s,extractSeparableConvParams:a}}function STe(n,e,t,r){var s=Pi(n),a=s.extractWeights,o=s.getRemainingWeights,i=[],u=wTe(a,i),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams,p;if(e.withSeparableConvs){var m=r[0],v=r[1],b=r[2],y=r[3],w=r[4],S=r[5],N=r[6],C=r[7],T=r[8],E=e.isFirstLayerConv2d?l(m,v,3,"conv0"):d(m,v,"conv0"),$=d(v,b,"conv1"),_=d(b,y,"conv2"),R=d(y,w,"conv3"),D=d(w,S,"conv4"),A=d(S,N,"conv5"),M=C?d(N,C,"conv6"):void 0,H=T?d(C,T,"conv7"):void 0,j=l(T||C||N,5*t,1,"conv8");p={conv0:E,conv1:$,conv2:_,conv3:R,conv4:D,conv5:A,conv6:M,conv7:H,conv8:j}}else{var m=r[0],v=r[1],b=r[2],y=r[3],w=r[4],S=r[5],N=r[6],C=r[7],T=r[8],E=c(m,v,"conv0"),$=c(v,b,"conv1"),_=c(b,y,"conv2"),R=c(y,w,"conv3"),D=c(w,S,"conv4"),A=c(S,N,"conv5"),M=c(N,C,"conv6"),H=c(C,T,"conv7"),j=l(T,5*t,1,"conv8");p={conv0:E,conv1:$,conv2:_,conv3:R,conv4:D,conv5:A,conv6:M,conv7:H,conv8:j}}if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:p,paramMappings:i}}function CTe(n,e){var t=el(n,e);function r(i){var u=t(i+"/sub",1),l=t(i+"/truediv",1);return{sub:u,truediv:l}}function s(i){var u=t(i+"/filters",4),l=t(i+"/bias",1);return{filters:u,bias:l}}function a(i){var u=s(i+"/conv"),l=r(i+"/bn");return{conv:u,bn:l}}var o=dE(t);return{extractConvParams:s,extractConvWithBatchNormParams:a,extractSeparableConvParams:o}}function NTe(n,e){var t=[],r=CTe(n,t),s=r.extractConvParams,a=r.extractConvWithBatchNormParams,o=r.extractSeparableConvParams,i;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;i={conv0:e.isFirstLayerConv2d?s("conv0"):o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:u>7?o("conv6"):void 0,conv7:u>8?o("conv7"):void 0,conv8:s("conv8")}}else i={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:s("conv8")};return Li(n,t),{params:i,paramMappings:t}}var D3;(function(n){n[n.XS=224]="XS",n[n.SM=320]="SM",n[n.MD=416]="MD",n[n.LG=608]="LG"})(D3||(D3={}));var gE=function(){function n(e){var t=e===void 0?{}:e,r=t.inputSize,s=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=s||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n}(),_W=function(n){gt(e,n);function e(t){var r=n.call(this,"TinyYolov2")||this;return xTe(t),r._config=t,r}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,r){var s=lu(t,r.conv0);return s=kr(s,[2,2],[2,2],"same"),s=lu(s,r.conv1),s=kr(s,[2,2],[2,2],"same"),s=lu(s,r.conv2),s=kr(s,[2,2],[2,2],"same"),s=lu(s,r.conv3),s=kr(s,[2,2],[2,2],"same"),s=lu(s,r.conv4),s=kr(s,[2,2],[2,2],"same"),s=lu(s,r.conv5),s=kr(s,[2,2],[1,1],"same"),s=lu(s,r.conv6),s=lu(s,r.conv7),Ya(s,r.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,r){var s=this.config.isFirstLayerConv2d?mE(Ya(t,r.conv0,"valid",!1)):cu(t,r.conv0);return s=kr(s,[2,2],[2,2],"same"),s=cu(s,r.conv1),s=kr(s,[2,2],[2,2],"same"),s=cu(s,r.conv2),s=kr(s,[2,2],[2,2],"same"),s=cu(s,r.conv3),s=kr(s,[2,2],[2,2],"same"),s=cu(s,r.conv4),s=kr(s,[2,2],[2,2],"same"),s=cu(s,r.conv5),s=kr(s,[2,2],[1,1],"same"),s=r.conv6?cu(s,r.conv6):s,s=r.conv7?cu(s,r.conv7):s,Ya(s,r.conv8,"valid",!1)},e.prototype.forwardInput=function(t,r){var s=this,a=this.params;if(!a)throw new Error("TinyYolov2 - load model before inference");return Ue(function(){var o=t.toBatchTensor(r,!1).toFloat();return o=s.config.meanRgb?lv(o,s.config.meanRgb):o,o=o.div(Le(256)),s.config.withSeparableConvs?s.runMobilenet(o,a):s.runTinyYolov2(o,a)})},e.prototype.forward=function(t,r){return tt(this,void 0,void 0,function(){var s;return nt(this,function(a){switch(a.label){case 0:return s=this.forwardInput,[4,Ar(t)];case 1:return[4,s.apply(this,[a.sent(),r])];case 2:return[2,a.sent()]}})})},e.prototype.detect=function(t,r){return r===void 0&&(r={}),tt(this,void 0,void 0,function(){var s,a,o,i,u,l,c,d,p,m,v,b,y,w,S=this;return nt(this,function(N){switch(N.label){case 0:return s=new gE(r),a=s.inputSize,o=s.scoreThreshold,[4,Ar(t)];case 1:return i=N.sent(),[4,this.forwardInput(i,a)];case 2:return u=N.sent(),l=Ue(function(){return dr(u)[0].expandDims()}),c={width:i.getInputWidth(0),height:i.getInputHeight(0)},[4,this.extractBoxes(l,i.getReshapedInputDimensions(0),o)];case 3:return d=N.sent(),u.dispose(),l.dispose(),p=d.map(function(C){return C.box}),m=d.map(function(C){return C.score}),v=d.map(function(C){return C.classScore}),b=d.map(function(C){return S.config.classes[C.label]}),y=fm(p.map(function(C){return C.rescale(a)}),m,this.config.iouThreshold,!0),w=y.map(function(C){return new tW(m[C],v[C],b[C],p[C],c)}),[2,w]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return NTe(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,s=r?r.length:void 0;if(s!==7&&s!==8&&s!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+s+" filterSizes in config");return STe(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,r,s){return tt(this,void 0,void 0,function(){var a,o,i,u,l,c,d,p,m,v,b,y,w,S,N,C,T,E,$,_,R,D,A,M,H,j,G,P,V,z=this;return nt(this,function(Y){switch(Y.label){case 0:return a=r.width,o=r.height,i=Math.max(a,o),u=i/a,l=i/o,c=t.shape[1],d=this.config.anchors.length,p=Ue(function(){var L=t.reshape([c,c,d,z.boxEncodingSize]),K=L.slice([0,0,0,0],[c,c,d,4]),J=L.slice([0,0,0,4],[c,c,d,1]),Z=z.withClassScores?Oi(L.slice([0,0,0,5],[c,c,d,z.config.classes.length]),3):Le(0);return[K,J,Z]}),m=p[0],v=p[1],b=p[2],y=[],[4,v.array()];case 1:return w=Y.sent(),[4,m.array()];case 2:S=Y.sent(),N=0,Y.label=3;case 3:if(!(N<c))return[3,12];C=0,Y.label=4;case 4:if(!(C<c))return[3,11];T=0,Y.label=5;case 5:return T<d?(E=rC(w[N][C][T][0]),!s||E>s?($=(C+rC(S[N][C][T][0]))/c*u,_=(N+rC(S[N][C][T][1]))/c*l,R=Math.exp(S[N][C][T][2])*this.config.anchors[T].x/c*u,D=Math.exp(S[N][C][T][3])*this.config.anchors[T].y/c*l,A=$-R/2,M=_-D/2,H={row:N,col:C,anchor:T},this.withClassScores?[4,this.extractPredictedClass(b,H)]:[3,7]):[3,9]):[3,10];case 6:return V=Y.sent(),[3,8];case 7:V={classScore:1,label:0},Y.label=8;case 8:j=V,G=j.classScore,P=j.label,y.push(es({box:new z1(A,M,A+R,M+D),score:E,classScore:E*G,label:P},H)),Y.label=9;case 9:return T++,[3,5];case 10:return C++,[3,4];case 11:return N++,[3,3];case 12:return m.dispose(),v.dispose(),b.dispose(),[2,y]}})})},e.prototype.extractPredictedClass=function(t,r){return tt(this,void 0,void 0,function(){var s,a,o,i;return nt(this,function(u){switch(u.label){case 0:return s=r.row,a=r.col,o=r.anchor,[4,t.array()];case 1:return i=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return i[s][a][o][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(Mi),kTe=function(n){gt(e,n);function e(t){t===void 0&&(t=!0);var r=this,s=Object.assign({},{withSeparableConvs:t,iouThreshold:pTe,classes:["face"]},t?{anchors:gTe,meanRgb:vTe}:{anchors:mTe,withClassScores:!0});return r=n.call(this,s)||this,r}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return tt(this,void 0,void 0,function(){var s;return nt(this,function(a){switch(a.label){case 0:return[4,this.detect(t,r)];case 1:return s=a.sent(),[2,s.map(function(o){return new Ho(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?bTe:yTe},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(_W),TTe=function(n){gt(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e}(gE),cv=function(){function n(){}return n.prototype.then=function(e){return tt(this,void 0,void 0,function(){var t;return nt(this,function(r){switch(r.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return tt(this,void 0,void 0,function(){return nt(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},n}();function G1(n,e,t,r,s){return s===void 0&&(s=function(a){var o=a.alignedRect;return o}),tt(this,void 0,void 0,function(){var a,o,i,u,l;return nt(this,function(c){switch(c.label){case 0:return a=n.map(function(d){return $ke(d)?s(d):d.detection}),i=r,i?[3,5]:e instanceof In?[4,lE(e,a)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,uE(e,a)];case 3:u=c.sent(),c.label=4;case 4:i=u,c.label=5;case 5:return o=i,[4,t(o)];case 6:return l=c.sent(),o.forEach(function(d){return d instanceof In&&d.dispose()}),[2,l]}})})}function vE(n,e,t,r,s){return tt(this,void 0,void 0,function(){var a=this;return nt(this,function(o){return[2,G1([n],e,function(i){return tt(a,void 0,void 0,function(){return nt(this,function(u){return[2,t(i[0])]})})},r,s)]})})}function ITe(n){return Ue(function(){return ua(dr(n,3).reverse(),3)})}var Qy=2,d0=12;function ETe(n,e){var t=U1(n,e),r=cE(n,e);function s(l,c){var d=Zn(n(l));return e.push({paramPath:c}),d}function a(l,c,d){d===void 0&&(d=!1);var p=t(l[0],l[1],3,c+"/conv1"),m=s(l[1],c+"/prelu1_alpha"),v=t(l[1],l[2],3,c+"/conv2"),b=s(l[2],c+"/prelu2_alpha"),y=t(l[2],l[3],d?2:3,c+"/conv3"),w=s(l[3],c+"/prelu3_alpha");return{conv1:p,prelu1_alpha:m,conv2:v,prelu2_alpha:b,conv3:y,prelu3_alpha:w}}function o(){var l=a([3,10,16,32],"pnet"),c=t(32,2,1,"pnet/conv4_1"),d=t(32,4,1,"pnet/conv4_2");return es(es({},l),{conv4_1:c,conv4_2:d})}function i(){var l=a([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),d=s(128,"rnet/prelu4_alpha"),p=r(128,2,"rnet/fc2_1"),m=r(128,4,"rnet/fc2_2");return es(es({},l),{fc1:c,prelu4_alpha:d,fc2_1:p,fc2_2:m})}function u(){var l=a([3,32,64,64],"onet"),c=t(64,128,2,"onet/conv4"),d=s(128,"onet/prelu4_alpha"),p=r(1152,256,"onet/fc1"),m=s(256,"onet/prelu5_alpha"),v=r(256,2,"onet/fc2_1"),b=r(256,4,"onet/fc2_2"),y=r(256,10,"onet/fc2_3");return es(es({},l),{conv4:c,prelu4_alpha:d,fc1:p,prelu5_alpha:m,fc2_1:v,fc2_2:b,fc2_3:y})}return{extractPNetParams:o,extractRNetParams:i,extractONetParams:u}}function _Te(n){var e=Pi(n),t=e.extractWeights,r=e.getRemainingWeights,s=[],a=ETe(t,s),o=a.extractPNetParams,i=a.extractRNetParams,u=a.extractONetParams,l=o(),c=i(),d=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:d},paramMappings:s}}function RTe(n,e){var t=el(n,e);function r(c){var d=t(c+"/weights",4,c+"/filters"),p=t(c+"/bias",1);return{filters:d,bias:p}}function s(c){var d=t(c+"/weights",2),p=t(c+"/bias",1);return{weights:d,bias:p}}function a(c){return t(c,1)}function o(c){var d=r(c+"/conv1"),p=a(c+"/prelu1_alpha"),m=r(c+"/conv2"),v=a(c+"/prelu2_alpha"),b=r(c+"/conv3"),y=a(c+"/prelu3_alpha");return{conv1:d,prelu1_alpha:p,conv2:m,prelu2_alpha:v,conv3:b,prelu3_alpha:y}}function i(){var c=o("pnet"),d=r("pnet/conv4_1"),p=r("pnet/conv4_2");return es(es({},c),{conv4_1:d,conv4_2:p})}function u(){var c=o("rnet"),d=s("rnet/fc1"),p=a("rnet/prelu4_alpha"),m=s("rnet/fc2_1"),v=s("rnet/fc2_2");return es(es({},c),{fc1:d,prelu4_alpha:p,fc2_1:m,fc2_2:v})}function l(){var c=o("onet"),d=r("onet/conv4"),p=a("onet/prelu4_alpha"),m=s("onet/fc1"),v=a("onet/prelu5_alpha"),b=s("onet/fc2_1"),y=s("onet/fc2_2"),w=s("onet/fc2_3");return es(es({},c),{conv4:d,prelu4_alpha:p,fc1:m,prelu5_alpha:v,fc2_1:b,fc2_2:y,fc2_3:w})}return{extractPNetParams:i,extractRNetParams:u,extractONetParams:l}}function ATe(n){var e=[],t=RTe(n,e),r=t.extractPNetParams,s=t.extractRNetParams,a=t.extractONetParams,o=r(),i=s(),u=a();return Li(n,e),{params:{pnet:o,rnet:i,onet:u},paramMappings:e}}function _N(n,e){var t=e[0],r=e[1];return{height:Math.floor(t*n),width:Math.floor(r*n)}}function DTe(n,e,t){for(var r=t[0],s=t[1],a=d0/n,o=[],i=Math.min(r,s)*a,u=0;i>=12;)o.push(a*Math.pow(e,u)),i=i*e,u+=1;return o}var yE=function(n){gt(e,n);function e(t,r,s,a){return n.call(this,{left:t,top:r,right:s,bottom:a},!0)||this}return e}(zu);function RW(n){return Ue(function(){return as(gr(n,Le(127.5)),Le(.0078125))})}function Bh(n,e){return Ue(function(){return At(_n(n),as(e,a0(_n(a0(n)))))})}function bE(n,e,t){return t===void 0&&(t=!1),Ue(function(){var r=Ya(n,e.conv1,"valid");return r=Bh(r,e.prelu1_alpha),r=kr(r,t?[2,2]:[3,3],[2,2],"same"),r=Ya(r,e.conv2,"valid"),r=Bh(r,e.prelu2_alpha),r=t?r:kr(r,[3,3],[2,2],"valid"),r=Ya(r,e.conv3,"valid"),r=Bh(r,e.prelu3_alpha),r})}function $Te(n,e){return Ue(function(){var t=bE(n,e,!0),r=Ya(t,e.conv4_1,"valid"),s=ka(M1(r,3),3),a=Oi(gr(r,s),3),o=Ya(t,e.conv4_2,"valid");return{prob:a,regions:o}})}function OTe(n,e){return Ue(function(){var t=_N(e,n.shape.slice(1)),r=t.height,s=t.width,a=YI.resizeBilinear(n,[r,s]),o=RW(a);return Bu(o,[0,2,1,3])})}function FTe(n,e,t,r){for(var s=[],a=n.arraySync(),o=0;o<n.shape[0];o++)for(var i=0;i<n.shape[1];i++)a[o][i]>=r&&s.push(new Ht(i,o));var u=s.map(function(l){var c=new z1(Math.round((l.y*Qy+1)/t),Math.round((l.x*Qy+1)/t),Math.round((l.y*Qy+d0)/t),Math.round((l.x*Qy+d0)/t)),d=a[l.y][l.x],p=e.arraySync(),m=new yE(p[l.y][l.x][0],p[l.y][l.x][1],p[l.y][l.x][2],p[l.y][l.x][3]);return{cell:c,score:d,region:m}});return u}function MTe(n,e,t,r,s){s.stage1=[];var a=e.map(function(p){return Ue(function(){var m={scale:p},v=OTe(n,p),b=Date.now(),y=$Te(v,r),w=y.prob,S=y.regions;m.pnet=Date.now()-b;var N=dr(dr(w,3)[1])[0],C=dr(S)[0];return{scoresTensor:N,regionsTensor:C,scale:p,statsForScale:m}})}),o=a.map(function(p){var m=p.scoresTensor,v=p.regionsTensor,b=p.scale,y=p.statsForScale,w=FTe(m,v,b,t);if(m.dispose(),v.dispose(),!w.length)return s.stage1.push(y),[];var S=Date.now(),N=fm(w.map(function(C){return C.cell}),w.map(function(C){return C.score}),.5);return y.nms=Date.now()-S,y.numBoxes=N.length,s.stage1.push(y),N.map(function(C){return w[C]})}),i=o.reduce(function(p,m){return p.concat(m)},[]),u=[],l=[];if(i.length>0){var c=Date.now(),d=fm(i.map(function(p){return p.cell}),i.map(function(p){return p.score}),.7);s.stage1_nms=Date.now()-c,l=d.map(function(p){return i[p].score}),u=d.map(function(p){return i[p]}).map(function(p){var m=p.cell,v=p.region;return new z1(m.left+v.left*m.width,m.top+v.top*m.height,m.right+v.right*m.width,m.bottom+v.bottom*m.height).toSquare().round()})}return{boxes:u,scores:l}}function AW(n,e,t){var r=t.width,s=t.height;return tt(this,void 0,void 0,function(){var a,o,i,u=this;return nt(this,function(l){switch(l.label){case 0:return a=uc(n),[4,Promise.all(e.map(function(c){return tt(u,void 0,void 0,function(){var d,p,m,v,b,y,w,S;return nt(this,function(N){return d=c.padAtBorders(n.height,n.width),p=d.y,m=d.ey,v=d.x,b=d.ex,y=v-1,w=p-1,S=a.getImageData(y,w,b-y,m-w),[2,is.isNodejs()?iE(S):createImageBitmap(S)]})})}))];case 1:return o=l.sent(),i=[],o.forEach(function(c){var d=V1({width:r,height:s}),p=uc(d);p.drawImage(c,0,0,r,s);for(var m=p.getImageData(0,0,r,s).data,v=[],b=0;b<m.length;b+=4)v.push(m[b+2]),v.push(m[b+1]),v.push(m[b]);i.push(v)}),[2,i.map(function(c){var d=Ue(function(){var p=Bu(As(c,[1,r,s,3]),[0,2,1,3]).toFloat();return RW(p)});return d})]}})})}function LTe(n,e){return Ue(function(){var t=bE(n,e),r=ja(t,[t.shape[0],e.fc1.weights.shape[0]]),s=No(r,e.fc1),a=Bh(s,e.prelu4_alpha),o=No(a,e.fc2_1),i=ka(M1(o,1),1),u=Oi(gr(o,i),1),l=No(a,e.fc2_2),c=dr(u,1)[1];return{scores:c,regions:l}})}function PTe(n,e,t,r,s){return tt(this,void 0,void 0,function(){var a,o,i,u,l,c,d,p,m,v,b,y,w,S;return nt(this,function(N){switch(N.label){case 0:return a=Date.now(),[4,AW(n,e,{width:24,height:24})];case 1:return o=N.sent(),s.stage2_extractImagePatches=Date.now()-a,a=Date.now(),i=o.map(function(C){var T=LTe(C,r);return C.dispose(),T}),s.stage2_rnet=Date.now()-a,u=i.length>1?hr(i.map(function(C){return C.scores})):i[0].scores,d=(c=Array).from,[4,u.data()];case 2:return l=d.apply(c,[N.sent()]),u.dispose(),p=l.map(function(C,T){return{score:C,idx:T}}).filter(function(C){return C.score>t}).map(function(C){var T=C.idx;return T}),m=p.map(function(C){return e[C]}),v=p.map(function(C){return l[C]}),b=[],y=[],m.length>0&&(a=Date.now(),w=fm(m,v,.7),s.stage2_nms=Date.now()-a,S=w.map(function(C){var T=i[p[C]].regions.arraySync();return new yE(T[0][0],T[0][1],T[0][2],T[0][3])}),y=w.map(function(C){return v[C]}),b=w.map(function(C,T){return m[C].calibrate(S[T])})),i.forEach(function(C){C.regions.dispose(),C.scores.dispose()}),[2,{boxes:b,scores:y}]}})})}function BTe(n,e){return Ue(function(){var t=bE(n,e);t=kr(t,[2,2],[2,2],"same"),t=Ya(t,e.conv4,"valid"),t=Bh(t,e.prelu4_alpha);var r=ja(t,[t.shape[0],e.fc1.weights.shape[0]]),s=No(r,e.fc1),a=Bh(s,e.prelu5_alpha),o=No(a,e.fc2_1),i=ka(M1(o,1),1),u=Oi(gr(o,i),1),l=No(a,e.fc2_2),c=No(a,e.fc2_3),d=dr(u,1)[1];return{scores:d,regions:l,points:c}})}function zTe(n,e,t,r,s){return tt(this,void 0,void 0,function(){var a,o,i,u,l,c,d,p,m,v,b,y,w,S,N;return nt(this,function(C){switch(C.label){case 0:return a=Date.now(),[4,AW(n,e,{width:48,height:48})];case 1:return o=C.sent(),s.stage3_extractImagePatches=Date.now()-a,a=Date.now(),i=o.map(function(T){var E=BTe(T,r);return T.dispose(),E}),s.stage3_onet=Date.now()-a,u=i.length>1?hr(i.map(function(T){return T.scores})):i[0].scores,d=(c=Array).from,[4,u.data()];case 2:return l=d.apply(c,[C.sent()]),u.dispose(),p=l.map(function(T,E){return{score:T,idx:E}}).filter(function(T){return T.score>t}).map(function(T){var E=T.idx;return E}),m=p.map(function(T){var E=i[T].regions.arraySync();return new yE(E[0][0],E[0][1],E[0][2],E[0][3])}),v=p.map(function(T,E){return e[T].calibrate(m[E])}),b=p.map(function(T){return l[T]}),y=[],w=[],S=[],v.length>0&&(a=Date.now(),N=fm(v,b,.7,!1),s.stage3_nms=Date.now()-a,y=N.map(function(T){return v[T]}),w=N.map(function(T){return b[T]}),S=N.map(function(T,E){return Array(5).fill(0).map(function($,_){var R=i[T].points.arraySync();return new Ht(R[0][_]*(y[E].width+1)+y[E].left,R[0][_+5]*(y[E].height+1)+y[E].top)})})),i.forEach(function(T){T.regions.dispose(),T.scores.dispose(),T.points.dispose()}),[2,{boxes:y,scores:w,points:S}]}})})}var VTe=function(n){gt(e,n);function e(){return n.call(this,"Mtcnn")||this}return e.prototype.load=function(t){return tt(this,void 0,void 0,function(){return nt(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.load.call(this,t)]})})},e.prototype.loadFromDisk=function(t){return tt(this,void 0,void 0,function(){return nt(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.loadFromDisk.call(this,t)]})})},e.prototype.forwardInput=function(t,r){return r===void 0&&(r={}),tt(this,void 0,void 0,function(){var s,a,o,i,u,l,c,d,p,m,v,b,y,w,S,N,C,T,E,$,_;return nt(this,function(R){switch(R.label){case 0:if(s=this.params,!s)throw new Error("Mtcnn - load model before inference");if(a=t.canvases[0],!a)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},i=Date.now(),u=Ue(function(){return ITe(ka(nE.fromPixels(a)).toFloat())}),l=function(D){return u.dispose(),o.total=Date.now()-i,D},c=u.shape.slice(1),d=c[0],p=c[1],m=new IW(r),v=m.minFaceSize,b=m.scaleFactor,y=m.maxNumScales,w=m.scoreThresholds,S=m.scaleSteps,N=(S||DTe(v,b,[d,p])).filter(function(D){var A=_N(D,[d,p]);return Math.min(A.width,A.height)>d0}).slice(0,y),o.scales=N,o.pyramid=N.map(function(D){return _N(D,[d,p])}),C=Date.now(),[4,MTe(u,N,w[0],s.pnet,o)];case 1:return T=R.sent(),o.total_stage1=Date.now()-C,T.boxes.length?(o.stage2_numInputBoxes=T.boxes.length,C=Date.now(),[4,PTe(a,T.boxes,w[1],s.rnet,o)]):[2,l({results:[],stats:o})];case 2:return E=R.sent(),o.total_stage2=Date.now()-C,E.boxes.length?(o.stage3_numInputBoxes=E.boxes.length,C=Date.now(),[4,zTe(a,E.boxes,w[2],s.onet,o)]):[2,l({results:[],stats:o})];case 3:return $=R.sent(),o.total_stage3=Date.now()-C,_=$.boxes.map(function(D,A){return fE(aE({},new Ho($.scores[A],new sE(D.left/p,D.top/d,D.width/p,D.height/d),{height:d,width:p})),new gke($.points[A].map(function(M){return M.sub(new Ht(D.left,D.top)).div(new Ht(D.width,D.height))}),{width:D.width,height:D.height}))}),[2,l({results:_,stats:o})]}})})},e.prototype.forward=function(t,r){return r===void 0&&(r={}),tt(this,void 0,void 0,function(){var s;return nt(this,function(a){switch(a.label){case 0:return s=this.forwardInput,[4,Ar(t)];case 1:return[4,s.apply(this,[a.sent(),r])];case 2:return[2,a.sent().results]}})})},e.prototype.forwardWithStats=function(t,r){return r===void 0&&(r={}),tt(this,void 0,void 0,function(){var s;return nt(this,function(a){switch(a.label){case 0:return s=this.forwardInput,[4,Ar(t)];case 1:return[2,s.apply(this,[a.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return ATe(t)},e.prototype.extractParams=function(t){return _Te(t)},e}(Mi),UTe=.4,WTe=[new Ht(1.603231,2.094468),new Ht(6.041143,7.080126),new Ht(2.882459,3.518061),new Ht(4.266906,5.178857),new Ht(9.041765,10.66308)],GTe=[117.001,114.697,97.404],HTe=function(n){gt(e,n);function e(){var t=this,r={withSeparableConvs:!0,iouThreshold:UTe,classes:["face"],anchors:WTe,meanRgb:GTe,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=n.call(this,r)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return tt(this,void 0,void 0,function(){var s;return nt(this,function(a){switch(a.label){case 0:return[4,this.detect(t,r)];case 1:return s=a.sent(),[2,s.map(function(o){return new Ho(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(_W),fs={ssdMobilenetv1:new EW,tinyFaceDetector:new HTe,tinyYolov2:new kTe,mtcnn:new VTe,faceLandmark68Net:new wW,faceLandmark68TinyNet:new jke,faceRecognitionNet:new Jke,faceExpressionNet:new Dke,ageGenderNet:new Uke},DW=function(n){gt(e,n);function e(t,r,s){var a=n.call(this)||this;return a.parentTask=t,a.input=r,a.extractedFaces=s,a}return e}(cv),xE=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return tt(this,void 0,void 0,function(){var t,r,s=this;return nt(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),[4,G1(t,this.input,function(o){return tt(s,void 0,void 0,function(){return nt(this,function(i){switch(i.label){case 0:return[4,Promise.all(o.map(function(u){return fs.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,i.sent()]}})})},this.extractedFaces)];case 2:return r=a.sent(),[2,t.map(function(o,i){return yW(o,r[i])})]}})})},e.prototype.withAgeAndGender=function(){return new NE(this,this.input)},e}(DW),wE=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return tt(this,void 0,void 0,function(){var t,r;return nt(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,vE(t,this.input,function(a){return fs.faceExpressionNet.predictExpressions(a)},this.extractedFaces)]:[2];case 2:return r=s.sent(),[2,yW(t,r)]}})})},e.prototype.withAgeAndGender=function(){return new kE(this,this.input)},e}(DW),SE=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new TE(this,this.input)},e.prototype.withFaceDescriptors=function(){return new EE(this,this.input)},e}(xE),CE=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new IE(this,this.input)},e.prototype.withFaceDescriptor=function(){return new _E(this,this.input)},e}(wE),$W=function(n){gt(e,n);function e(t,r,s){var a=n.call(this)||this;return a.parentTask=t,a.input=r,a.extractedFaces=s,a}return e}(cv),NE=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return tt(this,void 0,void 0,function(){var t,r,s=this;return nt(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),[4,G1(t,this.input,function(o){return tt(s,void 0,void 0,function(){return nt(this,function(i){switch(i.label){case 0:return[4,Promise.all(o.map(function(u){return fs.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,i.sent()]}})})},this.extractedFaces)];case 2:return r=a.sent(),[2,t.map(function(o,i){var u=r[i],l=u.age,c=u.gender,d=u.genderProbability;return kW(TW(o,c,d),l)})]}})})},e.prototype.withFaceExpressions=function(){return new xE(this,this.input)},e}($W),kE=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return tt(this,void 0,void 0,function(){var t,r,s,a,o;return nt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,vE(t,this.input,function(u){return fs.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=i.sent(),s=r.age,a=r.gender,o=r.genderProbability,[2,kW(TW(t,a,o),s)]}})})},e.prototype.withFaceExpressions=function(){return new wE(this,this.input)},e}($W),TE=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new SE(this,this.input)},e.prototype.withFaceDescriptors=function(){return new EE(this,this.input)},e}(NE),IE=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new CE(this,this.input)},e.prototype.withFaceDescriptor=function(){return new _E(this,this.input)},e}(kE),OW=function(n){gt(e,n);function e(t,r){var s=n.call(this)||this;return s.parentTask=t,s.input=r,s}return e}(cv),EE=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return tt(this,void 0,void 0,function(){var t,r;return nt(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),[4,G1(t,this.input,function(a){return Promise.all(a.map(function(o){return fs.faceRecognitionNet.computeFaceDescriptor(o)}))},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=s.sent(),[2,r.map(function(a,o){return NW(t[o],a)})]}})})},e.prototype.withFaceExpressions=function(){return new SE(this,this.input)},e.prototype.withAgeAndGender=function(){return new TE(this,this.input)},e}(OW),_E=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return tt(this,void 0,void 0,function(){var t,r;return nt(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,vE(t,this.input,function(a){return fs.faceRecognitionNet.computeFaceDescriptor(a)},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=s.sent(),[2,NW(t,r)]}})})},e.prototype.withFaceExpressions=function(){return new CE(this,this.input)},e.prototype.withAgeAndGender=function(){return new IE(this,this.input)},e}(OW),FW=function(n){gt(e,n);function e(t,r,s){var a=n.call(this)||this;return a.parentTask=t,a.input=r,a.useTinyLandmarkNet=s,a}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?fs.faceLandmark68TinyNet:fs.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(cv),jTe=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return tt(this,void 0,void 0,function(){var t,r,s,a,o,i=this;return nt(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),r=t.map(function(l){return l.detection}),this.input instanceof In?[4,lE(this.input,r)]:[3,3];case 2:return a=u.sent(),[3,5];case 3:return[4,uE(this.input,r)];case 4:a=u.sent(),u.label=5;case 5:return s=a,[4,Promise.all(s.map(function(l){return i.landmarkNet.detectLandmarks(l)}))];case 6:return o=u.sent(),s.forEach(function(l){return l instanceof In&&l.dispose()}),[2,t.map(function(l,c){return fE(l,o[c])})]}})})},e.prototype.withFaceExpressions=function(){return new SE(this,this.input)},e.prototype.withAgeAndGender=function(){return new TE(this,this.input)},e.prototype.withFaceDescriptors=function(){return new EE(this,this.input)},e}(FW),qTe=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return tt(this,void 0,void 0,function(){var t,r,s,a,o;return nt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?(r=t.detection,this.input instanceof In?[4,lE(this.input,[r])]:[3,3]):[2];case 2:return a=i.sent(),[3,5];case 3:return[4,uE(this.input,[r])];case 4:a=i.sent(),i.label=5;case 5:return s=a,[4,this.landmarkNet.detectLandmarks(s[0])];case 6:return o=i.sent(),s.forEach(function(u){return u instanceof In&&u.dispose()}),[2,fE(t,o)]}})})},e.prototype.withFaceExpressions=function(){return new CE(this,this.input)},e.prototype.withAgeAndGender=function(){return new IE(this,this.input)},e.prototype.withFaceDescriptor=function(){return new _E(this,this.input)},e}(FW),MW=function(n){gt(e,n);function e(t,r){r===void 0&&(r=new W1);var s=n.call(this)||this;return s.input=t,s.options=r,s}return e}(cv),LW=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return tt(this,void 0,void 0,function(){var t,r,s,a;return nt(this,function(o){switch(o.label){case 0:return t=this,r=t.input,s=t.options,s instanceof IW?[4,fs.mtcnn.forward(r,s)]:[3,2];case 1:return[2,o.sent().map(function(i){return i.detection})];case 2:if(a=s instanceof TTe?function(i){return fs.tinyFaceDetector.locateFaces(i,s)}:s instanceof W1?function(i){return fs.ssdMobilenetv1.locateFaces(i,s)}:s instanceof gE?function(i){return fs.tinyYolov2.locateFaces(i,s)}:null,!a)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,a(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return tt(t,void 0,void 0,function(){var s;return nt(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return s=a.sent(),[2,r(s.map(function(o){return aE({},o)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new jTe(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new xE(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new NE(this.runAndExtendWithFaceDetections(),this.input)},e}(MW);(function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return tt(this,void 0,void 0,function(){var t,r;return nt(this,function(s){switch(s.label){case 0:return[4,new LW(this.input,this.options)];case 1:return t=s.sent(),r=t[0],t.forEach(function(a){a.score>r.score&&(r=a)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return tt(t,void 0,void 0,function(){var s;return nt(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return s=a.sent(),[2,r(s?aE({},s):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new qTe(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new wE(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new kE(this.runAndExtendWithFaceDetection(),this.input)},e})(MW);function $3(n,e){return e===void 0&&(e=new W1),new LW(n,e)}function KTe(n,e){if(n.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(n),r=Array.from(e);return Math.sqrt(t.map(function(s,a){return s-r[a]}).reduce(function(s,a){return s+Math.pow(a,2)},0))}var oC=function(){function n(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var s=1,a=function(){return"person "+s++};this._labeledDescriptors=r.map(function(o){if(o instanceof Bl)return o;if(o instanceof Float32Array)return new Bl(a(),[o]);if(o.descriptor&&o.descriptor instanceof Float32Array)return new Bl(a(),[o.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(e,t){return t.map(function(r){return KTe(r,e)}).reduce(function(r,s){return r+s},0)/(t.length||1)},n.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(r){var s=r.descriptors,a=r.label;return new I3(a,t.computeMeanDistance(e,s))}).reduce(function(r,s){return r.distance<s.distance?r:s})},n.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new I3("unknown",t.distance)},n.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},n.fromJSON=function(e){var t=e.labeledDescriptors.map(function(r){return Bl.fromJSON(r)});return new n(t,e.distanceThreshold)},n}();const XTe=()=>{const[n,e]=_e.useState(!0),[t,r]=_e.useState(!1),[s,a]=_e.useState(null),[o,i]=_e.useState([]),[u,l]=_e.useState([]),[c,d]=_e.useState(null),p=_e.useRef(null);_e.useEffect(()=>{(async()=>{try{e(!0),a(null),await Promise.all([fs.ssdMobilenetv1.loadFromUri("/models"),fs.faceLandmark68Net.loadFromUri("/models"),fs.faceRecognitionNet.loadFromUri("/models")]),r(!0),e(!1),console.log("Face recognition models loaded successfully")}catch(N){console.error("Error loading face recognition models:",N),a("Failed to load face recognition models"),e(!1)}})()},[]),_e.useEffect(()=>{t&&(()=>{try{const N=localStorage.getItem("knownFaces");if(N){const C=JSON.parse(N);if(l(C),C.length>0){const T=C.map($=>new Bl($.name,$.descriptors.map(_=>new Float32Array(_)))),E=new oC(T,.6);d(E)}}}catch(N){console.error("Error loading known faces:",N)}})()},[t]);const m=async(S,N)=>{if(!t)throw new Error("Face recognition models are not ready yet. Please wait for models to load.");try{console.log("Starting face detection for:",S);const C=await $3(N).withFaceLandmarks().withFaceDescriptors();if(console.log("Face detections found:",C.length),C.length===0)throw new Error("No face detected in the image. Please use a clear photo with a visible face.");if(C.length>1)throw new Error("Multiple faces detected. Please use an image with only one face.");const T=Array.from(C[0].descriptor);console.log("Face descriptor extracted, length:",T.length);const E=u.findIndex(D=>D.name===S);let $;E>=0?($=[...u],$[E].descriptors.push(T),console.log("Added descriptor to existing person:",S)):($=[...u,{name:S,descriptors:[T]}],console.log("Added new person:",S)),localStorage.setItem("knownFaces",JSON.stringify($)),l($),console.log("Saved to localStorage, total known faces:",$.length);const _=$.map(D=>new Bl(D.name,D.descriptors.map(A=>new Float32Array(A)))),R=new oC(_,.6);return d(R),console.log("Face matcher updated"),!0}catch(C){throw console.error("Error adding known face:",C),C}},v=S=>{const N=u.filter(C=>C.name!==S);if(localStorage.setItem("knownFaces",JSON.stringify(N)),l(N),N.length>0){const C=N.map(E=>new Bl(E.name,E.descriptors.map($=>new Float32Array($)))),T=new oC(C,.6);d(T)}else d(null)},b=async S=>{if(!(!t||!S))try{const C=(await $3(S).withFaceLandmarks().withFaceDescriptors()).map(T=>{let E={label:"Unknown",distance:1};return c&&(E=c.findBestMatch(T.descriptor)),{detection:T.detection,landmarks:T.landmarks,descriptor:T.descriptor,name:E.label,confidence:1-E.distance,isKnown:E.label!=="Unknown"}});i(C)}catch(N){console.error("Error during face detection:",N)}},y=(S,N=100)=>{p.current&&clearInterval(p.current),p.current=setInterval(()=>{b(S)},N)},w=()=>{p.current&&(clearInterval(p.current),p.current=null),i([])};return _e.useEffect(()=>()=>{p.current&&clearInterval(p.current)},[]),{isLoading:n,isReady:t,error:s,faceDetections:o,knownFaces:u,addKnownFace:m,removeKnownFace:v,detectFaces:b,startFaceDetection:y,stopFaceDetection:w}},YTe=()=>{const[n,e]=_e.useState(!1),[t,r]=_e.useState(null),[s,a]=_e.useState([]),[o,i]=_e.useState(null),u=_e.useRef(null),l=_e.useRef(null),c=async()=>{try{const b=(await navigator.mediaDevices.enumerateDevices()).filter(y=>y.kind==="videoinput");a(b),b.length>0&&!o&&i(b[0].deviceId)}catch(v){console.error("Error getting video devices:",v),r("Failed to get video devices")}},d=async(v=o)=>{try{r(null),l.current&&l.current.getTracks().forEach(w=>w.stop());const b={video:{deviceId:v?{exact:v}:void 0,width:{ideal:640},height:{ideal:480}}},y=await navigator.mediaDevices.getUserMedia(b);l.current=y,u.current&&(u.current.srcObject=y,u.current.play(),e(!0))}catch(b){console.error("Error starting webcam:",b),r("Failed to access webcam. Please ensure camera permissions are granted."),e(!1)}},p=()=>{l.current&&(l.current.getTracks().forEach(v=>v.stop()),l.current=null),u.current&&(u.current.srcObject=null),e(!1)},m=async v=>{i(v),n&&await d(v)};return _e.useEffect(()=>{c()},[]),_e.useEffect(()=>()=>{p()},[]),{videoRef:u,isStreaming:n,error:t,devices:s,selectedDeviceId:o,startWebcam:d,stopWebcam:p,switchCamera:m,getVideoDevices:c}},ZTe=({predictions:n,videoWidth:e,videoHeight:t,containerRef:r})=>{if(!n||n.length===0||!(r!=null&&r.current))return null;const s=r.current.getBoundingClientRect(),a=s.width/e,o=s.height/t;return ne.jsx("div",{className:"absolute inset-0 pointer-events-none",children:n.map((i,u)=>{const[l,c,d,p]=i.bbox,m=l*a,v=c*o,b=d*a,y=p*o;return ne.jsxs("div",{children:[ne.jsx("div",{className:"absolute border-2 border-blue-500 bg-blue-500/10",style:{left:`${m}px`,top:`${v}px`,width:`${b}px`,height:`${y}px`}}),ne.jsxs("div",{className:"absolute bg-blue-500 text-white px-2 py-1 text-xs font-medium rounded-md shadow-lg",style:{left:`${m}px`,top:`${v-30}px`,transform:v<30?"translateY(40px)":"none"},children:[i.class," (",Math.round(i.score*100),"%)"]})]},u)})})},QTe=({faceDetections:n,videoWidth:e,videoHeight:t,containerRef:r})=>{if(!n||n.length===0||!(r!=null&&r.current))return null;const s=r.current.getBoundingClientRect(),a=s.width/e,o=s.height/t;return ne.jsx("div",{className:"absolute inset-0 pointer-events-none",children:n.map((i,u)=>{const{x:l,y:c,width:d,height:p}=i.detection.box,m=l*a,v=c*o,b=d*a,y=p*o,w=i.isKnown,S=Math.round(i.confidence*100),N=w?"border-green-500":"border-yellow-500",C=w?"bg-green-500/10":"bg-yellow-500/10",T=w?"bg-green-500":"bg-yellow-500";return ne.jsxs("div",{children:[ne.jsx("div",{className:`absolute border-2 ${N} ${C}`,style:{left:`${m}px`,top:`${v}px`,width:`${b}px`,height:`${y}px`}}),ne.jsxs("div",{className:`absolute ${T} text-white px-2 py-1 text-xs font-medium rounded-md shadow-lg`,style:{left:`${m}px`,top:`${v-30}px`,transform:v<30?"translateY(40px)":"none"},children:[i.name," ",w&&`(${S}%)`]}),i.landmarks&&ne.jsx("div",{className:"absolute",children:i.landmarks.positions.map((E,$)=>ne.jsx("div",{className:"absolute w-1 h-1 bg-blue-400 rounded-full",style:{left:`${E.x*a-2}px`,top:`${E.y*o-2}px`}},$))})]},u)})})},JTe=({videoRef:n,predictions:e,isStreaming:t,faceDetections:r,showFaceRecognition:s=!0})=>{const a=_e.useRef(null),[o,i]=ci.useState({width:640,height:480});return _e.useEffect(()=>{const u=n.current;if(!u)return;const l=()=>{i({width:u.videoWidth,height:u.videoHeight})};return u.addEventListener("loadedmetadata",l),()=>u.removeEventListener("loadedmetadata",l)},[n]),ne.jsx("div",{className:"relative w-full max-w-2xl mx-auto",children:ne.jsxs("div",{ref:a,className:"relative bg-gray-900 rounded-lg overflow-hidden shadow-2xl aspect-video",children:[ne.jsx("video",{ref:n,className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0,muted:!0}),!t&&ne.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-800/80",children:ne.jsxs("div",{className:"text-center text-white",children:[ne.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-700 rounded-full flex items-center justify-center",children:ne.jsx("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20",children:ne.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})})}),ne.jsx("p",{className:"text-lg font-medium",children:"Camera not active"}),ne.jsx("p",{className:"text-sm text-gray-300",children:'Click "Start Camera" to begin detection'})]})}),t&&ne.jsxs(ne.Fragment,{children:[ne.jsx(ZTe,{predictions:e,videoWidth:o.width,videoHeight:o.height,containerRef:a}),s&&ne.jsx(QTe,{faceDetections:r,videoWidth:o.width,videoHeight:o.height,containerRef:a})]})]})})};function eIe({className:n,type:e,...t}){return ne.jsx("input",{type:e,"data-slot":"input",className:ws("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",n),...t})}var tIe="Label",PW=_e.forwardRef((n,e)=>ne.jsx(lc.label,{...n,ref:e,onMouseDown:t=>{var s;t.target.closest("button, input, select, textarea")||((s=n.onMouseDown)==null||s.call(n,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));PW.displayName=tIe;var nIe=PW;function Jy({className:n,...e}){return ne.jsx(nIe,{"data-slot":"label",className:ws("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",n),...e})}const rIe=({knownFaces:n,addKnownFace:e,removeKnownFace:t,isReady:r,videoRef:s,isStreaming:a})=>{const[o,i]=_e.useState(""),[u,l]=_e.useState(!1),[c,d]=_e.useState(null),[p,m]=_e.useState(!1),v=_e.useRef(null);_e.useRef(null);const b=_e.useRef(null),y=async N=>{const C=N.target.files[0];if(C){if(!o.trim()){d({type:"error",text:"Please enter a person's name first"});return}l(!0),d(null);try{const T=new Image;T.onload=async()=>{try{await e(o.trim(),T),d({type:"success",text:`Successfully added ${o.trim()} to known faces!`}),i(""),v.current&&(v.current.value="")}catch(E){d({type:"error",text:E.message})}finally{l(!1)}},T.onerror=()=>{d({type:"error",text:"Failed to load image"}),l(!1)},T.src=URL.createObjectURL(C)}catch{d({type:"error",text:"Error processing image"}),l(!1)}}},w=async()=>{if(!o.trim()){d({type:"error",text:"Please enter a person's name first"});return}if(!a){d({type:"error",text:"Please start the camera first in the Live Detection tab"});return}if(!s.current){d({type:"error",text:"Camera not available"});return}l(!0),d(null);try{const N=b.current,C=s.current,T=N.getContext("2d");N.width=C.videoWidth,N.height=C.videoHeight,T.drawImage(C,0,0);const E=N.toDataURL("image/jpeg"),$=new Image;$.onload=async()=>{try{await e(o.trim(),$),d({type:"success",text:`Successfully captured and added ${o.trim()} to known faces!`}),i(""),m(!1)}catch(_){d({type:"error",text:_.message})}finally{l(!1)}},$.src=E}catch{d({type:"error",text:"Error capturing from camera"}),l(!1)}},S=N=>{t(N),d({type:"success",text:`Removed ${N} from known faces`})};return ne.jsxs(hu,{className:"bg-slate-800/50 border-slate-700",children:[ne.jsxs(du,{children:[ne.jsxs(fu,{className:"text-white flex items-center gap-2",children:[ne.jsx(VD,{className:"w-5 h-5"}),"Face Enrollment"]}),ne.jsx(cC,{className:"text-gray-400",children:"Add people to the recognition system by uploading photos or capturing from camera"})]}),ne.jsxs(pu,{className:"space-y-6",children:[c&&ne.jsxs(Z3,{className:`${c.type==="success"?"bg-green-900/50 border-green-700 text-green-200":"bg-red-900/50 border-red-700 text-red-200"}`,children:[c.type==="success"?ne.jsx(Wj,{className:"h-4 w-4"}):ne.jsx(xF,{className:"h-4 w-4"}),ne.jsx(Q3,{children:c.text})]}),ne.jsxs("div",{className:"space-y-2",children:[ne.jsx(Jy,{htmlFor:"personName",className:"text-white",children:"Person's Name"}),ne.jsx(eIe,{id:"personName",value:o,onChange:N=>i(N.target.value),placeholder:"Enter person's name",className:"bg-slate-700 border-slate-600 text-white placeholder-gray-400",disabled:u})]}),ne.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[ne.jsxs("div",{className:"space-y-3",children:[ne.jsx(Jy,{className:"text-white",children:"Upload Photo"}),ne.jsxs("div",{className:"flex flex-col gap-2",children:[ne.jsx("input",{ref:v,type:"file",accept:"image/*",onChange:y,className:"hidden",disabled:!r||u||!o.trim()}),ne.jsxs(Fp,{onClick:()=>{var N;return(N=v.current)==null?void 0:N.click()},disabled:!r||u,className:"bg-blue-600 hover:bg-blue-700 text-white disabled:bg-gray-600 disabled:cursor-not-allowed",children:[ne.jsx(Xj,{className:"w-4 h-4 mr-2"}),"Choose Image"]}),ne.jsx("p",{className:"text-xs text-gray-400",children:o.trim()?"Upload a clear photo with one face visible":"Enter a name first, then upload a photo"})]})]}),ne.jsxs("div",{className:"space-y-3",children:[ne.jsx(Jy,{className:"text-white",children:"Capture from Camera"}),ne.jsxs("div",{className:"flex flex-col gap-2",children:[ne.jsxs(Fp,{onClick:w,disabled:!r||u,className:"bg-green-600 hover:bg-green-700 text-white disabled:bg-gray-600 disabled:cursor-not-allowed",children:[ne.jsx(dC,{className:"w-4 h-4 mr-2"}),"Capture Now"]}),ne.jsx("p",{className:"text-xs text-gray-400",children:o.trim()?a?"Position face in camera and capture":"Start camera in Live Detection tab first":"Enter a name first"})]})]})]}),ne.jsx("canvas",{ref:b,className:"hidden"}),ne.jsxs("div",{className:"space-y-3",children:[ne.jsxs(Jy,{className:"text-white",children:["Known People (",n.length,")"]}),n.length===0?ne.jsxs("div",{className:"text-center py-6 text-gray-400",children:[ne.jsx(VD,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),ne.jsx("p",{children:"No people enrolled yet"}),ne.jsx("p",{className:"text-sm",children:"Add someone to start face recognition"})]}):ne.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:n.map((N,C)=>ne.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-700/50 rounded-lg",children:[ne.jsxs("div",{className:"flex items-center gap-3",children:[ne.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white font-medium text-sm",children:N.name.charAt(0).toUpperCase()}),ne.jsxs("div",{children:[ne.jsx("div",{className:"font-medium text-white",children:N.name}),ne.jsxs("div",{className:"text-xs text-gray-400",children:[N.descriptors.length," photo",N.descriptors.length!==1?"s":""]})]})]}),ne.jsx(Fp,{onClick:()=>S(N.name),size:"sm",variant:"destructive",className:"h-8 w-8 p-0",children:ne.jsx(qj,{className:"w-4 h-4"})})]},C))})]}),ne.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[ne.jsx("h4",{className:"text-white font-medium mb-2",children:"Tips for best results:"}),ne.jsxs("ul",{className:"text-sm text-gray-300 space-y-1",children:[ne.jsx("li",{children:" Use clear, well-lit photos"}),ne.jsx("li",{children:" Ensure only one face is visible in each photo"}),ne.jsx("li",{children:" Add multiple photos of the same person for better accuracy"}),ne.jsx("li",{children:" Face should be looking towards the camera"})]})]})]})]})};function sIe(){const{model:n,isLoading:e,predictions:t,error:r,startDetection:s,stopDetection:a}=Ixe(),{isLoading:o,isReady:i,error:u,faceDetections:l,knownFaces:c,addKnownFace:d,removeKnownFace:p,startFaceDetection:m,stopFaceDetection:v}=XTe(),{videoRef:b,isStreaming:y,error:w,devices:S,selectedDeviceId:N,startWebcam:C,stopWebcam:T,switchCamera:E}=YTe(),[$,_]=_e.useState(!1),[R,D]=_e.useState("detection"),A=async()=>{await C()},M=()=>{T(),a(),v(),_(!1)},H=()=>{$?(a(),v(),_(!1)):b.current&&n&&i&&(s(b.current),m(b.current),_(!0))};_e.useEffect(()=>{y&&n&&i&&!$&&H()},[y,n,i]);const j=r||u||w,G=n&&!e&&i&&!o,P=t.length+l.filter(V=>V.isKnown).length;return ne.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900",children:ne.jsxs("div",{className:"container mx-auto px-4 py-8",children:[ne.jsxs("div",{className:"text-center mb-8",children:[ne.jsx("h1",{className:"text-4xl md:text-6xl font-bold text-white mb-4 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:"AI Vision System"}),ne.jsx("p",{className:"text-xl text-gray-300 max-w-2xl mx-auto",children:"Real-time object detection and face recognition using TensorFlow.js"})]}),ne.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[ne.jsxs(hu,{className:"bg-slate-800/50 border-slate-700",children:[ne.jsx(du,{className:"pb-3",children:ne.jsxs(fu,{className:"text-white flex items-center gap-2",children:[ne.jsx(BD,{className:"w-5 h-5"}),"Object Detection"]})}),ne.jsx(pu,{children:e?ne.jsxs("div",{className:"flex items-center gap-2 text-yellow-400",children:[ne.jsx(zD,{className:"w-4 h-4 animate-spin"}),"Loading..."]}):ne.jsxs("div",{className:"flex items-center gap-2 text-green-400",children:[ne.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),"Ready"]})})]}),ne.jsxs(hu,{className:"bg-slate-800/50 border-slate-700",children:[ne.jsx(du,{className:"pb-3",children:ne.jsxs(fu,{className:"text-white flex items-center gap-2",children:[ne.jsx(Lj,{className:"w-5 h-5"}),"Face Recognition"]})}),ne.jsx(pu,{children:o?ne.jsxs("div",{className:"flex items-center gap-2 text-yellow-400",children:[ne.jsx(zD,{className:"w-4 h-4 animate-spin"}),"Loading..."]}):ne.jsxs("div",{className:"flex items-center gap-2 text-green-400",children:[ne.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),"Ready (",c.length," people)"]})})]}),ne.jsxs(hu,{className:"bg-slate-800/50 border-slate-700",children:[ne.jsx(du,{className:"pb-3",children:ne.jsxs(fu,{className:"text-white flex items-center gap-2",children:[ne.jsx(dC,{className:"w-5 h-5"}),"Camera Status"]})}),ne.jsx(pu,{children:y?ne.jsxs("div",{className:"flex items-center gap-2 text-green-400",children:[ne.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"Active"]}):ne.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[ne.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"}),"Inactive"]})})]}),ne.jsxs(hu,{className:"bg-slate-800/50 border-slate-700",children:[ne.jsx(du,{className:"pb-3",children:ne.jsx(fu,{className:"text-white",children:"Total Detections"})}),ne.jsxs(pu,{children:[ne.jsx("div",{className:"text-2xl font-bold text-blue-400",children:P}),ne.jsxs("div",{className:"text-xs text-gray-400",children:[t.length," objects, ",l.filter(V=>V.isKnown).length," people"]})]})]})]}),j&&ne.jsxs(Z3,{className:"mb-6 bg-red-900/50 border-red-700 text-red-200",children:[ne.jsx(xF,{className:"h-4 w-4"}),ne.jsx(Q3,{children:j})]}),ne.jsxs(_j,{value:R,onValueChange:D,className:"w-full",children:[ne.jsxs(Rj,{className:"grid w-full grid-cols-2 bg-slate-800/50 border-slate-700",children:[ne.jsx(MD,{value:"detection",className:"data-[state=active]:bg-blue-600",children:"Live Detection"}),ne.jsx(MD,{value:"enrollment",className:"data-[state=active]:bg-blue-600",children:"Face Enrollment"})]}),ne.jsx(LD,{value:"detection",className:"mt-6",children:ne.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[ne.jsx("div",{className:"lg:col-span-2",children:ne.jsxs(hu,{className:"bg-slate-800/50 border-slate-700",children:[ne.jsxs(du,{children:[ne.jsx(fu,{className:"text-white",children:"Live Camera Feed"}),ne.jsx(cC,{className:"text-gray-400",children:"Objects and faces will be detected and highlighted in real-time"})]}),ne.jsxs(pu,{children:[ne.jsx(JTe,{videoRef:b,predictions:t,faceDetections:l,isStreaming:y}),ne.jsxs("div",{className:"flex flex-wrap gap-3 mt-6 justify-center",children:[y?ne.jsxs(Fp,{onClick:M,variant:"destructive",children:[ne.jsx(Bj,{className:"w-4 h-4 mr-2"}),"Stop Camera"]}):ne.jsxs(Fp,{onClick:A,disabled:!G,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[ne.jsx(dC,{className:"w-4 h-4 mr-2"}),"Start Camera"]}),S.length>1&&ne.jsx("select",{value:N||"",onChange:V=>E(V.target.value),className:"px-3 py-2 bg-slate-700 text-white rounded-md border border-slate-600",children:S.map(V=>ne.jsx("option",{value:V.deviceId,children:V.label||`Camera ${V.deviceId.slice(0,8)}`},V.deviceId))})]})]})]})}),ne.jsxs("div",{children:[ne.jsxs(hu,{className:"bg-slate-800/50 border-slate-700",children:[ne.jsxs(du,{children:[ne.jsx(fu,{className:"text-white",children:"Detection Results"}),ne.jsx(cC,{className:"text-gray-400",children:"Objects and people currently visible"})]}),ne.jsx(pu,{children:P===0?ne.jsxs("div",{className:"text-center py-8 text-gray-400",children:[ne.jsx(BD,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),ne.jsx("p",{children:"No detections"}),ne.jsx("p",{className:"text-sm",children:"Point camera at objects or people"})]}):ne.jsxs("div",{className:"space-y-3",children:[l.filter(V=>V.isKnown).map((V,z)=>ne.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-700/20 rounded-lg border border-green-600/30",children:[ne.jsxs("div",{children:[ne.jsxs("div",{className:"font-medium text-white flex items-center gap-2",children:[ne.jsx(UD,{className:"w-4 h-4"}),V.name]}),ne.jsxs("div",{className:"text-sm text-gray-400",children:["Confidence: ",Math.round(V.confidence*100),"%"]})]}),ne.jsx(cS,{variant:"secondary",className:"bg-green-600/20 text-green-300",children:"Person"})]},`face-${z}`)),l.filter(V=>!V.isKnown).map((V,z)=>ne.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-700/20 rounded-lg border border-yellow-600/30",children:[ne.jsxs("div",{children:[ne.jsxs("div",{className:"font-medium text-white flex items-center gap-2",children:[ne.jsx(UD,{className:"w-4 h-4"}),"Unknown Person"]}),ne.jsx("div",{className:"text-sm text-gray-400",children:"Not in database"})]}),ne.jsx(cS,{variant:"secondary",className:"bg-yellow-600/20 text-yellow-300",children:"Unknown"})]},`unknown-${z}`)),t.map((V,z)=>ne.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-700/50 rounded-lg",children:[ne.jsxs("div",{children:[ne.jsx("div",{className:"font-medium text-white capitalize",children:V.class}),ne.jsxs("div",{className:"text-sm text-gray-400",children:["Confidence: ",Math.round(V.score*100),"%"]})]}),ne.jsxs(cS,{variant:"secondary",className:"bg-blue-600/20 text-blue-300",children:[Math.round(V.score*100),"%"]})]},`object-${z}`))]})})]}),ne.jsxs(hu,{className:"bg-slate-800/50 border-slate-700 mt-6",children:[ne.jsx(du,{children:ne.jsx(fu,{className:"text-white",children:"How to Use"})}),ne.jsxs(pu,{className:"text-gray-300 space-y-2",children:[ne.jsxs("div",{className:"flex items-start gap-2",children:[ne.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"1"}),ne.jsx("p",{children:'Click "Start Camera" to activate your webcam'})]}),ne.jsxs("div",{className:"flex items-start gap-2",children:[ne.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"2"}),ne.jsx("p",{children:'Add known people in the "Face Enrollment" tab'})]}),ne.jsxs("div",{className:"flex items-start gap-2",children:[ne.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"3"}),ne.jsx("p",{children:"Watch as objects and people are detected in real-time"})]})]})]})]})]})}),ne.jsx(LD,{value:"enrollment",className:"mt-6",children:ne.jsx("div",{className:"max-w-4xl mx-auto",children:ne.jsx(rIe,{knownFaces:c,addKnownFace:d,removeKnownFace:p,isReady:i,videoRef:b,isStreaming:y})})})]}),ne.jsx("div",{className:"text-center mt-12 text-gray-400",children:ne.jsx("p",{children:"Powered by TensorFlow.js, COCO-SSD, and face-api.js"})})]})})}uH.createRoot(document.getElementById("root")).render(ne.jsx(_e.StrictMode,{children:ne.jsx(sIe,{})}))});export default aIe();
